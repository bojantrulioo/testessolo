(this.webpackJsonpmitekScienceSDK=this.webpackJsonpmitekScienceSDK||[]).push([[6],{115:function(e,t,a){"use strict";function o(e,t){function a(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}function n(e,t,a,o){return new(a||(a=Promise))(function(n,r){function s(e){try{p(o.next(e))}catch(t){r(t)}}function i(e){try{p(o["throw"](e))}catch(t){r(t)}}function p(e){e.done?n(e.value):new a(function(t){t(e.value)}).then(s,i)}p((o=o.apply(e,t||[])).next())})}function r(e,a){function o(e){return function(t){return r([e,t])}}function r(o){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,i&&(p=2&o[0]?i["return"]:o[0]?i["throw"]||((p=i["return"])&&p.call(i),0):i.next)&&!(p=p.call(i,o[1])).done)return p;switch((i=0,p)&&(o=[2&o[0],p.value]),o[0]){case 0:case 1:p=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,i=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if((p=n.trys,!(p=0<p.length&&p[p.length-1]))&&(6===o[0]||2===o[0])){n=0;continue}if(3===o[0]&&(!p||o[1]>p[0]&&o[1]<p[3])){n.label=o[1];break}if(6===o[0]&&n.label<p[1]){n.label=p[1],p=o;break}if(p&&n.label<p[2]){n.label=p[2],n.ops.push(o);break}p[2]&&n.ops.pop(),n.trys.pop();continue;}o=a.call(e,n)}catch(t){o=[6,t],i=0}finally{s=p=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]},s,i,p,d;return d={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d}a.d(t,"c",function(){return o}),a.d(t,"a",function(){return i}),a.d(t,"b",function(){return n}),a.d(t,"d",function(){return r});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},s(e,t)},i=function(){return i=Object.assign||function(e){for(var t=1,a=arguments.length,o;t<a;t++)for(var n in o=arguments[t],o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);return e},i.apply(this,arguments)}},116:function(e,t,a){"use strict";var b=Math.pow,B=Number.NEGATIVE_INFINITY,p=Math.log,o=String.fromCharCode,s=Math.sin,i=Math.cos,d=Math.PI,l=Math.abs,u=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,W=Number.POSITIVE_INFINITY,$=Math.floor,h=Number.isInteger,_=Math.round,pe=Math.ceil,C=Math.sqrt,m=Math.exp,n=Math.tanh,de=Math.max,le=Math.min;a.r(t),function(r,g,e,f){function y(a,e){function t(){this.constructor=a}As(a,e),a.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}function x(p,e,t,n){return new(t||(t=Promise))(function(r,o){function a(t){try{s(n.next(t))}catch(t){o(t)}}function i(t){try{s(n.throw(t))}catch(t){o(t)}}function s(o){o.done?r(o.value):new t(function(e){e(o.value)}).then(a,i)}s((n=n.apply(p,e||[])).next())})}function R(p,e){function t(t){return function(a){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&t[0]?n.return:t[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,t[1])).done)return r;switch(n=0,r&&(t=[2&t[0],r.value]),t[0]){case 0:case 1:r=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,n=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(r=0<(r=s.trys).length&&r[r.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!r||t[1]>r[0]&&t[1]<r[3])){s.label=t[1];break}if(6===t[0]&&s.label<r[1]){s.label=r[1],r=t;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(t);break}r[2]&&s.ops.pop(),s.trys.pop();continue;}t=e.call(p,s)}catch(a){t=[6,a],n=0}finally{i=r=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,a])}}var s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i,n,r,d;return d={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d}function v(a,e){Ps[a]=e}function S(a){a in Ps||(Ps[a]=E(a));var e=Ps[a];return e.isContextLost()?(delete Ps[a],S(a)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Ps[a])}function E(a){if(1!==a&&2!==a)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete Ps[a]},!1),1===a?e.getContext("webgl",Fs)||e.getContext("experimental-webgl",Fs):e.getContext("webgl2",Fs)}function k(){var t=navigator.userAgent||navigator.vendor||window.opera;return /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}function w(a){for(var e=a.length,t=0,o=0;0<e;)o=0|Math.random()*e,t=a[--e],a[e]=a[o],a[o]=t}function I(a,e,t){return de(a,le(e,t))}function N(t){return 0==t%2?t:t+1}function T(a){for(var e=0,t=0;t<a.length;t++)e+=a[t];return e}function D(a,e){var t=Math.random();return e*t+(1-t)*a}function A(a,o){if(!a)throw new Error("string"==typeof o?o:o())}function O(a,e,t){void 0===t&&(t=""),A(L(a,e),function(){return t+" Shapes "+a+" and "+e+" must match"})}function P(t){A(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function F(a,e){if(void 0===e&&(e=[]),null==e&&(e=[]),Array.isArray(a)||ee(a))for(var t=0;t<a.length;++t)F(a[t],e);else e.push(a);return e}function U(a){if(0===a.length)return 1;for(var e=a[0],t=1;t<a.length;t++)e*=a[t];return e}function L(a,e){if(a===e)return!0;if(null==a||null==e)return!1;if(a.length!==e.length)return!1;for(var t=0;t<a.length;t++)if(a[t]!==e[t])return!1;return!0}function M(t){return 0==t%1}function z(a){if(null!=n)return n(a);if(a===1/0)return 1;if(a===-1/0)return-1;var e=m(2*a);return(e-1)/(e+1)}function G(a){var e=pe(C(a));return[e,pe(a/e)]}function V(a,e){return e<=a.length?a:a+" ".repeat(e-a.length)}function H(p,e,t){return void 0===e&&(e=function(){return 0}),new Promise(function(n,r){var o=0,a=function(){if(p())n();else{var i=e(++o);null!=t&&o>=t?r():setTimeout(a,i)}};a()})}function q(s,e){for(var t=1,n=-1,r=0;r<s.length;++r)if(0<=s[r])t*=s[r];else if(-1===s[r]){if(-1!==n)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+r);n=r}else if(0>s[r])throw Error("Shapes can not be < 0. Found "+s[r]+" at dim "+r);if(-1===n){if(0<e&&e!==t)throw Error("Size("+e+") must match the product of shape "+s);return s}if(0===t)throw Error("Cannot infer the missing size in ["+s+"] when there are 0 elements");if(0!=e%t)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=s.slice();return o[n]=e/t,o}function K(a,e){var t=e.length;return A((a=null==a?e.map(function(a,e){return e}):[].concat(a)).every(function(a){return a>=-t&&a<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+a}),A(a.every(function(t){return M(t)}),function(){return"All values in axis param must be integers but got axis "+a}),a.map(function(a){return 0>a?t+a:a})}function j(s,e){for(var t=[],p=[],d=null==e?null:K(e,s).sort(),o=0,a=0;a<s.length;++a){if(null!=d){if(d[o]===a&&1!==s[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+s[a]+"' is not 1");(null==d[o]||d[o]>a)&&1===s[a]&&(t.push(s[a]),p.push(a)),d[o]<=a&&o++}1!==s[a]&&(t.push(s[a]),p.push(a))}return{newShape:t,keptDims:p}}function X(a,e){var t=null;if(null==a||"float32"===a)t=new Float32Array(e);else if("int32"===a)t=new Int32Array(e);else{if("bool"!==a)throw new Error("Unknown data type "+a);t=new Uint8Array(e)}return t}function Y(a,e){var t=null;if(null==a||"float32"===a)t=new Float32Array(e);else if("int32"===a)t=new Int32Array(e);else if("bool"===a)t=new Uint8Array(e);else{if("string"!==a)throw new Error("Unknown data type "+a);t=Array(e)}return t}function Q(a,e,t){if("float32"===e)for(var n=0,r;n<a.length;n++)if(r=a[n],isNaN(r)||!isFinite(r))throw Error("The result of the '"+t+"' is "+r+".")}function Z(a,e){for(var t=0,o;t<a.length;t++)if(o=a[t],isNaN(o)||!isFinite(o))throw Error("A tensor of type "+e+" being uploaded contains "+o+".")}function J(a,e){return"complex64"!==e&&("float32"!==e||"complex64"===a)&&("int32"!==e||"float32"===a||"complex64"===a)&&("bool"!==e||"bool"!==a)}function ee(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function te(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function ae(a){if(null==a)return 0;var o=0;return a.forEach(function(t){return o+=2*t.length}),o}function oe(t){return"string"==typeof t||t instanceof String}function ne(t){return"boolean"==typeof t}function re(t){return"number"==typeof t}function se(t){return Array.isArray(t)?se(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":re(t)?"float32":oe(t)?"string":ne(t)?"bool":"float32"}function ie(t){return!!(t&&t.constructor&&t.call&&t.apply)}function ue(a,e){for(var t=e;t<a;++t)if(0==a%t)return t;return a}function ce(a){var e=a.length;if(2>e)return[];var t=Array(e-1);t[e-2]=a[e-1];for(var o=e-3;0<=o;--o)t[o]=t[o+1]*a[o+1];return t}function he(a,e,t){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(a)&&(a=F(a)),t&&Z(a,e),fe(a,e))return a;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(a);if("int32"===e)return new Int32Array(a);if("bool"===e){for(var n=new Uint8Array(a.length),r=0;r<n.length;++r)0!==_(a[r])&&(n[r]=1);return n}throw new Error("Unknown data type "+e)}function me(p,e,t){var n=[];if(1===e.length)for(var r=e[0],o=0;o<r;o++)n[o]=t[p+o];else{r=e[0];var a=e.slice(1),i=a.reduce(function(a,e){return a*e});for(o=0;o<r;o++)n[o]=me(p+o*i,a,t)}return n}function ge(a,e){if(0===a.length)return e[0];var t=a.reduce(function(a,e){return a*e});if(0===t)return[];if(t!==e.length)throw new Error("["+a+"] does not match the input size.");return me(0,a,e)}function fe(a,e){return a instanceof Float32Array&&"float32"===e||a instanceof Int32Array&&"int32"===e||a instanceof Uint8Array&&"bool"===e}function ye(a,e){for(var t=xe(a,e),o=0;o<t.length;o++)t[o]=1;return t}function xe(a,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(a);if("int32"===e)return new Int32Array(a);if("bool"===e)return new Uint8Array(a);throw new Error("Unknown data type "+e)}function be(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof r){var t=r.hrtime();return 1e3*t[0]+t[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function ve(t){t.forEach(function(e){A(h(e)&&0<=e,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function Ce(p,e,t,n){var r=ce(e),o=Re(p,e,t,r),a=e.length,i=_e(p,e,t,r,o),s=["Tensor"];return n&&(s.push("  dtype: "+t),s.push("  rank: "+a),s.push("  shape: ["+e+"]"),s.push("  values:")),s.push(i.map(function(t){return"    "+t}).join("\n")),s.join("\n")}function Re(d,e,t,n){var r=U(e),o=n[n.length-1],a=Array(o).fill(0),i=e.length,s="complex64"===t?ke(d):d;if(1<i)for(var u=0;u<r/o;u++)for(var c=u*o,l=0;l<o;l++)a[l]=de(a[l],Se(s[c+l],0,t).length);return a}function Se(a,e,t){return V(Array.isArray(a)?parseFloat(a[0].toFixed(zs))+" + "+parseFloat(a[1].toFixed(zs))+"j":oe(a)?"'"+a+"'":"bool"===t?Ee(a):parseFloat(a.toFixed(zs)).toString(),e)}function Ee(t){return 0===t?"false":"true"}function _e(c,e,b,t,n,o){void 0===o&&(o=!0);var a="complex64"===b?2:1,r=e[0],s=e.length;if(0===s)return"complex64"===b?[Se(ke(c)[0],0,b)]:"bool"===b?[Ee(c[0])]:[c[0].toString()];if(1===s){if(r>Ws){var i=Array.from(c.slice(0,Us*a)),l=Array.from(c.slice(r-Us*a,r));return"complex64"===b&&(i=ke(i),l=ke(l)),["["+i.map(function(a,e){return Se(a,n[e],b)}).join(", ")+", ..., "+l.map(function(a,e){return Se(a,n[r-Us+e],b)}).join(", ")+"]"]}return["["+("complex64"===b?ke(c):Array.from(c)).map(function(a,e){return Se(a,n[e],b)}).join(", ")+"]"]}var p=e.slice(1),d=t.slice(1),u=t[0]*a,h=[];if(r>Ws){for(var m=0,g;m<Us;m++)g=(f=m*u)+u,h.push.apply(h,_e(c.slice(f,g),p,b,d,n,!1));for(h.push("..."),m=r-Us;m<r;m++)g=(f=m*u)+u,h.push.apply(h,_e(c.slice(f,g),p,b,d,n,m===r-1))}else for(m=0;m<r;m++){var f;g=(f=m*u)+u,h.push.apply(h,_e(c.slice(f,g),p,b,d,n,m===r-1))}var y=2===s?",":"";for(h[0]="["+h[0]+y,m=1;m<h.length-1;m++)h[m]=" "+h[m]+y;var x=",\n";for(m=2;m<s;m++)x+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":x),h}function ke(a){for(var e=[],t=0;t<a.length;t+=2)e.push([a[t],a[t+1]]);return e}function we(t){Vs=t}function Ie(y,e,t){for(var n={},r={},o=0;o<e.length;o++)n[e[o].id]=!0;for(o=0;o<y.length;o++){var a=(h=y[o]).inputs;for(var i in a){for(var s=a[i],u=!1,c=0;c<e.length;c++)if(n[s.id]){h.outputs.forEach(function(t){return n[t.id]=!0}),u=!0,r[h.id]=!0;break}if(u)break}}var l={};l[t.id]=!0;var p={};for(o=y.length-1;0<=o;o--)for(a=(h=y[o]).inputs,c=0;c<h.outputs.length;c++)if(l[h.outputs[c].id]){for(var i in a)l[a[i].id]=!0,p[h.id]=!0;break}var d=[];for(o=0;o<y.length;o++){var h;if(r[(h=y[o]).id]&&p[h.id]){var f={};for(var i in h.inputs){var m=h.inputs[i];n[m.id]&&(f[i]=m)}var g=Object.assign({},h);g.inputs=f,g.outputs=h.outputs,d.push(g)}}return d}function Ne(p,e,d){for(var t=function(t){var n=e[t],o=[];if(n.outputs.forEach(function(e){var t=p[e.id];if(null!=t)o.push(t);else{var a=$s.make(e.shape,{values:xe(e.size,e.dtype)},e.dtype);o.push(a)}}),null==n.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+n.name+".");var l=n.gradient(1===n.outputs.length?o[0]:o),a=function(e){if(!(e in l))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(l)+".");var t=d(function(){return l[e]()});if("float32"!==t.dtype)throw new Error("Error in gradient for op "+n.name+". The gradient of input "+e+" must have 'float32' dtype, but has '"+t.dtype+"'");var o=n.inputs[e];if(!L(t.shape,o.shape))throw new Error("Error in gradient for op "+n.name+". The gradient of input '"+e+"' has shape '"+t.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==p[o.id])p[o.id]=t;else{var a=p[o.id];p[o.id]=a.add(t),a.dispose()}};for(var r in n.inputs)a(r)},a=e.length-1;0<=a;a--)t(a)}function Te(a,e){if("string"===a||"string"===e){if("string"===a&&"string"===e)return"string";throw new Error("Can not upcast "+a+" with "+e)}return ei[a][e]}function De(t){return Te(t,"int32")}function Ae(a,e){if(a.dtype===e.dtype)return[a,e];var t=Te(a.dtype,e.dtype);return[a.cast(t),e.cast(t)]}function Oe(a,e){A(a.dtype===e.dtype,function(){return"The dtypes of the first("+a.dtype+") and second("+e.dtype+") input must match"})}function Pe(a){var e=[];return Fe(a,e,new Set),e}function Fe(s,e,t){if(null!=s)if(s instanceof $s)e.push(s);else if(Be(s)){var n=s;for(var r in n){var o=n[r];t.has(o)||(t.add(o),Fe(o,e,t))}}}function Be(t){return Array.isArray(t)||"object"==typeof t}function Le(a){var e=ye(U(a),"float32");return $s.make(a,{values:e})}function Me(t){try{if(null!=S(t))return!0}catch(t){return!1}return!1}function We(a){if(null==li){var e=S(a);li=e.getParameter(e.MAX_TEXTURE_SIZE)}return li}function Ue(a){if(null==ui){var e=S(a);ui=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return le(16,ui)}function ze(a){if(0===a)return 0;var e=S(a);return Ke(e,"EXT_disjoint_timer_query_webgl2")&&2===a?2:Ke(e,"EXT_disjoint_timer_query")?1:0}function Ge(a){if(0===a)return!1;var e=S(a);if(1===a){if(!Ke(e,"OES_texture_float"))return!1;}else if(!Ke(e,"EXT_color_buffer_float"))return!1;return je(e,a)}function Ve(a){if(0===a)return!1;var e=S(a);if(1===a){if(!Ke(e,"OES_texture_float"))return!1;if(!Ke(e,"WEBGL_color_buffer_float"))return!1}else if(!Ke(e,"EXT_color_buffer_float"))return!1;return je(e,a)}function He(t){return 2===t&&null!=S(t).fenceSync}function qe(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function $e(){var a={};if("undefined"==typeof window||void 0===window.location||void 0===window.location.search)return a;var e=Xe(window.location.search);if(ri in e){var s={};e[ri].split(",").forEach(function(a){var e=a.split(":"),t=e[0],n=e[1];s[t]=n}),ni.forEach(function(e){e.name in s&&(console.log("Setting feature override from URL "+e.name+": "+s[e.name]),e.type===oi.NUMBER?a[e.name]=+s[e.name]:e.type===oi.BOOLEAN?a[e.name]="true"===s[e.name]:e.type===oi.STRING?a[e.name]=s[e.name]:console.warn("Unknown URL param: "+e.name+"."))})}return a}function Ke(a,e){return null!=a.getExtension(e)}function je(s,e){var t=s.createFramebuffer(),n=s.createTexture();s.bindTexture(s.TEXTURE_2D,n);var r=2===e?s.RGBA32F:s.RGBA;s.texImage2D(s.TEXTURE_2D,0,r,1,1,0,s.RGBA,s.FLOAT,null),s.bindFramebuffer(s.FRAMEBUFFER,t),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0);var o=s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE;return s.bindTexture(s.TEXTURE_2D,null),s.bindFramebuffer(s.FRAMEBUFFER,null),s.deleteTexture(n),s.deleteFramebuffer(t),o}function Xe(a){var e={};return a.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return Ye(e,t[0],t[1]),t.join("=")}),e}function Ye(a,e,t){a[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Qe(){return window.screen.height*window.screen.width*window.devicePixelRatio*si/1024}function Ze(){if(null==ci){var t;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof g)t=g;else{if("undefined"==typeof r)throw new Error("Could not find a global object");t=r}ci=t}return ci}function Je(){hi.set("PROD",!0)}function et(){hi.set("DEBUG",!0)}function tt(){hi.set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function at(t){hi.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ot(a){var e=a;if(ee(a))return[a.length];if(!Array.isArray(a))return[];for(var t=[];Array.isArray(e)||ee(e);)t.push(e.length),e=e[0];return Array.isArray(a)&&hi.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&nt(a,t,[]),t}function nt(a,e,t){if(t=t||[],Array.isArray(a)||ee(a)){A(0<e.length,function(){return"Element arr["+t.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),A(a.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" elements, but has "+a.length+" elements"});for(var n=e.slice(1),r=0;r<a.length;++r)nt(a[r],n,t.concat(r))}else A(0===e.length,function(){return"Element arr["+t.join("][")+"] is a primitive, but should be an array/TypedArray of "+e[0]+" elements"})}function rt(a,e,t,o){if(null!=a&&("numeric"!==a&&a!==e||"numeric"===a&&"string"===e))throw new Error("Argument '"+t+"' passed to '"+o+"' must be "+a+" tensor, but got "+e+" tensor")}function st(p,d,t,n){if(void 0===n&&(n="numeric"),p instanceof $s)return rt(n,p.dtype,d,t),p;var r=se(p);if("string"!==r&&0<=["bool","int32","float32"].indexOf(n)&&(r=n),rt(n,r,d,t),null==p||!ee(p)&&!Array.isArray(p)&&"number"!=typeof p&&"boolean"!=typeof p&&"string"!=typeof p){var o=null==p?"null":p.constructor.name;throw new Error("Argument '"+d+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=ot(p);ee(p)||Array.isArray(p)||(p=[p]);var i="string"===r?F(p):he(p,r,hi.get("DEBUG"));return $s.make(a,{values:i},r)}function it(a,o,t,e){if(void 0===e&&(e="numeric"),!Array.isArray(a))throw new Error("Argument "+o+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return a.map(function(a,e){return st(a,o+"["+e+"]",t)},e)}function pt(t){return A(ie(t),function(){return"The f passed in grad(f) must be a function"}),function(e,a){var s=st(e,"x","tf.grad",null),r=null==a?null:st(a,"dy","tf.grad");return hi.engine.tidy(function(){var e=hi.engine.gradients(function(){return t(s)},[s],r),o=e.value,n=e.grads;return null!=r&&O(o.shape,r.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),mt(n),n[0]})}}function dt(t){return A(ie(t),function(){return"The f passed in grads(f) must be a function"}),function(e,a){A(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var s=it(e,"args","tf.grads",null),r=null==a?null:st(a,"dy","tf.grads");return hi.engine.tidy(function(){var e=hi.engine.gradients(function(){return t.apply(void 0,s)},s,r),o=e.value,n=e.grads;return null!=r&&O(o.shape,r.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),mt(n),n})}}function lt(a){return A(ie(a),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){A(e instanceof $s,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),A(null==t||t instanceof $s,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=hi.engine.gradients(function(){return a(e)},[e],t),r=n.grads,o=n.value;return mt(r),{grad:r[0],value:o}}}function ut(a){return A(ie(a),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){A(Array.isArray(e)&&e.every(function(t){return t instanceof $s}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),A(null==t||t instanceof $s,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var o=hi.engine.gradients(function(){return a.apply(void 0,e)},e,t);return null!=t&&O(o.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),mt(o.grads),o}}function ct(p,e){if(A(ie(p),function(){return"The f passed in variableGrads(f) must be a function"}),A(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof Ks}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),null==e)for(var t in e=[],hi.engine.registeredVariables)e.push(hi.engine.registeredVariables[t]);var n=e.length;A(0<(e=e.filter(function(t){return t.trainable})).length,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+n+" variables is trainable."});var r=hi.engine.gradients(p,e,null,!0),o=r.value,d=r.grads;A(d.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),A(0===o.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+o.rank+" tensor"});var i={};return e.forEach(function(a,e){null!=d[e]&&(i[a.name]=d[e])}),{value:o,grads:i}}function ht(t){return hi.engine.customGrad(t)}function mt(t){if(0<t.filter(function(t){return null==t}).length)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}function gt(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];hi.get("IS_TEST")||console.warn.apply(console,a)}function ft(s,e,t,n){void 0===n&&(n=!0);var r=[];if(n)(r=r.concat(e.slice(0))).push(s[0]/t),r=r.concat(s.slice(1));else{r=r.concat(s[0]);for(var o=e.length,a=0;a<o;++a)r=r.concat([s[a+1]/e[a],e[a]]);r=r.concat(s.slice(o+1))}return r}function yt(s,e,t){void 0===t&&(t=!0);var n=[];if(t){n.push(e);for(var r=e+1;r<s;++r)r<=2*e?(n.push(r),n.push(r-(e+1))):n.push(r)}else{var o=[],a=[];for(r=1;r<s;++r)r>=2*e+1||1==r%2?a.push(r):o.push(r);n.push.apply(n,o),n.push(0),n.push.apply(n,a)}return n}function xt(s,e,t,n){void 0===n&&(n=!0);var r=[];n?r.push(s[0]/t):r.push(s[0]*t);for(var o=1;o<s.length;++o)o<=e.length?n?r.push(e[o-1]*s[o]):r.push(s[o]/e[o-1]):r.push(s[o]);return r}function bt(a,e){for(var t=[0],o=0;o<e;++o)t.push(a[o][0]);return t}function vt(a,e,t){for(var n=a.slice(0,1),r=0;r<t;++r)n.push(a[r+1]-e[r][0]-e[r][1]);return n}function Ct(a,e){for(var t=0;t<a.length;++t)if(a[a.length-t-1]!==e-1-t)return!1;return!0}function Rt(p,e,t){for(var n=p.length+e.length,r=[],o=0,a=0,i=0;i<n;i++)-1===t.indexOf(i)?r.push(p[o++]):r.push(e[a++]);return r}function St(a,e){for(var t=[],n=a.length,r=0;r<n;r++)-1===e.indexOf(r)&&t.push(a[r]);return[t,e.map(function(e){return a[e]})]}function Et(a,e){return Rt(a,e.map(function(){return 1}),e)}function _t(a,e,t){A(Ct(e,t),function(){return a+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function kt(a,e){if(Ct(a,e))return null;for(var t=[],o=0;o<e;++o)-1===a.indexOf(o)&&t.push(o);return a.forEach(function(a){return t.push(a)}),t}function wt(t){return t.map(function(a,e){return[e,a]}).sort(function(a,e){return a[1]-e[1]}).map(function(t){return t[0]})}function It(a,e){for(var t=[],o=e-a;o<e;++o)t.push(o);return t}function Nt(a,s){var i=a[0].length;a.forEach(function(a,e){A(a.length===i,function(){return"Error in concat"+i+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+i+")"})}),A(0<=s&&s<i,function(){return"Error in concat"+i+"D: axis must be between 0 and "+(i-1)+"."});var t=a[0];a.forEach(function(n,e){for(var o=0;o<i;o++)A(o===s||n[o]===t[o],function(){return"Error in concat"+i+"D: Shape of tensors["+e+"] ("+n+") does not match the shape of the rest ("+t+") along the non-concatenated axis "+e+"."})})}function Tt(a,e){for(var t=a[0].slice(),o=1;o<a.length;o++)t[e]+=a[o][e];return t}function Dt(p,e){if(1>p.rank)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+p.rank+".");if(1>e.rank)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>p.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+p.rank);if(0===p.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+p.shape+".");for(var t=e.shape,n=t[t.length-1],r=1,o=0;o<t.length-1;++o)r*=t[o];var a=p.shape,i=t.slice();i.pop();var s=1;for(o=n;o<p.rank;++o)s*=a[o],i.push(a[o]);var d=ce(p.shape).map(function(t){return t/s}).concat([1]).slice(0,n);return[i,r,s,d]}function At(t){return t<=vi?t:ue(t,$(C(t)))}function Ot(s,e,t){var n=1<e.rank?e.shape[e.rank-1]:1,r=1<e.rank?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+s+", sliceDim: "+n+", and batchDim: "+r+".";if(t.rank<r)throw new Error(o+" update.rank < "+r+". ");if(s.length<n+(t.rank-r))throw new Error(o+" Output shape length < "+(n+(t.rank-r)));if(t.rank!==r+s.length-n)throw new Error(o+" update.rank != "+(r+s.length-n));for(var a=0;a<r;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-r;++a)if(t.shape[a+r]!==s[a+n])throw new Error(o+" updates.shape["+(a+r)+"] ("+t.shape[a+r]+") != shape["+(a+r)+"] ("+s[a+r]+")")}function Pt(a,e,t){if(1>e.rank)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(1>a.rank)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+a.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(1>t.length)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(0===t.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===a.size)throw new Error("Updates specified for empty output. updates shape: "+a.shape)}Ot(t,e,a)}function Ft(p,e,t){for(var n=1<e.rank?e.shape[e.rank-1]:1,d=t.length,o=1,l=n;l<d;++l)o*=t[l];var i=1>n?1:n;return{sliceRank:n,numUpdates:e.size/i,sliceSize:o,strides:ce(t.slice(0,n)).concat([1]),outputSize:U(t)}}function Bt(a,e){var t=!1,o;for(a<=vi?(o=a,t=!0):o=ue(a,$(C(a)));!t;)o>e||o===a?t=!0:o=ue(a,o+1);return o}function Lt(s,e,t){for(var n=[],r=s.length,o=0;o<r;o++)o===e?n.push(t):n.push(s[o]);return n}function Mt(p,e,t){for(var n=p.shape[t],d=[],l=1,u=1,c=0;c<t;c++)d.push(p.shape[c]),l*=p.shape[c];for(c=0;c<e.rank;c++)d.push(e.shape[c]);for(c=t+1;c<p.rank;c++)d.push(p.shape[c]),u*=p.shape[c];return{batchSize:l,sliceSize:u,dimSize:n,outputShape:d}}function Wt(a,e,t){A(a.rank===e.length,function(){return"Error in slice"+a.rank+"D: Length of begin "+e+" must match the rank of the array ("+a.rank+")."}),A(a.rank===t.length,function(){return"Error in slice"+a.rank+"D: Length of size "+t+" must match the rank of the array ("+a.rank+")."});for(var n=function(o){A(e[o]+t[o]<=a.shape[o],function(){return"Error in slice"+a.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+a.shape[o]+")"})},r=0;r<a.rank;++r)n(r)}function Ut(m,e,t,g,n,o,a,r,s){if(void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===s&&(s=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==r)throw new Error("new axis mask is not yet supported");for(var i=[],u=[],l=[],p=0;p<m.length;p++)i[p]=zt(n,e,g,m,p),u[p]=Gt(o,t,g,m,p),s&1<<p&&(u[p]=i[p]+1,l.push(p));var d=Array(m.length).fill(0);return d=d.map(function(r,e){for(var t=0,n=g[e]||1,o=i[e];0<n?!(o>=u[e]):!(o<=u[e]);o+=n)t+=1;return t}),[i,d,l]}function zt(p,e,t,n,r){var o=e[r],a=t[r]||1;(p&1<<r||null==o)&&(o=0<a?c:u);var i=n[r];return 0>o&&(o+=i),o=I(0,o,i-1)}function Gt(p,e,t,n,r){var o=e[r],a=t[r]||1;(p&1<<r||null==o)&&(o=0<a?u:c);var i=n[r];return 0>o&&(o+=i),o=0<a?I(0,o,i):I(-1,o,i-1)}function Vt(a,e,t){for(var n=t.length,r=0;r<t.length;r++)if(1<t[r]){n=r;break}for(r=n+1;r<t.length;r++)if(0<e[r]||t[r]!==a[r])return!1;return!0}function Ht(a,e){for(var t=0<a.length?a[a.length-1]:1,o=0;o<a.length-1;o++)t+=a[o]*e[o];return t}function qt(a){var e=Object.keys(a);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var s=e[0],t=a[s];s.endsWith("_")&&(s=s.substring(0,s.length-1));var r=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];hi.engine.startScope(s);try{var n=t.apply(void 0,a);return n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),hi.engine.endScope(n),n}catch(t){throw hi.engine.endScope(null),t}};return Object.defineProperty(r,"name",{value:s,configurable:!0}),r}function $t(p,d,t){if(null==t&&(t=se(p)),"complex64"===t)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ee(p)&&!Array.isArray(p)&&"number"!=typeof p&&"boolean"!=typeof p&&"string"!=typeof p)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var n=ot(p);if(null!=d){ve(d);var r=U(d),o=U(n);A(r===o,function(){return"Based on the provided shape, ["+d+"], the tensor should have "+r+" values but has "+o});for(var a=0;a<n.length;++a){var i=n[a],s=a!==n.length-1||i!==U(d.slice(a));A(n[a]===d[a]||!s,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+d+"). "})}}return ee(p)||Array.isArray(p)||(p=[p]),d=d||n,p="string"===t?F(p):he(p,t,hi.get("DEBUG")),$s.make(d,{values:p},t)}function Kt(a,e){if((ee(a)||Array.isArray(a))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return $t(a,[],e)}function jt(a,e){P(a);var t=ot(a);if(1!==t.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return $t(a,t,e)}function Xt(a,e,t){if(P(a),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var o=ot(a);if(2!==o.length&&1!==o.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return $t(a,e=e||o,t)}function Yt(a,e,t){if(P(a),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var o=ot(a);if(3!==o.length&&1!==o.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return $t(a,e=e||o,t)}function Qt(a,e,t){if(P(a),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var o=ot(a);if(4!==o.length&&1!==o.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return $t(a,e=e||o,t)}function Zt(a,e,t){if(P(a),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var o=ot(a);if(5!==o.length&&1!==o.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return $t(a,e=e||o,t)}function Jt(a,e,t){if(P(a),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var o=ot(a);if(6!==o.length&&1!==o.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return $t(a,e=e||o,t)}function ea(a,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=ea(a,"float32"),n=ea(a,"float32");return Si(t,n)}var r=ye(U(a),e);return $s.make(a,{values:r},e)}function ta(a,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=ta(a,"float32"),n=ta(a,"float32");return Si(t,n)}var r=xe(U(a),e);return $s.make(a,{values:r},e)}function aa(a,e,t){return hi.engine.runKernel(function(o){return o.fill(a,e,t)},{})}function oa(r,e,t){if(0===t)throw new Error("Cannot request zero samples");var n=xe(t,"float32");n[0]=r;for(var o=1;o<n.length;o++)n[o]=n[o-1]+(e-r)/(t-1);return jt(n,"float32")}function na(s,e,t,n){if(void 0===t&&(t=1),void 0===n&&(n="float32"),0===t)throw new Error("Cannot have a step of zero");if(s===e||s<e&&0>t||e<s&&1<t)return ta([0],n);var r=xe(l(pe((e-s)/t)),n);e<s&&1===t&&(t=-1),r[0]=s;for(var o=1;o<r.length;o++)r[o]=r[o-1]+t;return jt(r,n)}function ra(p,e,t){if("complex64"===e){if("complex64"===p.dtype)return p.clone();var n=ta(p.shape),r=p.toFloat(),o=t.complex(r,n);return n.dispose(),r.dispose(),o}if(!J(p.dtype,e))return $s.make(p.shape,{dataId:p.dataId},e);if("complex64"===p.dtype){var a=t.real(p);return o=a.cast(e),a.dispose(),o}if("int32"===e)return t.int(p);if("bool"===e){var i=Kt(0,p.dtype);return o=t.notEqual(p,i),i.dispose(),o}throw new Error("Error in Cast: unknown dtype argument ("+e+")")}function sa(a,e){return $s.make(e,{dataId:a.dataId},a.dtype)}function ia(a,e){if(a.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+a.length+", imag: "+e.length+".");for(var t=new Float32Array(2*a.length),o=0;o<t.length;o+=2)t[o]=a[o/2],t[o+1]=e[o/2];return t}function pa(a){for(var e=new Float32Array(a.length/2),o=new Float32Array(a.length/2),s=0;s<a.length;s+=2)e[s/2]=a[s],o[s/2]=a[s+1];return{real:e,imag:o}}function da(a){for(var e=pe(a.length/4),t=new Float32Array(e),s=new Float32Array(e),i=0;i<a.length;i+=4)t[$(i/4)]=a[i],s[$(i/4)]=a[i+1];return{real:t,imag:s}}function la(a){for(var e=$(a.length/4),t=new Float32Array(e),s=new Float32Array(e),i=2;i<a.length;i+=4)t[$(i/4)]=a[i],s[$(i/4)]=a[i+1];return{real:t,imag:s}}function ua(a,e){return{real:a[2*e],imag:a[2*e+1]}}function ca(a,e,t,o){a[2*o]=e,a[2*o+1]=t}function ha(p,e){for(var t=new Float32Array(p/2),l=new Float32Array(p/2),u=0,o;u<pe(p/2);u++)o=(e?2:-2)*d*(u/p),t[u]=i(o),l[u]=s(o);return{real:t,imag:l}}function ma(a,e,t){var o=(t?2:-2)*d*(a/e);return{real:i(o),imag:s(o)}}function ga(h,e,t,n,r){for(var o=Array.from(e).map(function(a,o){return{score:a,boxIndex:o}}).filter(function(t){return t.score>r}).sort(function(a,e){return e.score-a.score}),a=[],i=0;i<o.length;i++){var s=o[i],u=s.score,c=s.boxIndex;if(u<r)break;for(var l=!1,m=a.length-1;0<=m;--m)if(fa(h,c,a[m])>=n){l=!0;break}if(!l&&(a.push(c),a.length>=t))break}return jt(a,"int32")}function fa(b,e,t){var n=b.subarray(4*e,4*e+4),r=b.subarray(4*t,4*t+4),o=le(n[0],n[2]),a=le(n[1],n[3]),i=de(n[0],n[2]),s=de(n[1],n[3]),u=le(r[0],r[2]),c=le(r[1],r[3]),l=de(r[0],r[2]),p=de(r[1],r[3]),d=(i-o)*(s-a),h=(l-u)*(p-c);if(0>=d||0>=h)return 0;var f=de(o,u),m=de(a,c),g=le(i,l),v=le(s,p),y=de(g-f,0)*de(v-m,0);return y/(d+h-y)}function ya(s,e,i){var n=Array(s.rank).fill(0),r=s.shape.slice();return e.map(function(e){r[i]=e;var t=s.slice(n,r);return n[i]+=e,t})}function xa(o,e,t,n){for(var r=e[e.length-1],a=[o.length/r,r],i=a[0],s=a[1],u=X(t,i*n),c=X("int32",i*n),l=0;l<i;l++){for(var p=l*s,d=o.subarray(p,p+s),h=[],f=0;f<d.length;f++)h.push({value:d[f],index:f});h.sort(function(a,e){return e.value-a.value});var b=l*n,g=u.subarray(b,b+n),v=c.subarray(b,b+n);for(f=0;f<n;f++)g[f]=h[f].value,v[f]=h[f].index}var y=e.slice();return y[y.length-1]=n,[$t(u,y,t),$t(c,y,"int32")]}function ba(a,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return a+"."+e})}function va(a,e){return 1===e?[a]:ba(a,e)}function Ca(a,e){if(1===a)return"rc";for(var t="",o=0;o<a;o++)t+=e[o],o<a-1&&(t+=",");return t}function Ra(s,e){for(var t=s.length,n=[],r=0;r<t;r++){var o=t-1-r,a=s[o]||1;1<(e[e.length-1-r]||1)&&1===a&&n.unshift(o)}return n}function Sa(s,e){for(var t=[],n=0;n<e.length;n++){var r=s[s.length-n-1],o=e.length-n-1,a=e[o];(null==r||1===r&&1<a)&&t.unshift(o)}return t}function Ea(s,e){for(var t=[],n=de(s.length,e.length),r=0,o;r<n;r++){o=s[s.length-r-1],null==o&&(o=1);var a=e[e.length-r-1];if(null==a&&(a=1),1==o)t.unshift(a);else if(1===a)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+s+" and "+e+".");t.unshift(o)}}return t}function _a(){var p,d,l,h,m,g,f,y,x,b;return 2===hi.get("WEBGL_VERSION")?(p="#version 300 es",d="in",l="out",h="in",m="texture",g="outputColor",f="out vec4 outputColor;",y="\n      const float NAN = uintBitsToFloat(uint(0x7fc00000));\n    ",x="\n      const float INFINITY = uintBitsToFloat(uint(0x7f800000));\n    ",b="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(p="",d="attribute",l="varying",h="varying",m="texture2D",g="gl_FragColor",f="",y="\n      uniform float NAN;\n\n      bool isnan(float val) {\n        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n      }\n      bvec4 isnan(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",x="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",b="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:p,attribute:d,varyingVs:l,varyingFs:h,texture2D:m,output:g,defineOutput:f,defineSpecialNaN:y,defineSpecialInf:x,defineRound:b}}function ka(a,e,s){void 0===s&&(s="index");var n=ce(e);return n.map(function(e,t){return"int "+a[t]+" = "+s+" / "+e+"; "+(t===n.length-1?"int "+a[t+1]+" = "+s+" - "+a[t]+" * "+e:"index -= "+a[t]+" * "+e)+";"}).join("")}function wa(t){return 1===t.length?""+t[0]:"vec"+t.length+"("+t.join(",")+")"}function Ia(p,e){if(p.length!==e.length)throw new Error("Vectors to be dotted must be of the same length -got "+p.length+" and "+e.length);for(var t=[],n=$(p.length/4),r=p.length%4,o=0;o<n;o++){var a=p.slice(4*o,4*o+4),i=e.slice(4*o,4*o+4);t.push(wa(a)+", "+wa(i))}return 0!=r&&(a=p.slice(4*n),i=e.slice(4*n),1===a.length&&(a=a.map(function(t){return"float("+t+")"}),i=i.map(function(t){return"float("+t+")"})),t.push(wa(a)+", "+wa(i))),t.map(function(t){return"dot("+t+")"}).join("+")}function Na(h,m,e,t){var n=[];h.forEach(function(a){var e=U(a.shapeInfo.logicalShape);a.shapeInfo.isUniform?n.push("uniform float "+a.name+(1<e?"["+e+"]":"")+";"):(n.push("uniform sampler2D "+a.name+";"),n.push("uniform int offset"+a.name+";"))});var o=n.join("\n"),r=h.map(function(a){return Aa(a,m,t)}).join("\n"),s=m.texShape,u=_a(),l=Fa(u),p=Ma(u),d,a;return m.isPacked?(d=Oa(m.logicalShape,s),a=La(u)):(d=Pa(m.logicalShape,s),a=Ba(u)),t&&(p+=Pi),[p,l,a,o,d,r,e].join("\n")}function Ta(a){var e=a.shapeInfo.logicalShape;switch(e.length){case 0:return Za(a);case 1:return eo(a);case 2:return ao(a);case 3:return no(a);case 4:return so(a);case 5:return po(a);case 6:return lo(a);default:throw new Error(e.length+"-D input sampling is not yet supported");}}function Da(t){switch(t.shapeInfo.logicalShape.length){case 0:return Qa(t);case 1:return Ja(t);case 2:return to(t);case 3:return oo(t);default:return ro(t);}}function Aa(s,e,t){void 0===t&&(t=!1);var n="";n+=t?Da(s):Ta(s);var r=s.shapeInfo.logicalShape,o=e.logicalShape;return r.length<=o.length&&(n+=t?co(s,e):ho(s,e)),n}function Oa(a,e){switch(a.length){case 0:return Wa();case 1:return Ua(a,e);case 2:return ja(a,e);case 3:return Ga(a,e);default:return Ha(a,e);}}function Pa(a,e){switch(a.length){case 0:return Wa();case 1:return za(a,e);case 2:return Xa(a,e);case 3:return Va(a,e);case 4:return qa(a,e);case 5:return $a(a,e);case 6:return Ka(a,e);default:throw new Error(a.length+"-D output sampling is not yet supported");}}function Fa(t){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+t.texture2D+"(textureSampler, uv).r;\n    }\n  "}function Ba(t){return"\n    void setOutput(float val) {\n      "+t.output+" = vec4(val, 0, 0, 0);\n    }\n  "}function La(t){return"\n    void setOutput(vec4 val) {\n      "+t.output+" = val;\n    }\n  "}function Ma(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Di+"\n    "+Ai+"\n    "+Oi+"\n  "}function Wa(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function Ua(a,e){var t=[pe(e[0]/2),pe(e[1]/2)];return 1===t[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}function za(a,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}function Ga(a,e){var t=[pe(e[0]/2),pe(e[1]/2)],n=pe(a[2]/2),r=n*pe(a[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      int b = index / "+r+";\n      index -= b * "+r+";\n\n      int r = 2 * (index / "+n+");\n      int c = imod(index, "+n+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}function Va(a,e){var t=ka(["r","c","d"],a);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+t+"\n      return ivec3(r, c, d);\n    }\n  "}function Ha(p,e){for(var t=[pe(e[0]/2),pe(e[1]/2)],n=pe(p[p.length-1]/2),r=n*pe(p[p.length-2]/2),o=r,a="",i="b, r, c",s=2;s<p.length-1;s++)a="\n      int b"+s+" = index / "+(o*=p[p.length-s-1])+";\n      index -= b"+s+" * "+o+";\n    "+a,i="b"+s+", "+i;return"\n    ivec"+p.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+r+";\n      index -= b * "+r+";\n\n      int r = 2 * (index / "+n+");\n      int c = imod(index, "+n+") * 2;\n\n      return ivec"+p.length+"("+i+");\n    }\n  "}function qa(a,e){var t=ka(["r","c","d","d2"],a);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+t+"\n      return ivec4(r, c, d, d2);\n    }\n  "}function $a(a,e){var t=ka(["r","c","d","d2","d3"],a);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+t+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}function Ka(a,e){var t=ka(["r","c","d","d2","d3","d4"],a);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+t+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}function ja(a,e){var t=[pe(e[0]/2),pe(e[1]/2)];if(L(a,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ";var o=pe(a[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = 2 * (index / "+o+");\n      int c = imod(index, "+o+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}function Xa(a,e){return L(a,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===a[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===a[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+a[1]+";\n      int c = index - r * "+a[1]+";\n      return ivec2(r, c);\n    }\n  "}function Ya(t){return"offset"+t}function Qa(a){var e=a.name;return"\n    vec4 get"+e.charAt(0).toUpperCase()+e.slice(1)+"() {\n      return "+_a().texture2D+"("+e+", halfCR);\n    }\n  "}function Za(s){var e=s.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);if(s.shapeInfo.isUniform)return"float "+t+"() {return "+e+";}";var n=s.shapeInfo.texShape,r=n[0],o=n[1];if(1===r&&1===o)return"\n      float "+t+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=s.shapeInfo.texShape;return"\n    float "+t+"() {\n      vec2 uv = uvFromFlat("+a[0]+", "+a[1]+", "+Ya(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}function Ja(s){var e=s.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=s.shapeInfo.texShape,r=[pe(n[0]/2),pe(n[1]/2)],o=_a();return"\n    vec4 "+t+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+r[0]+", "+r[1]+", index);\n      return "+o.texture2D+"("+e+", uv);\n    }\n  "}function eo(s){var e=s.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);if(s.shapeInfo.isUniform)return"\n      float "+t+"(int index) {\n        "+uo(s)+"\n      }\n    ";var n=s.shapeInfo.texShape,r=n[0],o=n[1];if(1===o&&1===r)return"\n      float "+t+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=Ya(e);return 1===o?"\n      float "+t+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+r+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===r?"\n      float "+t+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+o+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+t+"(int index) {\n      vec2 uv = uvFromFlat("+r+", "+o+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}function to(p){var e=p.shapeInfo.logicalShape,t=p.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=p.shapeInfo.texShape,o=r[0],a=r[1],i=_a();if(null!=r&&L(e,r))return"\n      vec4 "+n+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+o+".0);\n\n        return "+i.texture2D+"("+t+", uv);\n      }\n    ";var s=[pe(r[0]/2),pe(r[1]/2)];return"\n    vec4 "+n+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+pe(e[1]/2)+", "+s[0]+", "+s[1]+", row, col);\n      return "+i.texture2D+"("+t+", uv);\n    }\n  "}function ao(h){var e=h.shapeInfo.logicalShape,t=h.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=h.shapeInfo.texShape;if(null!=r&&L(e,r)){var o=r[0];return"\n    float "+n+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+r[1]+".0, "+o+".0);\n      return sampleTexture("+t+", uv);\n    }\n  "}var a=j(e),i=a.newShape,s=a.keptDims,u=i;if(u.length<e.length)return"\n      "+Ta(go(h,u))+"\n      float "+n+"(int row, int col) {\n        return "+n+"("+fo(["row","col"],s)+");\n      }\n    ";if(h.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+e[1]+", 1)));\n        "+uo(h)+"\n      }\n    ";var c=r[0],l=r[1],p=Ya(t);return 1===l?"\n    float "+n+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ":1===c?"\n    float "+n+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+l+".0, 0.5);\n      return sampleTexture("+t+", uv);\n    }\n  ":"\n  float "+n+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+e[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+c+", "+l+", index);\n    return sampleTexture("+t+", uv);\n  }\n"}function oo(p){var e=p.shapeInfo.logicalShape,t=p.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=p.shapeInfo.texShape,o=[pe(r[0]/2),pe(r[1]/2)];if(1===e[0])return"\n        "+Da(go(p,e.slice(1)))+"\n        vec4 "+n+"(int b, int row, int col) {\n          return "+n+"("+fo(["b","row","col"],[1,2])+");\n        }\n      ";var a=o[0],i=o[1],s=pe(e[2]/2);return"\n    vec4 "+n+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+a+", "+i+", "+s*pe(e[1]/2)+", "+s+", b, row, col);\n      return "+_a().texture2D+"("+t+", uv);\n    }\n  "}function no(m){var e=m.shapeInfo.logicalShape,t=m.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[1]*e[2],o=e[2],a=j(e),i=a.newShape,s=a.keptDims,u=i;if(u.length<e.length)return"\n        "+Ta(go(m,u))+"\n        float "+n+"(int row, int col, int depth) {\n          return "+n+"("+fo(["row","col","depth"],s)+");\n        }\n      ";if(m.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+r+", "+o+", 1)));\n        "+uo(m)+"\n      }\n    ";var c=m.shapeInfo.texShape,l=c[0],p=c[1],d=m.shapeInfo.flatOffset;return p===r&&null==d?"\n        float "+n+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+o+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+l+".0);\n          return sampleTexture("+t+", uv);\n        }\n      ":p===o&&null==d?"\n    float "+n+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+e[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+l+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ":"\n      float "+n+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+r+" + col * "+o+" + depth + "+Ya(t)+";\n        vec2 uv = uvFromFlat("+l+", "+p+", index);\n        return sampleTexture("+t+", uv);\n      }\n  "}function ro(m){for(var e=m.shapeInfo.logicalShape,t=e.length,n=m.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=m.shapeInfo.texShape,a=[pe(o[0]/2),pe(o[1]/2)],i=a[0],s=a[1],u=pe(e[t-1]/2),c=u*pe(e[t-2]/2),l="int b, int row, int col",p="b * "+c+" + (row / 2) * "+u+" + (col / 2)",d=2;d<t-1;d++)l="int b"+d+", "+l,p="b"+d+" * "+(c*=e[t-d-1])+" + "+p;return"\n    vec4 "+r+"("+l+") {\n      int index = "+p+";\n      int texR = index / "+s+";\n      int texC = index - texR * "+s+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+s+", "+i+");\n      return "+_a().texture2D+"("+n+", uv);\n    }\n  "}function so(m){var e=m.shapeInfo.logicalShape,t=m.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[3],o=e[2]*r,a=e[1]*o,i=j(e),s=i.newShape,u=i.keptDims;if(s.length<e.length)return"\n      "+Ta(go(m,s))+"\n      float "+n+"(int row, int col, int depth, int depth2) {\n        return "+n+"("+fo(["row","col","depth","depth2"],u)+");\n      }\n    ";if(m.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+a+", "+o+", "+r+", 1)));\n        "+uo(m)+"\n      }\n    ";var c=m.shapeInfo.flatOffset,l=m.shapeInfo.texShape,p=l[0],d=l[1];return d===a&&null==c?"\n      float "+n+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+o+", "+r+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+p+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":d===r&&null==c?"\n      float "+n+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+e[1]*e[2]+", "+e[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+p+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+a+" + col * "+o+" +\n          depth * "+r+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+d+", index + "+Ya(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}function po(m){var e=m.shapeInfo.logicalShape,t=m.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,a=e[2]*o,i=e[1]*a,s=j(e),u=s.newShape,c=s.keptDims;if(u.length<e.length)return"\n      "+Ta(go(m,u))+"\n      float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+n+"("+fo(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(m.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+i+", "+a+", "+o+", "+r+")) +\n          depth3;\n        "+uo(m)+"\n      }\n    ";var l=m.shapeInfo.flatOffset,p=m.shapeInfo.texShape,d=p[0],h=p[1];return h===i&&null==l?"\n      float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+a+", "+o+", "+r+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+d+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":h===r&&null==l?"\n      float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]+",\n               "+e[2]*e[3]+", "+e[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+d+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" + depth * "+o+" +\n          depth2 * "+r+" + depth3 + "+Ya(t)+";\n      vec2 uv = uvFromFlat("+d+", "+h+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}function lo(g){var e=g.shapeInfo.logicalShape,t=g.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=j(e),o=r.newShape,a=r.keptDims;if(o.length<e.length)return"\n      "+Ta(go(g,o))+"\n      float "+n+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+n+"("+fo(["row","col","depth","depth2","depth3","depth4"],a)+");\n      }\n    ";var i=e[5],s=e[4]*i,u=e[3]*s,c=e[2]*u,l=e[1]*c;if(g.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+i+", 1)));\n        "+uo(g)+"\n      }\n    ";var p=g.shapeInfo.flatOffset,d=g.shapeInfo.texShape,h=d[0],f=d[1];return f===l&&null==p?"\n      float "+n+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+u+", "+s+", "+i+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+h+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":f===i&&null==p?"\n      float "+n+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]*e[4]+",\n               "+e[2]*e[3]*e[4]+",\n               "+e[3]*e[4]+",\n               "+e[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+h+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+l+" + col * "+c+" + depth * "+u+" +\n          depth2 * "+s+" + depth3 * "+i+" + depth4 + "+Ya(t)+";\n      vec2 uv = uvFromFlat("+h+", "+f+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}function uo(a){var e=a.name,t=U(a.shapeInfo.logicalShape);return 2>t?"return "+e+";":"\n    for (int i = 0; i < "+t+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function co(a,e){var t=a.name,r=t.charAt(0).toUpperCase()+t.slice(1),o=a.shapeInfo.logicalShape.length,i=e.logicalShape.length,s=Ra(a.shapeInfo.logicalShape,e.logicalShape),u=mo(i),c=i-o,l=["x","y","z","w","u","v"],p;p=0===o?"":2>i&&1<=s.length?"coords = 0;":s.map(function(t){return"coords."+l[t+c]+" = 0;"}).join("\n");var n="";n=2>i&&0<o?"coords":a.shapeInfo.logicalShape.map(function(a,e){return"coords."+l[e+c]}).join(", ");var d="return outputValue;";if(1===o&&1<i)d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";else if(0===o&&0<i)d=1===i?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(s.length){var h=o-2,g=o-1;-1<s.indexOf(h)&&-1<s.indexOf(g)?d="return vec4(outputValue.x);":-1<s.indexOf(h)?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":-1<s.indexOf(g)&&(d="return vec4(outputValue.xx, outputValue.zz);")}return"\n    vec4 "+("get"+r+"AtOutCoords")+"() {\n      "+u+" coords = getOutputCoords();\n      "+p+"\n      vec4 outputValue = get"+r+"("+n+");\n      "+d+"\n    }\n  "}function ho(h,e){var t=h.name,n=t.charAt(0).toUpperCase()+t.slice(1),r="get"+n+"AtOutCoords",o=e.texShape,a=h.shapeInfo.texShape,i=h.shapeInfo.logicalShape.length,s=e.logicalShape.length;if(!h.shapeInfo.isUniform&&i===s&&null==h.shapeInfo.flatOffset&&L(a,o))return"\n      float "+r+"() {\n        return sampleTexture("+t+", resultUV);\n      }\n    ";var u=mo(s),c=Ra(h.shapeInfo.logicalShape,e.logicalShape),l=s-i,p=["x","y","z","w","u","v"];return"\n    float "+r+"() {\n      "+u+" coords = getOutputCoords();\n      "+(0===i?"":2>s&&1<=c.length?"coords = 0;":c.map(function(t){return"coords."+p[t+l]+" = 0;"}).join("\n"))+"\n      return get"+n+"("+(2>s&&0<i?"coords":h.shapeInfo.logicalShape.map(function(a,e){return"coords."+p[e+l]}).join(", "))+");\n    }\n  "}function mo(t){if(1>=t)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function go(a,e){var t=JSON.parse(JSON.stringify(a));return t.shapeInfo.logicalShape=e,t}function fo(a,e){return e.map(function(e){return a[e]}).join(", ")}function yo(a,e){if(1===a)return""+e;if(2===a)return e+".x, "+e+".y";if(3===a)return e+".x, "+e+".y, "+e+".z";if(4===a)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}function xo(a,e){if(1===a)return""+e;if(2===a)return e+".y";if(3===a)return e+".z";if(4===a)return e+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}function bo(s,e){var t=s.length;if(4<t)throw Error("Gather for rank "+t+" is not yet supported");if(1===t)return"int(getIndices(resRC))";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],o=0;o<s.length;o++)o===e?r.push("int(getIndices("+n[o]+"))"):r.push(""+n[o]);return r.join()}function vo(a,e){return[e,a]}function Co(a,e){return a*e}function Ro(a,e){if(0!=a%e)throw new Error("unpackedSize ("+a+") must be a multiple of "+e);return a/e}function So(s,e,t){var n=Co(s.length,t);if(e.length<n)throw new Error("unpackedArray length ("+e.length+") must be >= "+n);for(var r=0,o=0;o<s.length;++o)e[r]=s[o],r+=t}function Eo(s,e,t){var n=Ro(s.length,t);if(e.length<n)throw new Error("matrix length ("+e.length+") must be >= "+n);for(var r=0,o=0;o<s.length;o+=t)e[r++]=s[o]}function _o(a,e){return[de(1,pe(e/2)),de(1,pe(a/2))]}function ko(a,e){var t=_o(a,e);return 4*(t[0]*t[1])}function wo(b,e,t,n,r){for(var o=1==n%2,a=1==t%2,i=$(n/2),s=$(t/2),u=pe(n/2),c=u*pe(t/2),l=N(t)*N(n),p=0;p<e;p++){for(var d=p*t*n,h=p*l,f=o?4:0,m=n,g=h,v=0;v<s;++v){for(var y=2*v*n,x=0,C;x<i;++x)C=d+y+2*x,r[g]=b[C],r[g+1]=b[C+1],r[g+2]=b[C+m],r[g+3]=b[C+m+1],g+=4;g+=f}if(o){C=d+n-1,g=h+4*(u-1);for(f=4*u,v=0;v<s;++v)r[g]=b[C],r[g+2]=b[C+n],C+=2*n,g+=f}if(a){for(C=d+(t-1)*n,g=h+4*(c-u),x=0;x<i;++x)r[g++]=b[C++],r[g++]=b[C++],g+=2;o&&a&&(r[h+l-4]=b[C])}}return r}function Io(s,e,t,n,r){var o=t*n;if(r.length<o)throw new Error("matrix length ("+r.length+") must be >= "+o);for(var a=1==n%2,i=$(n/2),u=$(t/2),c=pe(n/2),l=c*pe(t/2),p=N(t)*N(n),d=0;d<e;d++){for(var h=d*t*n,f=d*p,m=a?4:0,g=n+(a?1:0),v=f,y=h,x=h+n,C=0;C<u;++C){for(var R=0;R<i;++R)r[y++]=s[v++],r[y++]=s[v++],r[x++]=s[v++],r[x++]=s[v++];v+=m,y+=g,x+=g}if(a){v=f+4*(c-1);var b=h+n-1;for(m=4*c,g=2*n,C=0;C<u;++C)r[b]=s[v],r[b+n]=s[v+2],v+=m,b+=g}if(1==t%2){for(v=f+4*(l-c),b=h+(t-1)*n,R=0;R<i;++R)r[b++]=s[v++],r[b++]=s[v++],v+=2;a&&(r[h+t*n-1]=s[v])}}return r}function No(a,e,t){var o=t();return e&&To(a),o}function To(a){var e=a.getError();if(e!==a.NO_ERROR)throw new Error("WebGL Error: "+Ao(a,e))}function Do(t){return!!(hi.get("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||Sp<l(t)&&l(t)<Ep)}function Ao(a,e){return e===a.NO_ERROR?"NO_ERROR":e===a.INVALID_ENUM?"INVALID_ENUM":e===a.INVALID_VALUE?"INVALID_VALUE":e===a.INVALID_OPERATION?"INVALID_OPERATION":e===a.INVALID_FRAMEBUFFER_OPERATION?"INVALID_FRAMEBUFFER_OPERATION":e===a.OUT_OF_MEMORY?"OUT_OF_MEMORY":e===a.CONTEXT_LOST_WEBGL?"CONTEXT_LOST_WEBGL":"Unknown error code "+e}function Oo(a,e,t){return tn(a,e,function(){return a.getExtension(t)},"Extension \""+t+"\" not supported on this browser.")}function Po(a,e,t){var o=tn(a,e,function(){return a.createShader(a.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(No(a,e,function(){return a.shaderSource(o,t)}),No(a,e,function(){return a.compileShader(o)}),!1===a.getShaderParameter(o,a.COMPILE_STATUS))throw console.log(a.getShaderInfoLog(o)),new Error("Failed to compile vertex shader.");return o}function Fo(a,e,t){var o=tn(a,e,function(){return a.createShader(a.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(No(a,e,function(){return a.shaderSource(o,t)}),No(a,e,function(){return a.compileShader(o)}),!1===a.getShaderParameter(o,a.COMPILE_STATUS))throw Bo(t,a.getShaderInfoLog(o)),new Error("Failed to compile fragment shader.");return o}function Bo(d,e){var t=_p.exec(e);if(null==t)return console.log("Couldn't parse line number in error: "+e),void console.log(d);for(var n=+t[1],r=d.split("\n"),o=r.length.toString().length+2,a=r.map(function(a,e){return V((e+1).toString(),o)+a}),i=0,s=0;s<a.length;s++)i=de(a[s].length,i);var u=a.slice(0,n-1),c=a.slice(n-1,n),l=a.slice(n);console.log(u.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+V(c[0],i),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}function Lo(a,e){return tn(a,e,function(){return a.createProgram()},"Unable to create WebGLProgram.")}function Mo(a,e,t){if(No(a,e,function(){return a.linkProgram(t)}),!1===a.getProgramParameter(t,a.LINK_STATUS))throw console.log(a.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Wo(a,e,t){if(No(a,e,function(){return a.validateProgram(t)}),!1===a.getProgramParameter(t,a.VALIDATE_STATUS))throw console.log(a.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Uo(a,e,t){var o=tn(a,e,function(){return a.createBuffer()},"Unable to create WebGLBuffer");return No(a,e,function(){return a.bindBuffer(a.ARRAY_BUFFER,o)}),No(a,e,function(){return a.bufferData(a.ARRAY_BUFFER,t,a.STATIC_DRAW)}),o}function zo(a,e,t){var o=tn(a,e,function(){return a.createBuffer()},"Unable to create WebGLBuffer");return No(a,e,function(){return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,o)}),No(a,e,function(){return a.bufferData(a.ELEMENT_ARRAY_BUFFER,t,a.STATIC_DRAW)}),o}function Go(){return 2===hi.get("WEBGL_VERSION")?1:4}function Vo(a,e){return tn(a,e,function(){return a.createTexture()},"Unable to create WebGLTexture.")}function Ho(a,e){var t=hi.get("WEBGL_MAX_TEXTURE_SIZE");if(0>=a||0>=e){var o="["+a+"x"+e+"]";throw new Error("Requested texture size "+o+" is invalid.")}if(a>t||e>t)throw o="["+a+"x"+e+"]",new Error("Requested texture size "+o+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]."))}function qo(a,e){return tn(a,e,function(){return a.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function $o(p,e,t,n,r,o,a,i){var s=p.getAttribLocation(t,n);return-1!==s&&(No(p,e,function(){return p.bindBuffer(p.ARRAY_BUFFER,r)}),No(p,e,function(){return p.vertexAttribPointer(s,o,p.FLOAT,!1,a,i)}),No(p,e,function(){return p.enableVertexAttribArray(s)}),!0)}function Ko(a,e,t,o){an(a,o),No(a,e,function(){return a.activeTexture(a.TEXTURE0+o)}),No(a,e,function(){return a.bindTexture(a.TEXTURE_2D,t)})}function jo(a,e,t,o){return tn(a,e,function(){return a.getUniformLocation(t,o)},"uniform \""+o+"\" not present in program.")}function Xo(a,e,t){return a.getUniformLocation(e,t)}function Yo(s,e,t,n,r,o){No(s,e,function(){return Ko(s,e,n,o)}),No(s,e,function(){return s.uniform1i(r,o)})}function Qo(a,e,t,o){No(a,e,function(){return a.bindFramebuffer(a.FRAMEBUFFER,o)}),No(a,e,function(){return a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0)})}function Zo(a,e,t){No(a,e,function(){return a.bindFramebuffer(a.FRAMEBUFFER,t)}),No(a,e,function(){return a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0)})}function Jo(a){var e=a.checkFramebufferStatus(a.FRAMEBUFFER);if(e!==a.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+en(a,e))}function en(a,e){return e===a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?"FRAMEBUFFER_INCOMPLETE_ATTACHMENT":e===a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT":e===a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?"FRAMEBUFFER_INCOMPLETE_DIMENSIONS":e===a.FRAMEBUFFER_UNSUPPORTED?"FRAMEBUFFER_UNSUPPORTED":"unknown error "+e}function tn(a,e,t,n){var r=No(a,e,function(){return t()});if(null==r)throw new Error(n);return r}function an(a,e){var t=a.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,o=e+a.TEXTURE0;if(o<a.TEXTURE0||o>t)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+t+"].")}function on(a,e){return void 0===e&&(e=2),U(a.slice(0,a.length-e))}function nn(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[1<t.length?t[t.length-2]:1,t[t.length-1]]}function rn(p,e){var t;void 0===e&&(e=!1);var n=hi.get("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,1===(p=p.map(function(e,t){return t>=p.length-2?N(p[t]):p[t]})).length&&(p=[2,p[0]])),2!==p.length){var r=j(p);p=r.newShape}var o=U(p);if(1>=p.length&&o<=n)return[1,o];if(2===p.length&&p[0]<=n&&p[1]<=n)return p;if(3===p.length&&p[0]*p[1]<=n&&p[2]<=n)return[p[0]*p[1],p[2]];if(3===p.length&&p[0]<=n&&p[1]*p[2]<=n)return[p[0],p[1]*p[2]];if(4===p.length&&p[0]*p[1]*p[2]<=n&&p[3]<=n)return[p[0]*p[1]*p[2],p[3]];if(4===p.length&&p[0]<=n&&p[1]*p[2]*p[3]<=n)return[p[0],p[1]*p[2]*p[3]];if(e){var a=on(p),i=2,s=2;return p.length&&(i=(t=nn(p))[0],s=t[1]),G(o=a*(i/2)*(s/2)).map(function(t){return 2*t})}return G(o)}function sn(t){return 0==t%2}function pn(a,e){if(L(a=a.slice(-2),e=e.slice(-2)))return!0;if(!a.length||!e.length)return!0;if(0===a[0]||0===a[1]||0===e[0]||0===e[1])return!0;if(a.length!==e.length){var t=a.slice(-1)[0],o=e.slice(-1)[0];if(t===o)return!0;if(sn(t)&&sn(o)&&(1===a[0]||1===e[0]))return!0}return a[1]===e[1]&&sn(a[0])&&sn(e[0])}function dn(a,e){var t=_a();return Po(a,e,t.version+"\n    precision highp float;\n    "+t.attribute+" vec3 clipSpacePos;\n    "+t.attribute+" vec2 uv;\n    "+t.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function ln(a,e){return Uo(a,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function un(a,e){return zo(a,e,new Uint16Array([0,1,2,2,1,3]))}function cn(p,e){var t=p,d,l,h,m,g,f,y,x;return 2===hi.get("WEBGL_VERSION")?(d=t.R32F,l=t.R16F,h=t.RGBA16F,m=t.RGBA32F,g=t.RED,f=4,y=1,x=t.HALF_FLOAT):(d=p.RGBA,l=p.RGBA,h=p.RGBA,m=t.RGBA,g=p.RGBA,f=4,y=4,x=null==e?null:e.HALF_FLOAT_OES),{internalFormatFloat:d,internalFormatHalfFloat:l,internalFormatPackedHalfFloat:h,internalFormatPackedFloat:m,textureFormatFloat:g,downloadTextureFormat:p.RGBA,downloadUnpackNumChannels:f,defaultNumChannels:y,textureTypeHalfFloat:x}}function hn(p,e,t,n,r,o,a){Ho(t,n);var i=Vo(p,e),s=p.TEXTURE_2D;return No(p,e,function(){return p.bindTexture(s,i)}),No(p,e,function(){return p.texParameteri(s,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE)}),No(p,e,function(){return p.texParameteri(s,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE)}),No(p,e,function(){return p.texParameteri(s,p.TEXTURE_MIN_FILTER,p.NEAREST)}),No(p,e,function(){return p.texParameteri(s,p.TEXTURE_MAG_FILTER,p.NEAREST)}),No(p,e,function(){return p.texImage2D(s,0,r,t,n,0,o,a,null)}),No(p,e,function(){return p.bindTexture(p.TEXTURE_2D,null)}),i}function mn(s,e,t,n,r){var o=vo(t,n);return hn(s,e,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,s.FLOAT)}function gn(s,e,t,n,r){var o=vo(t,n);return hn(s,e,o[0],o[1],r.internalFormatHalfFloat,r.textureFormatFloat,r.textureTypeHalfFloat)}function fn(o,e,t,n){var r=vo(t,n);return hn(o,e,r[0],r[1],o.RGBA,o.RGBA,o.UNSIGNED_BYTE)}function yn(s,e,t,n,r){var o=_o(t,n);return hn(s,e,o[0],o[1],r.internalFormatPackedFloat,s.RGBA,s.FLOAT)}function xn(s,e,t,n,r){var o=_o(t,n);return hn(s,e,o[0],o[1],r.internalFormatPackedHalfFloat,s.RGBA,r.textureTypeHalfFloat)}function bn(a,e,t,o){return No(a,e,function(){return a.bindBuffer(a.ARRAY_BUFFER,o)}),$o(a,e,t,"clipSpacePos",o,3,20,0)&&$o(a,e,t,"uv",o,2,20,12)}function vn(a,e,t,o){No(a,e,function(){return a.bindTexture(a.TEXTURE_2D,t)}),No(a,e,function(){return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,o)}),No(a,e,function(){return a.bindTexture(a.TEXTURE_2D,null)})}function Cn(s,e,t,n,r,o,a){Ho(n,r),No(s,e,function(){return s.bindTexture(s.TEXTURE_2D,t)}),No(s,e,function(){return s.texSubImage2D(s.TEXTURE_2D,0,0,0,n,r,a,s.FLOAT,o)}),No(s,e,function(){return s.bindTexture(s.TEXTURE_2D,null)})}function Rn(h,e,t,n,r,o,a,i){var s=vo(n,r),c=s[0],l=s[1],p=n*r,d;1===i.defaultNumChannels&&p===o.length?d=o:So(o,d=new Float32Array(p*a),a),Cn(h,e,t,c,l,d,i.textureFormatFloat)}function Sn(c,e,t,n,r,o,a,i,s){var u=_o(a,i),l=u[0],p=u[1],d=new Float32Array(ko(a,i));wo(s,n,r,o,d),Cn(c,e,t,l,p,d,c.RGBA)}function En(p,e,t,n,r,o){var a=t;if(2===hi.get("WEBGL_VERSION")){var i=p,s=i.createBuffer();No(p,e,function(){return p.bindBuffer(i.PIXEL_PACK_BUFFER,s)});var d=4*Co(n*r,o.downloadUnpackNumChannels);No(p,e,function(){return p.bufferData(i.PIXEL_PACK_BUFFER,d,i.STREAM_READ)}),No(p,e,function(){return i.readPixels(0,0,r,n,p.RGBA,p.FLOAT,0)}),No(p,e,function(){return p.bindBuffer(i.PIXEL_PACK_BUFFER,null)}),a=s}return a}function _n(p,e,t,n,r){var o=p,a=new Float32Array(Co(t*n,r.downloadUnpackNumChannels));o.bindBuffer(o.PIXEL_PACK_BUFFER,e),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,a),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);var i=new Float32Array(t*n);return Eo(a,i,r.downloadUnpackNumChannels),i}function kn(p,e,t,n,r){var o=vo(t,n),a=o[0],i=o[1],s=new Float32Array(Co(t*n,r.downloadUnpackNumChannels));No(p,e,function(){return p.readPixels(0,0,a,i,r.downloadTextureFormat,p.FLOAT,s)});var d=new Float32Array(t*n);return Eo(s,d,r.downloadUnpackNumChannels),d}function wn(p,e,t,n,r){var o=vo(t,n),a=o[0],i=o[1],s=new Uint8Array(Co(t*n,4));return No(p,e,function(){return p.readPixels(0,0,a,i,r.downloadTextureFormat,p.UNSIGNED_BYTE,s)}),new Float32Array(s.buffer)}function In(s,e,t,n,r,o,a){var i=s,p=new Float32Array(ko(o,a));i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,p),i.bindBuffer(i.PIXEL_PACK_BUFFER,null);var d=new Float32Array(U([t,n,r]));return Io(p,t,n,r,d),d}function Nn(s,e,t,n,r,o,a){var i=_o(o,a),u=i[0],c=i[1],l=new Float32Array(ko(o,a));No(s,e,function(){return s.readPixels(0,0,u,c,s.RGBA,s.FLOAT,l)});var p=new Float32Array(U([t,n,r]));return Io(l,t,n,r,p)}function Tn(a){for(var e=0;e<a.length&&!!a[e]();++e);return e-1}function Dn(m,g,e,n){var r=g.userCode,o=e.map(function(t,e){var a={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&0<t.texData.slice.flatOffset&&(a.flatOffset=t.texData.slice.flatOffset),{name:g.variableNames[e],shapeInfo:a}}),a=o.map(function(t){return t.shapeInfo}),y={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},x=Na(o,y,r,g.usesPackedTextures),b=m.createProgram(x),v=null,C=null;1===hi.get("WEBGL_VERSION")&&(v=m.getUniformLocation(b,"INFINITY",!1),C=m.getUniformLocation(b,"NAN",!1));for(var R={},S=0,h;S<g.variableNames.length;S++)h=g.variableNames[S],R[h]=m.getUniformLocation(b,h,!1),R["offset"+h]=m.getUniformLocation(b,"offset"+h,!1);return{program:g,source:x,webGLProgram:b,uniformLocations:R,inShapeInfos:a,outShapeInfo:y,infLoc:v,nanLoc:C}}function An(a,p){if(a.length!==p.length)throw Error("Binary was compiled with "+a.length+" inputs, but was executed with "+p.length+" inputs");a.forEach(function(t,e){var n=t.logicalShape,r=p[e],o=r.shape;if(!L(n,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+n+" and "+o+" must match");if(!t.isUniform||!r.isUniform){var a=t.texShape,i=r.isUniform?null:r.texData.texShape;if(!L(a,i))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+i+" must match")}})}function On(p,e,t,n,r){An(e.inShapeInfos,t),An([e.outShapeInfo],[n]);var o=n.texData.texture,a=n.texData.texShape;n.texData.isPacked?p.setOutputPackedMatrixTexture(o,a[0],a[1]):p.setOutputMatrixTexture(o,a[0],a[1]),p.setProgram(e.webGLProgram),1===hi.get("WEBGL_VERSION")&&(null!==e.infLoc&&p.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&p.gl.uniform1f(e.nanLoc,NaN)),t.forEach(function(t,n){var r=e.program.variableNames[n],o=e.uniformLocations[r],a=e.uniformLocations["offset"+r];if(null!=o)if(!t.isUniform)null!=t.texData.slice&&null!=a&&p.gl.uniform1i(a,t.texData.slice.flatOffset),p.setInputMatrixTexture(t.texData.texture,o,n);else if(2>U(t.shape))p.gl.uniform1f(o,t.uniformValues[0]);else{var i=t.uniformValues;i instanceof Float32Array||(i=new Float32Array(i)),p.gl.uniform1fv(o,i)}}),null!=r&&r(p,e.webGLProgram),p.executeProgram()}function Pn(s,e,t){var i="";e.concat(t).forEach(function(a){var e=null!=a.texData&&null!=a.texData.slice&&0<a.texData.slice.flatOffset,t=a.isUniform?"uniform":a.texData.texShape;i+=a.shape+"_"+t+"_"+e});var n=s.userCode,o=s.constructor.name;return o+="_"+i+"_"+n}function Fn(s,e){for(var t=[],n=0;1>=n;n++)for(var r=0;1>=r;r++){for(var o=(0===n?"r":"rp1")+", "+(0===r?"c":"cp1"),a=2;a<s;a++)o=e[e.length-1-a]+","+o;t.push(o)}return t}function Bn(a,e,t){if(1===a)return"rc > "+e[0];for(var n="",r=a-2;r<a;r++)n+=t[r]+" >= "+e[r],r<a-1&&(n+="||");return n}function Ln(a,e,t,n){if(1===a)return"";var r=n.slice(-2);return"\n    int r = "+r[0]+";\n    int c = "+r[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+t+";\n  "}function Mn(a,e){var t=a.length,o=Fn(t,e);return 1===t?"getA(rc),\n            rc + 1 >= "+a[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+o[0]+"),\n          cEdge ? 0. : getA("+o[1]+"),\n          rEdge ? 0. : getA("+o[2]+"),\n          rEdge || cEdge ? 0. : getA("+o[3]+")"}function Wn(t){return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+Ia(["coords.x","coords.y","coords.z"],ce(t).map(function(t){return t.toString()}).concat(["1."]))+");\n    }\n  "}function Un(t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+ka(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  "}function zn(t){if(1===t)return"sourceLoc";if(6>=t)return Jp.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}function Gn(a,e){if(a===Cp.UPLOAD)return e?Rp.PACKED_2X2_FLOAT32:Rp.UNPACKED_FLOAT32;if(a===Cp.RENDER||null==a)return e?hi.get("WEBGL_RENDER_FLOAT32_ENABLED")?Rp.PACKED_2X2_FLOAT32:Rp.PACKED_2X2_FLOAT16:hi.get("WEBGL_RENDER_FLOAT32_ENABLED")?Rp.UNPACKED_FLOAT32:Rp.UNPACKED_FLOAT16;if(a===Cp.DOWNLOAD||a===Cp.PIXELS)return Rp.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+a)}function Vn(a,e,t){return a[0]+"_"+a[1]+"_"+e+"_"+t}function Hn(a){var e=a.length;if(5<e)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+a[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],r=0;r<a.length;r++)n.push("imod("+t[r]+", "+a[r]+")");return n.join()}function qn(a){var e=a.length;if(6<e)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=Array(e),r=0;r<a.length;r++)n[a[r]]=t[r];return n.join()}function $n(t){return void 0===t&&(t=0),gd+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}function Kn(a,e){return a(e={exports:{}},e.exports),e.exports}function jn(a,e,t){return void 0===e&&(e="float32"),e=e||"float32",ve(a),new Gs(a,e,t)}function Xn(a,e){void 0===e&&(e=!1),console.log(a.toString(e))}function Yn(p,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var r=jn(p,"int32"),o=jn([t.length,p.length],"int32");for(n=0;n<t.length;n++){var a=r.indexToLoc(t[n]),i=n*p.length;o.values.set(a,i)}return o.toTensor()}function Qn(t){return t in ul?ul[t]:(ul[t]={},ul[t])}function Zn(a,e){if(void 0===e&&(e=!1),"linear"===a)return e?vd:fd;if("relu"===a)return e?Cd:yd;throw new Error("Activation "+a+" has not been implemented for the WebGL backend.")}function Jn(a,e){if("float32"===e||"complex64"===e)return a;if("int32"===e||"bool"===e){for(var t="int32"===e?new Int32Array(a.length):new Uint8Array(a.length),o=0;o<t.length;++o)t[o]=_(a[o]);return t}throw new Error("Unknown dtype "+e)}function er(t){return t instanceof Float32Array?t:new Float32Array(t)}function tr(p,e,t,n,r,o){var a=st(p,"x","batchNorm"),d=st(e,"mean","batchNorm"),u=st(t,"variance","batchNorm"),l,i;return null!=r&&(l=st(r,"scale","batchNorm")),null!=n&&(i=st(n,"offset","batchNorm")),A(2===a.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+a.rank+"."}),A(2===d.rank||1===d.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+d.rank+"."}),A(2===u.rank||1===u.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+u.rank+"."}),null!=l&&A(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=i&&A(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+i.rank+"."}),nr(a,d,u,i,l,o)}function ar(p,e,t,n,r,o){var a=st(p,"x","batchNorm"),d=st(e,"mean","batchNorm"),u=st(t,"variance","batchNorm"),l,i;return null!=r&&(l=st(r,"scale","batchNorm")),null!=n&&(i=st(n,"offset","batchNorm")),A(3===a.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+a.rank+"."}),A(3===d.rank||1===d.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+d.rank+"."}),A(3===u.rank||1===u.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+u.rank+"."}),null!=l&&A(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=i&&A(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+i.rank+"."}),nr(a,d,u,i,l,o)}function or(p,e,t,n,r,o){var a=st(p,"x","batchNorm"),d=st(e,"mean","batchNorm"),u=st(t,"variance","batchNorm"),l,i;return null!=r&&(l=st(r,"scale","batchNorm")),null!=n&&(i=st(n,"offset","batchNorm")),A(4===a.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+a.rank+"."}),A(4===d.rank||1===d.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+d.rank+"."}),A(4===u.rank||1===u.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+u.rank+"."}),null!=l&&A(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=i&&A(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+i.rank+"."}),nr(a,d,u,i,l,o)}function nr(d,e,t,n,r,g){null==g&&(g=.001);var a=st(d,"x","batchNorm"),o=st(e,"mean","batchNorm"),h=st(t,"variance","batchNorm"),m,f,y;return null!=r&&(m=st(r,"scale","batchNorm")),null!=n&&(f=st(n,"offset","batchNorm")),A(o.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),A(null==f||o.rank===f.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),A(null==m||o.rank===m.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),y=0===a.rank||1===a.rank?a.as4D(1,1,1,a.size):2===a.rank?a.as4D(1,1,a.shape[0],a.shape[1]):3===a.rank?a.as4D(1,a.shape[0],a.shape[1],a.shape[2]):a,hi.engine.runKernel(function(r,e){var t=r.batchNormalization(y,rr(o),rr(h),g,rr(m),rr(f));return e([a,o,h,m]),t},{$x:a,$mean:o,$variance:h,$scale:m,$offset:f},function(a,e){var t=e[0],u=e[1],n=e[2],o=e[3],r=null==o?Kt(1):o,s=Sa(u.shape,y.shape),i=[];if(1===u.rank){for(var l=0;l<y.shape.length-1;++l)i.push(y.shape[l]);i.push(1)}var p=t.sub(u),d=a.mul(r),c=Fl(n.add(Kt(g))),h=c.mul(c).mul(c).mul(Kt(-.5));return{$x:function(){return 1===u.rank?a.mul(il(c.as4D(1,1,1,u.shape[0]),i)).mul(r).reshape(t.shape):a.mul(c).mul(r).reshape(t.shape)},$mean:function(){var t=c.mul(Kt(-1)).mul(d);return 1===u.rank&&(t=t.sum(s)),t.reshape(u.shape)},$variance:function(){var t=h.mul(p).mul(d);return 1===u.rank&&(t=t.sum(s)),t.reshape(u.shape)},$scale:function(){var e=p.mul(c),t=a.mul(e);return 1===u.rank&&(t=t.sum(s)),t.reshape(u.shape)},$offset:function(){var e=a;return 1===u.rank&&(e=e.sum(s)),e.reshape(u.shape)}}}).reshape(a.shape)}function rr(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function sr(){at("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function ir(p,e,t,n,r,o,a){void 0===a&&(a="channelsLast");var i=cr(e),d=i[0],u=i[1],l;if("channelsLast"===a)l=[d,u,p[3],p[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);l=[d,u,p[1],p[1]]}return pr(p,l,t,n,r,o,!1,a)}function pr(k,I,D,n,r,o,a,i){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var O=[-1,-1,-1,-1],u=O[0],P=O[1],F=O[2],B=O[3];if("channelsLast"===i)u=k[0],P=k[1],F=k[2],B=k[3];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);u=k[0],B=k[1],P=k[2],F=k[3]}var L=I[0],M=I[1],W=I[3],g=cr(D),v=g[0],U=g[1],z=cr(n),E=z[0],G=z[1],V=mr(L,E),H=mr(M,G),q=gr(r,P,F,v,U,V,H,o),C=q.padInfo,$=q.outHeight,K=q.outWidth,j=a?W*B:W,X;return"channelsFirst"===i?X=[u,j,$,K]:"channelsLast"==i&&(X=[u,$,K,j]),{batchSize:u,dataFormat:i,inHeight:P,inWidth:F,inChannels:B,outHeight:$,outWidth:K,outChannels:j,padInfo:C,strideHeight:v,strideWidth:U,filterHeight:L,filterWidth:M,effectiveFilterHeight:V,effectiveFilterWidth:H,dilationHeight:E,dilationWidth:G,inShape:k,outShape:X,filterShape:I}}function dr(D,O,P,n,r,o,a){void 0===o&&(o=!1),void 0===a&&(a="channelsLast");var F=[-1,-1,-1,-1,-1],s=F[0],B=F[1],L=F[2],M=F[3],W=F[4];if("channelsLast"===a)s=D[0],B=D[1],L=D[2],M=D[3],W=D[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=D[0],W=D[1],B=D[2],L=D[3],M=D[4]}var U=O[0],z=O[1],G=O[2],V=O[4],v=hr(P),y=v[0],H=v[1],q=v[2],$=hr(n),b=$[0],K=$[1],j=$[2],X=fr(r,B,L,M,y,H,q,mr(U,b),mr(z,K),mr(G,j)),A=X.padInfo,Y=X.outDepth,Q=X.outHeight,Z=X.outWidth,J=o?V*W:V,ee;return"channelsFirst"===a?ee=[s,J,Y,Q,Z]:"channelsLast"==a&&(ee=[s,Y,Q,Z,J]),{batchSize:s,dataFormat:a,inDepth:B,inHeight:L,inWidth:M,inChannels:W,outDepth:Y,outHeight:Q,outWidth:Z,outChannels:J,padInfo:A,strideDepth:y,strideHeight:H,strideWidth:q,filterDepth:U,filterHeight:z,filterWidth:G,dilationDepth:b,dilationHeight:K,dilationWidth:j,inShape:D,outShape:ee,filterShape:O}}function lr(p,e,t,n,r,o){null==r&&(r=ur(p,e,n));var a=p[0],i=p[1],s=yr((a-e+2*r)/n+1,o);A(M(s),function(){return"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters"});var d=yr((i-e+2*r)/n+1,o);return A(M(d),function(){return"The output # of columns ("+d+") must be an integer. Change the stride and/or zero pad parameters"}),[s,d,t]}function ur(a,e,t,n){void 0===n&&(n=1);var r=mr(e,n);return $((a[0]*(t-1)-t+r)/2)}function cr(t){return"number"==typeof t?[t,t]:t}function hr(t){return"number"==typeof t?[t,t,t]:t}function mr(a,e){return 1>=e?a:a+(a-1)*(e-1)}function gr(m,y,t,n,r,o,a,i){var s,x,b;if("number"==typeof m){s={top:m,bottom:m,left:m,right:m,type:0===m?"VALID":"NUMBER"};var v=lr([y,t,1],o,1,n,m,i);x=v[0],b=v[1]}else if("same"===m){x=pe(y/n),b=pe(t/r);var p=de(0,(x-1)*n+o-y),d=de(0,(b-1)*r+a-t),h=$(p/2),C=$(d/2);s={top:h,bottom:p-h,left:C,right:d-C,type:"SAME"}}else{if("valid"!==m)throw Error("Unknown padding parameter: "+m);s={top:0,bottom:0,left:0,right:0,type:"VALID"},x=pe((y-o+1)/n),b=pe((t-a+1)/r)}return{padInfo:s,outHeight:x,outWidth:b}}function fr(y,e,t,n,r,o,a,i,s,u){var c,b,C,R;if("same"===y){var S=((b=pe(e/r))-1)*r+i-e,f=((C=pe(t/o))-1)*o+s-t,m=((R=pe(n/a))-1)*a+u-n,g=$(S/2),E=$(f/2),_=$(m/2);c={top:E,bottom:f-E,left:_,right:m-_,front:g,back:S-g,type:"SAME"}}else{if("valid"!==y)throw Error("Unknown padding parameter: "+y);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},b=pe((e-i+1)/r),C=pe((t-s+1)/o),R=pe((n-u+1)/a)}return{padInfo:c,outDepth:b,outHeight:C,outWidth:R}}function yr(a,e){if(!e)return a;switch(e){case"round":return _(a);case"ceil":return pe(a);case"floor":return $(a);default:throw new Error("Unknown roundingMode "+e);}}function xr(a){var e=cr(a),t=e[0],o=e[1];return 1===t&&1===o}function br(a,e){return xr(a)||xr(e)}function vr(h,e,m,t,r,o){A(h.length===e.rank,function(){return"Length of inShape ("+h.length+") and rank of dy ("+e.rank+") must match"});var a=h,i=e,g=!1;3===e.rank&&(g=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,h[0],h[1],h[2]]);var u=a[3],c=i.shape[3];A(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),A(4===i.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+i.rank}),A(4===m.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+m.rank}),A(u===m.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+u+") must match input depth for filter "+m.shape[2]+"."}),A(c===m.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+m.shape[3]+"."}),null!=o&&A(M(r),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=pr(a,m.shape,t,1,r,o),p=hi.engine.runKernel(function(a,e){var t=a.conv2dDerInput(i,m,l);return e([m,i]),t},{dy4D:i,filter:m},function(a,e){var s=e[0],n=e[1];return{dy4D:function(){return nu(a,s,t,r,"NHWC",1,o)},filter:function(){return su(a,n,s.shape,t,r,o)}}});return g?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Cr(p,e,t,n,r,o){var a=p;3===p.rank&&(a=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var d=e;3===d.rank&&(d=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),A(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),A(4===d.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+d.shape+"."}),A(4===t.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}),A(a.shape[3]===t[2],function(){return"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+t[2]+"."}),A(d.shape[3]===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d.shape[3]+") must match output depth for filter ("+t[3]+")."}),null!=o&&A(M(r),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=pr(a.shape,t,n,1,r,o);return hi.engine.runKernel(function(t){return t.conv2dDerFilter(a,d,l)},{x4D:a,dy4D:d})}function Rr(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Sr(a){var e=Rr(a),t=e[0],n=e[1],r=e[2];return 1===t&&1===n&&1===r}function Er(a,e){return Sr(a)||Sr(e)}function _r(s,e,t,n){var r=e,p=!1;3===e.rank&&(p=!0,r=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=hi.engine.runKernel(function(a){return a.depthwiseConv2DDerInput(r,t,n)},{dy4D:r});return p?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}function kr(s,e,t,n){var r=s;3===s.rank&&(r=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),hi.engine.runKernel(function(t){return t.depthwiseConv2DDerFilter(r,i,n)},{x4D:r,dy4D:i})}function wr(d,e,t,n,r){A(d.length===e.rank,function(){return"Length of inShape ("+d.length+") and rank of dy ("+e.rank+") must match"});var o=d,a=e,h=!1;4===e.rank&&(h=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,d[0],d[1],d[2],d[3]]);var s=o[4],u=a.shape[4];A(5===o.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),A(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),A(5===t.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),A(s===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+s+") must match input depth for filter "+t.shape[3]+"."}),A(u===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+t.shape[4]+"."});var c=dr(o,t.shape,n,1,r),l=hi.engine.runKernel(function(o){return o.conv3dDerInput(a,t,c)},{dy5D:a});return h?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}function Ir(p,e,t,n,r){var o=p;4===p.rank&&(o=p.as5D(1,p.shape[0],p.shape[1],p.shape[2],p.shape[3]));var d=e;4===d.rank&&(d=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),A(5===o.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+o.shape+"."}),A(5===d.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+d.shape+"."}),A(5===t.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+t+"."}),A(o.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input "+o.shape[4]+") must match input depth in filter ("+t[3]+"."}),A(d.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy ("+d.shape[4]+") must match output depth for filter ("+t[4]+")."});var l=dr(o.shape,t,n,1,r);return hi.engine.runKernel(function(t){return t.conv3dDerFilter(o,d,l)},{x5D:o,dy5D:d})}function Nr(p,d,t,n,r,e){var a=st(p,"x","maxPool"),o=a,i=!1;3===a.rank&&(i=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==n&&(n=[1,1]),A(4===o.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+o.rank+"."}),A(br(t,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}),null!=e&&A(M(r),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+r+"."});var u=ir(o.shape,d,t,n,r,e),c=hi.engine.runKernel(function(a,e){var t=a.maxPool(o,u);return e([o,t]),t},{x:o},function(o,e){var a=e[0],i=e[1];return{x:function(){return Dr(o,a,i,d,t,n,r)}}});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Tr(p,d,t,n,r,e){var a=st(p,"x","avgPool","float32");null==n&&(n=[1,1]),A(br(t,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"});var o=a,i=!1;3===a.rank&&(i=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(4===o.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+o.rank+"."}),null!=e&&A(M(r),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+r+"."});var u=ir(o.shape,d,t,n,r,e),c=hi.engine.runKernel(function(t){return t.avgPool(o,u)},{x:o},function(a){return{x:function(){return Ar(a,o,d,t,n,r)}}});return c=c.cast(a.dtype),i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function Dr(d,e,t,n,r,o,a,i){var s=st(d,"dy","maxPoolBackprop"),h=st(e,"input","maxPoolBackprop"),m=st(t,"output","maxPoolBackprop");A(h.rank===s.rank,function(){return"Rank of input ("+h.rank+") does not match rank of dy ("+s.rank+")"}),null==o&&(o=[1,1]),A(br(r,o),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),A(4===s.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."}),A(4===h.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+h.rank+"."}),null!=i&&A(M(a),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var l=ir(h.shape,n,r,o,a,i);return hi.engine.runKernel(function(t){return t.maxPoolBackprop(s,h,m,l)},{$dy:s,$input:h})}function Ar(h,e,t,n,r,o){var a=st(h,"dy","avgPoolBackprop"),i=st(e,"input","avgPoolBackprop");A(i.rank===a.rank,function(){return"Rank of input ("+i.rank+") does not match rank of dy ("+a.rank+")"}),null==r&&(r=[1,1]),A(br(n,r),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,m=a,g=!1;3===i.rank&&(g=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]),m=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(4===m.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+m.rank+"."}),A(4===s.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+"."});var l=ir(s.shape,t,n,r,o),p=hi.engine.runKernel(function(t){return t.avgPoolBackprop(m,s,l)},{dy4D:m,input4D:s});return g?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Or(p,e,t){var n=t.map(function(t){return t[0]}),r=t.map(function(t){return t[1]}),o=p.concat(n,r),a=e.map(function(a,e){return(a-o[e]%a)%a}),i=r.map(function(o,e){return o+a[e]});return[e.map(function(a,e){return[n[e],i[e]]}),e.map(function(o,e){return[0,a[e]]})]}function Pr(a,s){var e=a.map(function(t,e){return t+(t-1)*(s[e]-1)}).map(function(t){return t-1}),n=e.map(function(t){return $(t/2)}),r=e.map(function(a,e){return a-n[e]});return e.map(function(a,e){return[n[e],r[e]]})}function Fr(a,e,t,n,s){return e.rank<t.rank&&(e=e.reshape(Et(e.shape,n))),a.rank<t.rank&&(a=a.reshape(Et(a.shape,n))),{$x:function(){var o=a.mul(t.equal(e).cast(a.dtype));return null==s?o:o.transpose(s)}}}function Br(a,e,t){if(void 0===t&&(t=null),0===a.rank)return a.abs();if(1!==a.rank&&null===t)return Br(a.reshape([-1]),e,t);if(1===a.rank||"number"==typeof t||Array.isArray(t)&&1===t.length){if(1===e)return a.abs().sum(t);if(e===1/0)return a.abs().max(t);if(e===-1/0)return a.abs().min(t);if("euclidean"===e||2===e)return a.abs().pow(Kt(2,"int32")).sum(t).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&2===t.length){if(1===e)return a.abs().sum(t[0]).max(t[1]-1);if(e===1/0)return a.abs().sum(t[1]).max(t[0]);if(e===-1/0)return a.abs().sum(t[1]).min(t[0]);if("fro"===e||"euclidean"===e)return a.square().sum(t).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}function Lr(a,e){for(var t=[],o=a;o<e;++o)t.push(o);return t}function Mr(a){for(var e=[],t=0;t<a.length;++t)for(var o=0;o<a[t].length;++o)e.push(a[t][o]);return e}function Wr(p,e){for(var t=ac(e,wi(e)),n=Tc(p,t),r=Uu(e,Kt(0,"int32")),o=n.rank-r.rank,a=0;a<o;++a)r=qd(r,a+1);r=fc(r,ea(n.shape,"bool"));var i=wi(n);return vc(r,n,i)}function Ur(s,e,t,n){if("int32"!==s.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(2<s.rank)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var r=0<s.rank?s.shape[0]:1,o=1<s.rank?s.shape[1]:1;if(t.length!==o)throw new Error("outputShape has incorrect number of elements:, "+t.length+", should be: "+o+".");var a=e.size;if(0!==e.rank&&(1!==e.rank||a!==r))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+r+"]");if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function zr(p,e,t){void 0===t&&(t=qc.SUM_BY_NONZERO_WEIGHTS);var n=st(p,"losses","computeWeightedLoss"),r=null;null!=e&&(r=st(e,"weights","computeWeightedLoss"));var o=null==r?n:n.mul(r);if(t===qc.NONE)return o;if(t===qc.SUM)return o.sum();if(t===qc.MEAN){if(null==r)return o.mean();var a=n.size/r.size,i=o.sum().div(r.sum());return 1<a?i.div(Kt(a)):i}if(t===qc.SUM_BY_NONZERO_WEIGHTS){if(null==r)return o.sum().div(Kt(n.size));var s=r.mul(ea(n.shape)).notEqual(Kt(0)).sum().toFloat();return o.sum().div(s)}throw Error("Unknown reduction: "+t)}function Gr(p,e,t,n){void 0===n&&(n=qc.SUM_BY_NONZERO_WEIGHTS);var r=st(p,"labels","absoluteDifference"),o=st(e,"predictions","absoluteDifference"),a=null;null!=t&&(a=st(t,"weights","absoluteDifference")),O(r.shape,o.shape,"Error in absoluteDifference: ");var i=r.sub(o).abs();return Kc(i,a,n)}function Vr(p,e,t,n){void 0===n&&(n=qc.SUM_BY_NONZERO_WEIGHTS);var r=st(p,"labels","meanSquaredError"),o=st(e,"predictions","meanSquaredError"),a=null;null!=t&&(a=st(t,"weights","meanSquaredError")),O(r.shape,o.shape,"Error in meanSquaredError: ");var i=r.squaredDifference(o);return Kc(i,a,n)}function Hr(p,e,t,n,r){void 0===r&&(r=qc.SUM_BY_NONZERO_WEIGHTS);var o=st(p,"labels","cosineDistance"),a=st(e,"predictions","cosineDistance"),i=null;null!=n&&(i=st(n,"weights","cosineDistance")),O(o.shape,a.shape,"Error in cosineDistance: ");var s=Kt(1).sub(o.mul(a).sum(t,!0));return Kc(s,i,r)}function $r(p,e,t,n){void 0===n&&(n=qc.SUM_BY_NONZERO_WEIGHTS);var r=st(p,"labels","hingeLoss"),o=st(e,"predictions","hingeLoss"),a=null;null!=t&&(a=st(t,"weights","hingeLoss")),O(r.shape,o.shape,"Error in hingeLoss: ");var i=Kt(1);r=Kt(2).mul(r).sub(i);var s=i.sub(r.mul(o)).relu();return Kc(s,a,n)}function Kr(p,e,t,n,r){void 0===n&&(n=1e-7),void 0===r&&(r=qc.SUM_BY_NONZERO_WEIGHTS);var o=st(p,"labels","logLoss"),a=st(e,"predictions","logLoss"),i=null;null!=t&&(i=st(t,"weights","logLoss")),O(o.shape,a.shape,"Error in logLoss: ");var s=Kt(1),d=Kt(n),u=o.mul(a.add(d).log()).neg().sub(s.sub(o).mul(s.sub(a).add(d).log()));return Kc(u,i,r)}function jr(s,e){var t=st(s,"labels","sigmoidCrossEntropyWithLogits"),n=st(e,"logits","sigmoidCrossEntropyWithLogits");O(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var r=n.relu(),o=n.mul(t),a=n.abs().neg().exp().log1p();return r.sub(o).add(a)}function Xr(d,e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=qc.SUM_BY_NONZERO_WEIGHTS);var o=st(d,"multiClassLabels","sigmoidCrossEntropy"),a=st(e,"logits","sigmoidCrossEntropy"),i=null;if(null!=t&&(i=st(t,"weights","sigmoidCrossEntropy")),O(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),0<n){var s=Kt(n),u=Kt(1),c=Kt(.5);o=o.mul(u.sub(s)).add(c.mul(s))}var l=jr(o,a);return Kc(l,i,r)}function Yr(h,e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=qc.SUM_BY_NONZERO_WEIGHTS);var o=st(h,"labels","huberLoss"),a=st(e,"predictions","huberLoss"),i=null;null!=t&&(i=st(t,"weights","huberLoss")),O(o.shape,a.shape,"Error in huberLoss: ");var s=Kt(n),u=a.sub(o).abs(),c=nc(u,s),l=u.sub(c),p=Kt(.5).mul(c.square()).add(s.mul(l));return Kc(p,i,r)}function Qr(a,e,s){if(void 0===s&&(s=-1),-1===s&&(s=e.rank-1),s!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+s);return ht(function(n,e,t){var r=e.logSumExp([s],!0),o=e.toFloat().sub(r);return t([n,o]),{value:o.mul(n).neg().sum([s]),gradFunc:function(n,e){var t=e[0],r=e[1],o=Et(n.shape,[s]);return[n.reshape(o).mul(t.toFloat().sub(r.exp())),n.reshape(o).mul(r.exp().sub(t.toFloat()))]}}})(a,e)}function Zr(d,e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=qc.SUM_BY_NONZERO_WEIGHTS);var o=st(d,"onehotLabels","softmaxCrossEntropy"),a=st(e,"logits","softmaxCrossEntropy"),i=null;if(null!=t&&(i=st(t,"weights","softmaxCrossEntropy")),O(o.shape,a.shape,"Error in softmaxCrossEntropy: "),0<n){var s=Kt(n),u=Kt(1),c=Kt(o.shape[1]);o=o.mul(u.sub(s)).add(s.div(c))}var l=Qr(o,a);return Kc(l,i,r)}function Jr(p,e){return void 0===e&&(e=!1),hi.engine.tidy(function(){if(2!==p.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+p.shape.length+"D Tensor.");for(var y=p.shape[0],n=p.shape[1],r=$d(y),o=p.clone(),a=Xt([[1]],[1,1]),i=a.clone(),s=y>=n?n:y,d=function(s){var e=o,p=i,d=r,l;l=hi.engine.tidy(function(){var e=o.slice([s,s],[y-s,1]),t=e.norm(),u=o.slice([s,s],[1,1]),c=u.sign().neg(),l=u.sub(c.mul(t)),p=e.div(l);i=1===p.shape[0]?a.clone():a.concat(p.slice([1,0],[p.shape[0]-1,p.shape[1]]),0);var d=c.matMul(l).div(t).neg(),h=o.slice([s,0],[y-s,n]),f=d.mul(i);o=0===s?h.sub(f.matMul(i.transpose().matMul(h))):o.slice([0,0],[s,n]).concat(h.sub(f.matMul(i.transpose().matMul(h))),0);var m=r.slice([0,s],[y,r.shape[1]-s]);return r=0===s?m.sub(m.matMul(i).matMul(f.transpose())):r.slice([0,0],[y,s]).concat(m.sub(m.matMul(i).matMul(f.transpose())),1),[i,o,r]}),i=l[0],o=l[1],r=l[2],yi([e,p,d])},u=0;u<s;++u)d(u);return!e&&y>n&&(r=r.slice([0,0],[y,n]),o=o.slice([0,0],[n,n])),[r,o]})}function es(s,e,t,i,p){null==i&&(i=.5),null==p&&(p=B);var d=s.shape[0];return t=le(t,d),A(0<=i&&1>=i,function(){return"iouThreshold must be in [0, 1], but was '"+i+"'"}),A(2===s.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+s.rank+"'"}),A(4===s.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+s.shape[1]}),A(1===e.rank,function(){return"scores must be a 1D tensor"}),A(e.shape[0]===d,function(){return"scores has incompatible shape with boxes. Expected "+d+", but was "+e.shape[0]}),{maxOutputSize:t,iouThreshold:i,scoreThreshold:p}}function ts(a,e,t){if("linear"===e)return a.linear(t);if("relu"===e)return a.relu(t);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}function as(){return new Promise(function(t){return mh(function(){return t()})})}function os(m,e){for(var g={},n=0,t=function(e){var t=e.name,o=e.dtype,a=e.shape,r=U(a),s;if(("quantization"in e)){var i=e.quantization;if("uint8"!==i.dtype&&"uint16"!==i.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+i.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var u=gh[i.dtype],l=m.slice(n,n+r*u),p="uint8"===i.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===o)s=Float32Array.from(p,function(t){return t*i.scale+i.min});else{if("int32"!==o)throw new Error("Unsupported dtype in weight '"+t+"': "+o);s=Int32Array.from(p,function(t){return _(t*i.scale+i.min)})}n+=r*u}else{var d=gh[o];if(l=m.slice(n,n+r*d),"float32"===o)s=new Float32Array(l);else if("int32"===o)s=new Int32Array(l);else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+t+"': "+o);s=new Uint8Array(l)}n+=r*d}var c;if("float32"===o)c=$t(s,a,"float32");else if("int32"===o)c=$t(s,a,"int32");else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+t+"': "+o);c=$t(s,a,"bool")}g[t]=c},o=0,a=e;o<a.length;o++)t(a[o]);return g}function ns(a){if(null===a)throw new Error("Invalid input value: "+JSON.stringify(a));var s=0,t=[];a.forEach(function(a){if(s+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var n=new Uint8Array(s),r=0;return t.forEach(function(t){n.set(new Uint8Array(t.buffer),r),r+=t.byteLength}),n.buffer}function rs(t){return fh?f.byteLength(t):new Blob([t]).size}function ss(t){return fh?f.from(t).toString("base64"):btoa(o.apply(null,new Uint8Array(t)))}function is(a){if(fh){var e=f.from(a,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(a),n=new Uint8Array(t.length),r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function ps(a){var o=0;a.forEach(function(t){o+=t.byteLength});var t=new Uint8Array(o),n=0;return a.forEach(function(a){t.set(new Uint8Array(a),n),n+=a.byteLength}),t.buffer}function ds(a){for(a=a.trim();a.endsWith("/");)a=a.slice(0,a.length-1);var e=a.split("/");return e[e.length-1]}function ls(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:rs(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:rs(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function us(t){if(-1===t.indexOf(xh))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+bh.getSchemes().join(","));return{scheme:t.split(xh)[0],path:t.split(xh)[1]}}function cs(h,e,t){return void 0===t&&(t=!1),x(this,void 0,void 0,function(){var m,r,o,a,i,s,u,c,l;return R(this,function(p){switch(p.label){case 0:return A(h!==e,function(){return"Old path and new path are the same: '"+h+"'"}),A(0<(m=yh.getLoadHandlers(h)).length,function(){return"Copying failed because no load handler is found for source URL "+h+"."}),A(2>m.length,function(){return"Copying failed because more than one ("+m.length+") load handlers for source URL "+h+"."}),r=m[0],A(0<(o=yh.getSaveHandlers(e)).length,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),A(2>o.length,function(){return"Copying failed because more than one ("+m.length+") save handlers for destination URL "+e+"."}),a=o[0],i=us(h).scheme,s=us(h).path,u=i===us(h).scheme,[4,r.load()];case 1:return c=p.sent(),t&&u?[4,bh.getManager(i).removeModel(s)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[4,a.save(c)];case 4:return l=p.sent(),!t||u?[3,6]:[4,bh.getManager(i).removeModel(s)];case 5:p.sent(),p.label=6;case 6:return[2,l.modelArtifactsInfo];}})})}function hs(){if(!hi.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var a=window,e=a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB||a.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ms(a){var e=a.result;e.createObjectStore(Rh,{keyPath:"modelPath"}),e.createObjectStore(Sh,{keyPath:"modelPath"})}function gs(t){return new Eh(t)}function fs(t){return t.startsWith(Eh.URL_SCHEME)?t.slice(Eh.URL_SCHEME.length):t}function ys(t){return{info:[Ih,t,Nh].join(wh),topology:[Ih,t,Th].join(wh),weightSpecs:[Ih,t,Dh].join(wh),weightData:[Ih,t,Ah].join(wh),modelMetadata:[Ih,t,Oh].join(wh)}}function xs(a){var e=a.split(wh);if(3>e.length)throw new Error("Invalid key format: "+a);return e.slice(1,e.length-1).join(wh)}function bs(t){return t.startsWith(Ph.URL_SCHEME)?t.slice(Ph.URL_SCHEME.length):t}function vs(t){return new Ph(t)}function Cs(t){return void 0===t&&(t="model"),new Lh(t)}function Rs(s,e,t,n){!function(t){A(null!=t&&Array.isArray(t)&&0<t.length,function(){return"promises must be a none empty array"})}(s),function(a,e){A(0<=a&&1>=a,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),A(0<=e&&1>=e,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),A(e>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+e})}(t=null==t?0:t,n=null==n?1:n);var r=0;return Promise.all(s.map(function(o){return o.then(function(o){var a=t+ ++r/s.length*(n-t);return e(a),o}),o}))}function Ss(d,h){return x(this,void 0,void 0,function(){var t,e,n,o,a,r,s,i,u;return R(this,function(l){switch(l.label){case 0:return null==h&&(h={}),t=null==h.fetchFunc?fetch:h.fetchFunc,e=d.map(function(a){return t(a,h.requestInit)}),n=0,o=.5,null==h.onProgress?[4,Promise.all(e)]:[3,2];case 1:return a=l.sent(),[3,4];case 2:return[4,Rs(e,h.onProgress,n,o)];case 3:a=l.sent(),l.label=4;case 4:return r=a.map(function(t){return t.arrayBuffer()}),s=.5,i=1,null==h.onProgress?[4,Promise.all(r)]:[3,6];case 5:return u=l.sent(),[3,8];case 6:return[4,Rs(r,h.onProgress,s,i)];case 7:u=l.sent(),l.label=8;case 8:return[2,u];}})})}function Es(m){var e=this;return function(g,a,y){return void 0===a&&(a=""),x(e,void 0,void 0,function(){var o,x,r,t,e,n,s,b,i,p;return R(this,function(d){switch(d.label){case 0:if(o=g.map(function(){return!1}),x={},r=null==y?[]:y.map(function(){return!1}),t=[],g.forEach(function(a,s){var n=0;a.weights.forEach(function(a){var i="quantization"in a?a.quantization.dtype:a.dtype,p=gh[i]*U(a.shape),d=function(){o[s]=!0,null==x[s]&&(x[s]=[]),x[s].push({manifestEntry:a,groupOffset:n,sizeBytes:p})};null==y?d():y.forEach(function(e,t){e===a.name&&(d(),r[t]=!0)}),t.push(a.name),n+=p})}),!r.every(function(t){return t}))throw e=y.filter(function(a,e){return!r[e]}),new Error("Could not find weights in manifest with names: "+e.join(", ")+". \nManifest JSON has weights with names: "+t.join(", ")+".");return n=o.reduce(function(a,e,t){return e&&a.push(t),a},[]),s=[],n.forEach(function(t){g[t].paths.forEach(function(o){var e=a+(a.endsWith("/")?"":"/")+o;s.push(e)})}),[4,m(s)];case 1:return b=d.sent(),i={},p=0,n.forEach(function(a){for(var e=g[a].paths.length,t=0,n=0;n<e;n++)t+=b[p+n].byteLength;for(var o=new ArrayBuffer(t),r=new Uint8Array(o),s=0,d=0,u;d<e;d++)u=new Uint8Array(b[p+d]),r.set(u,s),s+=u.byteLength;x[a].forEach(function(a){var e=os(o.slice(a.groupOffset,a.groupOffset+a.sizeBytes),[a.manifestEntry]);for(var t in e)i[t]=e[t]}),p+=e}),[2,i];}})})}}function _s(a){var e=a.lastIndexOf("/"),t=a.lastIndexOf("?");return[a.substring(0,e)+"/",t>e?a.substring(t):""]}function ks(t){return null!=t.match(Wh.URL_SCHEME_REGEX)}function ws(a,e){return new Wh(a,e)}function Is(t){A(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),A("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),A(0<t.className.length,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),jh.register(t)}function Ns(a,e,o){return null==o&&(o=hi.get("TEST_EPSILON")),Ts(a,"number"==typeof e||"boolean"==typeof e?[e]:e,function(a,e){return Ds(a,+e,o)})}function Ts(p,e,t){if(!(p instanceof $s||e instanceof $s)){var n=p.constructor.name,r=e.constructor.name;if(n!==r)throw new Error("Arrays are of different type actual: "+n+" vs expected: "+r)}else if(p instanceof $s&&e instanceof $s){if(p.dtype!==e.dtype)throw new Error("Arrays are of different type actual: "+p.dtype+" vs expected: "+e.dtype+".");if(!L(p.shape,e.shape))throw new Error("Arrays are of different shape actual: "+p.shape+" vs expected: "+e.shape+".")}var o,a;if(o=p instanceof $s?p.dataSync():p,a=e instanceof $s?e.dataSync():e,o.length!==a.length)throw new Error("Arrays have different lengths actual: "+o.length+" vs expected: "+a.length+".\nActual:   "+o+".\nExpected: "+a+".");for(var i=0;i<a.length;++i){var s=o[i],d=a[i];if(!t(s,d))throw new Error("Arrays differ: actual["+i+"] = "+s+", expected["+i+"] = "+d+".\nActual:   "+o+".\nExpected: "+a+".")}}function Ds(a,e,t){return isNaN(a)&&isNaN(e)||!(isNaN(a)||isNaN(e)||l(a-e)>t)}a.d(t,"setBackend",function(){return dm}),a.d(t,"getBackend",function(){return lm}),a.d(t,"disposeVariables",function(){return um}),a.d(t,"memory",function(){return cm}),a.d(t,"version_core",function(){return Qh}),a.d(t,"nextFrame",function(){return as}),a.d(t,"enableProdMode",function(){return Je}),a.d(t,"enableDebugMode",function(){return et}),a.d(t,"disableDeprecationWarnings",function(){return tt}),a.d(t,"deprecationWarn",function(){return at}),a.d(t,"browser",function(){return $h}),a.d(t,"environment",function(){return mi}),a.d(t,"io",function(){return Vh}),a.d(t,"math",function(){return Hh}),a.d(t,"serialization",function(){return Xh}),a.d(t,"test_util",function(){return Yh}),a.d(t,"util",function(){return Bs}),a.d(t,"webgl",function(){return Zh}),a.d(t,"tensor_util",function(){return ti}),a.d(t,"AdadeltaOptimizer",function(){return em}),a.d(t,"AdagradOptimizer",function(){return tm}),a.d(t,"AdamOptimizer",function(){return am}),a.d(t,"AdamaxOptimizer",function(){return om}),a.d(t,"MomentumOptimizer",function(){return rm}),a.d(t,"Optimizer",function(){return Jh}),a.d(t,"RMSPropOptimizer",function(){return sm}),a.d(t,"SGDOptimizer",function(){return nm}),a.d(t,"Tensor",function(){return $s}),a.d(t,"TensorBuffer",function(){return Gs}),a.d(t,"variable",function(){return js}),a.d(t,"Variable",function(){return Ks}),a.d(t,"Rank",function(){return Xs}),a.d(t,"Reduction",function(){return qc}),a.d(t,"ENV",function(){return hi}),a.d(t,"Environment",function(){return di}),a.d(t,"KernelBackend",function(){return Ni}),a.d(t,"DataStorage",function(){return Ii}),a.d(t,"image",function(){return dh}),a.d(t,"linalg",function(){return nh}),a.d(t,"losses",function(){return th}),a.d(t,"spectral",function(){return Gc}),a.d(t,"fused",function(){return uh}),a.d(t,"op",function(){return qt}),a.d(t,"batchNormalization2d",function(){return Xl}),a.d(t,"batchNormalization3d",function(){return Yl}),a.d(t,"batchNormalization4d",function(){return Ql}),a.d(t,"batchNormalization",function(){return Zl}),a.d(t,"batchNorm",function(){return Jl}),a.d(t,"batchNorm2d",function(){return eu}),a.d(t,"batchNorm3d",function(){return tu}),a.d(t,"batchNorm4d",function(){return au}),a.d(t,"complex",function(){return Si}),a.d(t,"real",function(){return Ei}),a.d(t,"imag",function(){return _i}),a.d(t,"concat",function(){return Ed}),a.d(t,"concat1d",function(){return _d}),a.d(t,"concat2d",function(){return kd}),a.d(t,"concat3d",function(){return wd}),a.d(t,"concat4d",function(){return Id}),a.d(t,"split",function(){return Nd}),a.d(t,"conv1d",function(){return ou}),a.d(t,"conv2d",function(){return nu}),a.d(t,"conv3d",function(){return ru}),a.d(t,"conv2dDerFilter",function(){return su}),a.d(t,"depthwiseConv2d",function(){return iu}),a.d(t,"separableConv2d",function(){return pu}),a.d(t,"conv2dTranspose",function(){return du}),a.d(t,"matMul",function(){return lu}),a.d(t,"dot",function(){return uu}),a.d(t,"outerProduct",function(){return cu}),a.d(t,"reverse",function(){return hu}),a.d(t,"reverse1d",function(){return mu}),a.d(t,"reverse2d",function(){return gu}),a.d(t,"reverse3d",function(){return fu}),a.d(t,"reverse4d",function(){return yu}),a.d(t,"maxPool",function(){return xu}),a.d(t,"avgPool",function(){return bu}),a.d(t,"pool",function(){return vu}),a.d(t,"slice",function(){return Cu}),a.d(t,"slice1d",function(){return Ru}),a.d(t,"slice2d",function(){return Su}),a.d(t,"slice3d",function(){return Eu}),a.d(t,"slice4d",function(){return _u}),a.d(t,"abs",function(){return ml}),a.d(t,"acos",function(){return gl}),a.d(t,"acosh",function(){return fl}),a.d(t,"asin",function(){return yl}),a.d(t,"asinh",function(){return xl}),a.d(t,"atan",function(){return bl}),a.d(t,"atanh",function(){return vl}),a.d(t,"ceil",function(){return Cl}),a.d(t,"clipByValue",function(){return Rl}),a.d(t,"cos",function(){return Sl}),a.d(t,"cosh",function(){return El}),a.d(t,"erf",function(){return _l}),a.d(t,"exp",function(){return kl}),a.d(t,"expm1",function(){return wl}),a.d(t,"floor",function(){return Il}),a.d(t,"log",function(){return Nl}),a.d(t,"log1p",function(){return Tl}),a.d(t,"logSigmoid",function(){return Dl}),a.d(t,"neg",function(){return Al}),a.d(t,"reciprocal",function(){return Ol}),a.d(t,"round",function(){return Pl}),a.d(t,"rsqrt",function(){return Fl}),a.d(t,"sigmoid",function(){return Bl}),a.d(t,"sign",function(){return Ll}),a.d(t,"isNaN",function(){return Ml}),a.d(t,"isInf",function(){return Wl}),a.d(t,"isFinite",function(){return Ul}),a.d(t,"sin",function(){return zl}),a.d(t,"sinh",function(){return Gl}),a.d(t,"softplus",function(){return Vl}),a.d(t,"sqrt",function(){return Hl}),a.d(t,"square",function(){return ql}),a.d(t,"step",function(){return $l}),a.d(t,"tan",function(){return Kl}),a.d(t,"tanh",function(){return jl}),a.d(t,"all",function(){return ku}),a.d(t,"any",function(){return wu}),a.d(t,"argMax",function(){return Iu}),a.d(t,"argMin",function(){return Nu}),a.d(t,"logSumExp",function(){return Tu}),a.d(t,"max",function(){return Du}),a.d(t,"mean",function(){return Au}),a.d(t,"min",function(){return Ou}),a.d(t,"moments",function(){return Pu}),a.d(t,"sum",function(){return Fu}),a.d(t,"prod",function(){return Bu}),a.d(t,"equal",function(){return Lu}),a.d(t,"equalStrict",function(){return Mu}),a.d(t,"greater",function(){return Wu}),a.d(t,"greaterEqual",function(){return Uu}),a.d(t,"greaterEqualStrict",function(){return zu}),a.d(t,"greaterStrict",function(){return Gu}),a.d(t,"less",function(){return Vu}),a.d(t,"lessEqual",function(){return Hu}),a.d(t,"lessEqualStrict",function(){return qu}),a.d(t,"lessStrict",function(){return $u}),a.d(t,"notEqual",function(){return Ku}),a.d(t,"notEqualStrict",function(){return ju}),a.d(t,"add",function(){return Xu}),a.d(t,"addN",function(){return Yu}),a.d(t,"addStrict",function(){return Qu}),a.d(t,"atan2",function(){return Zu}),a.d(t,"div",function(){return Ju}),a.d(t,"divStrict",function(){return ec}),a.d(t,"floorDiv",function(){return tc}),a.d(t,"maximum",function(){return ac}),a.d(t,"maximumStrict",function(){return oc}),a.d(t,"minimum",function(){return nc}),a.d(t,"minimumStrict",function(){return rc}),a.d(t,"mod",function(){return sc}),a.d(t,"modStrict",function(){return ic}),a.d(t,"mul",function(){return pc}),a.d(t,"mulStrict",function(){return dc}),a.d(t,"pow",function(){return lc}),a.d(t,"powStrict",function(){return uc}),a.d(t,"squaredDifference",function(){return cc}),a.d(t,"squaredDifferenceStrict",function(){return hc}),a.d(t,"sub",function(){return mc}),a.d(t,"subStrict",function(){return gc}),a.d(t,"elu",function(){return Rc}),a.d(t,"leakyRelu",function(){return Sc}),a.d(t,"prelu",function(){return Ec}),a.d(t,"relu",function(){return _c}),a.d(t,"selu",function(){return kc}),a.d(t,"logicalAnd",function(){return fc}),a.d(t,"logicalNot",function(){return yc}),a.d(t,"logicalOr",function(){return xc}),a.d(t,"logicalXor",function(){return bc}),a.d(t,"where",function(){return vc}),a.d(t,"whereAsync",function(){return Cc}),a.d(t,"buffer",function(){return jn}),a.d(t,"print",function(){return Xn}),a.d(t,"batchToSpaceND",function(){return Ud}),a.d(t,"cast",function(){return zd}),a.d(t,"clone",function(){return Gd}),a.d(t,"cumsum",function(){return Vd}),a.d(t,"depthToSpace",function(){return Hd}),a.d(t,"expandDims",function(){return qd}),a.d(t,"eye",function(){return $d}),a.d(t,"multinomial",function(){return Kd}),a.d(t,"oneHot",function(){return jd}),a.d(t,"pad",function(){return Xd}),a.d(t,"pad1d",function(){return Yd}),a.d(t,"pad2d",function(){return Qd}),a.d(t,"pad3d",function(){return Zd}),a.d(t,"pad4d",function(){return Jd}),a.d(t,"rand",function(){return el}),a.d(t,"randomNormal",function(){return tl}),a.d(t,"randomUniform",function(){return al}),a.d(t,"reshape",function(){return ol}),a.d(t,"spaceToBatchND",function(){return nl}),a.d(t,"squeeze",function(){return rl}),a.d(t,"stack",function(){return sl}),a.d(t,"tile",function(){return il}),a.d(t,"truncatedNormal",function(){return pl}),a.d(t,"unstack",function(){return dl}),a.d(t,"setdiff1dAsync",function(){return ll}),a.d(t,"fill",function(){return aa}),a.d(t,"linspace",function(){return oa}),a.d(t,"ones",function(){return ea}),a.d(t,"range",function(){return na}),a.d(t,"scalar",function(){return Kt}),a.d(t,"tensor",function(){return $t}),a.d(t,"tensor1d",function(){return jt}),a.d(t,"tensor2d",function(){return Xt}),a.d(t,"tensor3d",function(){return Yt}),a.d(t,"tensor4d",function(){return Qt}),a.d(t,"tensor5d",function(){return Zt}),a.d(t,"tensor6d",function(){return Jt}),a.d(t,"zeros",function(){return ta}),a.d(t,"onesLike",function(){return ki}),a.d(t,"zerosLike",function(){return wi}),a.d(t,"transpose",function(){return wc}),a.d(t,"softmax",function(){return Ci}),a.d(t,"logSoftmax",function(){return Ri}),a.d(t,"localResponseNormalization",function(){return Ic}),a.d(t,"norm",function(){return Nc}),a.d(t,"gather",function(){return Tc}),a.d(t,"unsortedSegmentSum",function(){return Dc}),a.d(t,"basicLSTMCell",function(){return Ac}),a.d(t,"multiRNNCell",function(){return Oc}),a.d(t,"movingAverage",function(){return Pc}),a.d(t,"stridedSlice",function(){return Fc}),a.d(t,"topk",function(){return Bc}),a.d(t,"scatterND",function(){return Lc}),a.d(t,"fft",function(){return Mc}),a.d(t,"ifft",function(){return Wc}),a.d(t,"rfft",function(){return Uc}),a.d(t,"irfft",function(){return zc}),a.d(t,"sparseToDense",function(){return Vc}),a.d(t,"gatherND",function(){return Hc}),a.d(t,"train",function(){return pm}),a.d(t,"tidy",function(){return gi}),a.d(t,"keep",function(){return fi}),a.d(t,"dispose",function(){return yi}),a.d(t,"time",function(){return xi}),a.d(t,"profile",function(){return bi}),a.d(t,"customGrad",function(){return ht}),a.d(t,"grad",function(){return pt}),a.d(t,"grads",function(){return dt}),a.d(t,"valueAndGrad",function(){return lt}),a.d(t,"valueAndGrads",function(){return ut}),a.d(t,"variableGrads",function(){return ct});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var As=function(a,e){return(As=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=e}||function(a,e){for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t])})(a,e)},Os=function(){return(Os=Object.assign||function(a){for(var e=1,n=arguments.length,r;e<n;e++)for(var t in r=arguments[e])Object.prototype.hasOwnProperty.call(r,t)&&(a[t]=r[t]);return a}).apply(this,arguments)},Ps={},Fs={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0},Bs=Object.freeze({shuffle:w,clamp:I,nearestLargerEven:N,sum:T,randUniform:D,distSquared:function(a,e){for(var t=0,n=0,r;n<a.length;n++)r=+a[n]-+e[n],t+=r*r;return t},assert:A,assertShapesMatch:O,assertNonNull:P,flatten:F,sizeFromShape:U,isScalarShape:function(t){return 0===t.length},arraysEqual:L,isInt:M,tanh:z,sizeToSquarishShape:G,createShuffledIndices:function(a){for(var e=new Uint32Array(a),t=0;t<a;++t)e[t]=t;return w(e),e},rightPad:V,repeatedTry:H,inferFromImplicitShape:q,parseAxisParam:K,squeezeShape:j,getTypedArrayFromDType:X,getArrayFromDType:Y,checkComputationForErrors:Q,checkConversionForErrors:Z,hasEncodingLoss:J,isTypedArray:ee,bytesPerElement:te,bytesFromStringArray:ae,isString:oe,isBoolean:ne,isNumber:re,inferDtype:se,isFunction:ie,nearestDivisor:ue,computeStrides:ce,toTypedArray:he,toNestedArray:ge,makeOnesTypedArray:ye,makeZerosTypedArray:xe,now:be,assertNonNegativeIntegerDimensions:ve}),Ls=function(){function t(a,o){this.backendTimer=a,this.logger=o,null==o&&(this.logger=new Ms)}return t.prototype.profileKernel=function(s,e){var i=this,a=this.backendTimer.time(function(){t=e()}),t;return(Array.isArray(t)?t:[t]).forEach(function(e){var t=e.dataSync();Q(t,e.dtype,s),a.then(function(n){var o="";null!=n.getExtraProfileInfo&&(o=n.getExtraProfileInfo()),i.logger.logKernelProfile(s,e,t,n.kernelMs,o)})}),t},t}(),Ms=function(){function t(){}return t.prototype.logKernelProfile=function(p,e,t,n,r){var o=V(n+"ms",9),a=V(p,25),i=e.rank,s=e.size,d=V(e.shape.toString(),14);console.log("%c"+a+"\t%c"+o+"\t%c"+i+"D "+d+"\t%c"+s+"\t%c"+r,"font-weight:bold","color:red","color:blue","color: orange","color: green")},t}(),Ws=20,Us=3,zs=7,Gs=function(){function t(a,s,t){var n=this;if(this.dtype=s,this.shape=a.slice(),this.size=U(a),null!=t){var r=t.length;A(r===this.size,function(){return"Length of values '"+r+"' does not match the size inferred by the shape '"+n.size+"'."})}if("complex64"===s)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=t||Y(s,this.size),this.strides=ce(a)}return t.prototype.set=function(a){for(var e=this,t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length&&(t=[0]),A(t.length===this.rank,function(){return"The number of provided coordinates ("+t.length+") must match the rank ("+e.rank+")"});var r=this.locToIndex(t);this.values[r]=a},t.prototype.get=function(){for(var p=[],e=0;e<arguments.length;e++)p[e]=arguments[e];0===p.length&&(p=[0]);for(var t=0,n=0,r=p,o;n<r.length;n++){if(o=r[n],0>o||o>=this.shape[t]){var a="Requested out of range element at "+p+".   Buffer shape="+this.shape;throw new Error(a)}t++}for(var i=p[p.length-1],s=0;s<p.length-1;++s)i+=this.strides[s]*p[s];return this.values[i]},t.prototype.locToIndex=function(a){if(0===this.rank)return 0;if(1===this.rank)return a[0];for(var e=a[a.length-1],t=0;t<a.length-1;++t)e+=this.strides[t]*a[t];return e},t.prototype.indexToLoc=function(a){if(0===this.rank)return[];if(1===this.rank)return[a];for(var e=Array(this.shape.length),t=0;t<e.length-1;++t)e[t]=$(a/this.strides[t]),a-=e[t]*this.strides[t];return e[e.length-1]=a,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return $s.make(this.shape,{values:this.values},this.dtype)},t}(),Vs=null,Hs=null,qs=null,$s=function(){function a(a,s,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=a.slice(),this.dtype=s||"float32",this.size=U(a),this.strides=ce(a),this.dataId=null==n?{}:n,this.id=Vs().nextTensorId(),this.rankType=5>this.rank?this.rank.toString():"higher",Vs().registerTensor(this,r),null!=t&&Vs().write(this.dataId,t)}return a.make=function(e,t,n,r){return new a(e,n,t.values,t.dataId,r)},a.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},a.prototype.asScalar=function(){return this.throwIfDisposed(),A(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},a.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},a.prototype.as2D=function(a,e){return this.throwIfDisposed(),this.reshape([a,e])},a.prototype.as3D=function(a,e,t){return this.throwIfDisposed(),this.reshape([a,e,t])},a.prototype.as4D=function(a,e,t,o){return this.throwIfDisposed(),this.reshape([a,e,t,o])},a.prototype.as5D=function(a,e,t,n,r){return this.throwIfDisposed(),this.reshape([a,e,t,n,r])},a.prototype.asType=function(t){return this.throwIfDisposed(),Hs.cast(this,t)},Object.defineProperty(a.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),a.prototype.buffer=function(){return x(this,void 0,void 0,function(){var a;return R(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return a=e.sent(),[2,Hs.buffer(this.shape,this.dtype,a)];}})})},a.prototype.bufferSync=function(){return Hs.buffer(this.shape,this.dtype,this.dataSync())},a.prototype.array=function(){return x(this,void 0,void 0,function(){var a;return R(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return a=e.sent(),[2,ge(this.shape,a)];}})})},a.prototype.arraySync=function(){return ge(this.shape,this.dataSync())},a.prototype.data=function(){return x(this,void 0,void 0,function(){return R(this,function(){return this.throwIfDisposed(),[2,Vs().read(this.dataId)]})})},a.prototype.dataSync=function(){return this.throwIfDisposed(),Vs().readSync(this.dataId)},a.prototype.dispose=function(){this.isDisposed||(Vs().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(a.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),a.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},a.prototype.toFloat=function(){return this.asType("float32")},a.prototype.toInt=function(){return this.asType("int32")},a.prototype.toBool=function(){return this.asType("bool")},a.prototype.print=function(t){return void 0===t&&(t=!1),Hs.print(this,t)},a.prototype.reshape=function(t){return this.throwIfDisposed(),Hs.reshape(this,t)},a.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},a.prototype.expandDims=function(t){return void 0===t&&(t=0),Hs.expandDims(this,t)},a.prototype.cumsum=function(a,e,t){return void 0===a&&(a=0),void 0===e&&(e=!1),void 0===t&&(t=!1),Hs.cumsum(this,a,e,t)},a.prototype.squeeze=function(t){return this.throwIfDisposed(),Hs.squeeze(this,t)},a.prototype.clone=function(){return this.throwIfDisposed(),Hs.clone(this)},a.prototype.oneHot=function(a,e,t){return this.throwIfDisposed(),Hs.oneHot(this,a,e,t)},a.prototype.toString=function(t){return void 0===t&&(t=!1),Ce(this.dataSync(),this.shape,this.dtype,t)},a.prototype.tile=function(t){return this.throwIfDisposed(),Hs.tile(this,t)},a.prototype.gather=function(a,e){return void 0===e&&(e=0),this.throwIfDisposed(),Hs.gather(this,a,e)},a.prototype.matMul=function(a,e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),this.throwIfDisposed(),Hs.matMul(this,a,e,t)},a.prototype.dot=function(t){return this.throwIfDisposed(),Hs.dot(this,t)},a.prototype.norm=function(a,e,t){return void 0===a&&(a="euclidean"),void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Hs.norm(this,a,e,t)},a.prototype.slice=function(a,e){return this.throwIfDisposed(),Hs.slice(this,a,e)},a.prototype.reverse=function(t){return this.throwIfDisposed(),Hs.reverse(this,t)},a.prototype.concat=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),e instanceof a&&(e=[e]),Hs.concat([this].concat(e),t)},a.prototype.split=function(a,e){return void 0===e&&(e=0),this.throwIfDisposed(),Hs.split(this,a,e)},a.prototype.stack=function(a,e){return void 0===e&&(e=0),Hs.stack([this,a],e)},a.prototype.unstack=function(t){return void 0===t&&(t=0),Hs.unstack(this,t)},a.prototype.pad=function(a,e){return void 0===e&&(e=0),Hs.pad(this,a,e)},a.prototype.batchNormalization=function(a,e,t,n,r){return void 0===t&&(t=.001),qs("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(a,e,r,n,t)},a.prototype.batchNorm=function(a,e,t,n,r){return void 0===r&&(r=.001),this.throwIfDisposed(),Hs.batchNorm(this,a,e,t,n,r)},a.prototype.all=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Hs.all(this,a,e)},a.prototype.any=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Hs.any(this,a,e)},a.prototype.logSumExp=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Hs.logSumExp(this,a,e)},a.prototype.sum=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Hs.sum(this,a,e)},a.prototype.prod=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Hs.prod(this,a,e)},a.prototype.mean=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Hs.mean(this,a,e)},a.prototype.min=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Hs.min(this,a,e)},a.prototype.max=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Hs.max(this,a,e)},a.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Hs.argMin(this,t)},a.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Hs.argMax(this,t)},a.prototype.cast=function(t){return this.throwIfDisposed(),Hs.cast(this,t)},a.prototype.add=function(t){return this.throwIfDisposed(),Hs.add(this,t)},a.prototype.addStrict=function(t){return this.throwIfDisposed(),Hs.addStrict(this,t)},a.prototype.atan2=function(t){return this.throwIfDisposed(),Hs.atan2(this,t)},a.prototype.sub=function(t){return this.throwIfDisposed(),Hs.sub(this,t)},a.prototype.subStrict=function(t){return this.throwIfDisposed(),Hs.subStrict(this,t)},a.prototype.pow=function(t){return this.throwIfDisposed(),Hs.pow(this,t)},a.prototype.powStrict=function(t){return this.throwIfDisposed(),Hs.powStrict(this,t)},a.prototype.mul=function(t){return this.throwIfDisposed(),Hs.mul(this,t)},a.prototype.mulStrict=function(t){return this.throwIfDisposed(),Hs.mulStrict(this,t)},a.prototype.div=function(t){return this.throwIfDisposed(),Hs.div(this,t)},a.prototype.floorDiv=function(t){return this.throwIfDisposed(),Hs.floorDiv(this,t)},a.prototype.divStrict=function(t){return this.throwIfDisposed(),Hs.divStrict(this,t)},a.prototype.minimum=function(t){return this.throwIfDisposed(),Hs.minimum(this,t)},a.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Hs.minimumStrict(this,t)},a.prototype.maximum=function(t){return this.throwIfDisposed(),Hs.maximum(this,t)},a.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Hs.maximumStrict(this,t)},a.prototype.mod=function(t){return this.throwIfDisposed(),Hs.mod(this,t)},a.prototype.modStrict=function(t){return this.throwIfDisposed(),Hs.modStrict(this,t)},a.prototype.squaredDifference=function(t){return this.throwIfDisposed(),Hs.squaredDifference(this,t)},a.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Hs.squaredDifferenceStrict(this,t)},a.prototype.transpose=function(t){return this.throwIfDisposed(),Hs.transpose(this,t)},a.prototype.notEqual=function(t){return this.throwIfDisposed(),Hs.notEqual(this,t)},a.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Hs.notEqualStrict(this,t)},a.prototype.less=function(t){return this.throwIfDisposed(),Hs.less(this,t)},a.prototype.lessStrict=function(t){return this.throwIfDisposed(),Hs.lessStrict(this,t)},a.prototype.equal=function(t){return this.throwIfDisposed(),Hs.equal(this,t)},a.prototype.equalStrict=function(t){return this.throwIfDisposed(),Hs.equalStrict(this,t)},a.prototype.lessEqual=function(t){return this.throwIfDisposed(),Hs.lessEqual(this,t)},a.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Hs.lessEqualStrict(this,t)},a.prototype.greater=function(t){return this.throwIfDisposed(),Hs.greater(this,t)},a.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Hs.greaterStrict(this,t)},a.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Hs.greaterEqual(this,t)},a.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Hs.greaterEqualStrict(this,t)},a.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Hs.logicalAnd(this,t)},a.prototype.logicalOr=function(t){return this.throwIfDisposed(),Hs.logicalOr(this,t)},a.prototype.logicalNot=function(){return this.throwIfDisposed(),Hs.logicalNot(this)},a.prototype.logicalXor=function(t){return this.throwIfDisposed(),Hs.logicalXor(this,t)},a.prototype.where=function(a,e){return this.throwIfDisposed(),Hs.where(a,this,e)},a.prototype.neg=function(){return this.throwIfDisposed(),Hs.neg(this)},a.prototype.ceil=function(){return this.throwIfDisposed(),Hs.ceil(this)},a.prototype.floor=function(){return this.throwIfDisposed(),Hs.floor(this)},a.prototype.sign=function(){return this.throwIfDisposed(),Hs.sign(this)},a.prototype.exp=function(){return this.throwIfDisposed(),Hs.exp(this)},a.prototype.expm1=function(){return this.throwIfDisposed(),Hs.expm1(this)},a.prototype.log=function(){return this.throwIfDisposed(),Hs.log(this)},a.prototype.log1p=function(){return this.throwIfDisposed(),Hs.log1p(this)},a.prototype.sqrt=function(){return this.throwIfDisposed(),Hs.sqrt(this)},a.prototype.rsqrt=function(){return this.throwIfDisposed(),Hs.rsqrt(this)},a.prototype.square=function(){return this.throwIfDisposed(),Hs.square(this)},a.prototype.reciprocal=function(){return this.throwIfDisposed(),Hs.reciprocal(this)},a.prototype.abs=function(){return this.throwIfDisposed(),Hs.abs(this)},a.prototype.clipByValue=function(a,e){return this.throwIfDisposed(),Hs.clipByValue(this,a,e)},a.prototype.relu=function(){return this.throwIfDisposed(),Hs.relu(this)},a.prototype.elu=function(){return this.throwIfDisposed(),Hs.elu(this)},a.prototype.selu=function(){return this.throwIfDisposed(),Hs.selu(this)},a.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),Hs.leakyRelu(this,t)},a.prototype.prelu=function(t){return this.throwIfDisposed(),Hs.prelu(this,t)},a.prototype.sigmoid=function(){return this.throwIfDisposed(),Hs.sigmoid(this)},a.prototype.logSigmoid=function(){return this.throwIfDisposed(),Hs.logSigmoid(this)},a.prototype.softplus=function(){return this.throwIfDisposed(),Hs.softplus(this)},a.prototype.zerosLike=function(){return this.throwIfDisposed(),Hs.zerosLike(this)},a.prototype.onesLike=function(){return this.throwIfDisposed(),Hs.onesLike(this)},a.prototype.sin=function(){return this.throwIfDisposed(),Hs.sin(this)},a.prototype.cos=function(){return this.throwIfDisposed(),Hs.cos(this)},a.prototype.tan=function(){return this.throwIfDisposed(),Hs.tan(this)},a.prototype.asin=function(){return this.throwIfDisposed(),Hs.asin(this)},a.prototype.acos=function(){return this.throwIfDisposed(),Hs.acos(this)},a.prototype.atan=function(){return this.throwIfDisposed(),Hs.atan(this)},a.prototype.sinh=function(){return this.throwIfDisposed(),Hs.sinh(this)},a.prototype.cosh=function(){return this.throwIfDisposed(),Hs.cosh(this)},a.prototype.tanh=function(){return this.throwIfDisposed(),Hs.tanh(this)},a.prototype.asinh=function(){return this.throwIfDisposed(),Hs.asinh(this)},a.prototype.acosh=function(){return this.throwIfDisposed(),Hs.acosh(this)},a.prototype.atanh=function(){return this.throwIfDisposed(),Hs.atanh(this)},a.prototype.erf=function(){return this.throwIfDisposed(),Hs.erf(this)},a.prototype.round=function(){return this.throwIfDisposed(),Hs.round(this)},a.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),Hs.step(this,t)},a.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Hs.softmax(this,t)},a.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Hs.logSoftmax(this,t)},a.prototype.resizeBilinear=function(a,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Hs.image.resizeBilinear(this,a,e)},a.prototype.resizeNearestNeighbor=function(a,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Hs.image.resizeNearestNeighbor(this,a,e)},a.prototype.conv1d=function(s,e,t,n,r,o){return void 0===n&&(n="NWC"),void 0===r&&(r=1),this.throwIfDisposed(),Hs.conv1d(this,s,e,t,n,r,o)},a.prototype.conv2d=function(s,e,t,n,r,o){return void 0===n&&(n="NHWC"),void 0===r&&(r=[1,1]),this.throwIfDisposed(),Hs.conv2d(this,s,e,t,n,r,o)},a.prototype.conv2dTranspose=function(a,e,t,n,r){return this.throwIfDisposed(),Hs.conv2dTranspose(this,a,e,t,n,r)},a.prototype.depthwiseConv2D=function(s,e,t,n,r,o){return void 0===n&&(n="NHWC"),void 0===r&&(r=[1,1]),this.throwIfDisposed(),Hs.depthwiseConv2d(this,s,e,t,n,r,o)},a.prototype.separableConv2d=function(s,e,t,n,r,o){return void 0===r&&(r=[1,1]),void 0===o&&(o="NHWC"),this.throwIfDisposed(),Hs.separableConv2d(this,s,e,t,n,r,o)},a.prototype.avgPool=function(a,e,t,o){return this.throwIfDisposed(),Hs.avgPool(this,a,e,t,o)},a.prototype.maxPool=function(a,e,t,o){return this.throwIfDisposed(),Hs.maxPool(this,a,e,t,o)},a.prototype.localResponseNormalization=function(a,e,t,o){return void 0===a&&(a=5),void 0===e&&(e=1),void 0===t&&(t=1),void 0===o&&(o=.5),Hs.localResponseNormalization(this,a,e,t,o)},a.prototype.pool=function(a,e,t,n,r){return this.throwIfDisposed(),Hs.pool(this,a,e,t,n,r)},a.prototype.variable=function(a,e,t){return void 0===a&&(a=!0),this.throwIfDisposed(),Ks.variable(this,a,e,t)},a.prototype.unsortedSegmentSum=function(a,e){return this.throwIfDisposed(),Hs.unsortedSegmentSum(this,a,e)},a.prototype.batchToSpaceND=function(a,e){return this.throwIfDisposed(),Hs.batchToSpaceND(this,a,e)},a.prototype.spaceToBatchND=function(a,e){return this.throwIfDisposed(),Hs.spaceToBatchND(this,a,e)},a.prototype.topk=function(a,e){return void 0===a&&(a=1),void 0===e&&(e=!0),this.throwIfDisposed(),Hs.topk(this,a,e)},a.prototype.stridedSlice=function(p,e,t,n,r,o,a,i){return void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),this.throwIfDisposed(),Hs.stridedSlice(this,p,e,t,n,r,o,a,i)},a.prototype.depthToSpace=function(a,e){return this.throwIfDisposed(),Hs.depthToSpace(this,a,e)},a.prototype.fft=function(){return this.throwIfDisposed(),Hs.spectral.fft(this)},a.prototype.ifft=function(){return this.throwIfDisposed(),Hs.spectral.ifft(this)},a.prototype.rfft=function(){return this.throwIfDisposed(),Hs.spectral.rfft(this)},a.prototype.irfft=function(){return this.throwIfDisposed(),Hs.spectral.irfft(this)},a}();Object.defineProperty($s,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var Ks=function(a){function s(e,s,n){void 0===s&&(s=!0);var r=a.call(this,e.shape,e.dtype,null,e.dataId)||this;r.trainable=s,r.name=n,null==r.name&&(r.name=Vs().nextVariableId().toString());try{Vs().registerVariable(r)}catch(t){throw Vs().disposeTensor(r),t}return r}return y(s,a),s.variable=function(t,e,a,n){return void 0===e&&(e=!0),null!=n&&n!==t.dtype&&(t=t.asType(n)),new s(t,e,a)},s.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!L(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Vs().disposeTensor(this),this.dataId=t.dataId,Vs().registerTensor(this)},s}($s);Object.defineProperty(Ks,Symbol.hasInstance,{value:function(t){return t instanceof $s&&null!=t.assign&&t.assign instanceof Function}});var js=Ks.variable,Xs,Ys,Qs,Zs,Js;!function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(Xs||(Xs={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Ys||(Ys={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Qs||(Qs={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Zs||(Zs={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Js||(Js={}));var ei={float32:Zs,int32:Ys,bool:Qs,complex64:Js},ti=Object.freeze({makeTypesMatch:Ae,assertTypesMatch:Oe,isTensorInList:function(a,e){for(var t=0;t<e.length;t++)if(e[t].id===a.id)return!0;return!1},getTensorsInContainer:Pe}),ai=function(){function t(a,o,t){this.backend=a,this.safeMode=o,this.debugMode=t,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiler=new Ls(a),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.moveData=function(t){this.write(t,this.readSync(t))},t.prototype.tidy=function(a,s){var i=this,r=null,o;if(null==s){if("function"!=typeof a)throw new Error("Please provide a function to tidy()");s=a}else{if("string"!=typeof a&&!(a instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof s)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=a}return this.scopedRun(function(){return i.startScope(r)},function(){return i.endScope(o)},function(){return(o=s())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o})},t.prototype.scopedRun=function(a,o,e){a();try{var t=e();return o(),t}catch(t){throw o(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(a){var e=$s.make(a.shape,{dataId:a.dataId},a.dtype);return this.addTapeNode([a],e,function(t){return[t.toFloat()]}),e},t.prototype.runKernel=function(d,h,m){var n=this,o=[],g=this.isTapeOn(),e=null==this.activeScope?"":this.activeScope.name,i=function(t){g&&(o=t.map(function(t){return n.keep(n.clone(t))}))},u=this.numBytes,c=this.numTensors,l;if(this.scopedRun(function(){return n.kernelDepth++},function(){return n.kernelDepth--},function(){l=n.debugMode()?n.profiler.profileKernel(e,function(){return d(n.backend,i)}):d(n.backend,i)}),g){var r={id:this.nextTapeNodeId++,name:e,inputs:h,outputs:Array.isArray(l)?l:[l],saved:o};null!=m&&(r.gradient=function(t){return m(t,o)}),this.activeTape.push(r)}return this.profiling&&this.activeProfile.kernels.push({name:e,bytesAdded:this.numBytes-u,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-c,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(h).map(function(t){return h[t].shape}),outputShape:Array.isArray(l)?l.map(function(t){return t.shape}):l.shape}),l},t.prototype.registerTensor=function(a,e){var t=this.tensorInfo.has(a.dataId)?this.tensorInfo.get(a.dataId).refCount:0;if(this.numTensors++,"string"===a.dtype&&this.numStringTensors++,0===t){this.numDataBuffers++;var o=0;"complex64"!==a.dtype&&"string"!==a.dtype&&(o=a.size*te(a.dtype)),this.tensorInfo.set(a.dataId,{backend:null==e?this.backend:e,dtype:a.dtype,shape:a.shape,bytes:o,refCount:0}),this.numBytes+=o,null==e?this.backend.register(a.dataId,a.shape,a.dtype):e.register(a.dataId,a.shape,a.dtype)}this.tensorInfo.get(a.dataId).refCount++,a instanceof Ks||this.track(a)},t.prototype.registerVariable=function(t){if(null!=this.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(a){if(this.tensorInfo.has(a.dataId)){this.numTensors--,"string"===a.dtype&&this.numStringTensors--;var e=this.tensorInfo.get(a.dataId);1>=e.refCount?("complex64"!==a.dtype&&(this.numBytes-=e.bytes),this.numDataBuffers--,e.backend.disposeData(a.dataId),this.tensorInfo.delete(a.dataId)):this.tensorInfo.get(a.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var a in this.registeredVariables){var e=this.registeredVariables[a];this.disposeTensor(e),delete this.registeredVariables[a]}},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,0<this.numStringTensors&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(a){return x(this,void 0,void 0,function(){var e,t;return R(this,function(){return this.profiling=!0,e=this.numBytes,t=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=a(),this.profiling=!1,this.activeProfile.peakBytes=de.apply(Math,this.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-e,this.activeProfile.newTensors=this.numTensors-t,[2,this.activeProfile]})})},t.prototype.isTapeOn=function(){return 0<this.gradientDepth&&0===this.kernelDepth},t.prototype.addTapeNode=function(a,e,s){var n={};a.forEach(function(a,e){n[e]=a});var t={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:n,outputs:[e],gradient:function(a){var o={};return s(a).forEach(function(t,e){o[e]=function(){return t}}),o}};this.activeTape.push(t)},t.prototype.keep=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return t.kept=!0,t},t.prototype.startTape=function(){0===this.gradientDepth&&(this.activeTape=[]),this.gradientDepth++},t.prototype.endTape=function(){this.gradientDepth--},t.prototype.startScope=function(a){var e={track:[],name:"unnamed scope",id:this.nextScopeId++};a&&(e.name=a),this.scopeStack.push(e),this.activeScope=e},t.prototype.endScope=function(s){for(var p=this,e=Pe(s),t=new Set(e.map(function(t){return t.id})),n=0,o;n<this.activeScope.track.length;n++)o=this.activeScope.track[n],o.kept||t.has(o.id)||o.dispose();var a=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?null:this.scopeStack[this.scopeStack.length-1],e.forEach(function(t){t.kept||t.scopeId!==a.id||p.track(t)})},t.prototype.gradients=function(s,p,t,e){var n=this;if(void 0===e&&(e=!1),A(0<p.length,function(){return"gradients() received an empty list of xs."}),null!=t&&"float32"!==t.dtype)throw new Error("dy must have 'float32' dtype, but has '"+t.dtype+"'");var o=this.scopedRun(function(){return n.startTape()},function(){return n.endTape()},function(){return n.tidy("forward",s)});A(o instanceof $s,function(){return"The result y returned by f() must be a tensor."});var d=Ie(this.activeTape,p,o);if(!e&&0===d.length&&0<p.length)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var s={};s[o.id]=null==t?Le(o.shape):t,Ne(s,d,function(t){return n.tidy(t)});var e=p.map(function(e){return s[e.id]});return 0===n.gradientDepth&&(n.activeTape.forEach(function(a){for(var e in a.saved)a.saved[e].dispose()}),n.activeTape=null),{value:o,grads:e}})},t.prototype.customGrad=function(a){var e=this;return A(ie(a),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var s=[],t=0,r;t<arguments.length;t++)s[t]=arguments[t];A(s.every(function(t){return t instanceof $s}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return s.forEach(function(a,e){o[e]=a}),e.runKernel(function(e,t){return A((r=a.apply(void 0,s.concat([t]))).value instanceof $s,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),A(ie(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},o,function(n,e){var t=r.gradFunc(n,e),o=Array.isArray(t)?t:[t];A(o.length===s.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),A(o.every(function(t){return t instanceof $s}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return o.forEach(function(o,e){a[e]=function(){return o}}),a})}},t.prototype.write=function(a,e){var t=this.tensorInfo.get(a);if("string"===t.dtype){var o=ae(e);this.numBytes+=o-t.bytes,t.bytes=o}this.backend!==t.backend&&(t.backend.disposeData(a),t.backend=this.backend,this.backend.register(a,t.shape,t.dtype)),this.backend.write(a,e)},t.prototype.readSync=function(t){return this.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.tensorInfo.get(t).backend.read(t)},t.prototype.fromPixels=function(a,e){return this.backend.fromPixels(a,e)},t.prototype.time=function(a){return x(this,void 0,void 0,function(){var e,t;return R(this,function(o){switch(o.label){case 0:return e=be(),[4,this.backend.time(a)];case 1:return(t=o.sent()).wallMs=be()-e,[2,t];}})})},t.prototype.track=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return null!=this.activeScope&&(t.scopeId=this.activeScope.id,this.activeScope.track.push(t)),t},t.nextTensorId=0,t.nextVariableId=0,t}(),oi;!function(t){t[t.NUMBER=0]="NUMBER",t[t.BOOLEAN=1]="BOOLEAN",t[t.STRING=2]="STRING"}(oi||(oi={}));var ni=[{name:"DEBUG",type:oi.BOOLEAN},{name:"IS_BROWSER",type:oi.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:oi.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:oi.BOOLEAN},{name:"WEBGL_PACK",type:oi.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:oi.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:oi.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:oi.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:oi.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:oi.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:oi.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:oi.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:oi.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:oi.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:oi.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:oi.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:oi.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:oi.BOOLEAN},{name:"WEBGL_VERSION",type:oi.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:oi.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:oi.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:oi.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:oi.NUMBER},{name:"BACKEND",type:oi.STRING},{name:"EPSILON",type:oi.NUMBER},{name:"PROD",type:oi.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:oi.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:oi.BOOLEAN}],ri="tfjsflags",si=600,ii=1e-4,pi=1e-7,di=function(){function t(t){this.features={},this.registry={},this.registryFactory={},null!=t&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return t.setBackend=function(a,e){if(void 0===e&&(e=!1),!(a in hi.registry))throw new Error("Backend name '"+a+"' not found in registry");hi.engine.backend=hi.findBackend(a),hi.backendName=a},t.getBackend=function(){return hi.initEngine(),hi.backendName},t.disposeVariables=function(){hi.engine.disposeVariables()},t.memory=function(){return hi.engine.memory()},t.profile=function(t){return hi.engine.profile(t)},t.tidy=function(a,e){return hi.engine.tidy(a,e)},t.dispose=function(t){Pe(t).forEach(function(t){return t.dispose()})},t.keep=function(t){return hi.engine.keep(t)},t.time=function(t){return hi.engine.time(t)},t.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},t.prototype.getFeatures=function(){return this.features},t.prototype.set=function(a,e){this.features[a]=e},t.prototype.getBestBackendName=function(){var a=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(e){return{name:e,entry:a.registry[e]}}).sort(function(a,e){return e.entry.priority-a.entry.priority})[0].name},t.prototype.evaluateFeature=function(a){if("DEBUG"===a)return!1;if("IS_BROWSER"===a)return"undefined"!=typeof window;if("IS_NODE"===a)return"undefined"!=typeof r&&void 0!==r.versions&&void 0!==r.versions.node;if("IS_CHROME"===a)return qe();if("WEBGL_CPU_FORWARD"===a)return!0;if("WEBGL_PACK"===a)return 0!==this.get("WEBGL_VERSION");if("WEBGL_PACK_BATCHNORMALIZATION"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_CLIP"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_DEPTHWISECONV"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_BINARY_OPERATIONS"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_ARRAY_OPERATIONS"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_IMAGE_OPERATIONS"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_REDUCE"===a)return this.get("WEBGL_PACK");if("WEBGL_LAZILY_UNPACK"===a)return this.get("WEBGL_PACK");if("WEBGL_CONV_IM2COL"===a)return this.get("WEBGL_PACK");if("WEBGL_NUM_MB_BEFORE_PAGING"===a)return this.get("PROD")||!this.get("IS_BROWSER")?W:Qe();if("WEBGL_MAX_TEXTURE_SIZE"===a)return We(this.get("WEBGL_VERSION"));if("WEBGL_MAX_TEXTURES_IN_SHADER"===a)return Ue(this.get("WEBGL_VERSION"));if("IS_TEST"===a)return!1;if("BACKEND"===a)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===a){var e=this.get("WEBGL_VERSION");return 0===e?0:ze(e)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===a)return 0<this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")&&!k();if("HAS_WEBGL"===a)return 0<this.get("WEBGL_VERSION");if("WEBGL_VERSION"===a)return Me(2)?2:Me(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===a)return Ge(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===a)return Ve(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===a)return He(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===a)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if("TEST_EPSILON"===a)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===a)return 32===this.backend.floatPrecision()?pi:ii;if("PROD"===a)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===a)return!this.get("PROD");if("DEPRECATION_WARNINGS_ENABLED"===a)return!0;throw new Error("Unknown feature "+a+".")},t.prototype.setFeatures=function(t){this.features=Object.assign({},t)},t.prototype.reset=function(){this.features=$e(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(t.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),t.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t]:null},t.prototype.registerBackend=function(a,e,t){var s=this;if(void 0===t&&(t=1),a in this.registry)return console.warn(a+" backend was already registered. Reusing existing backend"),!1;try{var r=e();return r.setDataMover({moveData:function(t){return s.engine.moveData(t)}}),this.registry[a]={backend:r,priority:t},this.registryFactory[a]=e,!0}catch(e){return console.warn("Registration of backend "+a+" failed"),console.warn(e.stack||e.message),!1}},t.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(t.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),t.prototype.initEngine=function(){var a=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var e=this.findBackend(this.backendName);this.globalEngine=new ai(e,!1,function(){return a.get("DEBUG")})}},Object.defineProperty(t.prototype,"global",{get:function(){return Ze()},enumerable:!0,configurable:!0}),t}(),li,ui,ci;(function(t){qs=t})(at);var hi=function(){var t=Ze();return null==t.ENV&&(t.ENV=new di($e())),we(function(){return t.ENV.engine}),t.ENV}(),mi=Object.freeze({EPSILON_FLOAT16:ii,EPSILON_FLOAT32:pi,Environment:di,enableProdMode:Je,enableDebugMode:et,disableDeprecationWarnings:tt,deprecationWarn:at,ENV:hi}),gi=di.tidy,fi=di.keep,yi=di.dispose,xi=di.time,bi=di.profile,vi=30,Ci=qt({softmax_:function(a,s){void 0===s&&(s=-1);var e=st(a,"logits","softmax");if(-1===s&&(s=e.rank-1),s!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+s);return ht(function(t,e){var a=t.logSumExp([s],!0),n=t.toFloat().sub(a).exp();return e([n]),{value:n,gradFunc:function(t,e){var a=e[0],n=t.mul(a);return n.sub(n.sum([s],!0).mul(a))}}})(e)}}),Ri=qt({logSoftmax_:function(a,s){void 0===s&&(s=-1);var e=st(a,"logits","logSoftmax");if(-1===s&&(s=e.rank-1),s!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+s);return ht(function(t,e){var n=t.max(s,!0),r=t.sub(n),o=r.toFloat().sub(r.exp().sum(s,!0).log());return e([o]),{value:o,gradFunc:function(t,e){var a=e[0].exp();return t.sub(t.sum(s,!0).mul(a))}}})(e)}}),Si=qt({complex_:function(a,e){var t=st(a,"real","complex"),o=st(e,"imag","complex");return O(t.shape,o.shape,"real and imag shapes, "+t.shape+" and "+o.shape+", must match in call to tf.complex()."),hi.engine.runKernel(function(a){return a.complex(t,o)},{$real:t,$imag:o})}}),Ei=qt({real_:function(a){var o=st(a,"input","real");return hi.engine.runKernel(function(t){return t.real(o)},{$input:o})}}),_i=qt({imag_:function(a){var o=st(a,"input","imag");return hi.engine.runKernel(function(t){return t.imag(o)},{$input:o})}}),ki=qt({onesLike_:function(a){var o=st(a,"x","onesLike");if("complex64"===o.dtype){var e=ki(Ei(o)),n=wi(_i(o));return Si(e,n)}return hi.engine.runKernel(function(t){return t.onesLike(o)},{$x:o},null)}}),wi=qt({zerosLike_:function(a){var o=st(a,"x","zerosLike");return hi.engine.runKernel(function(t){return t.zerosLike(o)},{$x:o},null)}}),Ii=function(){function t(t){this.dataMover=t,this.data=new WeakMap}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},t.prototype.set=function(a,e){this.data.set(a,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.data.delete(t)},t}(),Ni=function(){function t(){}return t.prototype.time=function(){throw new Error("Not yet implemented.")},t.prototype.read=function(){throw new Error("Not yet implemented.")},t.prototype.readSync=function(){throw new Error("Not yet implemented.")},t.prototype.disposeData=function(){throw new Error("Not yet implemented.")},t.prototype.write=function(){throw new Error("Not yet implemented.")},t.prototype.fromPixels=function(){throw new Error("Not yet implemented.")},t.prototype.register=function(){throw new Error("Not yet implemented.")},t.prototype.memory=function(){throw new Error("Not yet implemented.")},t.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},t.prototype.batchMatMul=function(){throw new Error("Not yet implemented")},t.prototype.fusedBatchMatMul=function(){throw new Error("Not yet implemented")},t.prototype.slice=function(){throw new Error("Not yet implemented")},t.prototype.stridedSlice=function(){throw new Error("Not yet implemented")},t.prototype.unstack=function(){throw new Error("Not yet implemented")},t.prototype.reverse=function(){throw new Error("Not yet implemented")},t.prototype.concat=function(){throw new Error("Not yet implemented")},t.prototype.neg=function(){throw new Error("Not yet implemented")},t.prototype.add=function(){throw new Error("Not yet implemented")},t.prototype.addN=function(){throw new Error("Not yet implemented")},t.prototype.subtract=function(){throw new Error("Not yet implemented")},t.prototype.multiply=function(){throw new Error("Not yet implemented")},t.prototype.realDivide=function(){throw new Error("Not yet implemented")},t.prototype.floorDiv=function(){throw new Error("Not yet implemented")},t.prototype.sum=function(){throw new Error("Not yet implemented")},t.prototype.prod=function(){throw new Error("Not yet implemented")},t.prototype.unsortedSegmentSum=function(){throw new Error("Not yet implemented")},t.prototype.argMin=function(){throw new Error("Not yet implemented")},t.prototype.argMax=function(){throw new Error("Not yet implemented")},t.prototype.equal=function(){throw new Error("Not yet implemented")},t.prototype.notEqual=function(){throw new Error("Not yet implemented")},t.prototype.less=function(){throw new Error("Not yet implemented")},t.prototype.lessEqual=function(){throw new Error("Not yet implemented")},t.prototype.greater=function(){throw new Error("Not yet implemented")},t.prototype.greaterEqual=function(){throw new Error("Not yet implemented")},t.prototype.logicalNot=function(){throw new Error("Not yet implemented")},t.prototype.logicalAnd=function(){throw new Error("Not yet implemented")},t.prototype.logicalOr=function(){throw new Error("Not yet implemented")},t.prototype.where=function(){throw new Error("Not yet implemented")},t.prototype.select=function(){throw new Error("Not yet implemented")},t.prototype.topk=function(){throw new Error("Not yet implemented")},t.prototype.min=function(){throw new Error("Not yet implemented")},t.prototype.minimum=function(){throw new Error("Not yet implemented")},t.prototype.mod=function(){throw new Error("Not yet implemented")},t.prototype.max=function(){throw new Error("Not yet implemented")},t.prototype.maximum=function(){throw new Error("Not yet implemented")},t.prototype.all=function(){throw new Error("Not yet implemented")},t.prototype.any=function(){throw new Error("Not yet implemented")},t.prototype.squaredDifference=function(){throw new Error("Not yet implemented")},t.prototype.ceil=function(){throw new Error("Not yet implemented")},t.prototype.floor=function(){throw new Error("Not yet implemented")},t.prototype.round=function(){throw new Error("Not yet implemented")},t.prototype.sign=function(){throw new Error("Not yet implemented")},t.prototype.isNaN=function(){throw new Error("Not yet implemented")},t.prototype.isInf=function(){throw new Error("Not yet implemented")},t.prototype.isFinite=function(){throw new Error("Not yet implemented")},t.prototype.pow=function(){throw new Error("Not yet implemented")},t.prototype.exp=function(){throw new Error("Not yet implemented")},t.prototype.expm1=function(){throw new Error("Not yet implemented")},t.prototype.log=function(){throw new Error("Not yet implemented")},t.prototype.log1p=function(){throw new Error("Not yet implemented")},t.prototype.sqrt=function(){throw new Error("Not yet implemented")},t.prototype.rsqrt=function(){throw new Error("Not yet implemented")},t.prototype.square=function(){throw new Error("Not yet implemented")},t.prototype.reciprocal=function(){throw new Error("Not yet implemented")},t.prototype.relu=function(){throw new Error("Not yet implemented")},t.prototype.prelu=function(){throw new Error("Not yet implemented")},t.prototype.elu=function(){throw new Error("Not yet implemented")},t.prototype.eluDer=function(){throw new Error("Not yet implemented")},t.prototype.selu=function(){throw new Error("Not yet implemented")},t.prototype.int=function(){throw new Error("Not yet implemented")},t.prototype.clip=function(){throw new Error("Not yet implemented")},t.prototype.abs=function(){throw new Error("Not yet implemented")},t.prototype.complexAbs=function(){throw new Error("Not yet implemented")},t.prototype.sigmoid=function(){throw new Error("Not yet implemented")},t.prototype.softplus=function(){throw new Error("Not yet implemented")},t.prototype.sin=function(){throw new Error("Not yet implemented")},t.prototype.cos=function(){throw new Error("Not yet implemented")},t.prototype.tan=function(){throw new Error("Not yet implemented")},t.prototype.asin=function(){throw new Error("Not yet implemented")},t.prototype.acos=function(){throw new Error("Not yet implemented")},t.prototype.atan=function(){throw new Error("Not yet implemented")},t.prototype.atan2=function(){throw new Error("Not yet implemented")},t.prototype.sinh=function(){throw new Error("Not yet implemented")},t.prototype.cosh=function(){throw new Error("Not yet implemented")},t.prototype.tanh=function(){throw new Error("Not yet implemented")},t.prototype.asinh=function(){throw new Error("Not yet implemented")},t.prototype.acosh=function(){throw new Error("Not yet implemented")},t.prototype.atanh=function(){throw new Error("Not yet implemented")},t.prototype.erf=function(){throw new Error("Not yet implemented")},t.prototype.step=function(){throw new Error("Not yet implemented")},t.prototype.conv2d=function(){throw new Error("Not yet implemented")},t.prototype.conv2dDerInput=function(){throw new Error("Not yet implemented")},t.prototype.conv2dDerFilter=function(){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2D=function(){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerInput=function(){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerFilter=function(){throw new Error("Not yet implemented")},t.prototype.conv3d=function(){throw new Error("Not yet implemented")},t.prototype.conv3dDerInput=function(){throw new Error("Not yet implemented")},t.prototype.conv3dDerFilter=function(){throw new Error("Not yet implemented")},t.prototype.maxPool=function(){throw new Error("Not yet implemented")},t.prototype.maxPoolBackprop=function(){throw new Error("Not yet implemented")},t.prototype.avgPool=function(){throw new Error("Not yet implemented")},t.prototype.avgPoolBackprop=function(){throw new Error("Not yet implemented")},t.prototype.reshape=function(){throw new Error("Not yet implemented")},t.prototype.cast=function(){throw new Error("Not yet implemented")},t.prototype.tile=function(){throw new Error("Not yet implemented")},t.prototype.pad=function(){throw new Error("Not yet implemented")},t.prototype.transpose=function(){throw new Error("Not yet implemented")},t.prototype.gather=function(){throw new Error("Not yet implemented")},t.prototype.gatherND=function(){throw new Error("Not yet implemented")},t.prototype.scatterND=function(){throw new Error("Not yet implemented")},t.prototype.batchToSpaceND=function(){throw new Error("Not yet implemented")},t.prototype.spaceToBatchND=function(){throw new Error("Not yet implemented")},t.prototype.resizeBilinear=function(){throw new Error("Not yet implemented")},t.prototype.resizeBilinearBackprop=function(){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighbor=function(){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighborBackprop=function(){throw new Error("Not yet implemented")},t.prototype.batchNormalization=function(){throw new Error("Not yet implemented")},t.prototype.localResponseNormalization4D=function(){throw new Error("Not yet implemented")},t.prototype.LRNGrad=function(){throw new Error("Not yet implemented")},t.prototype.multinomial=function(){throw new Error("Not yet implemented")},t.prototype.oneHot=function(){throw new Error("Not yet implemented")},t.prototype.cumsum=function(){throw new Error("Not yet implemented")},t.prototype.nonMaxSuppression=function(){throw new Error("Not yet implemented")},t.prototype.fft=function(){throw new Error("Not yet implemented")},t.prototype.ifft=function(){throw new Error("Not yet implemented")},t.prototype.complex=function(){throw new Error("Not yet implemented")},t.prototype.real=function(){throw new Error("Not yet implemented")},t.prototype.imag=function(){throw new Error("Not yet implemented")},t.prototype.cropAndResize=function(){throw new Error("Not yet implemented")},t.prototype.depthToSpace=function(){throw new Error("Not yet implemented")},t.prototype.split=function(){throw new Error("Not yet implemented")},t.prototype.sparseToDense=function(){throw new Error("Not yet implemented")},t.prototype.fill=function(){throw new Error("Not yet implemented.")},t.prototype.onesLike=function(){throw new Error("Not yet implemented")},t.prototype.zerosLike=function(){throw new Error("Not yet implemented")},t.prototype.setDataMover=function(){throw new Error("Not yet implemented")},t.prototype.dispose=function(){throw new Error("Not yet implemented")},t}(),Ti=function(){return function(p,e,t){this.variableNames=["A"];var n=p.windowSize,r=p.batchSize,o=p.inSize,a=pe(o/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[r,a];var i="max"===e?">":"<",s=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+n+"; i++) {\n          int inIdx = "+s+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+i+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}}(),Di="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ai="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Oi="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Pi="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n",Fi=function(){return function(C,e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,A(2<C.length,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var r=C[C.length-1],o=pe(r/e);this.outputShape=C.slice(0,-1),1<o&&this.outputShape.push(o),n||this.variableNames.push("bestIndicesA");var a=this.outputShape,u=a.length,c=mo(u),l=va("coords",u),p,i;if(1===o){var s=mo(i=u+1);p="\n        "+s+" sourceLocR = "+s+"("+l.join()+", 0);\n        ++"+l[u-1]+";\n        "+s+" sourceLocG = "+s+"("+l.join()+", 0);\n        ++"+l[u-2]+";\n        "+s+" sourceLocA = "+s+"("+l.join()+", 0);\n        --"+l[u-1]+";\n        "+s+" sourceLocB = "+s+"("+l.join()+", 0);\n        --"+l[u-2]+";"}else i=u,p="\n        "+c+" sourceLocR = coords;\n        ++"+l[u-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+l[u-2]+";\n        "+c+" sourceLocA = coords;\n        --"+l[u-1]+";\n        "+c+" sourceLocB = coords;\n        --"+l[u-2]+";";var d=["x","y","z","w","u","v"].slice(0,i),h="."+d[i-1],f=d.map(function(t){return"int "+t}),m=va("sourceLocR",i-1).concat("inIdx.r"),g=va("sourceLocG",i-1).concat("inIdx.g"),v=va("sourceLocB",i-1).concat("inIdx.b"),y=va("sourceLocA",i-1).concat("inIdx.a"),x="max"===t?"greaterThan":"lessThan",R=n?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",S="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+v.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",b=n?"":"\n      float getBestIndicesAChannel("+f.join()+") {\n        return getChannel(getBestIndicesA("+d.join()+"),\n                                          vec2("+d.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+f.join()+") {\n        return getChannel(getA("+d.join()+"),\n                               vec2("+d.slice(-2).join()+"));\n      }\n      "+b+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+l[u-1]+" < "+(a[u-1]-1)+";\n        bool hasNextRow = "+l[u-2]+" < "+(a[u-2]-1)+";\n        "+p+"\n        ivec4 srcIdx = ivec4(sourceLocR"+h+", sourceLocG"+h+",\n          sourceLocB"+h+", sourceLocA"+h+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+S+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+R+"\n          vec4 candidate = "+S+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "}}(),Bi=function(){return function(p){this.variableNames=["dy"],this.outputShape=p.inShape;var e=p.filterHeight,t=p.filterWidth,n=p.strideHeight,r=p.strideWidth,o=p.dilationHeight,a=p.dilationWidth,i=p.effectiveFilterHeight,s=p.effectiveFilterWidth,d=i-1-p.padInfo.top,u=s-1-p.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+d+", "+u+");\n      const float avgMultiplier = float("+1/(e*t)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n            wR += "+o+") {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+p.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+s+";\n            wC+= "+a+") {\n            float dyC = float(dyCCorner + wC) / "+r+".0;\n\n            if (dyC < 0.0 || dyC >= "+p.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Li=function(){return function(p,e,t,n,r,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Ea(p,e),Ea(p,t);var a="0.0";null!=n&&(Ea(p,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var i="1.0";null!=r&&(Ea(p,r),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=p,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+i+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "}}(),Mi=function(){return function(p,e,t,n,r,o){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],Ea(p,e),Ea(p,t);var a="vec4(0.0)";null!=n&&(Ea(p,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var i="vec4(1.0)";null!=r&&(Ea(p,r),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=p,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+i+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "}}(),Wi={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},Ui=function(){return function(a,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ea(e,t),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+a+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "}}(),zi="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",Gi="return a + b;",Vi="return a - b;",Hi="return a * b;",qi="return (a - b) * (a - b);",$i=function(){return function(a,e,t){this.variableNames=["A","B"],this.outputShape=Ea(e,t),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+a+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}}(),Ki="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n",ji=function(){return function(a,e,t){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=Ea(e,t),this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+a+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}}(),Xi=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a,e){var t=this;return function(n,r){null==t.minLoc&&(t.minLoc=n.getUniformLocationNoThrow(r,"min"),t.maxLoc=n.getUniformLocationNoThrow(r,"max")),n.gl.uniform1f(t.minLoc,a),n.gl.uniform1f(t.maxLoc,e)}},t}(),Yi=function(){function t(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a,e){var t=this;return function(n,r){null==t.minLoc&&(t.minLoc=n.getUniformLocationNoThrow(r,"min"),t.maxLoc=n.getUniformLocationNoThrow(r,"max")),n.gl.uniform1f(t.minLoc,a),n.gl.uniform1f(t.maxLoc,e)}},t}(),Qi=function(){return function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}(),Zi=function(){return function(s){this.outputShape=[],this.outputShape=Tt(s,1),this.variableNames=s.map(function(a,e){return"T"+e});var e=Array(s.length-1);e[0]=s[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+s[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var r=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+r+"));")}var o=e.length,a=e[e.length-1];n.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+n.join("\n        ")+"\n      }\n    "}}(),Ji=function(){return function(m,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Tt(m,e);var t=this.outputShape,n=t.length,r=mo(n),o=va("coords",n),a=["x","y","z","w","u","v"].slice(0,n);this.variableNames=m.map(function(a,e){return"T"+e});var i=Array(m.length-1);i[0]=m[0][e];for(var s=1;s<i.length;s++)i[s]=i[s-1]+m[s][e];var u=a[e],c="vec2("+a.slice(-2).join()+")",l=a.join(),p="if ("+u+" < "+i[0]+")\n          return getChannel(getT0("+l+"), "+c+");";for(s=1;s<i.length;s++){var d=i[s-1];p+="\n        else if ("+u+" < "+i[s]+") {\n          "+u+" -= "+d+";\n          return getChannel(getT"+s+"("+l+"), "+c+");\n        }"}var h=i.length;p+="\n        else {\n          "+u+" -= "+i[i.length-1]+";\n          return getChannel(getT"+h+"("+l+"), "+c+");\n        }",this.userCode="\n      float getValue("+a.map(function(t){return"int "+t})+") {\n        "+p+"\n      }\n\n      void main() {\n        "+r+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n        if (++"+o[n-1]+" < "+t[n-1]+") {\n          result.g = getValue("+o+");\n        }\n        if (++"+o[n-2]+" < "+t[n-2]+") {\n          result.a = getValue("+o+");\n        }\n        if ("+o[n-2]+" < "+t[n-2]+" &&\n            --"+o[n-1]+" < "+t[n-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "}}(),ep=function(){return function(a){this.variableNames=["x","dy"],this.outputShape=a.filterShape;var e=a.strideHeight,t=a.strideWidth,n=a.padInfo.top,r=a.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+a.batchSize+"; b++) {\n          for (int yR = 0; yR < "+a.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+n+";\n\n            if (xR < 0 || xR >= "+a.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+a.outWidth+"; yC++) {\n              int xC = wC + yC * "+t+" - "+r+";\n\n              if (xC < 0 || xC >= "+a.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),tp=function(){return function(s){this.variableNames=["dy","W"],this.outputShape=s.inShape;var e=s.filterHeight,t=s.filterWidth,n=s.strideHeight,r=s.strideWidth,o=e-1-s.padInfo.top,a=t-1-s.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+s.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r+".0;\n\n            if (dyC < 0.0 || dyC >= "+s.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+s.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),ap=function(){return function(s){this.variableNames=["x","dy"],this.outputShape=s.filterShape;var e=s.strideDepth,t=s.strideHeight,n=s.strideWidth,r=s.padInfo.front,o=s.padInfo.top,a=s.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+s.batchSize+"; b++) {\n          for (int yF = 0; yF < "+s.outDepth+"; yF++) {\n            int xF = wF + yF * "+e+" - "+r+";\n\n            if (xF < 0 || xF >= "+s.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+s.outHeight+"; yR++) {\n              int xR = wR + yR * "+t+" - "+o+";\n\n              if (xR < 0 || xR >= "+s.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+s.outWidth+"; yC++) {\n                int xC = wC + yC * "+n+" - "+a+";\n\n                if (xC < 0 || xC >= "+s.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),np=function(){return function(p){this.variableNames=["dy","W"],this.outputShape=p.inShape;var e=p.filterDepth,t=p.filterHeight,n=p.filterWidth,r=p.strideDepth,o=p.strideHeight,a=p.strideWidth,i=e-1-p.padInfo.front,s=t-1-p.padInfo.top,d=n-1-p.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+i+", "+s+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+r+".0;\n\n          if (dyF < 0.0 || dyF >= "+p.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+t+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+o+".0;\n\n            if (dyR < 0.0 || dyR >= "+p.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+t+" - 1 - wR;\n\n            for (int wC = 0; wC < "+n+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+p.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+n+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+p.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),rp=function(){return function(s){this.variableNames=["x","dy"],this.outputShape=s.filterShape;var e=s.strideHeight,t=s.strideWidth,n=s.padInfo.top,r=s.padInfo.left,o=s.outChannels/s.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+o+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+s.batchSize+"; b++) {\n          for (int yR = 0; yR < "+s.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+n+";\n\n            if (xR < 0 || xR >= "+s.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+s.outWidth+"; yC++) {\n              int xC = wC + yC * "+t+" - "+r+";\n\n              if (xC < 0 || xC >= "+s.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),sp=function(){return function(p){this.variableNames=["dy","W"],this.outputShape=p.inShape;var e=p.filterHeight,t=p.filterWidth,n=p.strideHeight,r=p.strideWidth,o=e-1-p.padInfo.top,a=t-1-p.padInfo.left,i=p.outChannels/p.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+p.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r+".0;\n\n            if (dyC < 0.0 || dyC >= "+p.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+i+"; dm++) {\n              int d2 = d1 * "+i+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),ip=function(){return function(p){this.variableNames=["x","W"],this.outputShape=p.outShape;var e=p.padInfo.top,t=p.padInfo.left,n=p.strideHeight,r=p.strideWidth,o=p.dilationHeight,a=p.dilationWidth,i=p.filterHeight,s=p.filterWidth,d=4*$(p.inChannels/4),u=p.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+n+", "+r+");\n      const ivec2 pads = ivec2("+e+", "+t+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+"; wR++) {\n          int xR = xRCorner + wR * "+o+";\n\n          if (xR < 0 || xR >= "+p.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+s+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+p.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1==u)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+d+") *\n                getW(wR, wC, "+d+", d2);\n            } else if ("+(2==u)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+d+"),\n                getX(batch, xR, xC, "+d+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3==u)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+d+"),\n                getX(batch, xR, xC, "+d+" + 1),\n                getX(batch, xR, xC, "+d+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),pp=function(){return function(m){this.variableNames=["x","W"],this.outputShape=m.outShape;var e=m.padInfo.front,t=m.padInfo.top,n=m.padInfo.left,r=m.strideDepth,o=m.strideHeight,a=m.strideWidth,i=m.dilationDepth,s=m.dilationHeight,u=m.dilationWidth,c=m.filterDepth,l=m.filterHeight,p=m.filterWidth,d=4*$(m.inChannels/4),h=m.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+r+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+t+", "+n+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+i+";\n\n          if (xF < 0 || xF >= "+m.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+l+"; wR++) {\n            int xR = xRCorner + wR * "+s+";\n\n            if (xR < 0 || xR >= "+m.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+p+"; wC++) {\n              int xC = xCCorner + wC * "+u+";\n\n              if (xC < 0 || xC >= "+m.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1==h)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+d+") *\n                  getW(wF, wR, wC, "+d+", d2);\n              } else if ("+(2==h)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3==h)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1),\n                  getX(batch, xF, xR, xC, "+d+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2),\n                  getW(wF, wR, wC, "+d+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),dp=function(){return function(d){this.variableNames=["x","W"],this.outputShape=d.outShape;var e=d.inHeight,t=d.inWidth,n=d.padInfo.top,r=d.padInfo.left,o=d.strideHeight,a=d.strideWidth,i=d.dilationHeight,s=d.dilationWidth,u=d.filterHeight,c=d.filterWidth,l=d.outChannels/d.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+n+", "+r+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+l+";\n        int q = d2 - d1 * "+l+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+u+"; wR++) {\n          int xR = xRCorner + wR * "+i+";\n\n          if (xR < 0 || xR >= "+e+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+s+";\n\n            if (xC < 0 || xC >= "+t+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),lp=function(){return function(y){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=y.outShape;for(var e=y.inHeight,t=y.inWidth,n=y.padInfo.top,r=y.padInfo.left,o=y.strideHeight,a=y.strideWidth,i=y.dilationHeight,s=y.dilationWidth,u=y.filterHeight,c=y.filterWidth,l=c,p="int xR; int xC; int xCOffset;",d=0;d<u;d++)for(var h=0;h<c;h++)p+="\n          vec4 xTexelR"+d+"C"+2*h+" = vec4(0.);\n          vec4 wR"+d+"C"+h+" = vec4(0.);\n          vec4 xR"+d+"C"+h+" = vec4(0.);";for(d=0;d<u;d++)for(var f=0;f<l;f++){if(!(p+="\n          xR = xRCorner + "+d*i+";\n          xC = xCCorner + "+(h=2*f)*s+";\n        ",1===a))h<c&&(p+="\n              if(xR >= 0 && xR < "+e+") {\n            ",1==r%2?(p+="\n                xCOffset = xC + 1 - "+a+";\n                if(xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+d+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+h+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+t+") {\n                  xTexelR"+d+"C"+(h+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+d+"C"+(h+2)+" = vec4(0.);\n                }\n\n                xR"+d+"C"+h+" = vec4(\n                  xTexelR"+d+"C"+h+".zw, xTexelR"+d+"C"+(h+2)+".zw);\n              ",h+1<c&&(p+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+a+";\n                  if(xCOffset >= 0 && xCOffset < "+t+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+d+"C"+(h+1)+" = vec4(xTexelR"+d+"C"+(h+2)+".xy, final.xy);\n                ")):(p+="\n                if(xC >= 0 && xC < "+t+") {\n                  xTexelR"+d+"C"+h+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+d+"C"+h+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+a+";\n                if(xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+d+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+(h+2)+" = vec4(0.);\n                }\n\n                xR"+d+"C"+h+" = vec4(\n                  xTexelR"+d+"C"+h+".xy, xTexelR"+d+"C"+(h+2)+".xy);\n              ",h+1<c&&(p+="\n                  xR"+d+"C"+(h+1)+" = vec4(\n                    xTexelR"+d+"C"+h+".zw, xTexelR"+d+"C"+(h+2)+".zw);\n                ")),p+="}");else if(h<c&&(p+=1==r%2?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+d+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+h+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+t+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+d+"C"+h+" = vec4(previous.zw, xTexelR"+d+"C"+h+".xy);\n                } else {\n                  xR"+d+"C"+h+" = vec4(0, 0, xTexelR"+d+"C"+h+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+e+" && xC >= 0 && xC < "+t+") {\n                  xTexelR"+d+"C"+h+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+d+"C"+h+" = vec4(0.);\n                }\n\n                xR"+d+"C"+h+" = xTexelR"+d+"C"+h+";\n              ",h+1<c)){var m=0==r%2?N(s):s;0==s%2&&1==r%2||0!=s%2&&1!=r%2?(p+="\n                  xCOffset = xC + "+r%2+" + "+m+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+t+") {\n                    xTexelR"+d+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",1<s&&(p+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+e+" &&\n                      xCOffset >= 0 && xCOffset < "+t+") {\n                      xTexelR"+d+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+d+"C"+h+" = vec4(0.);\n                    }\n                  "),p+="\n                  xR"+d+"C"+(h+1)+" = vec4(\n                    xTexelR"+d+"C"+h+".zw, xTexelR"+d+"C"+(h+2)+".xy);\n                "):p+="\n                  xCOffset = xC + "+m+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+t+") {\n                    xTexelR"+d+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+d+"C"+(h+1)+" = xTexelR"+d+"C"+(h+2)+";\n                "}h<c&&(p+="\n            vec4 wTexelR"+d+"C"+h+" = getW("+d+", "+h+", d1, q);\n            wR"+d+"C"+h+" = vec4(wTexelR"+d+"C"+h+".xz, wTexelR"+d+"C"+h+".xz);\n          ",h+1<c&&(p+="\n              vec4 wTexelR"+d+"C"+(h+1)+" = getW("+d+", "+(h+1)+", d1, q);\n              wR"+d+"C"+(h+1)+" =\n                vec4(wTexelR"+d+"C"+(h+1)+".xz, wTexelR"+d+"C"+(h+1)+".xz);"))}for(d=0;d<u;d++)for(h=0;h<c;h++)p+="result += xR"+d+"C"+h+" * wR"+d+"C"+h+";";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+n+", "+r+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "}}(),up=function(){return function(C,e,t,n,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=C[0],a=C[1],i=C[2],s=C[3],u=e[0],c=t[0],l=t[1];this.outputShape=[u,c,l,s];var p="bilinear"===n?1:0,d=[a-1+".0",i-1+".0"],h=d[0],f=d[1],m=1<c?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+h+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+h],g=m[0],v=m[1],y=m[2],x=1<l?[""+(i-1)/(l-1),"(x2-x1) * width_ratio","x1*"+f+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+f],R=x[0],S=x[1],b=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+R+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+v+";\n        float width_scale = "+S+";\n\n        float in_y = "+y+";\n        if( in_y < 0.0 || in_y > "+h+" ) {\n          setOutput(float("+r+"));\n          return;\n        }\n        float in_x = "+b+";\n        if( in_x < 0.0 || in_x > "+f+" ) {\n          setOutput(float("+r+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+p+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "}}(),cp=function(){return function(s,e,t){this.variableNames=["x"],this.outputShape=s;var n=s.length,r=s[s.length-1],o=t?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(t?"return "+r+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+mo(n)+" coords = getOutputCoords();\n        int end = "+xo(n,"coords")+";\n        float val = 0.0;\n        for (int i = "+r+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+xo(n,"coords")+" = idx;\n          val += getX("+yo(n,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}}(),hp=function(){function t(a,o,t){this.variableNames=["x"],this.outputShape=[],this.outputShape=a,this.blockSize=o,this.dataFormat=t,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+o+";\n      int offset_h = imod(h, "+o+");\n      int in_w = w / "+o+";\n      int offset_w = imod(w, "+o+");\n      int offset_d = (offset_h * "+o+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),mp=function(){return function(a){this.variableNames=["A"];var e=_a();this.outputShape=a,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isnan(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "}}(),gp={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"},fp=function(){return function(s,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var r=t?"2.0 * "+d:"-2.0 * "+d,o=t?n+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+r+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+s+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+n+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+n+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+o+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "}}(),yp=function(){function t(t){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a){var e=this;return function(t,o){null==e.valueLoc&&(e.valueLoc=t.getUniformLocationNoThrow(o,"value")),t.gl.uniform1f(e.valueLoc,a)}},t}(),xp=function(){return function(a){this.variableNames=["A"];var e=_a(),t=a[0],o=a[1];this.outputShape=a,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+o+".0, "+t+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}}(),bp=function(){return function(s,e,t){this.variableNames=["A","indices"];var n=s.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var r=mo(this.rank),o=bo(s,t);this.userCode="\n      void main() {\n        "+r+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "}}(),vp=function(){return function(s,e,t){this.sliceDim=s,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=mo(e.length),r=mo(t.length),o=1<this.sliceDim?"strides[j]":"strides";this.userCode="\n        "+n+" strides = "+n+"("+this.strides+");\n         void main() {\n          "+r+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+o+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "}}(),Cp,Rp;!function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Cp||(Cp={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Rp||(Rp={}));var Sp=5.96e-8,Ep=65504,_p=/ERROR: [0-9]+:([0-9]+):/g,kp=Object.freeze({callAndCheck:No,canBeRepresented:Do,getWebGLErrorMessage:Ao,getExtensionOrThrow:Oo,createVertexShader:Po,createFragmentShader:Fo,createProgram:Lo,linkProgram:Mo,validateProgram:Wo,createStaticVertexBuffer:Uo,createStaticIndexBuffer:zo,getNumChannels:Go,createTexture:Vo,validateTextureSize:Ho,createFramebuffer:qo,bindVertexBufferToProgramAttribute:$o,bindTextureUnit:Ko,unbindTextureUnit:function(a,e,t){an(a,t),No(a,e,function(){return a.activeTexture(a.TEXTURE0+t)}),No(a,e,function(){return a.bindTexture(a.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:jo,getProgramUniformLocation:Xo,bindTextureToProgramUniformSampler:Yo,bindCanvasToFramebuffer:function(a,e){No(a,e,function(){return a.bindFramebuffer(a.FRAMEBUFFER,null)}),No(a,e,function(){return a.viewport(0,0,a.canvas.width,a.canvas.height)}),No(a,e,function(){return a.scissor(0,0,a.canvas.width,a.canvas.height)})},bindColorTextureToFramebuffer:Qo,unbindColorTextureFromFramebuffer:Zo,validateFramebuffer:Jo,getFramebufferErrorMessage:en,getBatchDim:on,getRowsCols:nn,getTextureShapeFromLogicalShape:rn,isReshapeFree:pn}),wp=Object.freeze({createVertexShader:dn,createVertexBuffer:ln,createIndexBuffer:un,getTextureConfig:cn,createFloat32MatrixTexture:mn,createFloat16MatrixTexture:gn,createUnsignedBytesMatrixTexture:fn,createPackedMatrixTexture:yn,createFloat16PackedMatrixTexture:xn,bindVertexProgramAttributeStreams:bn,uploadPixelDataToTexture:vn,uploadMatrixToTexture:Rn,uploadMatrixToPackedTexture:Sn,maybeCreateBufferFromOutputTexture:En,downloadFloat32MatrixFromBuffer:_n,downloadFloat32MatrixFromOutputTexture:kn,downloadByteEncodedFloatMatrixFromOutputTexture:wn,downloadPackedMatrixFromBuffer:In,downloadMatrixFromPackedOutputTexture:Nn}),Ip=function(){function t(a){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var o=hi.get("WEBGL_VERSION");null==a?this.gl=S(o):(this.gl=a,v(o,a)),1===hi.get("WEBGL_VERSION")?(this.textureFloatExtension=Oo(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),hi.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Oo(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Oo(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=ln(this.gl,this.debug),this.indexBuffer=un(this.gl,this.debug),this.framebuffer=qo(this.gl,this.debug),this.textureConfig=cn(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return hi.get("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var a=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;No(e,this.debug,function(){return e.finish()}),No(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),No(e,this.debug,function(){return e.deleteFramebuffer(a.framebuffer)}),No(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),No(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),No(e,this.debug,function(){return e.deleteBuffer(a.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(a,e){return this.throwIfDisposed(),mn(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(a,e){return this.throwIfDisposed(),gn(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(a,e){return this.throwIfDisposed(),fn(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(a,e){this.throwIfDisposed(),vn(this.gl,this.debug,a,e)},t.prototype.createFloat16PackedMatrixTexture=function(a,e){return this.throwIfDisposed(),xn(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(a,e){return this.throwIfDisposed(),yn(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(a){var e=this;this.throwIfDisposed(),this.outputTexture===a&&(Zo(this.gl,this.debug,this.framebuffer),this.outputTexture=null),No(this.gl,this.debug,function(){return e.gl.deleteTexture(a)})},t.prototype.uploadMatrixToTexture=function(a,e,t,n){this.throwIfDisposed();var r=Go();return Rn(this.gl,this.debug,a,e,t,n,r,this.textureConfig)},t.prototype.uploadMatrixToPackedTexture=function(s,e,t,n,r,o,a){return this.throwIfDisposed(),Sn(this.gl,this.debug,s,e,t,n,r,o,a,this.textureConfig)},t.prototype.downloadFloat32MatrixFromOutputTexture=function(a,e,t){var o=this;return this.downloadMatrixDriver(a,function(){return kn(o.gl,o.debug,e,t,o.textureConfig)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(a,e,t){var o=this;return this.downloadMatrixDriver(a,function(){return wn(o.gl,o.debug,e,t,o.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(s,e,t,n,r,o){return In(this.gl,s,e,t,n,r,o,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(a,e,t){return _n(this.gl,a,e,t,this.textureConfig)},t.prototype.maybeCreateBufferFromTexture=function(a,e,t){this.bindTextureToFrameBuffer(a);var o=En(this.gl,this.debug,a,e,t,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(s){var e=this,r,i;if(hi.get("WEBGL_FENCE_API_ENABLED")){var p=s,o=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);s.flush(),i=function(){var t=p.clientWaitSync(o,0,0);return t===p.ALREADY_SIGNALED||t===p.CONDITION_SATISFIED},r=o}else 0<hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?(r=this.beginQuery(),this.endQuery(),i=function(){return e.isQueryAvailable(r,hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):i=function(){return!0};return{query:r,isFencePassed:i}},t.prototype.downloadMatrixFromPackedTexture=function(s,e,t,n,r,o){var a=this;return this.downloadMatrixDriver(s,function(){return Nn(a.gl,a.debug,e,t,n,r,o,a.textureConfig)})},t.prototype.createProgram=function(a){this.throwIfDisposed();var e=this.gl,t=Fo(e,this.debug,a),n=dn(e,this.debug),r=Lo(e,this.debug);return No(e,this.debug,function(){return e.attachShader(r,n)}),No(e,this.debug,function(){return e.attachShader(r,t)}),Mo(e,this.debug,r),this.debug&&Wo(e,this.debug,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=bn(e,this.debug,this.program,this.vertexBuffer)),r},t.prototype.deleteProgram=function(a){var e=this;this.throwIfDisposed(),a===this.program&&(this.program=null),null!=a&&No(this.gl,this.debug,function(){return e.gl.deleteProgram(a)})},t.prototype.setProgram=function(a){var e=this;this.throwIfDisposed(),this.program=a,null!=this.program&&this.debug&&Wo(this.gl,this.debug,this.program),No(this.gl,this.debug,function(){return e.gl.useProgram(a)})},t.prototype.getUniformLocation=function(a,e,t){return void 0===t&&(t=!0),this.throwIfDisposed(),t?jo(this.gl,this.debug,a,e):Xo(this.gl,a,e)},t.prototype.getAttributeLocation=function(a,e){var t=this;return this.throwIfDisposed(),No(this.gl,this.debug,function(){return t.gl.getAttribLocation(a,e)})},t.prototype.getUniformLocationNoThrow=function(a,e){return this.throwIfDisposed(),this.gl.getUniformLocation(a,e)},t.prototype.setInputMatrixTexture=function(a,e,t){this.throwIfDisposed(),this.throwIfNoProgram(),Yo(this.gl,this.debug,this.program,a,e,t)},t.prototype.setOutputMatrixTexture=function(a,e,t){this.setOutputMatrixTextureDriver(a,t,e)},t.prototype.setOutputPackedMatrixTexture=function(s,e,t){this.throwIfDisposed();var n=_o(e,t),r=n[0],o=n[1];this.setOutputMatrixTextureDriver(s,r,o)},t.prototype.setOutputMatrixWriteRegion=function(a,e,t,o){this.setOutputMatrixWriteRegionDriver(t,a,o,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Wo(this.gl,this.debug,this.program),Jo(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),No(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),No(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Oo(this.gl,this.debug,2===hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var a=this.gl,e=this.getQueryTimerExtensionWebGL2(),t=a.createQuery();return a.beginQuery(e.TIME_ELAPSED_EXT,t),t}var n=this.getQueryTimerExtensionWebGL1(),r=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,r),r},t.prototype.endQuery=function(){if(2!==hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var a=this.getQueryTimerExtensionWebGL1();a.endQueryEXT(a.TIME_ELAPSED_EXT)}else{var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(a){return x(this,void 0,void 0,function(){var e=this;return R(this,function(t){switch(t.label){case 0:return[4,H(function(){return e.disposed||e.isQueryAvailable(a,hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return t.sent(),[2,this.getQueryTime(a,hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))];}})})},t.prototype.getQueryTime=function(a,e){if(0===e)return null;if(2===e){var t=this.gl;return t.getQueryParameter(a,t.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(a,o.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(a,e){if(0===e)return!0;if(2===e){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(a,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}return r=(n=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(a,n.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint},t.prototype.pollFence=function(a){var e=this;return new Promise(function(t){e.addItemToPoll(function(){return a.isFencePassed()},function(){return t()})})},t.prototype.pollItems=function(){for(var a=Tn(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=a;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(a+1)},t.prototype.addItemToPoll=function(a,o){var r=this;this.itemsToPoll.push({isDoneFn:a,resolveFn:o}),1<this.itemsToPoll.length||H(function(){return r.pollItems(),0===r.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Qo(this.gl,this.debug,t,this.framebuffer),this.debug&&Jo(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null==this.outputTexture?Zo(this.gl,this.debug,this.framebuffer):(Qo(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Jo(this.gl))},t.prototype.downloadMatrixDriver=function(a,e){this.bindTextureToFrameBuffer(a);var t=e();return this.unbindTextureToFrameBuffer(),t},t.prototype.setOutputMatrixTextureDriver=function(a,e,t){this.throwIfDisposed();var o=this.gl;Qo(o,this.debug,a,this.framebuffer),this.debug&&Jo(o),this.outputTexture=a,No(o,this.debug,function(){return o.viewport(0,0,e,t)}),No(o,this.debug,function(){return o.scissor(0,0,e,t)})},t.prototype.setOutputMatrixWriteRegionDriver=function(a,e,t,n){var r=this;this.throwIfDisposed(),No(this.gl,this.debug,function(){return r.gl.scissor(a,e,t,n)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}(),Np=function(){return function(m,e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=m;var n=t.filterWidth,r=t.inChannels,o=t.strideWidth,a=t.strideHeight,i=t.padInfo,s=t.outWidth,u=t.dilationWidth,c=t.dilationHeight,l=i.left,p=i.top,d=r*n,h=_a();this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+m[1]+" || pos >= "+m[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+s+")) * "+a+" - "+p+";\n            int d0 = offsetY + "+c+" * (pos / "+d+");\n\n            if(d0 >= "+e[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+s+".) * "+o+". - "+l+".);\n            int d1 = offsetX + "+u+" * (int(mod(float(pos), "+d+".) / "+r+".));\n\n            if(d1 >= "+e[1]+" || d1 < 0) continue;\n\n            vec2 innerDims = vec2(d1, int(mod(float(pos), "+r+".)));\n            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),\n                                              int(innerDims.y)), innerDims);\n          }\n        }\n\n        "+h.output+" = result;\n      }\n    "}}(),Tp=function(){return function(p,e,t,n,r){this.variableNames=["x"],this.outputShape=[];var o=e,i=p[3]-1,s;this.outputShape=p;var a="float("+t+") + float("+n+") * sum";s=.5===r?"inversesqrt("+a+")":1===r?"1.0/("+a+")":"exp(log("+a+") * float(-"+r+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+i+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+s+";\n        setOutput(val);\n      }\n    "}}(),Dp=function(){return function(a,e,t,n,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=a,this.depth=a[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=r,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+n+") * norm + float("+t+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+n+")\n                * float("+r+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+r+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "}}(),Ap=function(){return function(p){this.variableNames=["dy","maxPos"],this.outputShape=p.inShape;var e=p.strideHeight,t=p.strideWidth,n=p.dilationHeight,r=p.effectiveFilterHeight,o=p.effectiveFilterWidth,a=r-1-p.padInfo.top,i=o-1-p.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+r+";\n          wR += "+n+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+p.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t+".0;\n\n            if (dyC < 0.0 || dyC >= "+p.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(r*o-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Op=function(){return function(m,e,t,n,r,o){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var a=t?m[1]:m[2],i=pe(a/2),s=t?"i * 2, rc.y":"rc.y, i * 2",u=n?"rc.z, i * 2":"i * 2, rc.z",c=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],l=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",d="";o&&(p="vec4 activation(vec4 x) {\n        "+o+"\n      }",d="result = activation(result);");var h=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+i+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+i+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+s+");\n          vec4 b = getMatrixB(rc.x, "+u+");\n\n          result += ("+c[0]+" * "+l[0]+") + ("+c[1]+" * "+l[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+h+"\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "}}(),Pp=function(){function t(a,o,t){this.variableNames=["probs"],this.outputShape=[a,t],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(o-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(o-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a){var e=this;return function(t,o){null==e.seedLoc&&(e.seedLoc=t.getUniformLocation(o,"seed")),t.gl.uniform1f(e.seedLoc,a)}},t}(),Fp=function(){return function(a,e,t,o){this.variableNames=["indices"],this.outputShape=[a,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+o+"), float("+t+"),\n                      float(index == coords.y)));\n      }\n    "}}(),Bp=function(){return function(s){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=s;var e=s.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var t=va("rc",e),n=mo(e),r=Bn(e,s,t),o=Ln(e,s[s.length-1],s[s.length-2],t),a=Mn(s,t);this.userCode="\n        void main() {\n          "+n+" rc = getOutputCoords();\n\n          if("+r+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}}}(),Lp=function(){return function(p,e,t){this.variableNames=["x"],this.outputShape=e.map(function(e,t){return e[0]+p[t]+e[1]});var n=p.length,r=mo(n),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,t){return e[0]+p[t]}).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=1===n?"\n        int start = "+o+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+t+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ":"\n      "+r+" start = "+r+"("+o+");\n      "+r+" end = "+r+"("+a+");\n\n      void main() {\n        "+r+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+t+"));\n        } else {\n          "+r+" coords = outC - start;\n          setOutput(getX("+i+"));\n        }\n      }\n    "}}(),Mp=function(){return function(g,e,t){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(e,t){return e[0]+g[t]+e[1]});for(var n=g.length,r=mo(n),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,t){return e[0]+g[t]}).join(","),i=va("rc",n),s=va("source",n),u=i[n-1]+" < "+this.outputShape[n-1],c=1===n?"source":"vec2("+s.slice(-2).join()+")",l=[r+" rc = outputLoc;",i[n-1]+" += 1;\n       if("+u+") {\n      ",1===n?"":"}\n       rc = outputLoc;\n       "+i[n-2]+" += 1;\n       if("+i[n-2]+" < "+this.outputShape[n-2]+") {",1===n?"":"  "+i[n-1]+" += 1;\n         if("+u+") {"],p=1===n?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",h=0,f=1===n?2:4;h<f;h++)d+="\n        "+l[h]+"\n        if ("+p+") {\n          result["+h+"] = float("+t+");\n        } else {\n          "+r+" source = rc - start;\n          result["+h+"] = getChannel(getX("+s.join()+"), "+c+");\n        }\n      ";d+=1===n?"} ":"}}",this.userCode="\n      const "+r+" start = "+r+"("+o+");\n      const "+r+" end = "+r+"("+a+");\n\n      void main() {\n        "+r+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+d+"\n        setOutput(result);\n      }\n    "}}(),Wp=function(){return function(y,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var n=y.filterWidth,r=y.strideHeight,o=y.strideWidth,a=y.dilationHeight,i=y.dilationWidth,s=y.effectiveFilterHeight,u=y.effectiveFilterWidth,c=y.padInfo.top,l=y.padInfo.left;this.outputShape=y.outShape;var p="avg"===e,d="0.0";if(p||(d="-1.0 / 1e-20"),t)this.userCode="\n        const ivec2 strides = ivec2("+r+", "+o+");\n        const ivec2 pads = ivec2("+c+", "+l+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+s+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+y.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+i+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+y.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+u+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var h=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(h="avgValue / count");var f=4*$(n/4),m=n%4,g="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float initializationValue = "+d+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+y.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+d+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+y.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC += 4) {\n            int xC = xCCorner + wC * "+i+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+i+", d),\n              getValue(batch, xR, xC + 2 * "+i+", d),\n              getValue(batch, xR, xC + 3 * "+i+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+f+";\n          if ("+(1==m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2==m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+i+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3==m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+i+", d),\n              getValue(batch, xR, xC + 2 * "+i+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+h+");\n      }\n    "}}}(),Up=function(){return function(m,e){this.variableNames=["x"];var t=m.windowSize,n=m.batchSize,r=m.inSize,o=pe(r/t);this.outputShape=[n,o];var a="0.0",i="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",i="min"):"max"==e&&(a="-1.0 / 1e-20",i="max");var s=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?s="sumValue":"prod"===e?s="prodValue":"all"===e?s="allValue":"any"==e&&(s="anyValue");var u=4*$(t/4),c=t%4,l="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+i+"(values, minMaxValue);\n      }\n    ",p="vec4";"all"===e?(a="1.0",l="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"==e&&(a="0.0",l="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var d="";0<r%t&&(d="\n        if (inIdx < 0 || inIdx >= "+r+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+t+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(1==c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+l+"\n        } else if ("+(2==c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+l+"\n        } else if ("+(3==c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+l+"\n        }\n        setOutput("+s+");\n      }\n    "}}(),zp=function(){return function(a,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=a;for(var t="",n=0,r;4>n;n++)r="thisRC = rc;",1==n%2&&(r+="thisRC.z += 1;"),1<n&&(r+="thisRC.y += 1;"),t+="\n        "+r+"\n        "+(0<n?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+n+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(0<n?"}":"")+"\n      ";this.userCode="\n      "+Un(e)+"\n      "+Wn(a)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+a[1]+";\n        int cols = "+a[2]+";\n\n        "+t+"\n\n        setOutput(result);\n      }\n    "}}(),Gp=function(){return function(y,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,r=n[1],o=n[2],a=y.shape,i=a[1],s=a[2],u=[t&&1<i?r-1:r,t&&1<s?o-1:o],c=[t&&1<i?i-1:i,t&&1<s?s-1:s],l=u[0]/c[0],p=u[1]/c[1],d=1/l,h=1/p,f=2*pe(d)+2,m=2*pe(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+l+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+f+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+i+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+s+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(r-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}}(),Vp=function(){return function(p,e,t,n){this.variableNames=["A"],this.outputShape=[];var r=p[0],o=p[1],a=p[2],i=p[3];this.outputShape=[r,e,t,i];var s=[n&&1<e?o-1:o,n&&1<t?a-1:a],d=[n&&1<e?e-1:e,n&&1<t?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+s[0]/d[0]+",\n          "+s[1]/d[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}}(),Hp=function(){return function(p,e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var r=p[0],o=p[1],a=p[2],i=p[3];this.outputShape=[r,e,t,i];var s=[n&&1<e?o-1:o,n&&1<t?a-1:a],d=[n&&1<e?e-1:e,n&&1<t?t-1:t];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/d[0]+",\n          "+s[1]/d[1]+",\n          "+s[1]/d[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(i-1)+"; \n        bool hasNextRow = coords.z < "+(t-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "}}(),qp=function(){return function(y,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,r=n[1],o=n[2],a=y.shape,i=a[1],s=a[2],u=[t&&1<i?r-1:r,t&&1<s?o-1:o],c=[t&&1<i?i-1:i,t&&1<s?s-1:s],l=u[0]/c[0],p=u[1]/c[1],d=1/l,h=1/p,f=2*pe(d)+2,m=2*pe(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+l+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+f+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+i+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+s+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+u[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+u[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+r+") - 1),\n                "+t+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+t+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}}(),$p=function(){return function(p,e,t,n){this.variableNames=["A"],this.outputShape=[];var r=p[0],o=p[1],a=p[2],i=p[3];this.outputShape=[r,e,t,i];var s=[n&&1<e?o-1:o,n&&1<t?a-1:a],d=[n&&1<e?e-1:e,n&&1<t?t-1:t],u=n?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+s[0]/d[0]+",\n          "+s[1]/d[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+u+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "}}(),Kp=function(){return function(a,e){this.variableNames=["x"];var t=a.length;if(4<t)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=a,1!==t){var n=a.map(function(t,o){return function(t){return-1!==e.indexOf(t)&&1!==a[t]?a[t]+" - coords["+t+"] - 1":"coords["+t+"]"}(o)}).join(","),r=mo(t);this.userCode="\n      void main() {\n        "+r+" coords = getOutputCoords();\n        setOutput(getX("+n+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+a[0]+" - coord - 1));\n        }\n      "}}(),jp=function(){return function(p,e){function t(t){var a=p.map(function(a,n){return function(t,a){return-1!==e.indexOf(t)&&1!==p[t]?p[t]+" - "+a[t]+" - 1":""+a[t]}(n,t)});return"getChannel(getX("+a.join(",")+"), vec2("+a.slice(-2).join(",")+"))"}this.variableNames=["x"],this.usesPackedTextures=!0;var s=p.length;if(4<s)throw new Error("WebGL backend: Reverse of rank-"+s+" tensor is not yet supported");this.outputShape=p;var n=va("rc",s),r=n[s-1]+" + 1 < "+this.outputShape[s-1],o=n[s-2]+" + 1 < "+this.outputShape[s-2],a=mo(s);this.userCode=1===s?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+p[0]+" - rc - 1), rc);\n          if("+r+"){\n              result.g = getChannel(getX("+p[0]+" - (rc  + 1) - 1), rc + 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(a){return t(a)}(n.slice())+";\n          if("+r+"){\n            result.g = "+function(a){return a[s-1]="("+a[s-1]+" + 1)",t(a)}(n.slice())+";\n          }\n          if("+o+") {\n            result.b = "+function(a){return a[s-2]="("+a[s-2]+" + 1)",t(a)}(n.slice())+";\n            if("+r+") {\n              result.a = "+function(a){return a[s-1]="("+a[s-1]+" + 1)",a[s-2]="("+a[s-2]+" + 1)",t(a)}(n.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "}}(),Xp=function(){return function(m,e,t,n,r,o,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var i=mo(r.length),s=mo(o.length),u="";1===t?u="i":2==t&&(u="i, j");var c="getIndices("+u+")",l="";1===n?l="i":2==n&&(l="i, coords[1]");var p="getUpdates("+l+")",d=1<e?"strides[j]":"strides";this.userCode="\n        "+i+" strides = "+i+"("+r+");\n\n        void main() {\n          "+s+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+m+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+d+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+p+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "}}(),Yp=function(){return function(t){this.variableNames=["x","segmentIds"];var e=t.windowSize,n=t.batchSize,r=t.inSize,o=t.numSegments,a=o*pe(r/e);this.outputShape=[n,a];var i=4*$(e/4),s=e%4,d="\n        sumValue += dot(values, segFilter);\n    ",u="";0<r%e&&(u="\n        if (inIdx < 0 || inIdx >= "+r+") {\n          return initializationValue;\n        }\n      ");var l="";0<r%e&&(l="\n        if (inIdx < 0 || inIdx >= "+r+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+u+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+l+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+i+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+i+";\n        if ("+(1==s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+d+"\n        } else if ("+(2==s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+d+"\n        } else if ("+(3==s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+d+"\n        }\n        setOutput(sumValue);\n      }\n    "}}(),Qp=function(){return function(p,e,t){var n,r;if(this.variableNames=["c","a","b"],this.outputShape=e,4<t)throw Error("Where for rank "+t+" is not yet supported");if(1===t)r="resRC",n="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=[],s=0;s<e.length;s++)i.push(""+o[s]),s<p&&a.push(""+o[s]);n=a.join(),r=i.join()}var d=mo(t);this.userCode="\n      void main() {\n        "+d+" resRC = getOutputCoords();\n        float cVal = getC("+n+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+r+"));\n        } else {\n          setOutput(getB("+r+"));\n        }\n      }\n    "}}(),Zp=function(){function t(a){this.variableNames=["source"],this.outputShape=a,this.rank=a.length;var s=mo(this.rank),n="uniform int start["+this.rank+"];",r=zn(this.rank),o;o="\n        "+s+" sourceLoc;\n        "+s+" coords = getOutputCoords();\n        "+a.map(function(a,e){return"sourceLoc."+Jp[e]+" = start["+e+"] + coords."+Jp[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+n+"\n      void main() {\n        "+o+"\n        setOutput(getSource("+r+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a){var e=this;if(a.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+a.length+")");return function(t,o){null==e.startLoc&&(e.startLoc=t.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||t.gl.uniform1iv(e.startLoc,a)}},t}(),Jp=["x","y","z","w","u","v"],ed=function(){function t(p){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=p,this.rank=p.length;var d=mo(this.rank),l=va("coords",this.rank),n=va("sourceLoc",this.rank),t=1===this.rank?"sourceLoc":"vec2("+n.slice(-2).join()+")",o="getChannel(getSource("+n.join()+"), "+t+")",a="\n      result.x = "+o+";\n      if (++"+l[this.rank-1]+" < "+p[this.rank-1]+") {\n        ++"+n[this.rank-1]+";\n        result.y = "+o+";\n        --"+n[this.rank-1]+";\n      }\n    ",r=1===this.rank?"":"\n      --"+l[this.rank-1]+";\n      if (++"+l[this.rank-2]+" < "+p[this.rank-2]+") {\n        ++"+n[this.rank-2]+";\n        result.z = "+o+";\n        if (++"+l[this.rank-1]+" < "+p[this.rank-1]+") {\n          ++"+n[this.rank-1]+";\n          result.w = "+o+";\n        }\n      }\n    ",s=4>=this.rank?"sourceLoc = coords +\n            "+d+"("+p.map(function(a,e){return"start["+e+"]"}).join()+");":p.map(function(a,e){return n[e]+" = "+l[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+d+" coords = getOutputCoords();\n        "+d+" sourceLoc;\n        "+s+" \n        vec4 result = vec4(0.);\n        "+a+"\n        "+r+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a){var e=this;if(a.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+a.length+")");return function(t,o){null==e.startLoc&&(e.startLoc=t.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||t.gl.uniform1iv(e.startLoc,a)}},t}(),td=function(){return function(p,e,t,n){this.variableNames=["x"];var r=t.filter(function(a,e){return-1===n.indexOf(e)});this.outputShape=r;var o=t.length,a=mo(t.length),i=mo(r.length),s="";if(1===o)s="coords * strides + begin";else{var d=0;s=t.map(function(a,e){return-1===n.indexOf(e)?(d++,1===r.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(d-1)+"] * strides["+e+"] + begin["+e+"]"):"begin["+e+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+p+");\n      "+a+" strides = "+a+"("+e+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+s+"));\n      }\n    "}}(),ad=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(s,e,t){var n=Gn(e,t),o=Vn(s,n,t),a;if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),0<this.freeTextures[o].length){this.numFreeTextures--,this.numUsedTextures++,this.log();var r=this.freeTextures[o].shift();return this.usedTextures[o].push(r),r}return this.numUsedTextures++,this.log(),n===Rp.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(s[0],s[1]):n===Rp.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(s[0],s[1]):n===Rp.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(s[0],s[1]):n===Rp.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(s[0],s[1]):n===Rp.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(s[0],s[1])),this.usedTextures[o].push(a),a},t.prototype.releaseTexture=function(s,e,t,n){if(null!=this.freeTextures){var r=Vn(e,Gn(t,n),n);r in this.freeTextures||(this.freeTextures[r]=[]),this.freeTextures[r].push(s),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[r],a=o.indexOf(s);if(0>a)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(a,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var a=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){a.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){a.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}(),od=function(){return function(s,e){this.variableNames=["A"];for(var t=Array(s.length),n=0;n<t.length;n++)t[n]=s[n]*e[n];this.outputShape=t,this.rank=t.length;var r=mo(this.rank),o=Hn(s);this.userCode="\n      void main() {\n        "+r+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "}}(),nd=function(){return function(s,e){this.variableNames=["A"];for(var t=Array(s.length),n=0;n<t.length;n++)t[n]=s[e[n]];this.outputShape=t,this.rank=t.length;var r=mo(this.rank),o=qn(e);this.userCode="\n    void main() {\n      "+r+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "}}(),rd=function(){return function(p,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var t=Array(p.length),n=0;n<t.length;n++)t[n]=p[e[n]];if(this.outputShape=t,this.rank=t.length,6<this.rank)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var r=mo(this.rank),o=ba("rc",this.rank),a=Array(this.rank);for(n=0;n<e.length;n++)a[e[n]]=o[n];var i="vec2("+a.slice(-2).join()+")",s="++"+o[this.rank-1]+" < "+t[this.rank-1],d="getChannel(getA("+a.join()+"), "+i+")";this.userCode="\n    void main() {\n      "+r+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+d+";\n      if("+s+") {\n        result[1] = "+d+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+t[this.rank-2]+") {\n        result[2] = "+d+";\n        if("+s+") {\n          result[3] = "+d+";\n        }\n      }  \n      setOutput(result);\n    }\n    "}}(),sd=.3275911,id=.254829592,pd=-.284496736,dd=1.421413741,ld=-1.453152027,ud=1.061405429,cd=1.7580993408473768,hd=1.0507009873554805,md=function(){return function(a,e){this.variableNames=["A"],this.outputShape=a,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}(),gd="if (isnan(x)) return x;",fd="return x;",yd=gd+"\n  return (x < 0.0) ? 0.0 : x;\n",xd="return exp(x);",bd="return x;",vd="return x;",Cd="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Rd=function(){return function(a,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=a,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}(),Sd=function(){return function(s){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=s;var e=s.length,t=va("rc",e),n=mo(e),r=Ca(e,t),o=t.slice(-2),a=1>=e?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+n+" rc = getOutputCoords();\n        vec4 packedInput = getA("+r+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "}}(),Ed=qt({concat_:function(s,i){void 0===i&&(i=0),A(1<=s.length,function(){return"Pass at least one tensor to concat"});var t=it(s,"tensors","concat");i=K(i,t[0].shape)[0];var e=Tt(t.map(function(t){return t.shape}),i);if(0===U(e))return $t([],e);if(1===(t=t.filter(function(t){return 0<t.size})).length)return t[0];var r=t.map(function(t){return t.shape});Nt(r,i);var o=t;return hi.engine.runKernel(function(a){return a.concat(t,i)},o,function(t){var e=r.map(function(t){return t[i]});return Nd(t,e,i).map(function(t){return function(){return t}})})}}),_d=qt({concat1d_:function(t){return Ed(t,0)}}),kd=qt({concat2d_:function(a,e){return Ed(a,e)}}),wd=qt({concat3d_:function(a,e){return Ed(a,e)}}),Id=qt({concat4d_:function(a,e){return Ed(a,e)}}),Nd=qt({split_:function(a,e,s){void 0===s&&(s=0);var n=st(a,"x","split"),i;return s=K(s,n.shape)[0],"number"==typeof e?(A(0==n.shape[s]%e,function(){return"Number of splits must evenly divide the axis."}),i=Array(e).fill(n.shape[s]/e)):(A(n.shape[s]===e.reduce(function(a,e){return a+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),i=e),hi.engine.runKernel(function(t){return t.split(n,i,s)},{$x:n},function(t){return{$x:function(){return Ed(t,s)}}})}}),Td="undefined"==typeof window?"undefined"==typeof g?"undefined"==typeof self?{}:self:g:window,Dd=Kn(function(t){!function(a,e,t){function s(a,e){return e.c=a.c,e.s0=a.s0,e.s1=a.s1,e.s2=a.s2,e}function n(r,e){var t=new function(a){var o=this,e=(s=4022871197,function(t){t=t.toString();for(var e=0,a;e<t.length;e++)a=.02519603282416938*(s+=t.charCodeAt(e)),a-=s=a>>>0,s=(a*=s)>>>0,s+=4294967296*(a-=s);return 23283064365386963e-26*(s>>>0)}),s;o.next=function(){var t=2091639*o.s0+23283064365386963e-26*o.c;return o.s0=o.s1,o.s1=o.s2,o.s2=t-(o.c=0|t)},o.c=1,o.s0=e(" "),o.s1=e(" "),o.s2=e(" "),o.s0-=e(a),0>o.s0&&(o.s0+=1),o.s1-=e(a),0>o.s1&&(o.s1+=1),o.s2-=e(a),0>o.s2&&(o.s2+=1),e=null}(r),n=e&&e.state,i=t.next;return i.int32=function(){return 0|4294967296*t.next()},i.double=function(){return i()+11102230246251565e-32*(0|2097152*i())},i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.alea=n}(0,t,!1)}),Ad=Kn(function(t){!function(a,e,t){function s(a,e){return e.x=a.x,e.y=a.y,e.z=a.z,e.w=a.w,e}function n(r,e){var t=new function(a){var o=this,e="";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var t=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^t^t>>>8},a===(0|a)?o.x=a:e+=a;for(var t=0;t<e.length+64;t++)o.x^=0|e.charCodeAt(t),o.next()}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.xor128=n}(0,t,!1)}),Od=Kn(function(t){!function(a,e,t){function s(a,e){return e.x=a.x,e.y=a.y,e.z=a.z,e.w=a.w,e.v=a.v,e.d=a.d,e}function n(r,e){var t=new function(a){var o=this,e="";o.next=function(){var t=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,0|(o.d=0|o.d+362437)+(o.v=o.v^o.v<<4^t^t<<1)},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,a===(0|a)?o.x=a:e+=a;for(var t=0;t<e.length+64;t++)o.x^=0|e.charCodeAt(t),t==e.length&&(o.d=o.x<<10^o.x>>>4),o.next()}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.xorwow=n}(0,t,!1)}),Pd=Kn(function(t){!function(a,e,t){function s(a,e){return e.x=a.x.slice(),e.i=a.i,e}function n(r,e){null==r&&(r=+new Date);var t=new function(a){var s=this;s.next=function(){var t=s.x,a=s.i,o,e;return o=t[a],e=(o^=o>>>7)^o<<24,e^=(o=t[7&a+1])^o>>>10,e^=(o=t[7&a+3])^o>>>3,e^=(o=t[7&a+4])^o<<7,o=t[7&a+7],e^=(o^=o<<13)^o<<9,t[a]=e,s.i=7&a+1,e},function(a,e){var t=[],o;if(e===(0|e))t[0]=e;else for(e=""+e,o=0;o<e.length;++o)t[7&o]=t[7&o]<<15^e.charCodeAt(o)+t[7&o+1]<<13;for(;8>t.length;)t.push(0);for(o=0;8>o&&0===t[o];++o);for(8==o?t[7]=-1:t[o],a.x=t,a.i=0,o=256;0<o;--o)a.next()}(s,a)}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&(n.x&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.xorshift7=n}(0,t,!1)}),Fd=Kn(function(t){!function(a,e,t){function s(a,e){return e.i=a.i,e.w=a.w,e.X=a.X.slice(),e}function n(r,e){null==r&&(r=+new Date);var t=new function(a){var s=this;s.next=function(){var t=s.w,r=s.X,o=s.i,a,e;return s.w=t=0|t+1640531527,e=r[127&o+34],a=r[o=127&o+1],e^=e<<13,a^=a<<17,e^=e>>>15,a^=a>>>12,e=r[o]=e^a,s.i=o,0|e+(t^t>>>16)},function(p,e){var t=[],s=128,d,n,r,o,a;for(e===(0|e)?(n=e,e=null):(e+="\0",n=0,s=de(s,e.length)),r=0,o=-32;o<s;++o)e&&(n^=e.charCodeAt((o+32)%e.length)),0===o&&(a=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,0<=o&&(a=0|a+1640531527,r=0==(d=t[127&o]^=n+a)?r+1:0);for(128<=r&&(t[127&(e&&e.length||0)]=-1),r=127,o=512;0<o;--o)n=t[127&r+34],d=t[r=127&r+1],n^=n<<13,d^=d<<17,n^=n>>>15,d^=d>>>12,t[r]=n^d;p.w=a,p.X=t,p.i=r}(s,a)}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&(n.X&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.xor4096=n}(0,t,!1)}),Bd=Kn(function(t){!function(a,e,t){function s(a,e){return e.a=a.a,e.b=a.b,e.c=a.c,e.d=a.d,e}function n(r,e){var t=new function(a){var s=this,e="";s.next=function(){var t=s.b,e=s.c,a=s.d,n=s.a;return t=t<<25^t>>>7^e,e=0|e-a,a=a<<24^a>>>8^n,n=0|n-t,s.b=t=t<<20^t>>>12^e,s.c=e=0|e-a,s.d=a<<16^e>>>16^n,s.a=0|n-t},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,a===$(a)?(s.a=0|a/4294967296,s.b=0|a):e+=a;for(var t=0;t<e.length+20;t++)s.b^=0|e.charCodeAt(t),s.next()}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.tychei=n}(0,t,!1)}),Ld=Kn(function(g){!function(b,C){function e(a,e,o){var r=[],g=t(function s(e,i){var n=[],o=typeof e,a;if(i&&"object"==o)for(a in e)try{n.push(s(e[a],i-1))}catch(t){}return n.length?n:"string"==o?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[a,h(b)]:null==a?function(){try{var t;return p&&(t=p.randomBytes)?t=t(m):(t=new Uint8Array(m),(d.crypto||d.msCrypto).getRandomValues(t)),h(t)}catch(t){var e=d.navigator,a=e&&e.plugins;return[+new Date,d,a,d.screen,h(b)]}}():a,3),r),y=new function(a){var e=a.length,p=this,n=0,o=p.i=p.j=0,r=p.S=[],s;for(e||(a=[e++]);n<m;)r[n]=n++;for(n=0;n<m;n++)r[n]=r[o=l&o+a[n%e]+(s=r[n])],r[o]=s;(p.g=function(a){for(var e=0,n=p.i,o=p.j,r=p.S,s;a--;)s=r[n=l&n+1],e=e*m+r[l&(r[n]=r[o=l&o+s])+(r[o]=s)];return p.i=n,p.j=o,e})(m)}(r),x=function(){for(var a=y.g(f),e=s,t=0;a<u;)a=(a+t)*m,e*=m,t=y.g(1);for(;a>=c;)a/=2,e/=2,t>>>=1;return(a+t)/e};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,t(h(y.S),b),(e.pass||o||function(a,e,t,r){return r&&(r.S&&n(r,y),a.state=function(){return n(y,{})}),t?(C[i]=a,e):a})(x,g,"global"in e?e.global:this==C,e.state)}function n(a,e){return e.i=a.i,e.j=a.j,e.S=a.S.slice(),e}function t(a,e){for(var t=a+"",r=0,o;r<t.length;)e[l&r]=l&(o^=19*e[l&r])+t.charCodeAt(r++);return h(e)}function h(t){return o.apply(0,t)}var d=this,m=256,f=6,i="random",s=C.pow(m,f),u=C.pow(2,52),c=2*u,l=m-1,p;if(C["seed"+i]=e,t(C.random(),b),g.exports){g.exports=e;try{p=a(142)}catch(t){}}else;}([],Math)});Ld.alea=Dd,Ld.xor128=Ad,Ld.xorwow=Od,Ld.xorshift7=Pd,Ld.xor4096=Fd,Ld.tychei=Bd;var Md=Ld.alea,Wd=function(){function t(s,i,t,n,r){this.mean=s,this.stdDev=i,this.dtype=t,this.nextVal=NaN,this.truncated=n,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=r||Math.random();this.random=Md(o.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var d=this.nextVal;return this.nextVal=NaN,d}for(var e=!1,l,t;!e;){var n=void 0,o=void 0,a=void 0;do a=(n=2*this.random()-1)*n+(o=2*this.random()-1)*o;while(1<=a||0===a);var i=C(-2*p(a)/a);l=this.mean+this.stdDev*n*i,t=this.mean+this.stdDev*o*i,this.truncated&&!this.isValidTruncated(l)||(e=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(l)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:_(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),Ud=qt({batchToSpaceND_:function(a,s,t){var n=st(a,"x","batchToSpaceND"),e=s.reduce(function(a,e){return a*e});return A(n.rank>=1+s.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+s.length}),A(t.length===s.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+s.length}),A(0==n.shape[0]%e,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+s.join(" * ")+" === "+e}),hi.engine.runKernel(function(a){return a.batchToSpaceND(n,s,t)},{$x:n},function(a){return{$x:function(){return a.spaceToBatchND(s,t)}}})}}),zd=qt({cast_:function(a,o){var t=st(a,"x","cast");return hi.engine.runKernel(function(a){return a.cast(t,o)},{$x:t},function(t){return{$x:function(){return t.clone()}}})}}),Gd=qt({clone_:function(a){var e=st(a,"x","clone",null);return hi.engine.runKernel(function(){return $s.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),Vd=qt({cumsum_:function(p,d,t,n){void 0===d&&(d=0),void 0===t&&(t=!1),void 0===n&&(n=!1);var e=st(p,"x","cumsum"),o=kt([d|=0],e.rank),a=e;null!=o&&(a=e.transpose(o));var l=It(1,e.rank)[0],s=hi.engine.runKernel(function(o){return o.cumsum(a,l,t,n)},{permutedX:a},function(a){return{permutedX:function(){return a.cumsum(d,t,!n)}}});return null!=o&&(s=s.transpose(o)),s}}),Hd=qt({depthToSpace_:function(s,p,t){void 0===t&&(t="NHWC");var n=st(s,"x","depthToSpace"),e="NHWC"===t?n.shape[1]:n.shape[2],o="NHWC"===t?n.shape[2]:n.shape[3],a="NHWC"===t?n.shape[3]:n.shape[1];return A(0<=e*p,function(){return"Negative dimension size caused by overflow when multiplying\n      "+e+" and "+p+"  for depthToSpace with input shape\n      "+n.shape}),A(0<=o*p,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+p+" for depthToSpace with input shape\n          "+n.shape}),A(0==a%(p*p),function(){return"Dimension size must be evenly divisible by "+p*p+" but is "+a+" for depthToSpace with input shape "+n.shape}),hi.engine.runKernel(function(a){return a.depthToSpace(n,p,t)},{$x:n})}}),qd=qt({expandDims_:function(a,e){void 0===e&&(e=0);var t=st(a,"x","expandDims");A(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var o=t.shape.slice();return 0>e&&(A(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),o.splice(e,0,1),ol(t,o)}}),$d=qt({eye_:function(p,e,t,n){void 0===n&&(n="float32"),null==e&&(e=p);for(var r=jn([p,e],n),o=p<=e?p:e,a=0;a<o;++a)r.set(1,a,a);var i=r.toTensor().as2D(p,e);if(null==t)return i;if(1===t.length)return il(qd(i,0),[t[0],1,1]);if(2===t.length)return il(qd(qd(i,0),0),[t[0],t[1],1,1]);if(3===t.length)return il(qd(qd(qd(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),Kd=qt({multinomial_:function(p,d,t,n){void 0===n&&(n=!1);var e=st(p,"logits","multinomial"),o=e.size,a=e.rank;if(2>o)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(2<a)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var r=1===a?e.as2D(1,-1):e,i=hi.engine.runKernel(function(a){return a.multinomial(r,n,d,t)},{logits2D:r});return 1===a?i.as1D():i}}),jd=qt({oneHot_:function(s,i,t,n){if(void 0===t&&(t=1),void 0===n&&(n=0),2>i)throw new Error("Error in oneHot: depth must be >=2, but it is "+i);var r=st(s,"indices","oneHot","int32"),e=r.shape.concat([i]);return r=r.flatten(),hi.engine.runKernel(function(a){return a.oneHot(r,i,t,n)},{$indices:r},function(){return{$indices:function(){return ta(r.shape,"float32")}}}).reshape(e)}}),Xd=qt({pad_:function(a,s,t){void 0===t&&(t=0);var n=st(a,"x","pad");if(0===n.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=s.map(function(t){return t[0]});return hi.engine.runKernel(function(a){return a.pad(n,s,t)},{$x:n},function(t){return{$x:function(){return t.slice(i,n.shape)}}})}}),Yd=qt({pad1d_:function(a,e,t){return void 0===t&&(t=0),A(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),Xd(a,[e],t)}}),Qd=qt({pad2d_:function(a,e,t){return void 0===t&&(t=0),A(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Xd(a,e,t)}}),Zd=qt({pad3d_:function(a,e,t){return void 0===t&&(t=0),A(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Xd(a,e,t)}}),Jd=qt({pad4d_:function(a,e,t){return void 0===t&&(t=0),A(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Xd(a,e,t)}}),el=qt({rand_:function(s,e,t){var n=U(s),r=null;if(null==t||"float32"===t)r=new Float32Array(n);else if("int32"===t)r=new Int32Array(n);else{if("bool"!==t)throw new Error("Unknown data type "+t);r=new Uint8Array(n)}for(var i=0;i<n;i++)r[i]=e();return $s.make(s,{values:r},t)}}),tl=qt({randomNormal_:function(p,e,t,n,r){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=n&&"bool"===n)throw new Error("Unsupported data type "+n);for(var o=new Wd(e,t,n,!1,r),a=jn(p,n),i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}}),al=qt({randomUniform_:function(s,e,t,n){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n="float32");for(var r=jn(s,n),o=0;o<r.values.length;o++)r.values[o]=D(e,t);return r.toTensor()}}),ol=qt({reshape_:function(a,o){var t=st(a,"x","reshape",null);return o=q(o,t.size),A(t.size===U(o),function(){return"new shape and old shape must have the same number of elements."}),hi.engine.runKernel(function(a){return a.reshape(t,o)},{$x:t},function(a){return{$x:function(){return a.reshape(t.shape)}}})}}),nl=qt({spaceToBatchND_:function(a,s,t){var o=st(a,"x","spaceToBatchND");return A(o.rank>=1+s.length,function(){return"input rank "+o.rank+" should be > than [blockShape] "+s.length}),A(t.length===s.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+s.length}),A(o.shape.reduce(function(a,e,n){return 0<n&&n<=s.length?a&&0==(e+t[n-1][0]+t[n-1][1])%s[n-1]:a},!0),function(){return"input spatial dimensions "+o.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+s.toString()}),hi.engine.runKernel(function(a){return a.spaceToBatchND(o,s,t)},{$x:o},function(a){return{$x:function(){return a.batchToSpaceND(s,t)}}})}}),rl=qt({squeeze_:function(a,e){var t=st(a,"x","squeeze");return ol(t,j(t.shape,e).newShape)}}),sl=qt({stack_:function(s,p){void 0===p&&(p=0);var e=it(s,"tensors","stack");if(A(1<=e.length,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(p);var t=e[0].rank,n=e[0].shape,o=e[0].dtype;A(p<=t,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(t){O(n,t.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(t){A(o===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=e.map(function(t){return t.expandDims(p)});return Ed(a,p)}}),il=qt({tile_:function(a,p){var t=st(a,"x","tile");return A(t.rank===p.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+p+"."}),hi.engine.runKernel(function(a,e){var n=a.tile(t,p);return e([t]),n},{$x:t},function(t,e){var d=e[0];return{$x:function(){var e=wi(d);if(1===d.rank)for(var n=0;n<p[0];++n)e=e.add(t.slice([n*d.shape[0]],[d.shape[0]]));else if(2===d.rank)for(n=0;n<p[0];++n)for(var o=0;o<p[1];++o)e=e.add(t.slice([n*d.shape[0],o*d.shape[1]],[d.shape[0],d.shape[1]]));else if(3===d.rank)for(n=0;n<p[0];++n)for(o=0;o<p[1];++o)for(var a=0;a<p[2];++a)e=e.add(t.slice([n*d.shape[0],o*d.shape[1],a*d.shape[2]],[d.shape[0],d.shape[1],d.shape[2]]));else{if(4!==d.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+d.rank+" tensors yet.");for(n=0;n<p[0];++n)for(o=0;o<p[1];++o)for(a=0;a<p[2];++a)for(var r=0;r<p[3];++r)e=e.add(t.slice([n*d.shape[0],o*d.shape[1],a*d.shape[2],r*d.shape[3]],[d.shape[0],d.shape[1],d.shape[2],d.shape[3]]))}return e}}})}}),pl=qt({truncatedNormal_:function(p,e,t,n,r){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=n&&"bool"===n)throw new Error("Unsupported data type "+n);for(var o=new Wd(e,t,n,!0,r),a=jn(p,n),i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}}),dl=qt({unstack_:function(a,o){void 0===o&&(o=0),o=o||0;var t=st(a,"x","unstack");return A(o>=-t.shape.length&&o<t.shape.length,function(){return"Axis = "+o+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),0>o&&(o+=t.shape.length),hi.engine.runKernel(function(a){return a.unstack(t,o)},{$x:t},function(t){return{$x:function(){return sl(t,o)}}})}}),ll=function(h,e){return x(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,c,d;return R(this,function(p){switch(p.label){case 0:return t=st(h,"x","setdiff1d"),n=st(e,"y","setdiff1d"),A(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),A(1===t.rank,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),A(1===n.rank,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return r=p.sent(),[4,n.data()];case 2:for(o=p.sent(),a=new Set(o),i=0,c=0;c<r.length;c++)a.has(r[c])||i++;for(s=new Gs([i],t.dtype),u=new Gs([i],"int32"),c=0,d=0;c<r.length;c++)a.has(r[c])||(s.values[d]=r[c],u.values[d]=c,d++);return[2,[s.toTensor(),u.toTensor()]];}})})},ul={},cl=1e3,hl=function(){function t(a){if(this.gpgpu=a,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.disposed=!1,1>hi.get("WEBGL_VERSION"))throw new Error("WebGL is not supported on this device");if(null==a){var o=S(hi.get("WEBGL_VERSION"));this.binaryCache=Qn(hi.get("WEBGL_VERSION")),this.gpgpu=new Ip(o),this.canvas=o.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=a.gl.canvas;this.textureManager=new ad(this.gpgpu)}return t.prototype.register=function(a,e,o){if(this.texData.has(a))throw new Error("Data buffer is already registered");this.texData.set(a,{shape:e,dtype:o})},t.prototype.setDataMover=function(t){this.texData=new Ii(t)},t.prototype.fromPixels=function(s,e){if(null==s)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=[s.height,s.width],n=[s.height,s.width,e];if(hi.get("IS_BROWSER")){if(!(s instanceof HTMLVideoElement||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+s.constructor.name);if(s instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=s.width,this.fromPixels2DContext.canvas.height=s.height,this.fromPixels2DContext.drawImage(s,0,0,s.width,s.height),s=this.fromPixels2DContext.canvas}}var r=this.makeTensorHandle(t,"int32");this.texData.get(r.dataId).usage=Cp.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(r.dataId),s);var o=new xp(n),a=this.compileAndRun(o,[r]);return this.disposeData(r.dataId),a},t.prototype.makeTensorHandle=function(a,o){var r={};return this.register(r,a,o),{dataId:r,shape:a,dtype:o}},t.prototype.write=function(p,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");if(hi.get("DEBUG"))for(var t=0,n;t<e.length;t++)if(n=e[t],!Do(n))throw Error("The value "+n+" cannot be represented on this device.");var r=this.texData.get(p),o=r.texture,a=r.texShape,i=r.usage,s=r.dtype,d=r.isPacked;if("complex64"===s)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=o&&(this.releaseTexture(p,o,a,i,s,d),r.texture=null,r.texShape=null),r.usage=Cp.UPLOAD,r.values=e},t.prototype.readSync=function(h){var m=this.texData.get(h),t=m.values,n=m.dtype,g=m.complexTensors,o=m.slice,a=m.shape;if(null!=o){var f=new md(a,bd),s=this.compileAndRun(f,[{dataId:h,shape:a,dtype:n}]),u=this.readSync(s.dataId);return s.dispose(),u}if(null!=t)return this.convertAndCacheOnCPU(h);if("string"===n)return t;var c=null!=this.activeTimers,d,l;return l=(c&&(d=performance.now()),"complex64"===n)?ia(g.real.dataSync(),g.imag.dataSync()):this.getValuesFromTexture(h),c&&(this.downloadWaitMs+=performance.now()-d),this.convertAndCacheOnCPU(h,l)},t.prototype.read=function(_){return x(this,void 0,void 0,function(){var k,t,n,r,o,a,i,s,u,I,l,N,d,h,f,m,g,v,y,x,E,T,b,w;return R(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(_))return n=this.pendingRead.get(_),[2,new Promise(function(t){return n.push(t)})];if(r=this.texData.get(_),o=r.texture,a=r.values,i=r.texShape,s=r.isPacked,u=r.shape,I=r.slice,l=r.dtype,null!=I)return N=new md(u,bd),d=this.compileAndRun(N,[{dataId:_,shape:u,dtype:l}]),h=this.read(d.dataId),d.dispose(),[2,h];if(null!=a)return[2,this.convertAndCacheOnCPU(_)];if(this.pendingRead.set(_,[]),!hi.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===hi.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return f=i[1],m=i[0],s&&(k=_o(i[0],i[1]),f=k[0],m=k[1]),g=this.gpgpu.maybeCreateBufferFromTexture(o,m,f),[4,this.gpgpu.createAndWaitForFence()];case 1:return R.sent(),g instanceof WebGLTexture?v=this.getValuesFromTexture(_):(y=U(u),s?(x=on(u),E=1,T=1,u.length&&(t=nn(u),E=t[0],T=t[1]),v=this.gpgpu.downloadPackedMatrixFromBuffer(g,x,E,T,i[0],i[1]).subarray(0,y)):v=this.gpgpu.downloadFloat32MatrixFromBuffer(g,i[0],i[1]).subarray(0,y)),b=this.convertAndCacheOnCPU(_,v),w=this.pendingRead.get(_),this.pendingRead.delete(_),w.forEach(function(t){return t(b)}),this.pendingDisposal.has(_)&&(this.pendingDisposal.delete(_),this.disposeData(_)),[2,b];}})})},t.prototype.getValuesFromTexture=function(g){var y=this,n=this.texData.get(g),r=n.shape,x=n.dtype,b=n.texture,i=n.texShape,s=U(r),u;if(hi.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(g).isPacked){var t=on(r),c=1,l=1;return r.length&&(c=(u=nn(r))[0],l=u[1]),this.gpgpu.downloadMatrixFromPackedTexture(b,t,c,l,i[0],i[1]).subarray(0,s)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(b,i[0],i[1]).subarray(0,s)}var p=this.makeTensorHandle(r,"float32");p.size=U(r),this.texData.get(p.dataId).usage=Cp.DOWNLOAD;var d=gi(function(){var n=new mp(r);return y.compileAndRun(n,[{shape:r,dtype:x,dataId:g}],p,null,!1)}),h=this.texData.get(d.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture,h.texShape[0],h.texShape[1]).subarray(0,s);return this.disposeData(p.dataId),f},t.prototype.time=function(p){return x(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return R(this,function(s){switch(s.label){case 0:return e=this.activeTimers,t=[],n=!1,null==this.programTimersStack?(this.programTimersStack=t,n=!0):this.activeTimers.push(t),this.activeTimers=t,p(),r=F(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),o=F(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,n&&(this.programTimersStack=null),[4,Promise.all(r)];case 1:return a=s.sent(),i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:T(a),getExtraProfileInfo:function(){return a.map(function(a,n){return{name:o[n],ms:a}}).map(function(t){return t.name+": "+t.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,i];}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return 0<hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},t.prototype.endTimer=function(t){return 0<hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},t.prototype.getQueryTime=function(a){return x(this,void 0,void 0,function(){var e;return R(this,function(){return 0<hi.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?[2,this.gpgpu.waitForQueryAndGetTime(a)]:[2,(e=a).endMs-e.startMs]})})},t.prototype.disposeData=function(p){if(!this.pendingDisposal.has(p))if(this.pendingRead.has(p))this.pendingDisposal.add(p);else if(this.texData.has(p)){var e=this.texData.get(p),t=e.texture,n=e.dtype,r=e.texShape,o=e.usage,a=e.complexTensors,i=e.isPacked,s=e.slice;if(null!=t){var d=s&&s.origDataId||p,u=this.dataRefCount.get(d);1<u?this.dataRefCount.set(d,u-1):(this.dataRefCount.delete(d),this.releaseTexture(p,t,r,o,n,i),this.texData.delete(p))}null!=a&&(a.real.dispose(),a.imag.dispose())}},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getCPUBackend=function(){return hi.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=hi.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(a,o){var t=this;return void 0===o&&(o=128),null!=this.getCPUBackend()&&a.every(function(a){return null==t.texData.get(a.dataId).texture&&a.size<o})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.getCanvas=function(){return this.canvas},t.prototype.complex=function(a,e){var t=this.makeOutputArray(a.shape,"complex64");return this.texData.get(t.dataId).complexTensors={real:hi.engine.keep(a.clone()),imag:hi.engine.keep(e.clone())},t},t.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},t.prototype.slice=function(s,e,t){if(this.shouldExecuteOnCPU([s]))return this.cpuBackend.slice(s,e,t);var n=this.texData.get(s.dataId).isPacked,r=Vt(s.shape,e,t);if(n||!r){var p=hi.get("WEBGL_PACK_ARRAY_OPERATIONS")?new ed(t):new Zp(t),a=p.getCustomSetupFunc(e);return this.compileAndRun(p,[s],null,a)}return this.uploadToGPU(s.dataId),this.shallowSlice(s,e,t)},t.prototype.shallowSlice=function(p,e,t){var n=this.texData.get(p.dataId),r=$s.make(t,{},p.dtype,this),o=this.texData.get(r.dataId);Object.assign(o,n),o.shape=t,o.dtype=p.dtype;var a=Ht(e,p.strides);n.slice&&(a+=n.slice.flatOffset),o.slice={flatOffset:a,origDataId:n.slice&&n.slice.origDataId||p.dataId};var d=this.dataRefCount.get(o.slice.origDataId)||1;return this.dataRefCount.set(o.slice.origDataId,d+1),r},t.prototype.stridedSlice=function(m,e,t,n,r,o,a,i,s){if(this.shouldExecuteOnCPU([m]))return this.cpuBackend.stridedSlice(m,e,t,n,r,o,a,i,s);var u=Ut(m.shape,e,t,n,r,o,a,i,s),c=u[0],l=u[1],p=u[2],d=l.filter(function(a,e){return-1===p.indexOf(e)});if(d.some(function(t){return 0===t}))return $t([],d);var h=new td(c,n,l,p);return this.compileAndRun(h,[m])},t.prototype.reverse=function(a,e){var t=hi.get("WEBGL_PACK_ARRAY_OPERATIONS")?new jp(a.shape,e):new Kp(a.shape,e);return this.compileAndRun(t,[a])},t.prototype.concat=function(p,d){if(this.shouldExecuteOnCPU(p))return this.cpuBackend.concat(p,d);if(1===p.length)return p[0];if(p.length>hi.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=$(p.length/2),t=this.concat(p.slice(0,e),d),n=this.concat(p.slice(e),d);return this.concat([t,n],d)}if(hi.get("WEBGL_PACK_ARRAY_OPERATIONS")&&1<p[0].rank){var o=new Ji(p.map(function(t){return t.shape}),d);return this.compileAndRun(o,p)}var a=Tt(p.map(function(t){return t.shape}),d),r=p.map(function(t){return t.as2D(-1,U(t.shape.slice(d)))}),s=new Zi(r.map(function(t){return t.shape}));return this.compileAndRun(s,r).reshape(a)},t.prototype.neg=function(a){var e=new md(a.shape,"return -x;");return this.compileAndRun(e,[a])},t.prototype.batchMatMul=function(m,e,t,n){var r=t?m.shape[2]:m.shape[1],o=n?e.shape[1]:e.shape[2],a=t?m.shape[1]:m.shape[2],i=m.shape[0];if((1===r||1===o)&&a>cl){t&&(m=m.transpose([0,2,1])),n&&(e=e.transpose([0,2,1]));var s=1===o?m:m.as3D(i,a,1),u=1===o?2:1,c=1===o?e.as3D(i,1,a):e;return this.multiply(s,c).sum(u,!0)}var l=Te(m.dtype,e.dtype),p=new Op(m.shape,[i,r,o],t,n),d=this.makePackedTensor(p.outputShape,l);return this.compileAndRun(p,[m,e],d)},t.prototype.fusedBatchMatMul=function(h,e,t,n,r,m){var a=t?h.shape[2]:h.shape[1],i=n?e.shape[1]:e.shape[2],s=h.shape[0],u=Te(h.dtype,e.dtype),c=new Op(h.shape,[s,a,i],t,n,!!r,m?Zn(m,!0):null),l=this.makePackedTensor(c.outputShape,u),p=[h,e];return r&&p.push(r),this.compileAndRun(c,p,l)},t.prototype.multiply=function(d,e){if("complex64"===d.dtype){var t=this.texData.get(d.dataId),n=this.texData.get(e.dataId),r=new Ui(Wi.REAL,d.shape,e.shape),o=new Ui(Wi.IMAG,d.shape,e.shape),a=[this.makeComplexComponentTensorHandle(d,t.complexTensors.real),this.makeComplexComponentTensorHandle(d,t.complexTensors.imag),this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s);return i.dispose(),s.dispose(),u}if(this.shouldExecuteOnCPU([d,e]))return this.cpuBackend.multiply(d,e);if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,e,Hi,d.dtype);var c=new $i(Hi,d.shape,e.shape),l=this.makeOutputArray(c.outputShape,d.dtype);return this.compileAndRun(c,[d,e],l)},t.prototype.batchNormalization=function(p,e,t,n,r,o){var a=[p,e,t],i=null;null!=o&&(i=o.shape,a.push(o));var s=null;if(null!=r&&(s=r.shape,a.push(r)),hi.get("WEBGL_PACK_BATCHNORMALIZATION")){var d=new Mi(p.shape,e.shape,t.shape,i,s,n);return this.compileAndRun(d,a)}var u=new Li(p.shape,e.shape,t.shape,i,s,n);return this.compileAndRun(u,a)},t.prototype.localResponseNormalization4D=function(s,e,t,n,r){var o=new Tp(s.shape,e,t,n,r);return this.compileAndRun(o,[s])},t.prototype.LRNGrad=function(p,e,t,n,r,o,a){var i=new Dp(e.shape,n,r,o,a);return this.compileAndRun(i,[e,t,p])},t.prototype.tile=function(a,e){var t=new od(a.shape,e);return this.compileAndRun(t,[a])},t.prototype.pad=function(a,e,t){var o=hi.get("WEBGL_PACK_ARRAY_OPERATIONS")?new Mp(a.shape,e,t):new Lp(a.shape,e,t);return this.compileAndRun(o,[a])},t.prototype.transpose=function(a,e){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.transpose(a,e);var t=hi.get("WEBGL_PACK_ARRAY_OPERATIONS")?new rd(a.shape,e):new nd(a.shape,e);return this.compileAndRun(t,[a])},t.prototype.gather=function(a,e,t){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.gather(a,e,t);var o=new bp(a.shape,e.size,t);return this.compileAndRun(o,[a,e])},t.prototype.batchToSpaceND=function(p,e,t){A(4>=p.rank,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var n=e.reduce(function(a,e){return a*e}),r=ft(p.shape,e,n),o=yt(r.length,e.length),a=xt(p.shape,e,n),i=bt(t,e.length),s=vt(a,t,e.length);return p.reshape(r).transpose(o).reshape(a).slice(i,s)},t.prototype.spaceToBatchND=function(p,e,t){A(4>=p.rank,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var n=e.reduce(function(a,e){return a*e}),r=[[0,0]];r.push.apply(r,t);for(var o=1+e.length;o<p.shape.length;++o)r.push([0,0]);var a=p.pad(r),i=ft(a.shape,e,n,!1),s=yt(i.length,e.length,!1),d=xt(a.shape,e,n,!1);return a.reshape(i).transpose(s).reshape(d)},t.prototype.reduce=function(p,e,t){var n=p.shape[0],d=p.shape[1],h=At(d),m=new Up({windowSize:h,inSize:d,batchSize:n},e),i=m.outputShape,s=i[0],u=i[1],c=this.makeOutputArray([s,u],t);return this.compileAndRun(m,[p],c),1===c.shape[1]?c:this.reduce(c,e,t)},t.prototype.argReduce=function(d,e,t){void 0===t&&(t=null);var n=d.shape[0],h=d.shape[1];null!=t&&(n=t.shape[0],h=t.shape[1]);var m=At(h),g=new Ti({windowSize:m,inSize:h,batchSize:n},e,null==t),i=g.outputShape,s=i[0],u=i[1],c=this.makeOutputArray([s,u],"int32"),l=[d];return null!=t&&l.push(t),this.compileAndRun(g,l,c),1===c.shape[1]?c:this.argReduce(d,e,c)},t.prototype.argReducePacked=function(p,e,t){void 0===t&&(t=null);var n=null==t?p.shape:t.shape,r=At(n[n.length-1]),o=new Fi(n,r,e,null==t),a=this.makePackedTensor(o.outputShape,"int32"),i=null==t?[p]:[p,t];return this.compileAndRun(o,i,a),a.rank===p.rank?this.argReducePacked(p,e,a):a},t.prototype.sum=function(s,e){_t("sum",e,s.rank);var t=St(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r),a=De(s.dtype);return this.reduce(o,"sum",a).reshape(n)},t.prototype.prod=function(s,e){if(this.shouldExecuteOnCPU([s]))return this.cpuBackend.prod(s,e);var t=St(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r),a=De(s.dtype);return this.reduce(o,"prod",a).reshape(n)},t.prototype.unsortedSegmentSum=function(p,e,t){var n=0,r=kt([n],p.rank),o=p;null!=r&&(o=p.transpose(r),n=It(1,p.rank)[0]);var a=Lt(o.shape,n,t),i=U([o.shape[n]]),s=o.as2D(-1,i),d=De(p.dtype),u=this.segOpCompute(s,"unsortedSegmentSum",e,d,t).reshape(a);return null!=r&&(u=u.transpose(wt(r))),u},t.prototype.segOpCompute=function(h,e,t,n,r){var m=h.shape[0],g=h.shape[1],f=Bt(g,r),y=new Yp({windowSize:f,inSize:g,batchSize:m,numSegments:r},e),u=y.outputShape,c=u[0],l=u[1],p=this.makeOutputArray([c,l],n);return this.compileAndRun(y,[h,t],p),p.shape[1]===r?p:(t=na(0,r).tile([g/f]),this.segOpCompute(p,e,t,n,r))},t.prototype.argMinMaxReduce=function(p,e,t){var n=[e];if(_t("arg"+t.charAt(0).toUpperCase()+t.slice(1),n,p.rank),!hi.get("WEBGL_PACK_REDUCE")||2>=p.rank){var r=St(p.shape,n),o=r[0],a=U(r[1]),i=p.as2D(-1,a);return this.argReduce(i,t).reshape(o)}return this.argReducePacked(p,t)},t.prototype.argMin=function(a,e){return this.argMinMaxReduce(a,e,"min")},t.prototype.argMax=function(a,e){return this.argMinMaxReduce(a,e,"max")},t.prototype.cumsum=function(a,e,t,n){if(e!==a.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(a.rank-1)+" but got axis="+e);var r=new cp(a.shape,t,n);return this.compileAndRun(r,[a])},t.prototype.equal=function(a,e){if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(equal(a, b));\n","bool");var t=new $i("return float(a == b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.notEqual=function(a,e){if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(notEqual(a, b));\n","bool");var t=new $i("return float(a != b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.less=function(a,e){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.less(a,e);if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(lessThan(a, b));\n","bool");var t=new $i("return float(a < b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.lessEqual=function(a,e){if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var t=new $i("return float(a <= b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.greater=function(a,e){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.greater(a,e);if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(greaterThan(a, b));\n","bool");var t=new $i("return float(a > b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.greaterEqual=function(a,e){if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var t=new $i("return float(a >= b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.logicalNot=function(a){var e=new md(a.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[a])},t.prototype.logicalAnd=function(a,e){if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var t=new $i("return float(a >= 1.0 && b >= 1.0);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.logicalOr=function(a,e){if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var t=new $i("return float(a >= 1.0 || b >= 1.0);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.select=function(a,e,t){var n=new Qp(a.rank,e.shape,e.rank),r=this.makeOutputArray(n.outputShape,Te(e.dtype,t.dtype));return this.compileAndRun(n,[a,e,t],r)},t.prototype.where=function(a){gt("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=a.dataSync();return Yn(a.shape,e)},t.prototype.topk=function(a,e,t){return xa(a.dataSync(),a.shape,a.dtype,e,t)},t.prototype.min=function(s,e){_t("min",e,s.rank);var t=St(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r);return this.reduce(o,"min",o.dtype).reshape(n)},t.prototype.minimum=function(a,e){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.minimum(a,e);var t=hi.get("WEBGL_PACK_BINARY_OPERATIONS")?new ji("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Ki+"\n  return result;\n",a.shape,e.shape):new $i(zi+"\n  return min(a, b);\n",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.mod=function(a,e){var t=hi.get("WEBGL_PACK_BINARY_OPERATIONS")?new ji("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+Ki+"\n  return result;\n",a.shape,e.shape):new $i("if (b == 0.0) return NAN;\n  return mod(a, b);",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.max=function(s,e){if(this.shouldExecuteOnCPU([s]))return this.cpuBackend.max(s,e);_t("max",e,s.rank);var t=St(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r);return this.reduce(o,"max",o.dtype).reshape(n)},t.prototype.maximum=function(a,e){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.maximum(a,e);var t=hi.get("WEBGL_PACK_BINARY_OPERATIONS")?new ji("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Ki+"\n  return result;\n",a.shape,e.shape):new $i(zi+"\n  return max(a, b);\n",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.all=function(s,e){_t("all",e,s.rank);var t=St(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r);return this.reduce(o,"all",o.dtype).reshape(n)},t.prototype.any=function(s,e){_t("any",e,s.rank);var t=St(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r);return this.reduce(o,"any",o.dtype).reshape(n)},t.prototype.squaredDifference=function(a,e){var t=hi.get("WEBGL_PACK_BINARY_OPERATIONS")?new ji(qi,a.shape,e.shape):new $i(qi,a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.realDivide=function(a,e){var t=new $i("if (a == b) return 1.0;\n  return a / b;",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"float32");return this.compileAndRun(t,[a,e],o)},t.prototype.floorDiv=function(a,e){if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  vec4 resultSign = sign(a) * sign(b);\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  ivec4 result = ia / ib;\n  ivec4 amodb = ia - ib * result;\n\n  // Vectorize INT_DIV\n  // if (resultSign < 0.0 && amodb != 0) result -= 1;\n  // return float(result);\n  return vec4(result -\n     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));\n","int32");var t=new $i("\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",a.shape,e.shape),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[a,e],n)},t.prototype.add=function(a,e){if("complex64"===a.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(a,e,Gi);if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.add(a,e);var t=Te(a.dtype,e.dtype);if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,Gi,t);var n=new $i(Gi,a.shape,e.shape),r=this.makeOutputArray(n.outputShape,t);return this.compileAndRun(n,[a,e],r)},t.prototype.packedBinaryOp=function(s,e,t,n){var r=new ji(t,s.shape,e.shape),o=this.makePackedTensor(r.outputShape,n);return this.compileAndRun(r,[s,e],o)},t.prototype.complexSeparableBinaryOp=function(p,e,t){var n=this,r=this.texData.get(p.dataId),o=this.texData.get(e.dataId),a=[[r.complexTensors.real,o.complexTensors.real],[r.complexTensors.imag,o.complexTensors.imag]].map(function(r){var o=r[0],a=r[1],i=n.makeComplexComponentTensorHandle(p,o),s=n.makeComplexComponentTensorHandle(e,a),d=new $i(t,p.shape,e.shape),u=n.makeOutputArray(d.outputShape,Te(o.dtype,a.dtype));return n.compileAndRun(d,[i,s],u)}),i=a[0],s=a[1],d=this.complex(i,s);return i.dispose(),s.dispose(),d},t.prototype.makeComplexComponentTensorHandle=function(a,e){return{dataId:e.dataId,dtype:e.dtype,shape:a.shape}},t.prototype.addN=function(a){for(var e=a[0],t=1;t<a.length;t++)e=this.add(e,a[t]);return e},t.prototype.subtract=function(a,e){if("complex64"===a.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(a,e,Vi);if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.subtract(a,e);var t=Te(a.dtype,e.dtype);if(hi.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,Vi,a.dtype);var n=new $i(Vi,a.shape,e.shape),r=this.makeOutputArray(n.outputShape,t);return this.compileAndRun(n,[a,e],r)},t.prototype.pow=function(s,e){var t=hi.get("WEBGL_PACK_BINARY_OPERATIONS"),n=t?new ji("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+Ki+"\n  return result;\n",s.shape,e.shape):new $i("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",s.shape,e.shape),r=Te(s.dtype,e.dtype),o=t?this.makePackedTensor(n.outputShape,r):this.makeOutputArray(n.outputShape,r);return this.compileAndRun(n,[s,e],o)},t.prototype.ceil=function(a){var e=new md(a.shape,"return ceil(x);");return this.compileAndRun(e,[a])},t.prototype.floor=function(a){var e=new md(a.shape,"return floor(x);");return this.compileAndRun(e,[a])},t.prototype.sign=function(a){var e=new md(a.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[a])},t.prototype.isNaN=function(a){var e=new md(a.shape,"return float(isnan(x));"),t=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[a],t)},t.prototype.isInf=function(a){var e=new md(a.shape,"return float(isinf(x));"),t=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[a],t)},t.prototype.isFinite=function(a){var e=new md(a.shape,"return float(!isnan(x) && !isinf(x));"),t=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[a],t)},t.prototype.round=function(a){var e=new md(a.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[a])},t.prototype.exp=function(a){var e;return e=hi.get("WEBGL_PACK")?new Rd(a.shape,xd):new md(a.shape,xd),this.compileAndRun(e,[a])},t.prototype.expm1=function(a){var e=new md(a.shape,"return exp(x) - 1.0;");return this.compileAndRun(e,[a])},t.prototype.log=function(a){var e;return e=hi.get("WEBGL_PACK")?new Rd(a.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new md(a.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(e,[a])},t.prototype.log1p=function(a){var e=new md(a.shape,"return log(1.0 + x);");return this.compileAndRun(e,[a])},t.prototype.sqrt=function(a){var e=new md(a.shape,"return sqrt(x);");return this.compileAndRun(e,[a])},t.prototype.rsqrt=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.rsqrt(a);var e=new md(a.shape,"return inversesqrt(x);");return this.compileAndRun(e,[a])},t.prototype.square=function(a){var e=new md(a.shape,"return x * x;");return this.compileAndRun(e,[a])},t.prototype.reciprocal=function(a){var e=new md(a.shape,"return 1.0 / x;");return this.compileAndRun(e,[a])},t.prototype.relu=function(a){var e;return e=hi.get("WEBGL_PACK")?new Rd(a.shape,Cd):new md(a.shape,yd),this.compileAndRun(e,[a])},t.prototype.prelu=function(a,e){var t=hi.get("WEBGL_PACK_BINARY_OPERATIONS")?new ji("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",a.shape,e.shape):new $i("return (a < 0.) ? b * a : a;",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.elu=function(a){var e=new md(a.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(e,[a])},t.prototype.eluDer=function(a,e){var t=hi.get("WEBGL_PACK_BINARY_OPERATIONS")?new ji("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",a.shape,e.shape):new $i("return (b >= 1.0) ? a : a * (b + 1.0);",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.selu=function(a){var e=new md(a.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+cd+";\n  float scale = "+hd+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[a])},t.prototype.int=function(a){var e=new md(a.shape,"return float(int(x));"),t=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[a],t)},t.prototype.clip=function(a,e,t){var n=(o=hi.get("WEBGL_PACK_CLIP")?new Yi(a.shape):new Xi(a.shape)).getCustomSetupFunc(e,t),o;return this.compileAndRun(o,[a],null,n)},t.prototype.abs=function(a){var e=new md(a.shape,"return abs(x);");return this.compileAndRun(e,[a])},t.prototype.complexAbs=function(a){var e=this.texData.get(a.dataId),t=new Qi(a.shape),o=[this.makeComplexComponentTensorHandle(a,e.complexTensors.real),this.makeComplexComponentTensorHandle(a,e.complexTensors.imag)];return this.compileAndRun(t,o)},t.prototype.sigmoid=function(a){var e=new md(a.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[a])},t.prototype.softplus=function(a){var e=new md(a.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[a])},t.prototype.sin=function(a){var e=new md(a.shape,gd+"\n  return sin(x);\n");return this.compileAndRun(e,[a])},t.prototype.cos=function(a){var e=new md(a.shape,gd+"\n  return cos(x);\n");return this.compileAndRun(e,[a])},t.prototype.tan=function(a){var e=new md(a.shape,"return tan(x);");return this.compileAndRun(e,[a])},t.prototype.asin=function(a){var e=new md(a.shape,"return asin(x);");return this.compileAndRun(e,[a])},t.prototype.acos=function(a){var e=new md(a.shape,"return acos(x);");return this.compileAndRun(e,[a])},t.prototype.atan=function(a){var e=new md(a.shape,gd+"\n  return atan(x);\n");return this.compileAndRun(e,[a])},t.prototype.atan2=function(a,e){var t=hi.get("WEBGL_PACK_BINARY_OPERATIONS")?new ji("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Ki+"\n  return result;\n",a.shape,e.shape):new $i(zi+"\n  return atan(a, b);\n",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.sinh=function(a){var e=new md(a.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[a])},t.prototype.cosh=function(a){var e=new md(a.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[a])},t.prototype.tanh=function(a){var e=new md(a.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[a])},t.prototype.asinh=function(a){var e=new md(a.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[a])},t.prototype.acosh=function(a){var e=new md(a.shape,gd+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[a])},t.prototype.atanh=function(a){var e=new md(a.shape,gd+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[a])},t.prototype.erf=function(a){var e=new md(a.shape,"\n  // Error function is calculated approximately with elementary function.\n  // See \"Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables\", Abramowitz and Stegun.\n  float p = "+sd+";\n  float a1 = "+id+";\n  float a2 = "+pd+";\n  float a3 = "+dd+";\n  float a4 = "+ld+";\n  float a5 = "+ud+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n");return this.compileAndRun(e,[a])},t.prototype.step=function(a,e){var t=new md(a.shape,$n(e));return this.compileAndRun(t,[a])},t.prototype.conv2dByMatMul=function(u,e,t){var n=u.shape,r=this.texData.get(u.dataId),o=t.inChannels,a=n[0]*n[1]*n[2],i=t.outChannels,s=0!=n[2]%2&&!!r.isPacked;if((1==a||1===i)&&o>cl||!hi.get("WEBGL_LAZILY_UNPACK")||!hi.get("WEBGL_PACK_BINARY_OPERATIONS")||!s){var y=this.reshape(u,[1,n[0]*n[1]*n[2],t.inChannels]),l=this.reshape(e,[1,t.inChannels,t.outChannels]);return this.reshape(this.batchMatMul(y,l,!1,!1),t.outShape)}var p=$s.make([1,n[0]*n[1]*(n[2]+1),t.inChannels],{dataId:u.dataId},u.dtype,this),d=r.shape;r.shape=r.shape.slice(),r.shape[r.shape.length-2]++,A(pn(r.shape,p.shape),function(){return"packed reshape "+r.shape+" to "+p.shape+" isn't free"});var h=this.reshape(e,[1,t.inChannels,t.outChannels]),f=this.batchMatMul(p,h,!1,!1),m=this.texData.get(f.dataId);return A(m.isPacked,function(){return"batchMatMul result is expected to be packed"}),r.shape=d,m.shape=t.outShape,$s.make(t.outShape,{dataId:f.dataId},f.dtype,this)},t.prototype.conv2dWithIm2Row=function(g,e,t){var n=t.filterWidth,r=t.filterHeight,o=t.inChannels,a=t.outWidth,i=t.outHeight,s=n*r*o,u=i*a,c=[s,u],l=g.squeeze([0]),p=e.reshape([1,s,-1]),d=new Np(c,l.shape,t),h=this.compileAndRun(d,[l]).reshape([1,c[0],c[1]]),f=new Op(h.shape,[1,u,t.outChannels],!0,!1);return this.compileAndRun(f,[h,p]).reshape([1,i,a,t.outChannels])},t.prototype.conv2d=function(a,e,t){if(1===t.filterHeight&&1===t.filterWidth&&1===t.dilationHeight&&1===t.dilationWidth&&1===t.strideHeight&&1===t.strideWidth&&("SAME"===t.padInfo.type||"VALID"===t.padInfo.type))return this.conv2dByMatMul(a,e,t);if(hi.get("WEBGL_CONV_IM2COL")&&1===a.shape[0])return this.conv2dWithIm2Row(a,e,t);var o=new ip(t);return this.compileAndRun(o,[a,e])},t.prototype.conv2dDerInput=function(a,e,t){var o=new tp(t);return this.compileAndRun(o,[a,e])},t.prototype.conv2dDerFilter=function(a,e,t){var o=new ep(t);return this.compileAndRun(o,[a,e])},t.prototype.depthwiseConv2D=function(a,e,t){var o;return hi.get("WEBGL_PACK_DEPTHWISECONV")&&2>=t.strideWidth&&1==t.outChannels/t.inChannels?(o=new lp(t),this.compileAndRun(o,[a,e],this.makePackedTensor(t.outShape,a.dtype))):(o=new dp(t),this.compileAndRun(o,[a,e]))},t.prototype.depthwiseConv2DDerInput=function(a,e,t){var o=new sp(t);return this.compileAndRun(o,[a,e])},t.prototype.depthwiseConv2DDerFilter=function(a,e,t){var o=new rp(t);return this.compileAndRun(o,[a,e])},t.prototype.conv3d=function(a,e,t){var o=new pp(t);return this.compileAndRun(o,[a,e])},t.prototype.conv3dDerInput=function(a,e,t){var o=new np(t);return this.compileAndRun(o,[a,e])},t.prototype.conv3dDerFilter=function(a,e,t){var o=new ap(t);return this.compileAndRun(o,[a,e])},t.prototype.maxPool=function(a,e){var t=new Wp(e,"max",!1),o=this.makeOutputArray(t.outputShape,a.dtype);return this.compileAndRun(t,[a],o)},t.prototype.avgPool=function(a,e){var t=new Wp(e,"avg",!1),o=this.makeOutputArray(t.outputShape,"float32");return this.compileAndRun(t,[a],o)},t.prototype.maxPoolBackprop=function(p,e,t,n){var r=new Wp(n,"max",!0),o=this.compileAndRun(r,[e]),a=new Ap(n),i=this.makeOutputArray(a.outputShape,e.dtype),s=this.compileAndRun(a,[p,o],i);return o.dispose(),s},t.prototype.avgPoolBackprop=function(a,e,t){var n=new Bi(t),r=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[a],r)},t.prototype.cast=function(a,e){return ra(a,e,this)},t.prototype.unstack=function(p,e){for(var t=p.shape[e],n=Array(p.rank-1),r=0,o=0;o<p.rank;o++)o!==e&&(n[r++]=p.shape[o]);var a=Array(p.rank).fill(0),i=p.shape.slice();i[e]=1;var s=Array(t);for(o=0;o<s.length;o++)a[e]=o,s[o]=this.slice(p,a,i).reshape(n);return s},t.prototype.reshape=function(a,e){var t=this.texData.get(a.dataId);return!t.isPacked||pn(a.shape,e)||null!==t.texture&&pn(t.shape,e)?sa(a,e):this.packedReshape(a,e)},t.prototype.resizeBilinear=function(a,e,t,n){var r=hi.get("WEBGL_PACK_IMAGE_OPERATIONS")?new Hp(a.shape,e,t,n):new Vp(a.shape,e,t,n);return this.compileAndRun(r,[a])},t.prototype.resizeBilinearBackprop=function(a,e,t){var o=new Gp(a,e,t);return this.compileAndRun(o,[a])},t.prototype.resizeNearestNeighbor=function(a,e,t,n){var r=new $p(a.shape,e,t,n);return this.compileAndRun(r,[a])},t.prototype.resizeNearestNeighborBackprop=function(a,e,t){var o=new qp(a,e,t);return this.compileAndRun(o,[a])},t.prototype.multinomial=function(p,e,t,n){var r=e?p:Ci(p),o=r.shape[0],a=r.shape[1],i=new Pp(o,a,t),s=this.makeOutputArray(i.outputShape,"int32"),d=i.getCustomSetupFunc(n);return this.compileAndRun(i,[r],s,d)},t.prototype.oneHot=function(a,e,t,n){var r=new Fp(a.size,e,t,n);return this.compileAndRun(r,[a])},t.prototype.nonMaxSuppression=function(a,e,t,n,r){return gt("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),ga(a.dataSync(),e.dataSync(),t,n,r)},t.prototype.cropAndResize=function(s,e,t,n,r,o){var a=new up(s.shape,e.shape,n,r,o);return this.compileAndRun(a,[s,e,t])},t.prototype.depthToSpace=function(p,e,t){A(1<e,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var n=p.shape[0],r="NHWC"===t?p.shape[1]:p.shape[2],o="NHWC"===t?p.shape[2]:p.shape[3],a="NHWC"===t?p.shape[3]:p.shape[1],i=r*e,s=o*e,d=a/(e*e),u=new hp("NHWC"===t?[n,i,s,d]:[n,d,i,s],e,t);return this.compileAndRun(u,[p])},t.prototype.split=function(a,e,t){return ya(a,e,t)},t.prototype.scatterND=function(c,e,t){var n=Ft(e,c,t),r=n.sliceRank,o=n.numUpdates,a=n.sliceSize,i=n.strides,s=n.outputSize,u=c.reshape([o,r]),l=e.reshape([o,a]);if(0===s)return sa($t([]),t);var p=Kt(0),d=new Xp(o,r,u.rank,l.rank,i,[s/a,a]);return this.compileAndRun(d,[l,u,p]).reshape(t)},t.prototype.sparseToDense=function(p,e,t,n){var r=Ft(e,p,t),o=r.sliceRank,a=r.numUpdates,i=r.strides,s=r.outputSize,d=new Xp(a,o,p.rank,e.rank,i,[s,1],!1);return this.compileAndRun(d,[e,p,n]).reshape(t)},t.prototype.fft=function(t){return this.fftImpl(t,!1)},t.prototype.ifft=function(t){return this.fftImpl(t,!0)},t.prototype.fftImpl=function(p,e){var t=this.texData.get(p.dataId),n=new fp(gp.REAL,p.shape,e),r=new fp(gp.IMAG,p.shape,e),o=[this.makeComplexComponentTensorHandle(p,t.complexTensors.real),this.makeComplexComponentTensorHandle(p,t.complexTensors.imag)],a=this.compileAndRun(n,o),i=this.compileAndRun(r,o),s=this.complex(a,i).as2D(p.shape[0],p.shape[1]);return a.dispose(),i.dispose(),s},t.prototype.gatherND=function(d,e){var t=e.shape,n=t[t.length-1],r=Dt(d,e),o=r[0],a=r[1],i=r[2],s=r[3],u=e.reshape([a,n]),c=d.reshape([d.size/i,i]),l=new vp(n,s,[a,i]);return this.compileAndRun(l,[c,u]).reshape(o)},t.prototype.fill=function(s,e,t){if("string"===(t=t||se(e))){var n=Y(t,U(s));return n.fill(e),$s.make(s,{values:n},t)}var p=new yp(s,e),o=p.getCustomSetupFunc(e),a=this.makeOutputArray(s,t);return this.compileAndRun(p,[],a,o)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},t.prototype.makeOutputArray=function(a,e){return $s.make(a,{},e,this)},t.prototype.makePackedTensor=function(a,e){var t=$s.make(a,{},e,this);return this.texData.get(t.dataId).isPacked=!0,t},t.prototype.unpackTensor=function(a){var e=new Sd(a.shape);return this.compileAndRun(e,[a],$s.make(e.outputShape,{},a.dtype,this))},t.prototype.packTensor=function(a){var e=new Bp(a.shape);return this.compileAndRun(e,[a],this.makePackedTensor(a.shape,a.dtype))},t.prototype.packedReshape=function(a,e){var t=a.reshape([on(a.shape)].concat(nn(a.shape))),n=[on(e)].concat(nn(e)),r=new zp(n,t.shape);return this.compileAndRun(r,[t]).reshape(e)},t.prototype.compileAndRun=function(y,e,t,n,r){var x=this;if(void 0===r&&(r=!0),null==t&&(t=y.usesPackedTextures?this.makePackedTensor(y.outputShape,e[0].dtype):this.makeOutputArray(y.outputShape,e[0].dtype)),0===t.size)return this.texData.get(t.dataId).values=X(t.dtype,0),t;var a=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var t=x.texData.get(e.dataId);if(null==t.texture){if(!y.usesPackedTextures&&U(e.shape)<=hi.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:x.readSync(e.dataId)};y.usesPackedTextures&&(t.isPacked=!0,t.shape=e.shape)}else if(!!t.isPacked!=!!y.usesPackedTextures)e=t.isPacked?x.unpackTensor(e):x.packTensor(e),t=x.texData.get(e.dataId);else if(t.isPacked&&!pn(t.shape,e.shape)){var a=e,r=e.shape;e.shape=t.shape,e=x.packedReshape(e,r),t=x.texData.get(e.dataId),a.shape=r}return x.uploadToGPU(e.dataId),{shape:e.shape,texData:t,isUniform:!1}});this.uploadToGPU(t.dataId);var o={shape:t.shape,texData:this.texData.get(t.dataId),isUniform:!1},i=Pn(y,a,o),u=this.getAndSaveBinary(i,function(){return Dn(x.gpgpu,y,a,o)}),l=null!=this.activeTimers,p;l&&(p=this.startTimer()),On(this.gpgpu,u,a,o,n);var s=1024*hi.get("WEBGL_NUM_MB_BEFORE_PAGING");if(r&&this.numBytesInGPU>s)for(var d=this.numBytesInGPU-s;0<d&&0<this.lruDataGPU.length;){var c=this.lruDataGPU.shift(),h=this.texData.get(c),m=h.texShape,g=h.dtype;d-=this.computeBytes(m,g),this.read(c)}return l&&(p=this.endTimer(p),this.activeTimers.push({name:y.constructor.name,query:this.getQueryTime(p)})),hi.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(t.dataId).isPacked||y.isPackShader?t:this.unpackTensor(t)},t.prototype.getAndSaveBinary=function(a,e){return a in this.binaryCache||(this.binaryCache[a]=e()),this.binaryCache[a]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var a=this;return gi(function(){var e=hi.get("DEBUG");hi.set("DEBUG",!1);var t=a.abs(Kt(1e-8)).dataSync()[0];return hi.set("DEBUG",e),0<t?32:16})},t.prototype.uploadToGPU=function(g){var e=this.texData.get(g),n=e.shape,r=e.dtype,o=e.values,a=e.texture,i=e.usage,s=e.isPacked,u;if(null==a){var t=null!=this.activeTimers,l;t&&(l=performance.now());var c=rn(n,s);e.texShape=c;var p=this.acquireTexture(g,c,i,r,s);if(e.texture=p,null!=o){if(s){var d=on(n),h=1,f=1;n.length&&(h=(u=nn(n))[0],f=u[1]),this.gpgpu.uploadMatrixToPackedTexture(p,d,h,f,c[0],c[1],er(o))}else this.gpgpu.uploadMatrixToTexture(p,c[0],c[1],er(o));e.values=null,t&&(this.uploadWaitMs+=performance.now()-l)}}else hi.get("WEBGL_NUM_MB_BEFORE_PAGING")<W&&0<=this.lruDataGPU.indexOf(g)&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(g),1),this.lruDataGPU.push(g))},t.prototype.convertAndCacheOnCPU=function(p,e){var t=this.texData.get(p),n=t.texture,r=t.texShape,o=t.dtype,a=t.usage,i=t.isPacked;return null!=n&&(this.releaseTexture(p,n,r,a,o,i),t.texture=null,t.texShape=null,t.isPacked=!1),t.usage=Cp.UPLOAD,null!=e&&(t.values=Jn(e,o)),t.values},t.prototype.releaseTexture=function(s,e,t,n,r,o){if(hi.get("WEBGL_NUM_MB_BEFORE_PAGING")<W){var a=this.lruDataGPU.indexOf(s);0<=a&&this.lruDataGPU.splice(a,1)}this.numBytesInGPU-=this.computeBytes(t,r),this.textureManager.releaseTexture(e,t,n,o)},t.prototype.acquireTexture=function(a,e,t,n,r){return hi.get("WEBGL_NUM_MB_BEFORE_PAGING")<W&&this.lruDataGPU.push(a),this.numBytesInGPU+=this.computeBytes(e,n),this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(a,e){return a[0]*a[1]*te(e)},t}();hi.get("IS_BROWSER")&&hi.registerBackend("webgl",function(){return new hl},2);var ml=qt({abs_:function(a){var o=st(a,"x","abs");return"complex64"===o.dtype?hi.engine.runKernel(function(t){return t.complexAbs(o)},{$x:o}):hi.engine.runKernel(function(t,e){var a=t.abs(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.toFloat().step(-1))}}})}}),gl=qt({acos_:function(a){var o=st(a,"x","acos");return hi.engine.runKernel(function(t,e){var a=t.acos(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.divStrict(Kt(1).sub(t.toFloat().square()).sqrt()).neg()}}})}}),fl=qt({acosh_:function(a){var o=st(a,"x","acosh");return hi.engine.runKernel(function(t,e){var a=t.acosh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.divStrict(t.toFloat().square().sub(1).sqrt())}}})}}),yl=qt({asin_:function(a){var o=st(a,"x","asin");return hi.engine.runKernel(function(t,e){var a=t.asin(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.divStrict(Kt(1).sub(t.toFloat().square()).sqrt())}}})}}),xl=qt({asinh_:function(a){var o=st(a,"x","asinh");return hi.engine.runKernel(function(t,e){var a=t.asinh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.divStrict(Kt(1).add(t.toFloat().square()).sqrt())}}})}}),bl=qt({atan_:function(a){var o=st(a,"x","atan");return hi.engine.runKernel(function(t,e){var a=t.atan(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.toFloat().square().add(1))}}})}}),vl=qt({atanh_:function(a){var o=st(a,"x","atanh");return hi.engine.runKernel(function(t,e){var a=t.atanh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(Kt(1).sub(t.toFloat().square()))}}})}}),Cl=qt({ceil_:function(a){var o=st(a,"x","ceil");return hi.engine.runKernel(function(t){return t.ceil(o)},{$x:o},function(t){return{$x:function(){return wi(t)}}})}}),Rl=qt({clipByValue_:function(a,s,t){var n=st(a,"x","clipByValue");return A(s<=t,function(){return"Error in clip: min ("+s+") must be less than or equal to max ("+t+")."}),hi.engine.runKernel(function(r,e){var o=r.clip(n,s,t);return e([n]),o},{$x:n},function(a,e){var n=e[0];return{$x:function(){return a.where(n.greaterEqual(s).logicalAnd(n.lessEqual(t)),wi(a))}}})}}),Sl=qt({cos_:function(a){var o=st(a,"x","cos");return hi.engine.runKernel(function(t,e){var a=t.cos(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return t.toFloat().sin().neg().mul(a)}}})}}),El=qt({cosh_:function(a){var o=st(a,"x","cosh");return hi.engine.runKernel(function(t,e){var a=t.cosh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return t.toFloat().sinh().mulStrict(a)}}})}}),_l=qt({erf_:function(a){var o=st(a,"x","erf");return A("int32"===o.dtype||"float32"===o.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===o.dtype&&(o=o.toFloat()),hi.engine.runKernel(function(t,e){var a=t.erf(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.square().neg().exp().mul(2/C(Math.PI)))}}})}}),kl=qt({exp_:function(a){var o=st(a,"x","exp");return hi.engine.runKernel(function(t,e){var a=t.exp(o);return e([a]),a},{$x:o},function(a,e){return{$x:function(){return a.mulStrict(e[0])}}})}}),wl=qt({expm1_:function(a){var o=st(a,"x","expm1");return hi.engine.runKernel(function(t,e){var a=t.expm1(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.exp())}}})}}),Il=qt({floor_:function(a){var o=st(a,"x","floor");return hi.engine.runKernel(function(t){return t.floor(o)},{$x:o},function(t){return{$x:function(){return wi(t)}}})}}),Nl=qt({log_:function(a){var o=st(a,"x","log");return hi.engine.runKernel(function(t,e){var a=t.log(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.toFloat())}}})}}),Tl=qt({log1p_:function(a){var o=st(a,"x","log1p");return hi.engine.runKernel(function(t,e){var a=t.log1p(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.add(1))}}})}}),Dl=qt({logSigmoid_:function(a){var o=st(a,"x","logSigmoid");return hi.engine.runKernel(function(t,e){var a=t.softplus(o.neg()).neg();return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.neg().sigmoid())}}})}}),Al=qt({neg_:function(a){var o=st(a,"x","neg");return hi.engine.runKernel(function(t){return t.neg(o)},{$x:o},function(t){return{$x:function(){return t.neg()}}})}}),Ol=qt({reciprocal_:function(a){var o=st(a,"x","reciprocal");return hi.engine.runKernel(function(t,e){var a=t.reciprocal(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.square().neg())}}})}}),Pl=qt({round_:function(a){var o=st(a,"x","round");return hi.engine.runKernel(function(t){return t.round(o)},{$x:o},function(t){return{$x:function(){return wi(t)}}})}}),Fl=qt({rsqrt_:function(a){var o=st(a,"x","rsqrt");return hi.engine.runKernel(function(t,e){var a=t.rsqrt(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.pow(1.5).mul(2)).neg()}}})}}),Bl=qt({sigmoid_:function(a){var o=st(a,"x","sigmoid");return hi.engine.runKernel(function(t,e){var a=t.sigmoid(o);return e([a]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.mul(Kt(1).sub(t)))}}})}}),Ll=qt({sign_:function(a){var o=st(a,"x","sign");return hi.engine.runKernel(function(t){return t.sign(o)},{$x:o},function(t){return{$x:function(){return wi(t)}}})}}),Ml=qt({isNaN_:function(a){var o=st(a,"x","isNaN");return hi.engine.runKernel(function(t){return t.isNaN(o)},{$x:o},function(t){return{$x:function(){return wi(t)}}})}}),Wl=qt({isInf_:function(a){var o=st(a,"x","isInf");return hi.engine.runKernel(function(t){return t.isInf(o)},{$x:o},function(t){return{$x:function(){return wi(t)}}})}}),Ul=qt({isFinite_:function(a){var o=st(a,"x","isFinite");return hi.engine.runKernel(function(t){return t.isFinite(o)},{$x:o},function(t){return{$x:function(){return wi(t)}}})}}),zl=qt({sin_:function(a){var o=st(a,"x","sin");return hi.engine.runKernel(function(t,e){var a=t.sin(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return t.toFloat().cos().mul(a)}}})}}),Gl=qt({sinh_:function(a){var o=st(a,"x","sinh");return hi.engine.runKernel(function(t,e){var a=t.sinh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return t.toFloat().cosh().mulStrict(a)}}})}}),Vl=qt({softplus_:function(a){var o=st(a,"x","softplus");return hi.engine.runKernel(function(t,e){var a=t.softplus(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.sigmoid())}}})}}),Hl=qt({sqrt_:function(a){var o=st(a,"x","sqrt");return hi.engine.runKernel(function(t,e){var a=t.sqrt(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.toFloat().sqrt().mul(2))}}})}}),ql=qt({square_:function(a){var o=st(a,"x","square");return hi.engine.runKernel(function(t,e){return e([o]),t.square(o)},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.toFloat().mul(2))}}})}}),$l=qt({step_:function(a,o){void 0===o&&(o=0);var t=st(a,"x","step");return hi.engine.runKernel(function(a){return a.step(t,o)},{$x:t},function(t){return{$x:function(){return wi(t)}}})}}),Kl=qt({tan_:function(a){var o=st(a,"x","tan");return hi.engine.runKernel(function(t,e){var a=t.tan(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.cos().square())}}})}}),jl=qt({tanh_:function(a){var o=st(a,"x","tanh");return hi.engine.runKernel(function(t,e){var a=t.tanh(o);return e([a]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return Kt(1).sub(t.square()).mulStrict(a)}}})}}),Xl=qt({batchNormalization2d_:function(s,e,t,n,r,o){return void 0===n&&(n=.001),sr(),tr(s,e,t,o,r,n)}}),Yl=qt({batchNormalization3d_:function(s,e,t,n,r,o){return void 0===n&&(n=.001),sr(),ar(s,e,t,o,r,n)}}),Ql=qt({batchNormalization4d_:function(s,e,t,n,r,o){return void 0===n&&(n=.001),sr(),or(s,e,t,o,r,n)}}),Zl=qt({batchNormalization_:function(s,e,t,n,r,o){return void 0===n&&(n=.001),sr(),nr(s,e,t,o,r,n)}}),Jl=qt({batchNorm_:nr}),eu=qt({batchNorm2d_:tr}),tu=qt({batchNorm3d_:ar}),au=qt({batchNorm4d_:or}),ou=qt({conv1d_:function(m,e,t,n,r,o,a){void 0===r&&(r="NWC"),void 0===o&&(o=1);var i=st(m,"x","conv1d"),s=st(e,"filter","conv1d"),u=i,c=!1;2===i.rank&&(c=!0,u=i.as3D(1,i.shape[0],i.shape[1])),A(3===u.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."}),A(3===s.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+s.rank+"."}),null!=a&&A(M(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),A(u.shape[2]===s.shape[1],function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+s.shape[1]+"."}),A(br(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),A("NWC"===r,function(){return"Error in conv1d: got dataFormat of "+r+" but only NWC is currently supported."});var l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),p=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),d=nu(p,l,[1,t],n,"NHWC",[1,o],a);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),nu=qt({conv2d_:function(h,e,t,n,r,m,a){void 0===r&&(r="NHWC"),void 0===m&&(m=[1,1]);var o=st(h,"x","conv2d"),s=st(e,"filter","conv2d"),i=o,g=!1;3===o.rank&&(g=!0,i=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(4===i.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+i.rank+"."}),A(4===s.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+s.rank+"."}),null!=a&&A(M(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),A(i.shape[3]===s.shape[2],function(){return"Error in conv2d: depth of input ("+i.shape[3]+") must match input depth for filter "+s.shape[2]+"."}),A(br(t,m),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+m+"'"}),A("NHWC"===r,function(){return"Error in conv2d: got dataFormat of "+r+" but only NHWC is currently supported."});var l=pr(i.shape,s.shape,t,m,n,a),p=hi.engine.runKernel(function(a,e){var t=a.conv2d(i,s,l);return e([s,i]),t},{x:i,$filter:s},function(a,e){var r=e,o=r[0],i=r[1];return A(xr(m),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+m+"'"}),{x:function(){return vr(i.shape,a,o,t,n)},$filter:function(){return Cr(i,a,o.shape,t,n)}}});return g?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),ru=qt({conv3d_:function(d,e,t,n,r,h){void 0===r&&(r="NHWC"),void 0===h&&(h=[1,1,1]);var a=st(d,"x","conv3d"),o=st(e,"filter","conv3d"),i=a,m=!1;4===a.rank&&(m=!0,i=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),A(5===i.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+i.rank+"."}),A(5===o.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+o.rank+"."}),A(i.shape[4]===o.shape[3],function(){return"Error in conv3d: depth of input ("+i.shape[4]+") must match input depth for filter "+o.shape[3]+"."}),A(Er(t,h),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+h+"'"}),A("NHWC"===r,function(){return"Error in conv3d: got dataFormat of "+r+" but only NHWC is currently supported."});var c=dr(i.shape,o.shape,t,h,n),l=hi.engine.runKernel(function(a,e){var t=a.conv3d(i,o,c);return e([i,o]),t},{x:i,$filter:o},function(a,e){A(Sr(h),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+h+"'"});var r=e[0],o=e[1];return{x:function(){return wr(r.shape,a,o,t,n)},$filter:function(){return Ir(r,a,o.shape,t,n)}}});return m?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}}),su=qt({conv2dDerFilter_:Cr}),iu=qt({depthwiseConv2d_:function(h,e,t,n,r,o,a){void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]);var i=st(h,"x","depthwiseConv2d"),s=st(e,"filter","depthwiseConv2d"),m=i,g=!1;3===i.rank&&(g=!0,m=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),A(4===m.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),A(4===s.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+s.rank+"."}),A(m.shape[3]===s.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+s.shape[2]+"."}),null==o&&(o=[1,1]),A(br(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),null!=a&&A(M(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var l=pr(m.shape,s.shape,t,o,n,a,!0),p=hi.engine.runKernel(function(a,e){var t=a.depthwiseConv2D(m,s,l);return e([m,s]),t},{x:m,$filter:s},function(a,e){A(xr(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var t=e[0],n=e[1];return{x:function(){return _r(t.shape,a,n,l)},$filter:function(){return kr(t,a,n.shape,l)}}});return g?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),pu=qt({separableConv2d_:function(g,e,t,n,r,o,a){void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC");var i=st(g,"x","separableConv2d"),s=st(e,"depthwiseFilter","separableConv2d"),u=st(t,"pointwiseFilter","separableConv2d"),c=i,l=!1;if(3===i.rank&&(l=!0,c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),A(4===s.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+s.rank+"."}),A(4===u.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+s.rank+"."}),A(1===u.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."}),A(1===u.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."});var p=s.shape[2],d=s.shape[3];A(u.shape[2]===p*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*d+", but got "+u.shape[2]+"."});var h=iu(c,s,n,r,a,o),f=nu(h,u,1,"valid",a);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),du=qt({conv2dTranspose_:function(s,e,t,n,r,o){return vr(t,st(s,"x","conv2dTranspose"),st(e,"filter","conv2dTranspose"),n,r,o)}}),lu=qt({matMul_:function(y,e,x,b){var t;void 0===x&&(x=!1),void 0===b&&(b=!1);var o=st(y,"a","matMul"),a=st(e,"b","matMul");t=Ae(o,a),o=t[0],a=t[1];var i=x?o.shape[o.rank-2]:o.shape[o.rank-1],s=b?a.shape[a.rank-1]:a.shape[a.rank-2],u=x?o.shape[o.rank-1]:o.shape[o.rank-2],c=b?a.shape[a.rank-2]:a.shape[a.rank-1],l=o.shape.slice(0,-2),p=a.shape.slice(0,-2),d=U(l),h=U(p);A(2<=o.rank&&2<=a.rank&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),A(L(l,p),function(){return"Error in matMul: outer dimensions ("+l+") and ("+p+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),A(i===s,function(){return"Error in matMul: inner shapes ("+i+") and ("+s+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+x+" and transposeB="+b+" must match."});var f=o.shape.slice(0,-2).concat([u,c]),m=x?o.as3D(d,i,u):o.as3D(d,u,i),C=b?a.as3D(h,c,s):a.as3D(h,s,c);return hi.engine.runKernel(function(a,e){var t=a.batchMatMul(m,C,x,b);return e([m,C]),t},{$a:m,$b:C},function(s,e){var t=e,o=t[0],a=t[1];return x||b?!x&&b?{$a:function(){return s.matMul(a,!1,!1)},$b:function(){return s.matMul(o,!0,!1)}}:x&&!b?{$a:function(){return a.matMul(s,!1,!0)},$b:function(){return o.matMul(s,!1,!1)}}:{$a:function(){return a.matMul(s,!0,!0)},$b:function(){return s.matMul(o,!0,!0)}}:{$a:function(){return s.matMul(a,!1,!0)},$b:function(){return o.matMul(s,!0,!1)}}}).reshape(f)}}),uu=qt({dot_:function(s,e){var t=st(s,"t1","dot"),n=st(e,"t2","dot");A((1===t.rank||2===t.rank)&&(1===n.rank||2===n.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."});var r=1===t.rank?t.size:t.shape[1],o=1===n.rank?n.size:n.shape[0];return A(r===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+r+" and "+o+"."}),1===t.rank&&1===n.rank?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():1===t.rank&&2===n.rank?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():2===t.rank&&1===n.rank?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),cu=qt({outerProduct_:function(a,e){var t=st(a,"v1","outerProduct"),o=st(e,"v2","outerProduct");return A(1===t.rank&&1===o.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+o.rank+"."}),t.as2D(-1,1).matMul(o.as2D(1,-1))}}),hu=qt({reverse_:function(a,e){var t=st(a,"x","reverse");if(0===t.rank)return t.clone();var o=K(e,t.shape);return hi.engine.runKernel(function(a){return a.reverse(t,o)},{$x:t},function(t){return{$x:function(){return t.reverse(o)}}}).reshapeAs(t)}}),mu=qt({reverse1d_:function(a){var e=st(a,"x","reverse");return A(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),hu(e,0)}}),gu=qt({reverse2d_:function(a,e){var t=st(a,"x","reverse");return A(2===t.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),hu(t,e)}}),fu=qt({reverse3d_:function(a,e){var t=st(a,"x","reverse");return A(3===t.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),hu(t,e)}}),yu=qt({reverse4d_:function(a,e){var t=st(a,"x","reverse");return A(4===t.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),hu(t,e)}}),xu=qt({maxPool_:function(a,e,t,n,r){return Nr(a,e,t,1,n,r)}}),bu=qt({avgPool_:function(a,e,t,n,r){return Tr(a,e,t,1,n,r)}}),vu=qt({pool_:function(b,e,t,n,r,o){null==r&&(r=[1,1]),null==o&&(o=1),0===n&&(n="valid");var a=st(b,"x","maxPool"),i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(br(o,r),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+r+"'"});var u=ir(i.shape,e,o,r,n),l=[u.dilationHeight,u.dilationWidth],p;p="same"===n?Pr([u.filterHeight,u.filterWidth],l):[[0,0],[0,0]];var c=1===l[0]&&1===l[1],d=Or([u.inHeight,u.inWidth],l,p),h=d[0],f=d[1],m=c?n:"valid",g=c?i:nl(i,l,h),v=("avg"===t?function(){return Tr(g,e,o,1,m)}:function(){return Nr(g,e,o,1,m)})(),y=c?v:Ud(v,l,f);return s?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),Cu=qt({slice_:function(s,e,p){var d=st(s,"x","slice"),l,r;if(0===d.rank)throw new Error("Slicing scalar is not possible");l="number"==typeof e?[e].concat(Array(d.rank-1).fill(0)):e.length<d.rank?e.concat(Array(d.rank-e.length).fill(0)):e.slice(),r=(r=null==p?Array(d.rank).fill(-1):"number"==typeof p?[p].concat(Array(d.rank-1).fill(-1)):p.length<d.rank?p.concat(Array(d.rank-p.length).fill(-1)):p).map(function(a,e){return 0<=a?a:(A(-1==a,function(){return"Bad value in size"}),d.shape[e]-l[e])}),Wt(d,l,r);var o=d.shape;return hi.engine.runKernel(function(t){return t.slice(d,l,r)},{$x:d},function(a){for(var e=[],t=0;t<a.rank;t++)e.push([l[t],o[t]-l[t]-r[t]]);return{$x:function(){return a.pad(e)}}})}}),Ru=qt({slice1d_:function(a,e,t){var o=st(a,"x","slice1d");return A(1===o.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+o.rank+" tensor"}),Cu(o,[e],[t])}}),Su=qt({slice2d_:function(a,e,t){var o=st(a,"x","slice2d");return A(2===o.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+o.rank+" tensor"}),Cu(o,e,t)}}),Eu=qt({slice3d_:function(a,e,t){var o=st(a,"x","slice3d");return A(3===o.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+o.rank+" tensor"}),Cu(o,e,t)}}),_u=qt({slice4d_:function(a,e,t){var o=st(a,"x","slice4d");return A(4===o.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+o.rank+" tensor"}),Cu(o,e,t)}}),ku=qt({all_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=st(p,"x","all","bool"),d=K(e,n.shape),o=d,a=kt(o,n.rank);null!=a&&(n=n.transpose(a),o=It(o.length,n.rank));var i=hi.engine.runKernel(function(t){return t.all(n,o)},{$x:n});if(t){var s=Et(i.shape,d);return i.reshape(s)}return i}}),wu=qt({any_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=st(p,"x","any","bool"),d=K(e,n.shape),o=d,a=kt(o,n.rank);null!=a&&(n=n.transpose(a),o=It(o.length,n.rank));var i=hi.engine.runKernel(function(t){return t.any(n,o)},{$x:n});if(t){var s=Et(i.shape,d);return i.reshape(s)}return i}}),Iu=qt({argMax_:function(a,e){void 0===e&&(e=0);var s=st(a,"x","argMax");null==e&&(e=0);var i=K(e,s.shape),t=kt(i,s.rank);return null!=t&&(s=s.transpose(t),i=It(i.length,s.rank)),hi.engine.runKernel(function(a,e){var t=a.argMax(s,i[0]);return e([s]),t},{$x:s},function(a,e){var t=e[0];return{$x:function(){return wi(t)}}})}}),Nu=qt({argMin_:function(a,e){void 0===e&&(e=0);var s=st(a,"x","argMin");null==e&&(e=0);var i=K(e,s.shape),t=kt(i,s.rank);return null!=t&&(s=s.transpose(t),i=It(i.length,s.rank)),hi.engine.runKernel(function(a,e){var t=a.argMin(s,i[0]);return e([s]),t},{$x:s},function(a,e){var t=e[0];return{$x:function(){return wi(t)}}})}}),Tu=qt({logSumExp_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=st(p,"x","logSumExp"),r=K(e,n.shape),o=n.max(r,!0),a=n.sub(o).exp().sum(r).log(),i=o.reshape(a.shape).add(a);if(t){var s=Et(i.shape,r);return i.reshape(s)}return i}}),Du=qt({max_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var d=st(p,"x","max"),l=d,o=K(e,d.shape),a=o,n=kt(a,d.rank);null!=n&&(d=d.transpose(n),a=It(a.length,d.rank));var s=hi.engine.runKernel(function(o,e){var t=o.max(d,a);return e([l,t]),t},{$x:d},function(a,e){return Fr(a,e[1],e[0],o,n)});if(t){var i=Et(s.shape,o);s=s.reshape(i)}return s}}),Au=qt({mean_:function(s,i,t){void 0===i&&(i=null),void 0===t&&(t=!1);var e=st(s,"x","mean"),r=K(i,e.shape),o=U(St(e.shape,r)[1]);return ht(function(a){var e=Kt(o);return{value:(e.dtype===a.dtype?a:a.cast(e.dtype)).div(e).sum(i,t),gradFunc:function(e){var t=a.shape.slice();return r.forEach(function(a){t[a]=1}),e.reshape(t).mul(ea(a.shape,"float32")).div(o)}}})(e)}}),Ou=qt({min_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var d=st(p,"x","min"),l=d,o=K(e,d.shape),a=o,n=kt(a,d.rank);null!=n&&(d=d.transpose(n),a=It(a.length,d.rank));var s=hi.engine.runKernel(function(o,e){var t=o.min(d,a);return e([l,t]),t},{$x:d},function(a,e){return Fr(a,e[1],e[0],o,n)});if(t){var i=Et(s.shape,o);s=s.reshape(i)}return s}}),Pu=qt({moments_:function(s,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=K(e,(s=st(s,"x","moments")).shape),r=s.mean(n,t),i=r.shape;return t||(i=Et(r.shape,n)),{mean:r,variance:s.toFloat().sub(r.reshape(i)).square().mean(n,t)}}}),Fu=qt({sum_:function(a,e,p){void 0===e&&(e=null),void 0===p&&(p=!1);var t=st(a,"x","sum");"bool"===t.dtype&&(t=t.toInt());var d=K(e,t.shape);return ht(function(o){var e=kt(d,o.rank),t=d,n=o;null!=e&&(n=o.transpose(e),t=It(t.length,o.rank));var r=hi.engine.runKernel(function(a){return a.sum(n,t)},{permutedX:n});if(p){var l=Et(r.shape,d);r=r.reshape(l)}return{value:r,gradFunc:function(e){var t=o.shape.slice();return d.forEach(function(a){t[a]=1}),e.reshape(t).mul(ea(o.shape,"float32"))}}})(t)}}),Bu=qt({prod_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=st(p,"x","prod");"bool"===n.dtype&&(n=n.toInt());var r=K(e,n.shape),o=kt(r,n.rank),a=r,i=n;null!=o&&(i=n.transpose(o),a=It(a.length,n.rank));var d=hi.engine.runKernel(function(t){return t.prod(i,a)},{permutedX:i});if(t){var l=Et(d.shape,r);d=d.reshape(l)}return d}}),Lu=qt({equal_:function(a,e){var t=st(a,"a","equal"),s=st(e,"b","equal"),i;return i=Ae(t,s),t=i[0],s=i[1],Ea(t.shape,s.shape),hi.engine.runKernel(function(a){return a.equal(t,s)},{$a:t,$b:s})}}),Mu=qt({equalStrict_:function(a,e){var t=st(a,"a","equalStrict"),o=st(e,"b","equalStrict");return O(t.shape,o.shape,"Error in equalStrict: "),t.equal(o)}}),Wu=qt({greater_:function(a,e){var t=st(a,"a","greater"),s=st(e,"b","greater"),i;return i=Ae(t,s),t=i[0],s=i[1],Ea(t.shape,s.shape),hi.engine.runKernel(function(a){return a.greater(t,s)},{$a:t,$b:s})}}),Uu=qt({greaterEqual_:function(a,e){var s=st(a,"a","greaterEqual"),i=st(e,"b","greaterEqual"),t;return t=Ae(s,i),s=t[0],i=t[1],Ea(s.shape,i.shape),hi.engine.runKernel(function(a,e){var t=a.greaterEqual(s,i);return e([s,i]),t},{$a:s,$b:i},function(a,e){var t=e[0],o=e[1];return{$a:function(){return wi(t)},$b:function(){return wi(o)}}})}}),zu=qt({greaterEqualStrict_:function(a,e){var t=st(a,"a","greaterEqualStrict"),o=st(e,"b","greaterEqualStrict");return O(t.shape,o.shape,"Error in greaterEqualStrict: "),t.greaterEqual(o)}}),Gu=qt({greaterStrict_:function(a,e){var t=st(a,"a","greaterStrict"),o=st(e,"b","greaterStrict");return O(t.shape,o.shape,"Error in greaterStrict: "),t.greater(o)}}),Vu=qt({less_:function(a,e){var t=st(a,"a","less"),s=st(e,"b","less"),i;return i=Ae(t,s),t=i[0],s=i[1],Ea(t.shape,s.shape),hi.engine.runKernel(function(a){return a.less(t,s)},{$a:t,$b:s})}}),Hu=qt({lessEqual_:function(a,e){var t=st(a,"a","lessEqual"),s=st(e,"b","lessEqual"),i;return i=Ae(t,s),t=i[0],s=i[1],Ea(t.shape,s.shape),hi.engine.runKernel(function(a){return a.lessEqual(t,s)},{$a:t,$b:s})}}),qu=qt({lessEqualStrict_:function(a,e){var t=st(a,"a","lessEqualStrict"),o=st(e,"b","lessEqualStrict");return O(t.shape,o.shape,"Error in lessEqualStrict: "),t.lessEqual(o)}}),$u=qt({lessStrict_:function(a,e){var t=st(a,"a","lessStrict"),o=st(e,"b","lessStrict");return O(t.shape,o.shape,"Error in lessStrict: "),t.less(o)}}),Ku=qt({notEqual_:function(a,e){var t=st(a,"a","notEqual"),s=st(e,"b","notEqual"),i;return i=Ae(t,s),t=i[0],s=i[1],Ea(t.shape,s.shape),hi.engine.runKernel(function(a){return a.notEqual(t,s)},{$a:t,$b:s})}}),ju=qt({notEqualStrict_:function(a,e){var t=st(a,"a","notEqualStrict"),o=st(e,"b","notEqualStrict");return O(t.shape,o.shape,"Error in notEqualStrict: "),t.notEqual(o)}}),Xu=qt({add_:function(s,e){var i=st(s,"a","add"),p=st(e,"b","add"),t;t=Ae(i,p),i=t[0],p=t[1];var d=Ea(i.shape,p.shape);return hi.engine.runKernel(function(t){return t.add(i,p)},{$a:i,$b:p},function(a){return{$a:function(){var e=a,t=Sa(i.shape,d);return 0<t.length&&(e=e.sum(t)),e.reshape(i.shape)},$b:function(){var e=a,t=Sa(p.shape,d);return 0<t.length&&(e=e.sum(t)),e.reshape(p.shape)}}})}}),Yu=qt({addN_:function(a){A(Array.isArray(a),function(){return"The argument passed to tf.addN() must be a list of tensors"}),A(1<=a.length,function(){return"Must pass at least one tensor to tf.addN(), but got "+a.length});var o=a.map(function(a,e){return st(a,"tensors"+e,"addN")}),t=o[0];o.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),o.forEach(function(a){if(!L(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});return hi.engine.runKernel(function(t){return t.addN(o)},o,function(t){var e={};return o.forEach(function(a,o){e[o]=function(){return t.clone()}}),e})}}),Qu=qt({addStrict_:function(a,e){var t=st(a,"a","addStrict"),o=st(e,"b","addStrict");return O(t.shape,o.shape,"Error in addStrict: "),t.add(o)}}),Zu=qt({atan2_:function(s,e){var i=st(s,"a","atan2"),p=st(e,"b","atan2"),t;t=Ae(i,p),i=t[0],p=t[1];var d=Ea(i.shape,p.shape);return hi.engine.runKernel(function(a,e){var t=a.atan2(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=Xu(s.square(),n.square()),t=a.mul(n.div(e)),o=Sa(s.shape,d);return 0<o.length&&(t=t.sum(o)),t.reshape(s.shape)},$b:function(){var e=Xu(s.square(),n.square()),t=Al(a.mul(s.div(e))),o=Sa(n.shape,d);return 0<o.length&&(t=t.sum(o)),t.reshape(n.shape)}}})}}),Ju=qt({div_:function(s,e){var i=st(s,"a","div"),p=st(e,"b","div"),t;if(t=Ae(i,p),i=t[0],p=t[1],"int32"===i.dtype&&"int32"===p.dtype)return tc(i,p);var d=Ea(i.shape,p.shape);return hi.engine.runKernel(function(a,e){var t=a.realDivide(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=a.div(n.toFloat()),t=Sa(s.shape,d);return 0<t.length?e.sum(t).reshape(s.shape):e},$b:function(){var e=a.mul(s.toFloat()),t=Sa(n.shape,d);0<t.length&&(e=e.sum(t).reshape(n.shape));var o=n.square();return e.div(o.toFloat()).neg()}}})}}),ec=qt({divStrict_:function(a,e){var t=st(a,"a","div"),o=st(e,"b","div");return O(t.shape,o.shape,"Error in divideStrict: "),t.div(o)}}),tc=qt({floorDiv_:function(s,e){var i=st(s,"a","floorDiv"),p=st(e,"b","floorDiv"),t;t=Ae(i,p),i=t[0],p=t[1];var d=Ea(i.shape,p.shape);return hi.engine.runKernel(function(a,e){var t=a.floorDiv(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=a.div(n.toFloat()),t=Sa(s.shape,d);return 0<t.length?e.sum(t).reshape(s.shape):e},$b:function(){var e=a.mul(s.toFloat()),t=Sa(n.shape,d);0<t.length&&(e=e.sum(t).reshape(n.shape));var o=n.square();return e.div(o.toFloat()).neg()}}})}}),ac=qt({maximum_:function(a,e){var s=st(a,"a","maximum"),i=st(e,"b","maximum"),t;return t=Ae(s,i),s=t[0],i=t[1],"bool"===s.dtype&&(s=s.toInt(),i=i.toInt()),Ea(s.shape,i.shape),hi.engine.runKernel(function(a,e){var t=a.maximum(s,i);return e([s,i]),t},{$a:s,$b:i},function(a,e){var t=e[0],o=e[1];return{$a:function(){return a.mul(t.greaterEqual(o).toFloat())},$b:function(){return a.mul(t.less(o).toFloat())}}})}}),oc=qt({maximumStrict_:function(a,e){var t=st(a,"a","maximumStrict"),o=st(e,"b","maximumStrict");return O(t.shape,o.shape,"Error in maximumStrict: "),t.maximum(o)}}),nc=qt({minimum_:function(a,e){var s=st(a,"a","minimum"),i=st(e,"b","minimum"),t;return t=Ae(s,i),s=t[0],i=t[1],"bool"===s.dtype&&(s=s.toInt(),i=i.toInt()),Ea(s.shape,i.shape),hi.engine.runKernel(function(a,e){var t=a.minimum(s,i);return e([s,i]),t},{$a:s,$b:i},function(a,e){var t=e[0],o=e[1];return{$a:function(){return a.mul(t.lessEqual(o).toFloat())},$b:function(){return a.mul(t.greater(o).toFloat())}}})}}),rc=qt({minimumStrict_:function(a,e){var t=st(a,"a","minimumStrict"),o=st(e,"b","minimumStrict");return O(t.shape,o.shape,"Error in minimumStrict: "),t.minimum(o)}}),sc=qt({mod_:function(s,e){var i=st(s,"a","mod"),p=st(e,"b","mod"),t;t=Ae(i,p),i=t[0],p=t[1];var d=Ea(i.shape,p.shape);return hi.engine.runKernel(function(a,e){var t=a.mod(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=Sa(s.shape,d);return 0<e.length?a.sum(e).reshape(s.shape):a},$b:function(){var e=a.mul(s.div(n).floor().neg()),t=Sa(n.shape,d);return 0<t.length?e.sum(t).reshape(n.shape):e}}})}}),ic=qt({modStrict_:function(a,e){var t=st(a,"a","modStrict"),o=st(e,"b","modStrict");return O(t.shape,o.shape,"Error in modStrict: "),t.mod(o)}}),pc=qt({mul_:function(s,e){var i=st(s,"a","mul"),p=st(e,"b","mul"),t;t=Ae(i,p),i=t[0],p=t[1];var d=Ea(i.shape,p.shape);return hi.engine.runKernel(function(a,e){var t=a.multiply(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=a.mul(n.toFloat()),t=Sa(s.shape,d);return 0<t.length?e.sum(t).reshape(s.shape):e},$b:function(){var e=a.mul(s.toFloat()),t=Sa(n.shape,d);return 0<t.length?e.sum(t).reshape(n.shape):e}}})}}),dc=qt({mulStrict_:function(a,e){var t=st(a,"a","mul"),o=st(e,"b","mul");return O(t.shape,o.shape,"Error in multiplyStrict: "),t.mul(o)}}),lc=qt({pow_:function(a,e){var s=st(a,"base","pow"),i=st(e,"exp","pow"),p=Ea(s.shape,i.shape);return a=s.cast(Te(s.dtype,i.dtype)),e=i.cast(Te(s.dtype,i.dtype)),hi.engine.runKernel(function(a,e){var t=a.pow(s,i);return e([s,i,t]),t},{$base:s,$exp:i},function(o,e){var d=e[0],n=e[1],r=e[2];return{$base:function(){var e=n.toFloat(),t=o.mul(e.mul(d.pow(e.sub(Kt(1))))),a=Sa(d.shape,p);return 0<a.length&&(t=t.sum(a)),t.reshape(d.shape)},$exp:function(){var e=d.greater(0),t=d.log().where(e,wi(d)),a=o.mul(r.mul(t)),s=Sa(n.shape,p);return 0<s.length&&(a=a.sum(s)),a.reshape(n.shape)}}})}}),uc=qt({powStrict_:function(a,e){return O(a.shape,e.shape,"Error in powStrict: "),a.pow(e)}}),cc=qt({squaredDifference_:function(a,e){var s=st(a,"a","squaredDifference"),i=st(e,"b","squaredDifference"),t;return t=Ae(s,i),s=t[0],i=t[1],Ea(s.shape,i.shape),hi.engine.runKernel(function(a,e){var t=a.squaredDifference(s,i);return e([s,i]),t},{$a:s,$b:i},function(a,e){var t=e[0],n=e[1],r=Kt(2);return{$a:function(){return a.mul(t.sub(n).mul(r))},$b:function(){return a.mul(n.sub(t).mul(r))}}})}}),hc=qt({squaredDifferenceStrict_:function(a,e){var t=st(a,"a","squaredDifferenceStrict"),o=st(e,"b","squaredDifferenceStrict");return O(t.shape,o.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(o)}}),mc=qt({sub_:function(s,e){var i=st(s,"a","sub"),p=st(e,"b","sub"),t;t=Ae(i,p),i=t[0],p=t[1];var d=Ea(i.shape,p.shape);return hi.engine.runKernel(function(t){return t.subtract(i,p)},{$a:i,$b:p},function(a){return{$a:function(){var e=a,t=Sa(i.shape,d);return 0<t.length&&(e=e.sum(t)),e.reshape(i.shape)},$b:function(){var e=a,t=Sa(p.shape,d);return 0<t.length&&(e=e.sum(t)),e.neg().reshape(p.shape)}}})}}),gc=qt({subStrict_:function(a,e){var t=st(a,"a","subStrict"),o=st(e,"b","subStrict");return O(t.shape,o.shape,"Error in subStrict: "),t.sub(o)}}),fc=qt({logicalAnd_:function(a,e){var t=st(a,"a","logicalAnd","bool"),o=st(e,"b","logicalAnd","bool");return Ea(t.shape,o.shape),hi.engine.runKernel(function(a){return a.logicalAnd(t,o)},{$a:t,$b:o})}}),yc=qt({logicalNot_:function(a){var o=st(a,"x","logicalNot","bool");return hi.engine.runKernel(function(t){return t.logicalNot(o)},{$x:o})}}),xc=qt({logicalOr_:function(a,e){var t=st(a,"a","logicalOr","bool"),o=st(e,"b","logicalOr","bool");return Ea(t.shape,o.shape),hi.engine.runKernel(function(a){return a.logicalOr(t,o)},{$a:t,$b:o})}}),bc=qt({logicalXor_:function(a,e){var t=st(a,"a","logicalXor","bool"),o=st(e,"b","logicalXor","bool");return Ea(t.shape,o.shape),xc(a,e).logicalAnd(fc(a,e).logicalNot())}}),vc=qt({where_:function(s,e,t){var i=st(e,"a","where"),p=st(t,"b","where"),d=st(s,"condition","where","bool");return O(i.shape,p.shape,"Error in where: "),1===d.rank?A(d.shape[0]===i.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):O(d.shape,p.shape,"Error in where: "),hi.engine.runKernel(function(a,e){var t=a.select(d,i,p);return e([d]),t},{$condition:d,$a:i,$b:p},function(a,e){var t=e[0];return{$condition:function(){return wi(t).toFloat()},$a:function(){return a.mul(t.cast(a.dtype))},$b:function(){return a.mul(t.logicalNot().cast(a.dtype))}}})}}),Cc=function(a){return x(this,void 0,void 0,function(){var e,t,n;return R(this,function(r){switch(r.label){case 0:return[4,(e=st(a,"condition","whereAsync","bool")).data()];case 1:return t=r.sent(),n=Yn(e.shape,t),a!==e&&e.dispose(),[2,n];}})})},Rc=qt({elu_:function(a){var o=st(a,"x","elu");return hi.engine.runKernel(function(t,e){var a=t.elu(o);return e([a]),a},{$x:o},function(a,o){var r=o[0];return{$x:function(){return hi.engine.runKernel(function(e){return e.eluDer(a,r)},{dy:a,y:r})}}})}}),Sc=qt({leakyRelu_:function(a,e){void 0===e&&(e=.2);var t=st(a,"x","leakyRelu");return ac(Kt(e).mul(t),t)}}),Ec=qt({prelu_:function(a,e){var s=st(a,"x","prelu"),i=st(e,"alpha","prelu");return hi.engine.runKernel(function(a,e){var t=a.prelu(s,i);return e([s,i]),t},{$x:s,$alpha:i},function(s,e){var i=e[0],n=e[1],r=i.greater(0);return{$x:function(){return vc(r,s,s.mul(n))},$alpha:function(){var e=vc(r,wi(s),s.mul(i)),t=Sa(n.shape,s.shape);return 0<t.length&&(e=e.sum(t)),e.reshape(n.shape)}}})}}),_c=qt({relu_:function(a){var o=st(a,"x","relu");return"bool"===o.dtype?o.toInt():hi.engine.runKernel(function(t,e){var a=t.relu(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mulStrict(t.step().toFloat())}}})}}),kc=qt({selu_:function(a){var o=st(a,"x","selu");return hi.engine.runKernel(function(t,e){var a=t.selu(o);return e([o]),a},{$x:o},function(s,e){var p=e[0];return{$x:function(){var e=p.greater(Kt(0)),t=Kt(cd),n=Kt(hd),o=s.mul(n),a=s.mul(t).mul(p.toFloat().exp());return vc(e,o,a)}}})}}),wc=qt({transpose_:function(a,o){var t=st(a,"x","transpose");return(null==o&&(o=t.shape.map(function(a,e){return e}).reverse()),A(t.rank===o.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+o+"."}),o.forEach(function(a){A(0<=a&&a<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+o})}),1>=t.rank)?t.clone():hi.engine.runKernel(function(a){return a.transpose(t,o)},{$x:t},function(t){var e=wt(o);return{$x:function(){return t.transpose(e)}}})}}),Ic=qt({localResponseNormalization_:function(p,d,t,n,r){void 0===d&&(d=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5);var e=st(p,"x","localResponseNormalization");A(4===e.rank||3===e.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+e.rank+"."}),A(M(d),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+d+"."});var o=e,a=!1;3===e.rank&&(a=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=hi.engine.runKernel(function(i,e){var a=i.localResponseNormalization4D(o,d,t,n,r);return e([o,a]),a},{x4D:o},function(o,e){var p=e[0],i=e[1];return{x4D:function(){return hi.engine.runKernel(function(e){return e.LRNGrad(o,p,i,d,t,n,r)},{})}}});return a?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),Nc=qt({norm_:function(s,e,t,n){void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1);var r=Br(s=st(s,"x","norm"),e,t),o=r.shape;if(n){var a=K(t,s.shape);o=Et(r.shape,a)}return r.reshape(o)}}),Tc=qt({gather_:function(s,e,x){void 0===x&&(x=0);var n=st(s,"x","gather"),i=st(e,"indices","gather","int32");x=K(x,n.shape)[0];var t=Mt(n,i,x);return hi.engine.runKernel(function(o,e){var t=o.gather(n,i.flatten(),x);return e([i]),t},{$x:n},function(r,e){var b=e[0];return{$x:function(){var e=n.shape,t=b.size,a=e.slice(0,x),o=a.length,s=e.slice(x,e.length).slice(1),i=s.length,u=Lr(0,o),l=Lr(o+1,o+1+i),p=Mr([a,[t],s]),d=r.reshape(p),c=b.reshape([t]),h=Mr([[o],u,l]),m=d.transpose(h),g=Dc(m,c,n.shape[x]),f=wt(h);return g=g.transpose(f)}}}).reshape(t.outputShape)}}),Dc=qt({unsortedSegmentSum_:function(a,e,s){var n=st(a,"x","unsortedSegmentSum"),i=st(e,"segmentIds","unsortedSegmentSum","int32");return A(M(s),function(){return"numSegments must be of dtype int"}),hi.engine.runKernel(function(o,e){var t=o.unsortedSegmentSum(n,i,s);return e([i]),t},{$x:n},function(a,e){var t=e[0];return{$x:function(){return Wr(a,t)}}})}}),Ac=qt({basicLSTMCell_:function(b,e,t,n,r,o){var a=st(b,"forgetBias","basicLSTMCell"),i=st(e,"lstmKernel","basicLSTMCell"),s=st(t,"lstmBias","basicLSTMCell"),u=st(n,"data","basicLSTMCell"),c=st(r,"c","basicLSTMCell"),l=st(o,"h","basicLSTMCell"),p=u.concat(l,1).matMul(i).add(s),d=p.shape[0],h=p.shape[1]/4,f=[d,h],m=p.slice([0,0],f),g=p.slice([0,h],f),v=p.slice([0,2*h],f),y=p.slice([0,3*h],f),x=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(a.add(v).sigmoid()));return[x,x.tanh().mulStrict(y.sigmoid())]}}),Oc=qt({multiRNNCell_:function(h,e,t,n){for(var r=st(e,"data","multiRNNCell"),o=it(t,"c","multiRNNCell"),a=it(n,"h","multiRNNCell"),i=r,s=[],u=0,c;u<h.length;u++)c=h[u](i,o[u],a[u]),s.push(c[0]),s.push(c[1]),i=c[1];var l=[],p=[];for(u=0;u<s.length;u+=2)l.push(s[u]),p.push(s[u+1]);return[l,p]}}),Pc=qt({movingAverage_:function(d,e,t,n,r){void 0===r&&(r=!0);var o=st(d,"v","movingAverage"),a=st(e,"x","movingAverage"),i=st(t,"decay","movingAverage");Oe(o,a),A(L(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var s=Kt(1),u=s.sub(i),c=a.sub(o).mul(u);if(r){A(null!=n,function(){return"When using zeroDebias: true, step is required."});var l=st(n,"step","movingAverage");c=c.div(s.sub(lc(i,l)))}return o.add(c)}}),Fc=qt({stridedSlice_:function(m,g,t,n,r,o,a,i,s){if(void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==i)throw new Error("new axis mask is not yet supported");var u=st(m,"x","stridedSlice");if(n.every(function(t){return 1===t})){var e=Ut(u.shape,g,t,n,r,o,a,i,s),l=e[0],p=e[1],d=e[2],h=p.filter(function(a,e){return-1===d.indexOf(e)});return Cu(u,l,p).reshape(h)}return hi.engine.runKernel(function(p){return p.stridedSlice(u,g,t,n,r,o,a,i,s)},{$x:u})}}),Bc=qt({topk_:function(s,i,t){void 0===i&&(i=1),void 0===t&&(t=!0);var n=st(s,"x","topk");if(0===n.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var e=n.shape[n.shape.length-1];if(i>e)throw new Error("'k' passed to topk() must be <= the last dimension ("+e+") but got "+i);var o=hi.engine.runKernel(function(a){return a.topk(n,i,t)},{$x:n});return{values:o[0],indices:o[1]}}}),Lc=qt({scatterND_:function(a,e,t){var n=st(a,"indices","scatterND","int32"),s=st(e,"updates","scatterND");return Pt(s,n,t),hi.engine.runKernel(function(a){return a.scatterND(n,s,t)},{$indices:n,$updates:s})}}),Mc=qt({fft_:function(a){A("complex64"===a.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+a.dtype+"."});var o=a.shape[a.shape.length-1],t=a.size/o,n=a.as2D(t,o);return hi.engine.runKernel(function(t){return t.fft(n)},{input:a}).reshape(a.shape)}}),Wc=qt({ifft_:function(a){A("complex64"===a.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+a.dtype+"."});var o=a.shape[a.shape.length-1],t=a.size/o,n=a.as2D(t,o);return hi.engine.runKernel(function(t){return t.ifft(n)},{input:a}).reshape(a.shape)}}),Uc=qt({rfft_:function(d){A("float32"===d.dtype,function(){return"The dtype for rfft() must be real value but got "+d.dtype});var e=d.shape[d.shape.length-1],t=d.size/e,n=d.zerosLike(),r=Si(d,n).as2D(t,e),o=Mc(r),a=$(e/2)+1,i=Ei(o),s=_i(o),u=i.split([a,e-a],i.shape.length-1),c=s.split([a,e-a],s.shape.length-1),l=d.shape.slice();return l[d.shape.length-1]=a,Si(u[0],c[0]).reshape(l)}}),zc=qt({irfft_:function(d){var e=d.shape[d.shape.length-1],t=d.size/e;if(2>=e){var n=d.as2D(t,e),r=Wc(n);return Ei(r)}var o=[t,2*(e-1)],a=Ei(d).as2D(t,e),i=_i(d).as2D(t,e),s=a.slice([0,1],[t,e-2]).reverse(1),u=i.slice([0,1],[t,e-2]).reverse(1).mul(Kt(-1)),c=a.concat(s,1),l=i.concat(u,1);return n=Si(c,l).as2D(o[0],o[1]),r=Wc(n),Ei(r)}}),Gc=Object.freeze({fft:Mc,ifft:Wc,rfft:Uc,irfft:zc}),Vc=qt({sparseToDense_:function(s,e,t,n){void 0===n&&(n=0);var r=st(s,"sparseIndices","sparseToDense","int32"),p=st(e,"sparseValues","sparseToDense"),d=st(n,"defaultValue","sparseToDense",p.dtype);return Ur(r,p,t,d),hi.engine.runKernel(function(a){return a.sparseToDense(r,p,t,d)},{$sparseIndices:r,$sparseValues:p,$defaultValue:d})}}),Hc=qt({gatherND_:function(a,e){var t=st(e,"indices","gatherND","int32"),o=st(a,"x","gatherND");return hi.engine.runKernel(function(a){return a.gatherND(o,t)},{$x:o,$indices:t})}}),qc;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(qc||(qc={}));var $c=qt({absoluteDifference_:Gr}),Kc=qt({computeWeightedLoss_:zr}),jc=qt({cosineDistance_:Hr}),Xc=qt({hingeLoss_:$r}),Yc=qt({huberLoss_:Yr}),Qc=qt({logLoss_:Kr}),Zc=qt({meanSquaredError_:Vr}),Jc=qt({sigmoidCrossEntropy_:Xr}),eh=qt({softmaxCrossEntropy_:Zr}),th=Object.freeze({get Reduction(){return qc},absoluteDifference:$c,computeWeightedLoss:Kc,cosineDistance:jc,hingeLoss:Xc,huberLoss:Yc,logLoss:Qc,meanSquaredError:Zc,sigmoidCrossEntropy:Jc,softmaxCrossEntropy:eh}),ah=qt({gramSchmidt_:function(p){var e;if(Array.isArray(p)){e=!1,A(null!=p&&0<p.length,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var d=p[0].shape[0],t=function(e){A(p[e].shape[0]===d,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+p[e].shape[0]+" vs. "+d+")"})},n=1;n<p.length;++n)t(n)}else e=!0,p=Nd(p,p.shape[0],0).map(function(t){return rl(t,[0])});A(p.length<=p[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+p.length+") exceeds number of dimensions ("+p[0].shape[0]+")."});var o=[],a=p,r=function(s){o.push(hi.engine.tidy(function(){var e=a[s];if(0<s)for(var t=0,n;t<s;++t)n=Fu(o[t].mulStrict(e)).mul(o[t]),e=e.sub(n);return e.div(Nc(e,"euclidean"))}))};for(n=0;n<p.length;++n)r(n);return e?sl(o,0):o}}),oh=qt({qr_:function(a,s){if(void 0===s&&(s=!1),2>a.rank)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+a.rank);if(2===a.rank)return Jr(a,s);var e=a.shape.slice(0,a.shape.length-2).reduce(function(a,e){return a*e}),t=[],r=[];return dl(a.reshape([e,a.shape[a.shape.length-2],a.shape[a.shape.length-1]]),0).forEach(function(o){var e=Jr(o,s),n=e[0],a=e[1];t.push(n),r.push(a)}),[sl(t,0).reshape(a.shape),sl(r,0).reshape(a.shape)]}}),nh=Object.freeze({gramSchmidt:ah,qr:oh}),rh=qt({resizeBilinear_:function(p,e,d){void 0===d&&(d=!1);var t=st(p,"images","resizeBilinear");A(3===t.rank||4===t.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+t.rank+"."}),A(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var n=t,r=!1;3===t.rank&&(r=!0,n=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=e[0],i=e[1],s=hi.engine.runKernel(function(o,e){return e([n]),o.resizeBilinear(n,a,i,d)},{batchImages:n},function(a,e){return{batchImages:function(){return hi.engine.runKernel(function(t){return t.resizeBilinearBackprop(a,e[0],d)},{})}}});return r?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),sh=qt({resizeNearestNeighbor_:function(p,e,d){void 0===d&&(d=!1);var t=st(p,"images","resizeNearestNeighbor");A(3===t.rank||4===t.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+t.rank+"."}),A(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),A("float32"===t.dtype||"int32"===t.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var n=t,r=!1;3===t.rank&&(r=!0,n=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=e[0],i=e[1],s=hi.engine.runKernel(function(o,e){return e([n]),o.resizeNearestNeighbor(n,a,i,d)},{batchImages:n},function(a,e){return{batchImages:function(){return hi.engine.runKernel(function(t){return t.resizeNearestNeighborBackprop(a,e[0],d)},{})}}});return r?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),ih=qt({nonMaxSuppression_:function(p,e,t,n,r){void 0===n&&(n=.5),void 0===r&&(r=B);var o=st(p,"boxes","nonMaxSuppression"),d=st(e,"scores","nonMaxSuppression"),i=es(o,d,t,n,r);return t=i.maxOutputSize,n=i.iouThreshold,r=i.scoreThreshold,hi.engine.runKernel(function(a){return a.nonMaxSuppression(o,d,t,n,r)},{$boxes:o})}}),ph=qt({cropAndResize_:function(p,e,t,n,r,o){var a=st(p,"image","cropAndResize","float32"),d=st(e,"boxes","cropAndResize","float32"),l=st(t,"boxInd","cropAndResize","int32");r=r||"bilinear",o=o||0;var u=d.shape[0];return A(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),A(2===d.rank&&4===d.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+d.shape+"."}),A(1===l.rank&&l.shape[0]===u,function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+d.shape+"."}),A(2===n.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),A(1<=n[0]&&1<=n[1],function(){return"cropSize must be atleast [1,1], but was "+n}),A("bilinear"===r||"nearest"===r,function(){return"method must be bilinear or nearest, but was "+r}),hi.engine.runKernel(function(t){return t.cropAndResize(a,d,l,n,r,o)},{$image:a,$boxes:d})}}),dh=Object.freeze({resizeBilinear:rh,resizeNearestNeighbor:sh,nonMaxSuppression:ih,nonMaxSuppressionAsync:function(d,e,t,n,r){return void 0===n&&(n=.5),void 0===r&&(r=B),x(this,void 0,void 0,function(){var o,a,i,s,u,c;return R(this,function(l){switch(l.label){case 0:return o=st(d,"boxes","nonMaxSuppressionAsync"),a=st(e,"scores","nonMaxSuppressionAsync"),i=es(o,a,t,n,r),t=i.maxOutputSize,n=i.iouThreshold,r=i.scoreThreshold,[4,o.data()];case 1:return s=l.sent(),[4,a.data()];case 2:return u=l.sent(),c=ga(s,u,t,n,r),o!==d&&o.dispose(),a!==e&&a.dispose(),[2,c];}})})},cropAndResize:ph}),lh=qt({matMul_:function(b,e,C,R,S,_){var t;void 0===C&&(C=!1),void 0===R&&(R=!1),void 0===_&&(_="linear");var a=st(b,"a","fused matMul"),o=st(e,"b","fused matMul");t=Ae(a,o),a=t[0],o=t[1];var s=C?a.shape[a.rank-2]:a.shape[a.rank-1],i=R?o.shape[o.rank-1]:o.shape[o.rank-2],l=C?a.shape[a.rank-1]:a.shape[a.rank-2],p=R?o.shape[o.rank-2]:o.shape[o.rank-1],d=a.shape.slice(0,-2),u=o.shape.slice(0,-2),c=U(d),h=U(u);A(2<=a.rank&&2<=o.rank&&a.rank===o.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."}),A(L(d,u),function(){return"Error in fused matMul: outer dimensions ("+d+") and ("+u+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."}),A(s===i,function(){return"Error in fused matMul: inner shapes ("+s+") and ("+i+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+C+" and transposeB="+R+" must match."});var m=a.shape.slice(0,-2).concat([l,p]),g=C?a.as3D(c,s,l):a.as3D(c,l,s),f=R?o.as3D(h,p,i):o.as3D(h,i,p),y;null!=S&&Ea(m,(y=Ae(y=st(S,"bias","fused matMul"),a)[0]).shape);var v={$a:g,$b:f};return null!=S&&(v.$bias=y),hi.engine.runKernel(function(a,e){var t=a.fusedBatchMatMul(g,f,C,R,y,_);return e([g,f,t]),t},v,function(a,e){var t=e[0],o=e[1],s=e[2],p;if(null==_||"linear"===_)p=a;else{if("relu"!==_)throw new Error("Gradient for activation "+_+" has not been implemented yet.");p=a.mul(s.step())}var i={};return null!=S&&(i={$bias:function(){var a=p,e=Sa(y.shape,p.shape);return 0<e.length&&(a=a.sum(e)),a.reshape(y.shape)}}),C||R?!C&&R?Object.assign({$a:function(){return p.matMul(o,!1,!1)},$b:function(){return p.matMul(t,!0,!1)}},i):C&&!R?Object.assign({$a:function(){return o.matMul(p,!1,!0)},$b:function(){return t.matMul(p,!1,!1)}},i):Object.assign({$a:function(){return o.matMul(p,!0,!0)},$b:function(){return p.matMul(t,!0,!0)}},i):Object.assign({$a:function(){return p.matMul(o,!1,!0)},$b:function(){return t.matMul(p,!0,!1)}},i)}).reshape(m)}}),uh=Object.freeze({matMul:lh}),ch=Object.freeze({image:dh,linalg:nh,losses:th,spectral:Gc,fused:uh,op:qt,batchNormalization2d:Xl,batchNormalization3d:Yl,batchNormalization4d:Ql,batchNormalization:Zl,batchNorm:Jl,batchNorm2d:eu,batchNorm3d:tu,batchNorm4d:au,complex:Si,real:Ei,imag:_i,concat:Ed,concat1d:_d,concat2d:kd,concat3d:wd,concat4d:Id,split:Nd,conv1d:ou,conv2d:nu,conv3d:ru,conv2dDerFilter:su,depthwiseConv2d:iu,separableConv2d:pu,conv2dTranspose:du,matMul:lu,dot:uu,outerProduct:cu,reverse:hu,reverse1d:mu,reverse2d:gu,reverse3d:fu,reverse4d:yu,maxPool:xu,avgPool:bu,pool:vu,slice:Cu,slice1d:Ru,slice2d:Su,slice3d:Eu,slice4d:_u,abs:ml,acos:gl,acosh:fl,asin:yl,asinh:xl,atan:bl,atanh:vl,ceil:Cl,clipByValue:Rl,cos:Sl,cosh:El,erf:_l,exp:kl,expm1:wl,floor:Il,log:Nl,log1p:Tl,logSigmoid:Dl,neg:Al,reciprocal:Ol,round:Pl,rsqrt:Fl,sigmoid:Bl,sign:Ll,isNaN:Ml,isInf:Wl,isFinite:Ul,sin:zl,sinh:Gl,softplus:Vl,sqrt:Hl,square:ql,step:$l,tan:Kl,tanh:jl,all:ku,any:wu,argMax:Iu,argMin:Nu,logSumExp:Tu,max:Du,mean:Au,min:Ou,moments:Pu,sum:Fu,prod:Bu,equal:Lu,equalStrict:Mu,greater:Wu,greaterEqual:Uu,greaterEqualStrict:zu,greaterStrict:Gu,less:Vu,lessEqual:Hu,lessEqualStrict:qu,lessStrict:$u,notEqual:Ku,notEqualStrict:ju,add:Xu,addN:Yu,addStrict:Qu,atan2:Zu,div:Ju,divStrict:ec,floorDiv:tc,maximum:ac,maximumStrict:oc,minimum:nc,minimumStrict:rc,mod:sc,modStrict:ic,mul:pc,mulStrict:dc,pow:lc,powStrict:uc,squaredDifference:cc,squaredDifferenceStrict:hc,sub:mc,subStrict:gc,elu:Rc,leakyRelu:Sc,prelu:Ec,relu:_c,selu:kc,logicalAnd:fc,logicalNot:yc,logicalOr:xc,logicalXor:bc,where:vc,whereAsync:Cc,buffer:jn,print:Xn,batchToSpaceND:Ud,cast:zd,clone:Gd,cumsum:Vd,depthToSpace:Hd,expandDims:qd,eye:$d,multinomial:Kd,oneHot:jd,pad:Xd,pad1d:Yd,pad2d:Qd,pad3d:Zd,pad4d:Jd,rand:el,randomNormal:tl,randomUniform:al,reshape:ol,spaceToBatchND:nl,squeeze:rl,stack:sl,tile:il,truncatedNormal:pl,unstack:dl,setdiff1dAsync:ll,fill:aa,linspace:oa,ones:ea,range:na,scalar:Kt,tensor:$t,tensor1d:jt,tensor2d:Xt,tensor3d:Yt,tensor4d:Qt,tensor5d:Zt,tensor6d:Jt,zeros:ta,onesLike:ki,zerosLike:wi,transpose:wc,softmax:Ci,logSoftmax:Ri,localResponseNormalization:Ic,norm:Nc,gather:Tc,unsortedSegmentSum:Dc,basicLSTMCell:Ac,multiRNNCell:Oc,movingAverage:Pc,stridedSlice:Fc,topk:Bc,scatterND:Lc,fft:Mc,ifft:Wc,rfft:Uc,irfft:zc,sparseToDense:Vc,gatherND:Hc}),hh=function(){function t(){this.blockSize=48,this.firstUse=!0,hi.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return t.prototype.setDataMover=function(t){this.data=new Ii(t)},t.prototype.register=function(a,e,t){if(this.firstUse&&(this.firstUse=!1,hi.get("IS_NODE")&&gt("\n============================\nHi there \uD83D\uDC4B. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(a))throw new Error("Data buffer is already registered");this.data.set(a,{dtype:t})},t.prototype.write=function(a,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(a).values=e},t.prototype.fromPixels=function(s,e){if(null==s)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t,n;if(hi.get("IS_NODE")&&null==s.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=s.getContext)t=s.getContext("2d").getImageData(0,0,s.width,s.height).data;else if(s instanceof ImageData)t=s.data;else{if(!(s instanceof HTMLImageElement||s instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+s.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=s.width,this.fromPixels2DContext.canvas.height=s.height,this.fromPixels2DContext.drawImage(s,0,0,s.width,s.height),t=this.fromPixels2DContext.getImageData(0,0,s.width,s.height).data}if(4===e)n=new Int32Array(t);else{var r=s.width*s.height;n=new Int32Array(r*e);for(var o=0;o<r;o++)for(var a=0;a<e;++a)n[o*e+a]=t[4*o+a]}return Yt(n,[s.height,s.width,e],"int32")},t.prototype.read=function(t){return x(this,void 0,void 0,function(){return R(this,function(){return[2,this.readSync(t)]})})},t.prototype.readSync=function(a){var e=this.data.get(a),t=e.dtype,o=e.complexTensors;return"complex64"===t?ia(o.real.dataSync(),o.imag.dataSync()):this.data.get(a).values},t.prototype.disposeData=function(a){if(this.data.has(a)){var e=this.data.get(a).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(a)}},t.prototype.time=function(a){return x(this,void 0,void 0,function(){var e;return R(this,function(){return e=be(),a(),[2,{kernelMs:be()-e}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(a,e){var t=$s.make(a.shape,{},"complex64");return this.data.get(t.dataId).complexTensors={real:hi.engine.keep(a.clone()),imag:hi.engine.keep(e.clone())},t},t.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},t.prototype.assertNotComplex=function(a,e){Array.isArray(a)||(a=[a]),a.forEach(function(t){null!=t&&A("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})},t.prototype.slice=function(p,d,e){if(this.assertNotComplex(p,"slice"),Vt(p.shape,d,e)){var t=Ht(d,p.strides),n=U(e);return $t(p.dataSync().subarray(t,t+n),e,p.dtype)}for(var o=jn(e,p.dtype),a=p.bufferSync(),r=0,s;r<o.size;++r)s=o.indexToLoc(r).map(function(t,e){return t+d[e]}),o.values[r]=a.get.apply(a,s);return o.toTensor()},t.prototype.stridedSlice=function(b,e,t,n,r,o,a,i,s){this.assertNotComplex(b,"stridedSlice");var u=Ut(b.shape,e,t,n,r,o,a,i,s),c=u[0],l=u[1],p=u[2],d=l.filter(function(a,e){return-1===p.indexOf(e)});if(d.some(function(t){return 0===t}))return $t([],d);for(var h=jn(l,b.dtype),f=b.bufferSync(),m=0;m<h.size;m++){for(var g=h.indexToLoc(m),v=Array(g.length),y=0;y<v.length;y++)v[y]=g[y]*n[y]+c[y];h.set.apply(h,[f.get.apply(f,v)].concat(g))}return h.toTensor().reshape(d)},t.prototype.unstack=function(p,e){for(var t=p.shape[e],n=Array(p.rank-1),r=0,o=0;o<p.rank;o++)o!==e&&(n[r++]=p.shape[o]);var a=Array(p.rank).fill(0),i=p.shape.slice();i[e]=1;var s=Array(t);for(o=0;o<s.length;o++)a[e]=o,s[o]=this.slice(p,a,i).reshape(n);return s},t.prototype.reverse=function(s,e){this.assertNotComplex(s,"reverse");for(var t=jn(s.shape,s.dtype),n=s.bufferSync(),r=function(r){var o=t.indexToLoc(r),a=o.slice();e.forEach(function(e){return a[e]=s.shape[e]-1-a[e]}),t.set.apply(t,[n.get.apply(n,a)].concat(o))},o=0;o<t.size;o++)r(o);return t.toTensor()},t.prototype.concat=function(p,d){this.assertNotComplex(p,"concat");var e=p.map(function(t){var e=U(t.shape.slice(d));return t.as2D(-1,e)}),l=Tt(e.map(function(t){return t.shape}),1),r=jn(l,p[0].dtype).values;if(1===e[0].shape[0]){var t=0;e.forEach(function(a){r.set(a.dataSync(),t),t+=a.size})}else{var o=0;e.forEach(function(i){for(var e=i.dataSync(),t=0,n=0;n<i.shape[0];++n)for(var a=n*l[1]+o,s=0;s<i.shape[1];++s)r[a+s]=e[t++];o+=i.shape[1]})}var a=Tt(p.map(function(t){return t.shape}),d);return $t(r,a,p[0].dtype)},t.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(Kt(-1),t)},t.prototype.add=function(a,e){return"complex64"===a.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),e.cast("complex64"),function(a,e,t,o){return{real:a+t,imag:e+o}}):this.broadcastedBinaryOp(a,e,Te(a.dtype,e.dtype),function(a,e){return a+e})},t.prototype.addN=function(s){this.assertNotComplex(s,"addN");for(var e=s.map(function(t){return t.dataSync()}),t=jn(s[0].shape,s[0].dtype),n=t.values,r=0;r<s.length;r++)for(var o=e[r],a=0;a<n.length;a++)n[a]+=o[a];return t.toTensor()},t.prototype.subtract=function(a,e){return"complex64"===a.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),e.cast("complex64"),function(a,e,t,o){return{real:a-t,imag:e-o}}):this.broadcastedBinaryOp(a,e,Te(a.dtype,e.dtype),function(a,e){return a-e})},t.prototype.pow=function(a,e){return this.assertNotComplex([a,e],"pow"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return b(a,e)})},t.prototype.batchMatMul=function(y,e,t,n){this.assertNotComplex([y,e],"matMul");for(var r=t?y.shape[1]:y.shape[2],o=t?y.shape[2]:y.shape[1],a=n?e.shape[1]:e.shape[2],i=y.shape[0],s=y.dataSync(),u=e.dataSync(),c=t?[y.strides[0],1,y.strides[1]]:[y.strides[0],y.strides[1],1],l=c[0],p=c[1],d=c[2],h=n?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],f=h[0],m=h[1],g=h[2],v=jn([i,o,a],y.dtype),x=v.values,E=this.blockSize,T=0;T<i;T++)for(var b=0;b<o;b+=E)for(var w=0;w<a;w+=E)for(var S=0;S<r;S+=E)for(var C=le(b+E,o),A=le(w+E,a),N=le(S+E,r),_=b;_<C;_++)for(var R=w;R<A;R++){for(var I=0,k=S;k<N;k++)I+=s[T*l+_*p+k*d]*u[k*f+R*m+T*g];x[T*(o*a)+(_*a+R)]+=I}return v.toTensor()},t.prototype.fusedBatchMatMul=function(s,e,t,n,r,o){var a=this.batchMatMul(s,e,t,n);return r&&(a=this.add(a,r)),o&&(a=ts(this,o,a)),a},t.prototype.multiply=function(a,e){return"complex64"===a.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),e.cast("complex64"),function(a,e,t,o){return{real:a*t-e*o,imag:a*o+e*t}}):this.broadcastedBinaryOp(a,e,Te(a.dtype,e.dtype),function(a,e){return a*e})},t.prototype.realDivide=function(a,e){return this.assertNotComplex([a,e],"realDivide"),this.broadcastedBinaryOp(a,e,"float32",function(a,e){return a/e})},t.prototype.floorDiv=function(a,e){return this.assertNotComplex([a,e],"floorDiv"),this.broadcastedBinaryOp(a,e,"int32",function(a,e){return $(a/e)})},t.prototype.sum=function(h,e){this.assertNotComplex(h,"sum"),_t("sum",e,h.rank);for(var t=St(h.shape,e),n=t[0],r=t[1],o=ta(n,Te(h.dtype,"int32")),a=U(r),i=o.dataSync(),s=h.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=0,p=0;p<a;++p)l+=s[c+p];i[u]=l}return o},t.prototype.prod=function(h,e){this.assertNotComplex(h,"sum");for(var t=St(h.shape,e),n=t[0],r=t[1],o=ta(n,Te(h.dtype,"int32")),a=U(r),i=o.dataSync(),s=h.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=1,p=0;p<a;++p)l*=s[c+p];i[u]=l}return o},t.prototype.unsortedSegmentSum=function(p,e,t){this.assertNotComplex(p,"unsortedSegmentSum");for(var n=[],r=p.rank-e.rank,o=0;o<r;++o)e=e.expandDims(o+1);for(o=0;o<t;++o){var a=Kt(o,"int32"),i=Lu(a,e).asType("float32").mul(p).sum(0);n.push(i)}return sl(n)},t.prototype.argMin=function(g,e){this.assertNotComplex(g,"argMin");var t=[e];_t("argMin",t,g.rank);for(var n=St(g.shape,t),r=n[0],o=n[1],a=ta(r,"int32"),i=U(o),s=a.dataSync(),u=g.dataSync(),c=0;c<s.length;++c){for(var l=c*i,p=u[l],d=0,h=0,f;h<i;++h)f=u[l+h],f<p&&(p=f,d=h);s[c]=d}return a},t.prototype.argMax=function(g,e){this.assertNotComplex(g,"argMax");var t=[e];_t("argMax",t,g.rank);for(var n=St(g.shape,t),r=n[0],o=n[1],a=ta(r,"int32"),i=U(o),s=a.dataSync(),u=g.dataSync(),c=0;c<s.length;++c){for(var l=c*i,p=u[l],d=0,h=0,f;h<i;++h)f=u[l+h],f>p&&(p=f,d=h);s[c]=d}return a},t.prototype.cumsum=function(m,e,t,n){if(this.assertNotComplex(m,"cumsum"),e!==m.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(m.rank-1)+" but got axis="+e);for(var r=Te(m.dtype,"int32"),o=ta(m.shape,r),a=o.dataSync(),i=m.dataSync(),s=m.shape[m.rank-1],u=n?function(a,e){return a+s-e-1}:function(a,e){return a+e},c=0;c<i.length;c+=s)for(var l=0,p;l<s;l++)if(p=u(c,l),0===l)a[p]=t?0:i[p];else{var d=u(c,l-1);a[p]=t?i[d]+a[d]:i[p]+a[d]}return o},t.prototype.equal=function(a,e){return this.assertNotComplex([a,e],"equal"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a===e?1:0})},t.prototype.notEqual=function(a,e){return this.assertNotComplex([a,e],"notEqual"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a===e?0:1})},t.prototype.less=function(a,e){return this.assertNotComplex([a,e],"less"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a<e?1:0})},t.prototype.lessEqual=function(a,e){return this.assertNotComplex([a,e],"lessEqual"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a<=e?1:0})},t.prototype.greater=function(a,e){return this.assertNotComplex([a,e],"greater"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a>e?1:0})},t.prototype.greaterEqual=function(a,e){return this.assertNotComplex([a,e],"greaterEqual"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a>=e?1:0})},t.prototype.logicalNot=function(a){this.assertNotComplex(a,"logicalNot");for(var e=a.dataSync(),t=new Uint8Array(e.length),o=0;o<e.length;++o)t[o]=e[o]?0:1;return $s.make(a.shape,{values:t},"bool")},t.prototype.logicalAnd=function(a,e){return this.assertNotComplex([a,e],"logicalAnd"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a&&e})},t.prototype.logicalOr=function(a,e){return this.assertNotComplex([a,e],"logicalOr"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a||e})},t.prototype.select=function(d,e,t){this.assertNotComplex([d,e,t],"select");for(var n=d.dataSync(),r=e.dataSync(),o=t.dataSync(),a=ta(e.shape,Te(e.dtype,t.dtype)),i=a.dataSync(),s=0,u=0===d.rank||1<d.rank||1===e.rank?1:e.shape[1],c=0;c<n.length;c++)for(var l=0;l<u;l++)i[s++]=1===n[c]?r[c]:o[c];return a},t.prototype.where=function(a){this.assertNotComplex([a],"where");var e=a.dataSync();return Yn(a.shape,e)},t.prototype.topk=function(a,e,t){return this.assertNotComplex(a,"topk"),xa(a.dataSync(),a.shape,a.dtype,e,t)},t.prototype.min=function(m,e){this.assertNotComplex(m,"min"),_t("min",e,m.rank);for(var t=St(m.shape,e),n=t[0],r=t[1],o=ta(n,m.dtype),a=U(r),i=o.dataSync(),s=m.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=s[c],p=0,d;p<a;++p)d=s[c+p],d<l&&(l=d);i[u]=l}return o},t.prototype.minimum=function(a,e){return this.assertNotComplex([a,e],"minimum"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return le(a,e)})},t.prototype.mod=function(a,e){return this.assertNotComplex([a,e],"mod"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){var t=a%e;return 0>a&&0>e||0<=a&&0<=e?t:(t+e)%e})},t.prototype.max=function(m,e){this.assertNotComplex(m,"max"),_t("max",e,m.rank);for(var t=St(m.shape,e),n=t[0],r=t[1],o=ta(n,m.dtype),a=U(r),i=o.dataSync(),s=m.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=s[c],p=0,d;p<a;++p)d=s[c+p],d>l&&(l=d);i[u]=l}return o},t.prototype.maximum=function(a,e){return this.assertNotComplex([a,e],"maximum"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return de(a,e)})},t.prototype.all=function(m,e){this.assertNotComplex(m,"all"),_t("all",e,m.rank);for(var t=St(m.shape,e),n=t[0],r=t[1],o=ta(n,m.dtype),a=U(r),i=o.dataSync(),s=m.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=s[c],p=0,d;p<a;++p)d=s[c+p],l=l&&d;i[u]=l}return o},t.prototype.any=function(m,e){this.assertNotComplex(m,"any"),_t("any",e,m.rank);for(var t=St(m.shape,e),n=t[0],r=t[1],o=ta(n,m.dtype),a=U(r),i=o.dataSync(),s=m.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=s[c],p=0,d;p<a;++p)d=s[c+p],l=l||d;i[u]=l}return o},t.prototype.squaredDifference=function(a,e){return this.assertNotComplex([a,e],"squaredDifference"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){var t=a-e;return t*t})},t.prototype.ceil=function(a){this.assertNotComplex(a,"ceil");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=pe(e[o]);return $s.make(a.shape,{values:t})},t.prototype.floor=function(a){this.assertNotComplex(a,"floor");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=$(e[o]);return $s.make(a.shape,{values:t})},t.prototype.sign=function(a){this.assertNotComplex(a,"x");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=0>e[o]?-1:0<e[o]?1:0;return $s.make(a.shape,{values:t})},t.prototype.isNaN=function(a){this.assertNotComplex(a,"x");for(var e=a.dataSync(),t=new Uint8Array(e.length),o=0;o<e.length;++o)Number.isNaN(e[o])&&(t[o]=1);return $s.make(a.shape,{values:t},"bool")},t.prototype.isInf=function(a){this.assertNotComplex(a,"x");for(var e=a.dataSync(),t=new Uint8Array(e.length),o=0;o<e.length;++o)l(e[o])===1/0&&(t[o]=1);return $s.make(a.shape,{values:t},"bool")},t.prototype.isFinite=function(a){this.assertNotComplex(a,"x");for(var e=a.dataSync(),t=new Uint8Array(e.length),o=0;o<e.length;++o)Number.isFinite(e[o])&&(t[o]=1);return $s.make(a.shape,{values:t},"bool")},t.prototype.round=function(a){this.assertNotComplex(a,"round");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=$(e[s]),t[s]=.5>e[s]-r?$(e[s]):.5<e[s]-r?pe(e[s]):0==r%2?r:r+1;return $s.make(a.shape,{values:t})},t.prototype.exp=function(a){this.assertNotComplex(a,"exp");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=m(e[o]);return $s.make(a.shape,{values:t})},t.prototype.expm1=function(a){this.assertNotComplex(a,"expm1");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=Math.expm1(e[o]);return $s.make(a.shape,{values:t})},t.prototype.log=function(a){this.assertNotComplex(a,"log");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=p(r);return $s.make(a.shape,{values:t})},t.prototype.log1p=function(a){this.assertNotComplex(a,"log1p");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=Math.log1p(r);return $s.make(a.shape,{values:t})},t.prototype.sqrt=function(a){this.assertNotComplex(a,"sqrt");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=C(r);return $s.make(a.shape,{values:t})},t.prototype.rsqrt=function(a){this.assertNotComplex(a,"rsqrt");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=1/C(r);return $s.make(a.shape,{values:t})},t.prototype.square=function(a){this.assertNotComplex(a,"square");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=r*r;return $s.make(a.shape,{values:t})},t.prototype.reciprocal=function(a){this.assertNotComplex(a,"reciprocal");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=1/e[o];return $s.make(a.shape,{values:t})},t.prototype.linear=function(t){return t},t.prototype.relu=function(a){this.assertNotComplex(a,"relu");for(var e=ta(a.shape,a.dtype),t=e.dataSync(),n=a.dataSync(),r=0;r<n.length;++r)t[r]=de(0,n[r]);return e},t.prototype.prelu=function(a,e){return this.assertNotComplex([a,e],"prelu"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return 0>a?e*a:a})},t.prototype.elu=function(a){this.assertNotComplex(a,"elu");for(var e=new Float32Array(a.size),s=a.dataSync(),n=0,r;n<s.length;++n)r=s[n],e[n]=0<=r?r:m(r)-1;return $s.make(a.shape,{values:e})},t.prototype.eluDer=function(s,e){this.assertNotComplex([s,e],"eluDer");for(var t=new Float32Array(e.size),p=e.dataSync(),r=s.dataSync(),o=0,a;o<p.length;++o)a=p[o],t[o]=1<=a?r[o]:r[o]*(a+1);return $s.make(e.shape,{values:t})},t.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=new Float32Array(t.size),n=t.dataSync(),o=0,a;o<n.length;++o)a=n[o],e[o]=0<=a?hd*a:cd*(m(a)-1);return $s.make(t.shape,{values:e})},t.prototype.clip=function(s,e,t){this.assertNotComplex(s,"clip");for(var n=new Float32Array(s.size),p=s.dataSync(),o=0,a;o<p.length;++o)a=p[o],n[o]=a>t?t:a<e?e:a;return $s.make(s.shape,{values:n})},t.prototype.abs=function(a){for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=l(o[n]);return $s.make(a.shape,{values:e})},t.prototype.complexAbs=function(s){for(var e=new Float32Array(s.size),i=s.dataSync(),n=0;n<s.size;++n){var r=i[2*n],o=i[2*n+1];e[n]=Math.hypot(r,o)}return $s.make(s.shape,{values:e})},t.prototype.int=function(a){this.assertNotComplex(a,"int");for(var e=new Int32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=o[n];return $s.make(a.shape,{values:e},"int32")},t.prototype.sigmoid=function(a){this.assertNotComplex(a,"sigmoid");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=1/(1+m(-o[n]));return $s.make(a.shape,{values:e})},t.prototype.softplus=function(d){this.assertNotComplex(d,"softplus");for(var e=-15.942385152878742+2,l=new Float32Array(d.size),c=d.dataSync(),r=0;r<c.length;++r){var o=c[r]>-e,a=c[r]<e,i=m(c[r]),s=void 0;s=a?i:o?c[r]:p(1+i),l[r]=s}return $s.make(d.shape,{values:l})},t.prototype.sin=function(a){this.assertNotComplex(a,"sin");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=s(o[n]);return $s.make(a.shape,{values:e})},t.prototype.cos=function(a){this.assertNotComplex(a,"cos");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=i(o[n]);return $s.make(a.shape,{values:e})},t.prototype.tan=function(a){this.assertNotComplex(a,"tan");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.tan(o[n]);return $s.make(a.shape,{values:e})},t.prototype.asin=function(a){this.assertNotComplex(a,"asin");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.asin(o[n]);return $s.make(a.shape,{values:e})},t.prototype.acos=function(a){this.assertNotComplex(a,"acos");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.acos(o[n]);return $s.make(a.shape,{values:e})},t.prototype.atan=function(a){this.assertNotComplex(a,"atan");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.atan(o[n]);return $s.make(a.shape,{values:e})},t.prototype.atan2=function(a,e){return this.assertNotComplex([a,e],"atan2"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return Math.atan2(a,e)})},t.prototype.sinh=function(a){this.assertNotComplex(a,"sinh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.sinh(o[n]);return $s.make(a.shape,{values:e})},t.prototype.cosh=function(a){this.assertNotComplex(a,"cosh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.cosh(o[n]);return $s.make(a.shape,{values:e})},t.prototype.tanh=function(a){this.assertNotComplex(a,"tanh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=z(o[n]);return $s.make(a.shape,{values:e})},t.prototype.asinh=function(a){this.assertNotComplex(a,"asinh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.asinh(o[n]);return $s.make(a.shape,{values:e})},t.prototype.acosh=function(a){this.assertNotComplex(a,"acosh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.acosh(o[n]);return $s.make(a.shape,{values:e})},t.prototype.atanh=function(a){this.assertNotComplex(a,"atanh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.atanh(o[n]);return $s.make(a.shape,{values:e})},t.prototype.erf=function(a){this.assertNotComplex(a,"erf");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n){var r=o[n],s=1/(1+sd*r);e[n]=1-((((ud*s+ld)*s+dd)*s+pd)*s+id)*s*m(-r*r)}return $s.make(a.shape,{values:e})},t.prototype.step=function(s,e){void 0===e&&(e=0),this.assertNotComplex(s,"step");for(var t=new Float32Array(s.size),i=s.dataSync(),r=0,o;r<i.length;++r)o=i[r],t[r]=isNaN(o)?NaN:0<o?1:e;return $s.make(s.shape,{values:t})},t.prototype.conv2d=function(P,e,t){this.assertNotComplex([P,e],"conv2d");for(var n=t.filterHeight,r=t.filterWidth,o=t.dilationHeight,a=t.dilationWidth,i=t.padInfo.left,s=t.padInfo.top,u=jn(t.outShape,P.dtype),c=P.dataSync(),l=e.dataSync(),p=u.values,d=0;d<t.batchSize;++d)for(var h=d*P.strides[0],f=d*u.strides[0],m=0;m<t.outHeight;++m)for(var g=f+m*u.strides[1],v=m*t.strideHeight-i,y=0,x;y<n;y++)if(x=v+y*o,!(0>x||x>=t.inHeight))for(var E=y*e.strides[0],T=h+x*P.strides[1],b=0;b<t.outWidth;++b)for(var w=g+b*t.outChannels,S=b*t.strideWidth-s,C=0,A;C<r;C++)if(A=S+C*a,!(0>A||A>=t.inWidth))for(var N=E+C*e.strides[1],_=T+A*t.inChannels,R=N,I=0;I<t.inChannels;++I){for(var k=c[_+I],D=0;D<t.outChannels;++D)p[w+D]+=k*l[R+D];R+=t.outChannels}return u.toTensor()},t.prototype.conv3d=function(H,e,t){for(var n=t.filterDepth,r=t.filterHeight,o=t.filterWidth,a=t.dilationDepth,i=t.dilationHeight,s=t.dilationWidth,u=t.padInfo.front,c=t.padInfo.left,l=t.padInfo.top,p=jn(t.outShape,H.dtype),d=H.dataSync(),h=e.dataSync(),f=p.values,m=0;m<t.batchSize;++m)for(var g=m*H.strides[0],v=m*p.strides[0],y=0;y<t.outDepth;++y)for(var x=v+y*p.strides[1],E=y*t.strideDepth-u,T=0,b;T<n;T++)if(b=E+T*a,!(0>b||b>=t.inDepth))for(var w=T*e.strides[0],S=g+b*H.strides[1],C=0;C<t.outHeight;++C)for(var A=x+C*p.strides[2],N=C*t.strideHeight-l,_=0,R;_<r;_++)if(R=N+_*i,!(0>R||R>=t.inHeight))for(var I=w+_*e.strides[1],k=S+R*H.strides[2],D=0;D<t.outWidth;++D)for(var O=A+D*t.outChannels,P=D*t.strideWidth-c,M=0,F;M<o;M++)if(F=P+M*s,!(0>F||F>=t.inWidth))for(var L=I+M*e.strides[2],B=k+F*t.inChannels,V=L,U=0;U<t.inChannels;++U){for(var z=d[B+U],W=0;W<t.outChannels;++W)f[O+W]+=z*h[V+W];V+=t.outChannels}return p.toTensor()},t.prototype.conv2dDerInput=function(j,e,t){this.assertNotComplex([j,e],"conv2dDerInput");for(var n=jn(t.inShape,"float32"),r=n.values,o=n.strides,a=o[0],i=o[1],s=o[2],u=j.dataSync(),c=j.strides,l=c[0],p=c[1],d=c[2],h=e.dataSync(),f=e.strides,m=f[0],g=f[1],v=f[2],y=t.batchSize,x=t.filterHeight,E=t.filterWidth,T=t.inChannels,b=t.inHeight,w=t.inWidth,S=t.outChannels,C=t.outHeight,A=t.outWidth,N=t.strideHeight,_=t.strideWidth,R=x-1-t.padInfo.top,I=E-1-t.padInfo.left,k=0;k<y;++k)for(var D=0;D<T;++D)for(var O=0;O<b;++O)for(var P=O-R,M=de(0,pe(P/N)),F=le(C,(x+P)/N),L=0;L<w;++L){for(var B=L-I,V=de(0,pe(B/_)),U=le(A,(E+B)/_),z=0,W=M;W<F;++W)for(var G=W*N-P,H=V;H<U;++H)for(var q=l*k+p*W+d*H,$=m*(x-1-G)+g*(E-1-(H*_-B))+v*D,K=0;K<S;++K)z+=u[q+K]*h[$+K];r[a*k+i*O+s*L+D]=z}return n.toTensor()},t.prototype.conv3dDerInput=function(ce,e,t){for(var n=jn(t.inShape,"float32"),r=n.values,o=n.strides,a=o[0],i=o[1],s=o[2],u=o[3],c=ce.dataSync(),l=ce.strides,p=l[0],d=l[1],h=l[2],f=l[3],m=e.dataSync(),g=e.strides,v=g[0],y=g[1],x=g[2],E=g[3],T=t.batchSize,b=t.filterDepth,w=t.filterHeight,S=t.filterWidth,C=t.inChannels,A=t.inDepth,N=t.inHeight,_=t.inWidth,R=t.outChannels,I=t.outDepth,k=t.outHeight,D=t.outWidth,O=t.strideDepth,P=t.strideHeight,M=t.strideWidth,F=b-1-t.padInfo.front,L=w-1-t.padInfo.top,B=S-1-t.padInfo.left,V=0;V<T;++V)for(var U=0;U<C;++U)for(var z=0;z<A;++z)for(var W=z-F,G=de(0,pe(W/O)),H=le(I,(b+W)/O),q=0;q<N;++q)for(var $=q-L,K=de(0,pe($/P)),X=le(k,(w+$)/P),j=0;j<_;++j){for(var Y=j-B,Q=de(0,pe(Y/M)),J=le(D,(S+Y)/M),Z=0,ee=G;ee<H;++ee)for(var te=ee*O-W,ne=K;ne<X;++ne)for(var re=ne*P-$,oe=Q;oe<J;++oe)for(var ae=p*V+d*ee+h*ne+f*oe,ie=v*(b-1-te)+y*(w-1-re)+x*(S-1-(oe*M-Y))+E*U,se=0;se<R;++se)Z+=c[ae+se]*m[ie+se];r[a*V+i*z+s*q+u*j+U]=Z}return n.toTensor()},t.prototype.conv2dDerFilter=function(R,e,t){this.assertNotComplex([R,e],"conv2dDerFilter");for(var n=t.strideHeight,r=t.strideWidth,o=t.filterHeight,a=t.filterWidth,i=jn(t.filterShape,"float32"),s=t.padInfo.left,u=t.padInfo.top,c=R.bufferSync(),l=e.bufferSync(),p=0;p<o;++p)for(var d=de(0,pe((u-p)/n)),h=le(t.outHeight,(t.inHeight+u-p)/n),f=0;f<a;++f)for(var m=de(0,pe((s-f)/r)),g=le(t.outWidth,(t.inWidth+s-f)/r),v=0;v<t.inChannels;++v)for(var y=0;y<t.outChannels;++y){for(var x=0,E=0;E<t.batchSize;++E)for(var _=d;_<h;++_)for(var b=p+_*n-u,k=m,S;k<g;++k)S=f+k*r-s,x+=c.get(E,b,S,v)*l.get(E,_,k,y);i.set(x,p,f,v,y)}return i.toTensor()},t.prototype.conv3dDerFilter=function(ae,e,t){for(var n=t.strideDepth,r=t.strideHeight,o=t.strideWidth,a=t.filterDepth,i=t.filterHeight,s=t.filterWidth,u=jn(t.filterShape,"float32"),c=u.values,l=u.strides,p=l[0],d=l[1],h=l[2],f=l[3],m=e.dataSync(),g=e.strides,v=g[0],y=g[1],x=g[2],E=g[3],T=ae.dataSync(),b=ae.strides,w=b[0],S=b[1],C=b[2],A=b[3],N=t.padInfo.front,_=t.padInfo.left,R=t.padInfo.top,I=0;I<a;++I)for(var k=de(0,pe((N-I)/n)),D=le(t.outDepth,(t.inDepth+N-I)/n),O=I*p,P=0;P<i;++P)for(var M=de(0,pe((R-P)/r)),F=le(t.outHeight,(t.inHeight+R-P)/r),L=P*d+O,B=0;B<s;++B)for(var V=de(0,pe((_-B)/o)),U=le(t.outWidth,(t.inWidth+_-B)/o),z=B*h+L,W=0;W<t.inChannels;++W)for(var G=W*f+z,H=0;H<t.outChannels;++H){for(var q=0,$=0;$<t.batchSize;++$)for(var K=$*w,X=$*v,j=k;j<D;++j)for(var Y=(I+j*n-N)*S+K,Q=j*y+X,J=M;J<F;++J)for(var Z=(P+J*r-R)*C+Y,ee=J*x+Q,te=V,oe;te<U;++te)oe=te*E+ee,q+=T[(B+te*o-_)*A+Z+W]*m[oe+H];c[G+H]=q}return u.toTensor()},t.prototype.depthwiseConv2D=function(F,e,t){this.assertNotComplex([F,e],"depthwiseConv2D");for(var n=t.filterHeight,r=t.filterWidth,o=t.dilationHeight,a=t.dilationWidth,i=t.padInfo.left,s=t.padInfo.top,u=t.outChannels/t.inChannels,c=jn(t.outShape,F.dtype),l=F.dataSync(),p=e.dataSync(),d=c.values,h=0;h<t.batchSize;++h)for(var f=h*F.strides[0],m=h*c.strides[0],g=0;g<t.outHeight;++g)for(var v=m+g*c.strides[1],y=g*t.strideHeight-i,x=0,E;x<n;++x)if(E=y+x*o,!(0>E||E>=t.inHeight))for(var T=x*e.strides[0],b=f+E*F.strides[1],w=0;w<t.outWidth;++w)for(var S=v+w*c.strides[2],C=w*t.strideWidth-s,A=0,N;A<r;++A)if(N=C+A*a,!(0>N||N>=t.inWidth))for(var _=T+A*e.strides[1],R=b+N*t.inChannels,I=S,k=_,D=0;D<t.inChannels;++D){for(var O=l[R+D],P=0;P<u;++P)d[I+P]+=O*p[k+P];I+=u,k+=u}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(Y,e,t){this.assertNotComplex([Y,e],"depthwiseConv2DDerInput");for(var n=jn(t.inShape,"float32"),r=n.values,o=n.strides,a=o[0],i=o[1],s=o[2],u=Y.dataSync(),c=Y.strides,l=c[0],p=c[1],d=c[2],h=e.dataSync(),f=e.strides,m=f[0],g=f[1],v=f[2],y=t.batchSize,x=t.filterHeight,E=t.filterWidth,T=t.inChannels,b=t.inHeight,w=t.inWidth,S=t.outChannels,C=t.outHeight,A=t.outWidth,N=t.strideHeight,_=t.strideWidth,R=x-1-t.padInfo.top,I=E-1-t.padInfo.left,k=S/T,D=0;D<y;++D)for(var O=0;O<T;++O)for(var P=0;P<b;++P)for(var M=P-R,F=de(0,pe(M/N)),L=le(C,(x+M)/N),B=0;B<w;++B){for(var V=B-I,U=de(0,pe(V/_)),z=le(A,(E+V)/_),W=0,G=F;G<L;++G)for(var H=G*N-M,q=U;q<z;++q)for(var $=l*D+p*G+d*q,K=m*(x-1-H)+g*(E-1-(q*_-V))+v*O,X=0;X<k;++X)W+=u[$+(O*k+X)]*h[K+X];r[a*D+i*P+s*B+O]=W}return n.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(R,e,t){this.assertNotComplex([R,e],"depthwiseConv2DDerFilter");for(var n=t.strideHeight,r=t.strideWidth,o=t.filterHeight,a=t.filterWidth,i=jn(t.filterShape,"float32"),s=t.padInfo.left,u=t.padInfo.top,c=t.outChannels/t.inChannels,l=R.bufferSync(),p=e.bufferSync(),d=0;d<o;++d)for(var h=de(0,pe((u-d)/n)),f=le(t.outHeight,(t.inHeight+u-d)/n),m=0;m<a;++m)for(var g=de(0,pe((s-m)/r)),v=le(t.outWidth,(t.inWidth+s-m)/r),y=0;y<t.outChannels;++y){for(var x=Math.trunc(y/c),E=y%c,_=0,b=0;b<t.batchSize;++b)for(var k=h;k<f;++k)for(var S=d+k*n-u,C=g,w;C<v;++C)w=m+C*r-s,_+=l.get(b,S,w,x)*p.get(b,k,C,y);i.set(_,d,m,x,E)}return i.toTensor()},t.prototype.tile=function(p,e){this.assertNotComplex(p,"tile");for(var t=Array(p.rank),n=0;n<t.length;n++)t[n]=p.shape[n]*e[n];var r=jn(t,p.dtype),o=p.bufferSync();for(n=0;n<r.values.length;++n){for(var a=r.indexToLoc(n),i=Array(p.rank),s=0;s<i.length;s++)i[s]=a[s]%p.shape[s];var d=o.locToIndex(i);r.values[n]=o.values[d]}return r.toTensor()},t.prototype.pad=function(p,e,t){this.assertNotComplex(p,"pad");var n=e.map(function(e,t){return e[0]+p.shape[t]+e[1]}),r=e.map(function(t){return t[0]}),o=p.bufferSync(),a=jn(n,p.dtype);0!==t&&a.values.fill(t);for(var i=0;i<p.size;i++){var s=o.indexToLoc(i),d=s.map(function(a,e){return a+r[e]});a.set.apply(a,[o.get.apply(o,s)].concat(d))}return a.toTensor()},t.prototype.transpose=function(p,e){this.assertNotComplex(p,"transpose");for(var t=Array(p.rank),n=0;n<t.length;n++)t[n]=p.shape[e[n]];var r=p.dataSync(),o=jn(t,p.dtype),a=p.bufferSync();for(n=0;n<p.size;++n){for(var i=a.indexToLoc(n),s=Array(i.length),d=0;d<s.length;d++)s[d]=i[e[d]];var u=o.locToIndex(s);o.values[u]=r[n]}return o.toTensor()},t.prototype.gather=function(p,e,t){this.assertNotComplex([p,e],"gather");var n=p.shape.slice(),r=e.dataSync();n[t]=r.length;for(var o=jn(n,p.dtype),a=p.bufferSync(),i=0;i<o.size;++i){var s=o.indexToLoc(i),d=s.slice();d[t]=r[s[t]];var u=a.locToIndex(d);o.values[i]=a.values[u]}return o.toTensor()},t.prototype.batchToSpaceND=function(p,e,t){this.assertNotComplex([p],"batchToSpaceND");var n=e.reduce(function(a,e){return a*e}),r=ft(p.shape,e,n),o=yt(r.length,e.length),a=xt(p.shape,e,n),i=bt(t,e.length),s=vt(a,t,e.length);return p.reshape(r).transpose(o).reshape(a).slice(i,s)},t.prototype.spaceToBatchND=function(p,e,t){this.assertNotComplex([p],"spaceToBatchND");var n=e.reduce(function(a,e){return a*e}),r=[[0,0]];r.push.apply(r,t);for(var o=1+e.length;o<p.shape.length;++o)r.push([0,0]);var a=p.pad(r),i=ft(a.shape,e,n,!1),s=yt(i.length,e.length,!1),d=xt(a.shape,e,n,!1);return a.reshape(i).transpose(s).reshape(d)},t.prototype.pool=function(U,e,t){this.assertNotComplex(U,"pool");for(var n=e.strideHeight,r=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,i=e.effectiveFilterHeight,s=e.effectiveFilterWidth,u=e.padInfo.top,c=e.padInfo.left,l="max"===t?B:W,p=U.dataSync(),d=jn(e.outShape,U.dtype),h=d.values,f=e.outShape[1]*e.outShape[2]*e.outShape[3],m=e.outShape[2]*e.outShape[3],g=e.outShape[3],v=0;v<e.batchSize;++v)for(var y=v*f,x=v*U.strides[0],E=0;E<e.inChannels;++E)for(var T=0;T<e.outHeight;++T)for(var b=T*n-u,w=de(0,b),S=le(e.inHeight,i+b),C=y+T*m,A=0;A<e.outWidth;++A){for(var N=A*r-c,_=de(0,N),R=le(e.inWidth,s+N),I=l,k=0,D=0,O=w;O<S;O+=o){for(var P=x+O*U.strides[1],M=_,F;M<R;M+=a)F=p[P+M*U.strides[2]+E],"max"===t&&F>I?I=F:"avg"==t&&(k+=F,D++);if(isNaN(I))break}h[C+A*g+E]="avg"===t?k/D:I}return d.toTensor()},t.prototype.maxPool=function(a,e){return this.pool(a,e,"max")},t.prototype.maxPoolPositions=function(R,e){for(var t=jn(e.outShape,"int32"),n=e.strideHeight,r=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,i=e.effectiveFilterHeight,s=e.effectiveFilterWidth,u=e.padInfo.top,c=e.padInfo.left,l=R.bufferSync(),p=0;p<e.batchSize;++p)for(var d=0;d<e.inChannels;++d)for(var h=0;h<e.outHeight;++h){for(var f=h*n-u,m=f;0>m;)m+=o;for(var g=le(e.inHeight,i+f),v=0;v<e.outWidth;++v){for(var y=v*r-c,x=y;0>x;)x+=a;for(var E=le(e.inWidth,s+y),k=B,b=-1,w=m;w<g;w+=o)for(var S=w-f,C=x;C<E;C+=a){var I=C-y,N=l.get(p,w,C,d);N>k&&(k=N,b=S*s+I)}t.set(b,p,h,v,d)}}return t.toTensor()},t.prototype.maxPoolBackprop=function(R,e,t,n){this.assertNotComplex([e,t],"maxPoolBackprop");for(var r=this.maxPoolPositions(e,n),o=n.strideHeight,a=n.strideWidth,i=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,l=c-1-n.padInfo.left,p=u-1-n.padInfo.top,d=jn(e.shape,"float32"),h=r.bufferSync(),f=R.bufferSync(),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var v=0;v<n.inHeight;++v)for(var y=0;y<n.inWidth;++y){for(var x=v-p,E=y-l,_=0,b=0,k;b<u;b+=i)if(k=(x+b)/o,!(0>k||k>=n.outHeight||$(k)!==k))for(var S=0,C;S<c;S+=s)if(C=(E+S)/a,!(0>C||C>=n.outWidth||$(C)!==C)){var w=u*c-1-h.get(m,k,C,g)===b*c+S?1:0;0!=w&&(_+=f.get(m,k,C,g)*w)}d.set(_,m,v,y,g)}return d.toTensor()},t.prototype.avgPoolBackprop=function(f,e,t){this.assertNotComplex([f,e],"avgPoolBackprop");for(var n=t.strideHeight,r=t.strideWidth,o=t.filterHeight,a=t.filterWidth,i=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=c-1-t.padInfo.left,p=u-1-t.padInfo.top,d=jn(e.shape,"float32"),h=f.bufferSync(),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var v=0;v<t.inHeight;++v)for(var y=0;y<t.inWidth;++y){for(var x=v-p,R=y-l,E=0,b=0,_;b<u;b+=i)if(_=(x+b)/n,!(0>_||_>=t.outHeight||$(_)!==_))for(var S=0,C;S<c;S+=s)C=(R+S)/r,0>C||C>=t.outWidth||$(C)!==C||(E+=h.get(m,_,C,g));d.set(E*(1/(o*a)),m,v,y,g)}return d.toTensor()},t.prototype.cast=function(a,e){return ra(a,e,this)},t.prototype.reshape=function(a,e){return sa(a,e)},t.prototype.avgPool=function(a,e){return this.assertNotComplex(a,"avgPool"),this.pool(a,e,"avg").toFloat()},t.prototype.resizeBilinear=function(E,e,t,n){this.assertNotComplex(E,"resizeBilinear");for(var r=E.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=E.dataSync(),c=new Float32Array(U([o,e,t,s])),l=[n&&1<e?a-1:a,n&&1<t?i-1:i],p=[n&&1<e?e-1:e,n&&1<t?t-1:t],d=0,h=l[0]/p[0],f=l[1]/p[1],m=0;m<o;m++)for(var g=0;g<e;g++)for(var v=h*g,y=$(v),x=le(a-1,pe(v)),T=m*E.strides[0]+y*E.strides[1],b=m*E.strides[0]+x*E.strides[1],w=0;w<t;w++)for(var S=f*w,C=$(S),A=S-C,N=le(i-1,pe(S)),B=T+C*E.strides[2],R=b+C*E.strides[2],I=T+ +N*E.strides[2],k=b+N*E.strides[2],D=0;D<s;D++){var O=u[B+D],P=u[R+D],M=O+(u[I+D]-O)*A,F=M+(P+(u[k+D]-P)*A-M)*(v-y);c[d++]=F}return $t(c,[o,e,t,s])},t.prototype.resizeBilinearBackprop=function(B,e,t){this.assertNotComplex([B,e],"resizeBilinearBackprop");for(var n=e.shape,r=n[0],o=n[1],a=n[2],i=n[3],s=B.shape,u=s[1],c=s[2],l=new Float32Array(r*o*a*i),p=[t&&1<u?o-1:o,t&&1<c?a-1:a],d=[t&&1<u?u-1:u,t&&1<c?c-1:c],h=p[0]/d[0],f=p[1]/d[1],m=B.dataSync(),g=0,v=0;v<r;v++)for(var y=v*e.strides[0],x=0;x<u;x++)for(var E=x*h,T=$(E),b=le(pe(E),o-1),w=y+T*e.strides[1],S=y+b*e.strides[1],C=E-T,A=1-C,N=0;N<c;N++)for(var _=N*f,R=$(_),I=le(pe(_),a-1),k=_-R,D=1-k,O=w+R*e.strides[2],P=w+I*e.strides[2],M=S+R*e.strides[2],F=S+I*e.strides[2],L=0,W;L<i;L++)W=m[g++],l[O+L]+=W*(A*D),l[P+L]+=W*(A*k),l[M+L]+=W*(C*D),l[F+L]+=W*(C*k);return Qt(l,[r,a,o,i],e.dtype)},t.prototype.resizeNearestNeighbor=function(R,e,t,n){this.assertNotComplex(R,"resizeNearestNeighbor");for(var r=R.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=R.dataSync(),c=new Float32Array(o*e*t*s),l=[n&&1<e?a-1:a,n&&1<t?i-1:i],p=[n&&1<e?e-1:e,n&&1<t?t-1:t],d=l[0]/p[0],h=l[1]/p[1],f=0,m=0;m<o;m++)for(var g=m*R.strides[0],v=0;v<e;v++)for(var y=d*v,x=g+le(a-1,n?_(y):$(y))*R.strides[1],E=0;E<t;E++)for(var k=h*E,b=x+le(i-1,n?_(k):$(k))*R.strides[2],w=0,S;w<s;w++)S=u[b+w],c[f++]=S;return $t(c,[o,e,t,s],R.dtype)},t.prototype.resizeNearestNeighborBackprop=function(W,e,t){this.assertNotComplex([W,e],"resizeNearestNeighborBackprop");for(var n=e.shape,r=n[0],o=n[1],a=n[2],i=n[3],s=W.shape,u=s[1],c=s[2],l=new Float32Array(r*o*a*i),p=W.dataSync(),d=[t&&1<u?o-1:o,t&&1<c?a-1:a],h=[t&&1<u?u-1:u,t&&1<c?c-1:c],f=d[0]/h[0],m=d[1]/h[1],g=1/f,v=1/m,y=2*pe(g)+2,x=2*pe(v)+2,E=0;E<r;E++)for(var T=E*e.strides[0],b=0;b<o;b++)for(var w=T+b*e.strides[1],S=$(b*g),C=$(S-y/2),A=0;A<a;A++)for(var N=w+A*e.strides[2],z=$(A*v),R=$(z-x/2),I=0;I<i;I++){for(var k=0,D=0,O;D<y;D++)if(O=D+C,!(0>O||O>=u)){var P=T+O*W.strides[1],M=O*f;if(b===le(o-1,t?_(M):$(M)))for(var F=0,L;F<x;F++)if(L=F+R,!(0>L||L>=c)){var B=P+L*W.strides[2],G=L*m;A===le(a-1,t?_(G):$(G))&&(k+=p[B+I])}}l[N+I]=k}return Qt(l,e.shape,e.dtype)},t.prototype.batchNormalization=function(b,e,t,n,r,o){this.assertNotComplex([b,e,t,r,o],"batchNorm");for(var a=b.dataSync(),i=e.dataSync(),s=t.dataSync(),u=r?r.dataSync():new Float32Array([1]),c=o?o.dataSync():new Float32Array([0]),l=new Float32Array(a.length),p=c.length,d=u.length,h=s.length,f=i.length,m=0,g=0,v=0,y=0,x=0;x<a.length;++x)l[x]=c[m++]+(a[x]-i[g++])*u[v++]/C(s[y++]+n),m>=p&&(m=0),g>=f&&(g=0),v>=d&&(v=0),y>=h&&(y=0);return Qt(l,b.shape)},t.prototype.localResponseNormalization4D=function(m,g,e,t,n){function r(t){for(var e=t%l,n=t-e+de(0,e-g),r=t-e+le(e+g,a),o=0,s;n<=r;n++)s=i[n],o+=s*s;return o}this.assertNotComplex(m,"localResponseNormalization4D");for(var l=m.shape[3],a=l-1,i=m.dataSync(),s=m.size,u=new Float32Array(s),c=0;c<s;c++){var p=r(c),d=i[c]*b(e+t*p,-n);u[c]=d}return Qt(u,m.shape)},t.prototype.LRNGrad=function(C,e,t,n,r,o,a){this.assertNotComplex(C,"LRNGrad");for(var R=C.shape[3],s=C.dataSync(),u=e.dataSync(),c=t.dataSync(),l=new Float32Array(C.size),p=C.size,d=0;d<p;d++){for(var h=d%R,f=d-h+de(0,h-n),m=d-h+le(R,h+n+1),g=0,v=f;v<m;v++)g+=b(u[v],2);for(g=o*g+r,v=f;v<m;v++){var y=-2*o*a*u[v]*c[d]/g;d===v&&(y+=b(g,-a)),y*=s[d],l[v]+=y}}return Qt(l,C.shape)},t.prototype.multinomial=function(x,e,t,n){this.assertNotComplex(x,"multinomial");for(var r=e?x:Ci(x),o=r.shape[0],a=r.shape[1],i=ta([o,t],"int32"),s=i.dataSync(),u=r.dataSync(),c=0;c<o;++c){var l=c*a,p=new Float32Array(a-1);p[0]=u[l];for(var d=1;d<p.length;++d)p[d]=p[d-1]+u[l+d];for(var h=Md(n.toString()),f=c*t,m=0,g;m<t;++m){g=h(),s[f+m]=p.length;for(var b=0;b<p.length;b++)if(g<p[b]){s[f+m]=b;break}}}return i},t.prototype.oneHot=function(s,e,t,n){this.assertNotComplex(s,"oneHot");var r=new Float32Array(s.size*e);r.fill(n);for(var o=s.dataSync(),a=0;a<s.size;++a)0<=o[a]&&o[a]<e&&(r[a*e+o[a]]=t);return Xt(r,[s.size,e],"int32")},t.prototype.nonMaxSuppression=function(a,e,t,n,r){return this.assertNotComplex(a,"nonMaxSuppression"),ga(a.dataSync(),e.dataSync(),t,n,r)},t.prototype.fft=function(t){return this.fftBatch(t,!1)},t.prototype.ifft=function(t){return this.fftBatch(t,!0)},t.prototype.fftBatch=function(m,e){for(var t=m.shape[0],n=m.shape[1],r=jn(m.shape,"float32"),o=jn(m.shape,"float32"),a=Ei(m).as2D(t,n),i=_i(m).as2D(t,n),s=0;s<t;s++)for(var u=a.slice([s,0],[1,n]),c=i.slice([s,0],[1,n]),l=Si(u,c),p=this.fftImpl(l,e).dataSync(),d=0,h;d<n;d++)h=ua(p,d),r.values[s*n+d]=h.real,o.values[s*n+d]=h.imag;return Si(r.toTensor(),o.toTensor()).as2D(t,n)},t.prototype.fftImpl=function(s,e){var t=s.as1D(),n=t.size;if(this.isExponentOf2(n)){var r=this.fftRadix2(t,n,e).as2D(s.shape[0],s.shape[1]);return e&&(r=Si(Ei(r).div(Kt(n)),_i(r).div(Kt(n)))),r}var o=s.dataSync(),a=pa(this.fourierTransformByMatmul(o,n,e));return Si(a.real,a.imag).as2D(s.shape[0],s.shape[1])},t.prototype.isExponentOf2=function(t){return 0==(t&t-1)},t.prototype.fftRadix2=function(m,e,t){if(1===e)return m;var n=m.dataSync(),r=e/2,o=da(n),a=Si(o.real,o.imag).as1D(),i=la(n),s=Si(i.real,i.imag).as1D();a=this.fftRadix2(a,r,t),s=this.fftRadix2(s,r,t);var u=ha(e,t),c=Si(u.real,u.imag).mul(s),l=a.add(c),p=a.sub(c),d=Ei(l).concat(Ei(p)),h=_i(l).concat(_i(p));return Si(d,h).as1D()},t.prototype.fourierTransformByMatmul=function(p,e,t){for(var n=new Float32Array(2*e),r=0;r<e;r++){for(var o=0,a=0,i=0;i<e;i++){var s=ma(r*i,e,t),d=ua(p,i);o+=d.real*s.real-d.imag*s.imag,a+=d.real*s.imag+d.imag*s.real}t&&(o/=e,a/=e),ca(n,o,a,r)}return n},t.prototype.depthToSpace=function(b,e,t){A("NHWC"===t,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+t}),A(1<e,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var n=b.shape[0],r=b.shape[1],o=b.shape[2],a=b.shape[3],i=r*e,s=o*e,u=a/(e*e),c=b.dataSync(),l=new Float32Array(n*i*s*u),p=0,d=0;d<n;++d)for(var h=0;h<i;++h)for(var f=$(h/e),m=h%e,g=0;g<s;++g)for(var v=$(g/e),y=(m*e+g%e)*u,x=0,C;x<u;++x)C=x+y+a*(v+o*(f+r*d)),l[p++]=c[C];return Qt(l,[n,i,s,u])},t.prototype.broadcastedBinaryOp=function(y,e,t,x){var n=Ea(y.shape,e.shape),r=jn(n,t),a=y.dataSync(),i=e.dataSync(),s=Ra(y.shape,n),u=Ra(e.shape,n),c=r.values;if(0===s.length+u.length)for(var o=0;o<c.length;++o)c[o]=x(a[o%a.length],i[o%i.length]);else{var l=y.bufferSync(),d=e.bufferSync(),p=function(t){var n=r.indexToLoc(t),o=n.slice(-y.rank);s.forEach(function(t){return o[t]=0});var p=l.locToIndex(o),h=n.slice(-e.rank);u.forEach(function(t){return h[t]=0});var m=d.locToIndex(h);c[t]=x(a[p],i[m])};for(o=0;o<c.length;++o)p(o)}return r.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(x,e,t){var n=Ea(x.shape,e.shape),b=jn(n,"float32"),o=jn(n,"float32"),C=x.dataSync(),i=e.dataSync(),s=Ra(x.shape,n),u=Ra(e.shape,n),c=b.values,l=o.values;if(0===s.length+u.length)for(var a=0;a<c.length;a++){var r=a%C.length,p=a%i.length,d=t(C[2*r],C[2*r+1],i[2*p],i[2*p+1]);c[a]=d.real,l[a]=d.imag}else{var R=this.data.get(x.dataId).complexTensors.real.bufferSync(),g=this.data.get(e.dataId).complexTensors.real.bufferSync(),h=function(o){var n=b.indexToLoc(o),a=n.slice(-x.rank);s.forEach(function(t){return a[t]=0});var r=R.locToIndex(a),p=n.slice(-e.rank);u.forEach(function(t){return p[t]=0});var d=g.locToIndex(p),h=t(C[2*r],C[2*r+1],i[2*d],i[2*d+1]);c[o]=h.real,l[o]=h.imag};for(a=0;a<c.length;a++)h(a)}return this.complex(b.toTensor(),o.toTensor())},t.prototype.split=function(a,e,t){return ya(a,e,t)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.cropAndResize=function(Y,e,t,n,r,o){for(var a=Y.shape,i=a[0],s=a[1],u=a[2],c=a[3],l=e.shape[0],p=n[0],d=n[1],h=jn([l,p,d,c],Y.dtype),f=e.dataSync(),m=t.dataSync(),g=Y.dataSync(),v=Y.strides,y=h.strides,x=0;x<l;x++){var E=4*x,T=f[E],b=f[E+1],w=f[E+2],S=f[E+3],C=m[x];if(!(C>=i))for(var A=1<p?(w-T)*(s-1)/(p-1):0,N=1<d?(S-b)*(u-1)/(d-1):0,Q=0,R;Q<p;Q++)if(R=1<p?T*(s-1)+Q*A:.5*(T+w)*(s-1),0>R||R>s-1)for(var I=0;I<d;I++)for(var k=0,D;k<c;k++)D=k+I*y[2]+Q*y[1]+x*y[0],h.values[D]=o;else if("bilinear"===r){var O=$(R),P=pe(R),M=R-O;for(I=0;I<d;I++)if(0>(H=1<d?b*(u-1)+I*N:.5*(b+S)*(u-1))||H>u-1)for(k=0;k<c;k++)D=k+I*y[2]+Q*y[1]+x*y[0],h.values[D]=o;else{var F=$(H),L=pe(H),B=H-F;for(k=0;k<c;k++){var V=g[D=k+F*v[2]+O*v[1]+C*v[0]],U=g[D=k+L*v[2]+O*v[1]+C*v[0]],z=g[D=k+F*v[2]+P*v[1]+C*v[0]],W=V+(U-V)*B,G=z+(g[D=k+L*v[2]+P*v[1]+C*v[0]]-z)*B;D=k+I*y[2]+Q*y[1]+x*y[0],h.values[D]=W+(G-W)*M}}}else for(I=0;I<d;++I){var H;if(0>(H=1<d?b*(u-1)+I*N:.5*(b+S)*(u-1))||H>u-1)for(k=0;k<c;k++)D=k+I*y[2]+Q*y[1]+x*y[0],h.values[D]=o;else{var q=_(H),Z=_(R);for(k=0;k<c;k++){var K=k+q*v[2]+Z*v[1]+C*v[0],X=k+I*y[2]+Q*y[1]+x*y[0];h.values[X]=g[K]}}}}return h.toTensor()},t.prototype.sparseToDense=function(p,e,t,n){var r=Ft(e,p,t),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,d=r.outputSize;return this.scatter(p,e,t,d,i,a,o,s,n,!1)},t.prototype.gatherND=function(y,e){var t=e.shape,n=t[t.length-1],r=Dt(y,e),o=r[0],a=r[1],i=r[2],s=r[3];if(0===a)return $t([],o,y.dtype);for(var u=new Gs([a,i],y.dtype),c=e.dataSync(),l=y.dataSync(),p=0;p<a;p++){for(var d=[],h=0,f=0,m;f<n;f++)m=c[p*n+f],h+=m*s[f],d.push(m);if(0>h||h>=y.size/i)throw new Error("Invalid indices: "+d+" does not index into "+y.shape);for(var g=0;g<i;g++)u.values[p*i+g]=l[h*i+g]}return u.toTensor().reshape(o)},t.prototype.scatterND=function(p,e,t){var n=Ft(e,p,t),r=n.sliceRank,o=n.numUpdates,a=n.sliceSize,i=n.strides,s=n.outputSize,d=Kt(0);return this.scatter(p,e,t,s,a,o,r,i,d,!0)},t.prototype.fill=function(a,e,t){var o=Y(t=t||se(e),U(a));return o.fill(e),$s.make(a,{values:o},t)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(a){var e=Y(a.dtype,U(a.shape));return $s.make(a.shape,{values:e},a.dtype)},t.prototype.scatter=function(l,e,t,n,r,o,a,i,s,u){var c=l.dataSync(),p=e.dataSync();if(0===n)return $t([],t,e.dtype);var d=new Gs([n/r,r],e.dtype);d.values.fill(s.dataSync()[0]);for(var h=0;h<o;h++){for(var f=[],m=0,g=0,b;g<a;g++)b=c[h*a+g],f.push(b),m+=b*i[g];if(0>m||m>=n/r)throw new Error("Invalid indices: "+f+" does not index into "+t);for(var y=0;y<r;y++)u?d.values[m*r+y]+=p[h*r+y]:d.values[m*r+y]=0===e.rank?p[0]:p[h*r+y]}return d.toTensor().reshape(t)},t}();hi.registerBackend("cpu",function(){return new hh},1);var mh="undefined"==typeof requestAnimationFrame?"undefined"==typeof e?function(t){return t()}:e:requestAnimationFrame,gh={float32:4,int32:4,uint16:2,uint8:1,bool:1},fh="undefined"!=typeof f&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa),yh=function(){function a(){this.saveRouters=[],this.loadRouters=[]}return a.getInstance=function(){return null==a.instance&&(a.instance=new a),a.instance},a.registerSaveRouter=function(e){a.getInstance().saveRouters.push(e)},a.registerLoadRouter=function(e){a.getInstance().loadRouters.push(e)},a.getSaveHandlers=function(e){return a.getHandlers(e,"save")},a.getLoadHandlers=function(e,t){return a.getHandlers(e,"load",t)},a.getHandlers=function(s,e,t){var r=[];return("load"===e?a.getInstance().loadRouters:a.getInstance().saveRouters).forEach(function(a){var e=a(s,t);null!==e&&r.push(e)}),r},a}(),xh="://",bh=function(){function a(){this.managers={}}return a.getInstance=function(){return null==a.instance&&(a.instance=new a),a.instance},a.registerManager=function(e,t){A(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(xh)&&(e=e.slice(0,e.indexOf(xh))),A(0<e.length,function(){return"scheme must not be an empty string."});var o=a.getInstance();A(null==o.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),o.managers[e]=t},a.getManager=function(a){var e=this.getInstance().managers[a];if(null==e)throw new Error("Cannot find model manager for scheme '"+a+"'");return e},a.getSchemes=function(){return Object.keys(this.getInstance().managers)},a}(),vh="tensorflowjs",Ch=1,Rh="models_store",Sh="model_info_store",Eh=function(){function t(t){if(this.indexedDB=hs(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return x(this,void 0,void 0,function(){return R(this,function(){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return x(this,void 0,void 0,function(){return R(this,function(){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(a,h){var m=this;return new Promise(function(n,e){var r=m.indexedDB.open(vh,Ch);r.onupgradeneeded=function(){return ms(r)},r.onsuccess=function(){var g=r.result;if(null==h){var a=g.transaction(Rh,"readonly"),o=a.objectStore(Rh).get(m.modelPath);o.onsuccess=function(){return null==o.result?(g.close(),e(new Error("Cannot find model with path '"+m.modelPath+"' in IndexedDB."))):void n(o.result.modelArtifacts)},o.onerror=function(){return g.close(),e(o.error)},a.oncomplete=function(){return g.close()}}else{var s=ls(h),i=g.transaction(Sh,"readwrite"),l=i.objectStore(Sh),p=l.put({modelPath:m.modelPath,modelArtifactsInfo:s}),d;p.onsuccess=function(){var a=(d=g.transaction(Rh,"readwrite")).objectStore(Rh).put({modelPath:m.modelPath,modelArtifacts:h,modelArtifactsInfo:s});a.onsuccess=function(){return n({modelArtifactsInfo:s})},a.onerror=function(){var o=(l=i.objectStore(Sh)).delete(m.modelPath);o.onsuccess=function(){return g.close(),e(a.error)},o.onerror=function(){return g.close(),e(a.error)}}},p.onerror=function(){return g.close(),e(p.error)},i.oncomplete=function(){null==d?g.close():d.oncomplete=function(){return g.close()}}}},r.onerror=function(){return e(r.error)}})},t.URL_SCHEME="indexeddb://",t}(),_h=function(t){return hi.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Eh.URL_SCHEME)?gs(t.slice(Eh.URL_SCHEME.length)):null};yh.registerSaveRouter(_h),yh.registerLoadRouter(_h);var kh=function(){function t(){this.indexedDB=hs()}return t.prototype.listModels=function(){return x(this,void 0,void 0,function(){var a=this;return R(this,function(){return[2,new Promise(function(s,t){var n=a.indexedDB.open(vh,Ch);n.onupgradeneeded=function(){return ms(n)},n.onsuccess=function(){var r=n.result,e=r.transaction(Sh,"readonly"),i=e.objectStore(Sh).getAll();i.onsuccess=function(){for(var t={},e=0,a=i.result,n;e<a.length;e++)n=a[e],t[n.modelPath]=n.modelArtifactsInfo;s(t)},i.onerror=function(){return r.close(),t(i.error)},e.oncomplete=function(){return r.close()}},n.onerror=function(){return t(n.error)}})]})})},t.prototype.removeModel=function(p){return x(this,void 0,void 0,function(){var e=this;return R(this,function(){return p=fs(p),[2,new Promise(function(t,n){var r=e.indexedDB.open(vh,Ch);r.onupgradeneeded=function(){return ms(r)},r.onsuccess=function(){var e=r.result,a=e.transaction(Sh,"readwrite"),d=a.objectStore(Sh),s=d.get(p),i;s.onsuccess=function(){if(null==s.result)return e.close(),n(new Error("Cannot find model with path '"+p+"' in IndexedDB."));var a=d.delete(p),o=function(){var a=(i=e.transaction(Rh,"readwrite")).objectStore(Rh).delete(p);a.onsuccess=function(){return t(s.result.modelArtifactsInfo)},a.onerror=function(){return n(s.error)}};a.onsuccess=o,a.onerror=function(){return o(),e.close(),n(s.error)}},s.onerror=function(){return e.close(),n(s.error)},a.oncomplete=function(){null==i?e.close():i.oncomplete=function(){return e.close()}}},r.onerror=function(){return n(r.error)}})]})})},t}();if(hi.get("IS_BROWSER"))try{bh.registerManager(Eh.URL_SCHEME,new kh)}catch(t){}var wh="/",Ih="tensorflowjs_models",Nh="info",Th="model_topology",Dh="weight_specs",Ah="weight_data",Oh="model_metadata",Ph=function(){function t(t){if(!hi.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=ys(this.modelPath)}return t.prototype.save=function(a){return x(this,void 0,void 0,function(){var e,t,o;return R(this,function(){if(a.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(a.modelTopology),t=JSON.stringify(a.weightSpecs),o=ls(a);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,t),this.LS.setItem(this.keys.weightData,ss(a.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy})),[2,{modelArtifactsInfo:o}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return x(this,void 0,void 0,function(){var s,e,t,n,r,o,a;return R(this,function(){if(null==(s=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==s.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(t=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=t,null==(n=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=n,null!=(r=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(r),e.format=o.format,e.generatedBy=o.generatedBy,e.convertedBy=o.convertedBy),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=is(a),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),Fh=function(t){return hi.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ph.URL_SCHEME)?vs(t.slice(Ph.URL_SCHEME.length)):null};yh.registerSaveRouter(Fh),yh.registerLoadRouter(Fh);var Bh=function(){function t(){A(hi.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),A(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return x(this,void 0,void 0,function(){var s,e,t,n,r,o;return R(this,function(){for(s={},e=Ih+wh,t=wh+Nh,n=0;n<this.LS.length;++n)(r=this.LS.key(n)).startsWith(e)&&r.endsWith(t)&&(o=xs(r),s[o]=JSON.parse(this.LS.getItem(r)));return[2,s]})})},t.prototype.removeModel=function(a){return x(this,void 0,void 0,function(){var e,t;return R(this,function(){if(a=bs(a),e=ys(a),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+a+"'");return t=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,t]})})},t}();if(hi.get("IS_BROWSER"))try{bh.registerManager(Ph.URL_SCHEME,new Bh)}catch(t){}var Lh=function(){function a(e){if(!hi.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(a.URL_SCHEME)&&(e=e.slice(a.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return a.prototype.save=function(s){return x(this,void 0,void 0,function(){var e,t,p,r,o,a;return R(this,function(){if(e=window.URL.createObjectURL(new Blob([s.weightData],{type:"application/octet-stream"})),s.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return t=[{paths:["./"+this.weightDataFileName],weights:s.weightSpecs}],p={modelTopology:s.modelTopology,format:s.format,generatedBy:s.generatedBy,convertedBy:s.convertedBy,weightsManifest:t},r=window.URL.createObjectURL(new Blob([JSON.stringify(p)],{type:"application/json"})),(o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=r,o.click(),null!=s.weightData&&((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=e,a.click()),[2,{modelArtifactsInfo:ls(s)}]})})},a.URL_SCHEME="downloads://",a}(),Mh=function(){function t(t){if(null==t||1>t.length)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return x(this,void 0,void 0,function(){var a=this,n,e;return R(this,function(){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(h,t){var o=new FileReader;o.onload=function(o){var r=JSON.parse(o.target.result),i=r.modelTopology;if(null!=i){0===e.length&&h({modelTopology:i});var m=r.weightsManifest;if(null!=m){var u;try{u=a.checkManifestAndWeightFiles(m,e)}catch(a){return void t(a)}var c=[],g=[],p=[];m.forEach(function(t){t.paths.forEach(function(t){g.push(t),p.push(null)}),c.push.apply(c,t.weights)}),m.forEach(function(a){a.paths.forEach(function(a){var e=new FileReader;e.onload=function(e){var t=e.target.result,n=g.indexOf(a);p[n]=t,-1===p.indexOf(null)&&h({modelTopology:i,weightSpecs:c,weightData:ps(p)})},e.onerror=function(){return t("Failed to weights data from file of path '"+a+"'.")},e.readAsArrayBuffer(u[a])})})}else t(new Error("weightManifest field is missing from file "+n.name))}else t(new Error("modelTopology field is missing from file "+n.name))},o.onerror=function(){return t("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},o.readAsText(n)})]})})},t.prototype.checkManifestAndWeightFiles=function(s,p){for(var t=[],n=p.map(function(t){return ds(t.name)}),r={},e=0,a=s;e<a.length;e++)a[e].paths.forEach(function(o){var e=ds(o);if(-1!==t.indexOf(e))throw new Error("Duplicate file basename found in weights manifest: '"+e+"'");if(t.push(e),-1===n.indexOf(e))throw new Error("Weight file with basename '"+e+"' is not provided.");r[o]=p[n.indexOf(e)]});if(t.length!==p.length)throw new Error("Mismatch in the number of files in weights manifest ("+t.length+") and the number of weight files provided ("+p.length+").");return r},t}();yh.registerSaveRouter(function(t){return hi.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Lh.URL_SCHEME)?Cs(t.slice(Lh.URL_SCHEME.length)):null});var Wh=function(){function t(a,o){if(this.DEFAULT_METHOD="POST",null==o&&(o={}),this.weightPathPrefix=o.weightPathPrefix,this.onProgress=o.onProgress,null==o.fetchFunc){var t=hi.global.fetch;if(void 0===t)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");o.fetchFunc=t.bind(hi.global)}else A("function"==typeof o.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(a,e){return o.fetchFunc(a,e).catch(function(e){throw new Error("Request for "+a+" failed due to error: "+e)})},A(null!=a&&0<a.length,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(a)&&A(2===a.length,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+a.length+")."}),this.path=a,null!=o.requestInit&&null!=o.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=o.requestInit||{}}return t.prototype.save=function(s){return x(this,void 0,void 0,function(){var e,t,i,r;return R(this,function(o){switch(o.label){case 0:if(s.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t=[{paths:["./model.weights.bin"],weights:s.weightSpecs}],i={modelTopology:s.modelTopology,format:s.format,generatedBy:s.generatedBy,convertedBy:s.convertedBy,weightsManifest:t},e.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),null!=s.weightData&&e.body.append("model.weights.bin",new Blob([s.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,e)];case 1:if((r=o.sent()).ok)return[2,{modelArtifactsInfo:ls(s),responses:[r]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+r.status+".");}})})},t.prototype.load=function(){return x(this,void 0,void 0,function(){var p,e,t,n,d,o,l,c;return R(this,function(s){switch(s.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(p=s.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+p.status+". Please verify this URL points to the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,p.json()];case 3:return e=s.sent(),[3,5];case 4:throw s.sent(),t="Failed to parse model JSON of response from "+this.path+".",t+=this.path.endsWith(".pb")?" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":" Please make sure the server is serving valid JSON for this request.",new Error(t);case 5:if(n=e.modelTopology,d=e.weightsManifest,null==n&&null==d)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==d?[3,7]:[4,this.loadWeights(d)];case 6:c=s.sent(),o=c[0],l=c[1],s.label=7;case 7:return[2,{modelTopology:n,weightSpecs:o,weightData:l}];}})})},t.prototype.loadWeights=function(h){return x(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s,d,u,l;return R(this,function(p){switch(p.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,t=_s(e),n=t[0],r=t[1],o=this.weightPathPrefix||n,a=[],i=0,s=h;i<s.length;i++)d=s[i],a.push.apply(a,d.weights);return u=[],h.forEach(function(t){t.paths.forEach(function(t){u.push(o+t+r)})}),[4,Ss(u,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return l=p.sent(),[2,[a,ps(l)]];}})})},t.prototype.getFetchFunc=function(){return this.fetchFunc},t.URL_SCHEME_REGEX=/^https?:\/\//,t}(),Uh=function(a,e){return"undefined"==typeof fetch?null:(Array.isArray(a)?a.every(function(t){return ks(t)}):ks(a))?ws(a,{onProgress:e}):null};yh.registerSaveRouter(Uh),yh.registerLoadRouter(Uh);var zh=function(){function t(a,o,t){this.modelTopology=a,this.weightSpecs=o,this.weightData=t}return t.prototype.load=function(){return x(this,void 0,void 0,function(){var t;return R(this,function(){return t={},null!=this.modelTopology&&(t=Os({modelTopology:this.modelTopology},t)),null!=this.weightSpecs&&0<this.weightSpecs.length&&(t=Os({weightSpecs:this.weightSpecs},t)),null!=this.weightData&&0<this.weightData.byteLength&&(t=Os({weightData:this.weightData},t)),[2,t]})})},t}(),Gh=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return x(this,void 0,void 0,function(){return R(this,function(){return[2,this.saveHandler(t)]})})},t}(),Vh=Object.freeze({browserFiles:function(t){return new Mh(t)},browserHTTPRequest:ws,concatenateArrayBuffers:ps,decodeWeights:os,encodeWeights:function(a){return x(this,void 0,void 0,function(){var e,s,n,i;return R(this,function(o){switch(o.label){case 0:for(n in e=[],s=[],a){if("float32"!==(i=a[n]).dtype&&"int32"!==i.dtype&&"bool"!==i.dtype)throw new Error("Unsupported dtype in weight '"+n+"': "+i.dtype);e.push({name:n,shape:i.shape,dtype:i.dtype}),s.push(i.data())}return[4,Promise.all(s)];case 1:return[2,{data:ns(o.sent()),specs:e}];}})})},fromMemory:function(a,e,t){return new zh(a,e,t)},getLoadHandlers:function(t){return yh.getLoadHandlers(t)},getModelArtifactsInfoForJSON:ls,getSaveHandlers:function(t){return yh.getSaveHandlers(t)},isHTTPScheme:ks,loadWeights:function(a,e,t,o){return void 0===e&&(e=""),x(this,void 0,void 0,function(){return R(this,function(){return[2,Es(function(t){return Ss(t,{requestInit:o})})(a,e,t)]})})},registerLoadRouter:function(t){return yh.registerLoadRouter(t)},registerSaveRouter:function(t){return yh.registerSaveRouter(t)},weightsLoaderFactory:Es,withSaveHandler:function(t){return new Gh(t)},copyModel:function(a,e){return x(this,void 0,void 0,function(){return R(this,function(t){switch(t.label){case 0:return[4,cs(a,e,!1)];case 1:return[2,t.sent()];}})})},listModels:function(){return x(this,void 0,void 0,function(){var p,e,t,n,r,o,a;return R(this,function(i){switch(i.label){case 0:p=bh.getSchemes(),e={},t=0,n=p,i.label=1;case 1:return t<n.length?(r=n[t],[4,bh.getManager(r).listModels()]):[3,4];case 2:for(a in o=i.sent())e[r+xh+a]=o[a];i.label=3;case 3:return t++,[3,1];case 4:return[2,e];}})})},moveModel:function(a,e){return x(this,void 0,void 0,function(){return R(this,function(t){switch(t.label){case 0:return[4,cs(a,e,!0)];case 1:return[2,t.sent()];}})})},removeModel:function(a){return x(this,void 0,void 0,function(){var e;return R(this,function(t){switch(t.label){case 0:return e=us(a),[4,bh.getManager(e.scheme).removeModel(e.path)];case 1:return[2,t.sent()];}})})}}),io=qt({confusionMatrix_:function(s,e,t){var n=st(s,"labels","confusionMatrix"),r=st(e,"predictions","confusionMatrix");A(null==t||0<t&&h(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),A(1===n.rank,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),A(1===r.rank,function(){return"Expected the rank of predictions to be 1, but got "+r.rank}),A(n.shape[0]===r.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+r.shape[0]+". Labels and predictions should have the same number of elements."}),A(0<t&&h(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=jd(n.asType("int32"),t),a=jd(r.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}}),Hh=Object.freeze({confusionMatrix:io}),qh=qt({fromPixels_:function(a,e){if(void 0===e&&(e=3),4<e)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return hi.engine.fromPixels(a,e)}}),$h=Object.freeze({toPixels:function(C,e){return x(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,c,l,p,d,h,f,m,g,v,y,x,S;return R(this,function(R){switch(R.label){case 0:if(t=st(C,"img","toPixels"),C instanceof $s||(t=t.toInt()),2!==t.rank&&3!==t.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),r=n[0],o=n[1],4<(a=2===t.rank?1:t.shape[2])||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return i=t.min(),s=t.max(),[4,i.data()];case 1:return u=R.sent()[0],[4,s.data()];case 2:if(!(c=R.sent()[0],i.dispose(),s.dispose(),"float32"===t.dtype)){if("int32"!==t.dtype)throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(0>u||255<c)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+u+" - "+c+"].")}else if(0>u||1<c)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+u+" - "+c+"].");return[4,t.data()];case 3:for(l=R.sent(),p="float32"===t.dtype?255:1,d=new Uint8ClampedArray(4*(o*r)),h=0;h<r*o;++h)f=void 0,m=void 0,g=void 0,v=void 0,1===a?(f=l[h]*p,m=l[h]*p,g=l[h]*p,v=255):3===a?(f=l[3*h]*p,m=l[3*h+1]*p,g=l[3*h+2]*p,v=255):4===a&&(f=l[4*h]*p,m=l[4*h+1]*p,g=l[4*h+2]*p,v=l[4*h+3]*p),d[(y=4*h)+0]=_(f),d[y+1]=_(m),d[y+2]=_(g),d[y+3]=_(v);return null!=e&&(e.width=o,e.height=r,x=e.getContext("2d"),S=new ImageData(d,o,r),x.putImageData(S,0,0)),t!==C&&t.dispose(),[2,d];}})})},fromPixels:qh}),Kh=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(a,e){return new a(e)},t}(),jh=function(){function a(){this.classNameMap={}}return a.getMap=function(){return null==a.instance&&(a.instance=new a),a.instance},a.register=function(e){a.getMap().classNameMap[e.className]=[e,e.fromConfig]},a}(),Xh=Object.freeze({Serializable:Kh,SerializationMap:jh,registerClass:Is}),Yh=Object.freeze({WEBGL_ENVS:{HAS_WEBGL:!0},PACKED_ENVS:{WEBGL_PACK:!0},NODE_ENVS:{IS_NODE:!0},CHROME_ENVS:{IS_CHROME:!0},BROWSER_ENVS:{IS_BROWSER:!0},CPU_ENVS:{HAS_WEBGL:!1},ALL_ENVS:{},expectArraysClose:Ns,expectPromiseToFail:function(a,e){a().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(a,e){var o="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return a instanceof $s&&"string"===a.dtype||e instanceof $s&&"string"===e.dtype||Array.isArray(a)&&oe(a[0])||Array.isArray(e)&&oe(e[0])?Ts(a,o,function(a,e){return a==e}):Ns(a,e,0)},expectNumbersClose:function(a,e,t){if(null==t&&(t=hi.get("TEST_EPSILON")),!Ds(a,e,t))throw new Error("Numbers differ: actual === "+a+", expected === "+e)},expectValuesInRange:function(a,e,t){var n=a instanceof $s?a.dataSync():a;for(var r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error("Value out of range:"+n[r]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function(a,e){expect(new Float32Array(a)).toEqual(new Float32Array(e))}}),Qh="1.0.3",Zh=Object.freeze({gpgpu_util:wp,webgl_util:kp,MathBackendWebGL:hl,GPGPUContext:Ip}),Jh=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return y(e,a),e.prototype.minimize=function(s,e,t){void 0===e&&(e=!1);var n=this.computeGradients(s,t),r=n.value,o=n.grads;return this.applyGradients(o),Object.keys(o).forEach(function(t){return o[t].dispose()}),e?r:(r.dispose(),null)},e.prototype.computeGradients=function(a,e){return ct(a,e)},e.prototype.dispose=function(){},e}(Kh);Object.defineProperty(Jh,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var em=function(a){function e(e,s,n){void 0===n&&(n=null);var r=a.call(this)||this;return r.learningRate=e,r.rho=s,r.epsilon=n,r.accumulatedGrads={},r.accumulatedUpdates={},r.c=fi(Kt(-e)),r.rhoScalar=fi(Kt(s)),r.oneMinusRho=fi(Kt(1-s)),null===n&&(n=hi.get("EPSILON")),r.epsilonScalar=fi(Kt(n)),r}return y(e,a),e.prototype.applyGradients=function(p){var d=this,e=function(l){var n=hi.engine.registeredVariables[l];null==t.accumulatedGrads[l]&&gi(function(){d.accumulatedGrads[l]=wi(n).variable(!1)}),null==t.accumulatedUpdates[l]&&gi(function(){d.accumulatedUpdates[l]=wi(n).variable(!1)});var o=p[l],a=t.accumulatedGrads[l],i=t.accumulatedUpdates[l];gi(function(){var t=d.rhoScalar.mul(a).add(d.oneMinusRho.mul(o.square())),e=i.add(d.epsilonScalar).sqrt().div(a.add(d.epsilonScalar).sqrt()).mul(o),r=d.rhoScalar.mul(i).add(d.oneMinusRho.mul(e.square()));d.accumulatedGrads[l].assign(t),d.accumulatedUpdates[l].assign(r);var s=d.c.mul(e).add(n);n.assign(s)})},t=this;for(var a in p)e(a)},e.prototype.dispose=function(){var a=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return a.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return a.accumulatedGrads[e].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(a,e){return new a(e.learningRate,e.rho,e.epsilon)},e.className="AdadeltaOptimizer",e}(Jh);Is(em);var tm=function(a){function e(e,o){void 0===o&&(o=.1);var n=a.call(this)||this;return n.learningRate=e,n.initialAccumulatorValue=o,n.accumulatedGrads={},n.c=fi(Kt(-e)),n.epsilon=fi(Kt(hi.get("EPSILON"))),n}return y(e,a),e.prototype.applyGradients=function(s){var p=this,e=function(d){var n=hi.engine.registeredVariables[d];null==t.accumulatedGrads[d]&&gi(function(){p.accumulatedGrads[d]=aa(n.shape,p.initialAccumulatorValue).variable(!1)});var o=s[d],a=t.accumulatedGrads[d];gi(function(){var t=a.add(o.square());p.accumulatedGrads[d].assign(t);var e=p.c.mul(o.div(t.add(p.epsilon).sqrt())).add(n);n.assign(e)})},t=this;for(var a in s)e(a)},e.prototype.dispose=function(){var a=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return a.accumulatedGrads[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(a,e){return new a(e.learningRate,e.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(Jh);Is(tm);var am=function(s){function e(e,i,n,r){void 0===r&&(r=null);var o=s.call(this)||this;return o.learningRate=e,o.beta1=i,o.beta2=n,o.epsilon=r,o.accumulatedFirstMoment={},o.accumulatedSecondMoment={},o.c=fi(Kt(-e)),o.beta1Scalar=fi(Kt(i)),o.beta2Scalar=fi(Kt(n)),gi(function(){o.accBeta1=Kt(i).variable(),o.accBeta2=Kt(n).variable()}),o.oneMinusBeta1=fi(Kt(1-i)),o.oneMinusBeta2=fi(Kt(1-n)),o.one=fi(Kt(1)),null===r&&(r=hi.get("EPSILON")),o.epsScalar=fi(Kt(r)),o}return y(e,s),e.prototype.applyGradients=function(m){var e=this;gi(function(){var t=e.one.sub(e.accBeta1),n=e.one.sub(e.accBeta2);for(var r in m){var o=hi.engine.registeredVariables[r];if(null==e.accumulatedFirstMoment[r]){var a=!1;e.accumulatedFirstMoment[r]=wi(o).variable(a)}null==e.accumulatedSecondMoment[r]&&(a=!1,e.accumulatedSecondMoment[r]=wi(o).variable(a));var i=m[r],s=e.accumulatedFirstMoment[r],u=e.accumulatedSecondMoment[r],c=e.beta1Scalar.mul(s).add(e.oneMinusBeta1.mul(i)),l=e.beta2Scalar.mul(u).add(e.oneMinusBeta2.mul(i.square())),p=c.div(t),d=l.div(n);e.accumulatedFirstMoment[r].assign(c),e.accumulatedSecondMoment[r].assign(l);var h=e.c.mul(p.div(e.epsScalar.add(d.sqrt()))).add(o);o.assign(h)}e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar)),e.accBeta2.assign(e.accBeta2.mul(e.beta2Scalar))})},e.prototype.dispose=function(){var a=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return a.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(e){return a.accumulatedSecondMoment[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(a,e){return new a(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="AdamOptimizer",e}(Jh);Is(am);var om=function(s){function e(e,p,n,r,o){void 0===r&&(r=null),void 0===o&&(o=0);var a=s.call(this)||this;return a.learningRate=e,a.beta1=p,a.beta2=n,a.epsilon=r,a.decay=o,a.accumulatedFirstMoment={},a.accumulatedWeightedInfNorm={},a.c=fi(Kt(-e)),a.beta1Scalar=fi(Kt(p)),a.beta2Scalar=fi(Kt(n)),a.decayScalar=fi(Kt(o)),gi(function(){a.iteration=Kt(0).variable(),a.accBeta1=Kt(p).variable()}),a.oneMinusBeta1=fi(Kt(1-p)),a.one=fi(Kt(1)),null===r&&(r=hi.get("EPSILON")),a.epsScalar=fi(Kt(r)),a}return y(e,s),e.prototype.applyGradients=function(m){var e=this;gi(function(){var t=e.one.sub(e.accBeta1),n=e.c.div(e.one.add(e.decayScalar.mul(e.iteration)));for(var r in m){var o=hi.engine.registeredVariables[r];if(null==e.accumulatedFirstMoment[r]){var a=!1;e.accumulatedFirstMoment[r]=wi(o).variable(a)}null==e.accumulatedWeightedInfNorm[r]&&(a=!1,e.accumulatedWeightedInfNorm[r]=wi(o).variable(a));var i=m[r],s=e.accumulatedFirstMoment[r],u=e.accumulatedWeightedInfNorm[r],c=e.beta1Scalar.mul(s).add(e.oneMinusBeta1.mul(i)),l=e.beta2Scalar.mul(u),p=i.abs(),d=l.maximum(p);e.accumulatedFirstMoment[r].assign(c),e.accumulatedWeightedInfNorm[r].assign(d);var h=n.div(t).mul(c.div(e.epsScalar.add(d))).add(o);o.assign(h)}e.iteration.assign(e.iteration.add(e.one)),e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar))})},e.prototype.dispose=function(){var a=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return a.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(e){return a.accumulatedWeightedInfNorm[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(a,e){return new a(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="AdamaxOptimizer",e}(Jh);Is(om);var nm=function(a){function e(e){var o=a.call(this)||this;return o.learningRate=e,o.setLearningRate(e),o}return y(e,a),e.prototype.applyGradients=function(a){var n=this;Object.keys(a).forEach(function(e){var t=a[e],r=hi.engine.registeredVariables[e];gi(function(){var a=n.c.mul(t).add(r);r.assign(a)})})},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=fi(Kt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(a,e){return new a(e.learningRate)},e.className="SGDOptimizer",e}(Jh);Is(nm);var rm=function(a){function e(e,s,n){void 0===n&&(n=!1);var r=a.call(this,e)||this;return r.learningRate=e,r.momentum=s,r.useNesterov=n,r.m=Kt(r.momentum),r.accumulations={},r}return y(e,a),e.prototype.applyGradients=function(s){var p=this,e=function(d){var n=hi.engine.registeredVariables[d];null==t.accumulations[d]&&gi(function(){p.accumulations[d]=wi(n).variable(!1)});var o=t.accumulations[d],a=s[d];gi(function(){var t=p.m.mul(o).add(a),r;r=p.useNesterov?p.c.mul(a.add(t.mul(p.m))).add(n):p.c.mul(t).add(n),p.accumulations[d].assign(t),n.assign(r)})},t=this;for(var a in s)e(a)},e.prototype.dispose=function(){if(a.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var e in this.accumulations)this.accumulations[e].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(a,e){return new a(e.learningRate,e.momentum,e.useNesterov)},e.className="MomentumOptimizer",e}(nm);Is(rm);var sm=function(s){function e(e,p,n,r,o){void 0===p&&(p=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1);var a=s.call(this)||this;return a.learningRate=e,a.decay=p,a.momentum=n,a.epsilon=r,a.accumulatedMeanSquares={},a.accumulatedMeanGrads={},a.accumulatedMoments={},a.c=fi(Kt(e)),a.decayScalar=fi(Kt(p)),a.momentumScalar=fi(Kt(n)),a.oneMinusDecay=fi(Kt(1-p)),a.centered=o,null===r&&(r=hi.get("EPSILON")),a.epsilonScalar=fi(Kt(r)),a}return y(e,s),e.prototype.applyGradients=function(p){var d=this,e=function(h){var n=hi.engine.registeredVariables[h];null==t.accumulatedMeanSquares[h]&&gi(function(){d.accumulatedMeanSquares[h]=wi(n).variable(!1)}),null==t.accumulatedMeanGrads[h]&&t.centered&&gi(function(){d.accumulatedMeanGrads[h]=wi(n).variable(!1)}),null==t.accumulatedMoments[h]&&gi(function(){d.accumulatedMoments[h]=wi(n).variable(!1)});var o=t.accumulatedMeanSquares[h],a=t.accumulatedMeanGrads[h],i=t.accumulatedMoments[h],s=p[h];gi(function(){var t=d.decayScalar.mul(o).add(d.oneMinusDecay.mul(s.square()));if(d.centered){var e=d.decayScalar.mul(a).add(d.oneMinusDecay.mul(s)),r=d.momentumScalar.mul(i).add(d.c.mul(s).div(t.sub(e.square().add(d.epsilonScalar)).sqrt()));d.accumulatedMeanSquares[h].assign(t),d.accumulatedMeanGrads[h].assign(e),d.accumulatedMoments[h].assign(r);var u=n.sub(r);n.assign(u)}else{var l=d.decayScalar.mul(o).add(d.oneMinusDecay.mul(s.square()));r=d.momentumScalar.mul(i).add(d.c.mul(s).div(l.add(d.epsilonScalar).sqrt())),d.accumulatedMeanSquares[h].assign(l),d.accumulatedMoments[h].assign(r),u=n.sub(r),n.assign(u)}})},t=this;for(var a in p)e(a)},e.prototype.dispose=function(){var a=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return a.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(e){return a.accumulatedMeanGrads[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return a.accumulatedMoments[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(a,e){return new a(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSPropOptimizer",e}(Jh);Is(sm);var im=function(){function t(){}return t.sgd=function(t){return new nm(t)},t.momentum=function(a,e,t){return void 0===t&&(t=!1),new rm(a,e,t)},t.rmsprop=function(a,e,t,n,r){return void 0===e&&(e=.9),void 0===t&&(t=0),void 0===n&&(n=null),void 0===r&&(r=!1),new sm(a,e,t,n,r)},t.adam=function(a,e,t,o){return void 0===a&&(a=.001),void 0===e&&(e=.9),void 0===t&&(t=.999),void 0===o&&(o=null),new am(a,e,t,o)},t.adadelta=function(a,e,t){return void 0===a&&(a=.001),void 0===e&&(e=.95),void 0===t&&(t=null),new em(a,e,t)},t.adamax=function(a,e,t,n,r){return void 0===a&&(a=.002),void 0===e&&(e=.9),void 0===t&&(t=.999),void 0===n&&(n=null),void 0===r&&(r=0),new om(a,e,t,n,r)},t.adagrad=function(a,e){return void 0===e&&(e=.1),new tm(a,e)},t}(),pm={sgd:im.sgd,momentum:im.momentum,adadelta:im.adadelta,adagrad:im.adagrad,rmsprop:im.rmsprop,adamax:im.adamax,adam:im.adam},dm=di.setBackend,lm=di.getBackend,um=di.disposeVariables,cm=di.memory;(function(t){Hs=t})(ch)}.call(this,a(123),a(15),a(148).setImmediate,a(119).Buffer)},121:function(e,t,a){"use strict";var b=Math.pow,B=Number.NEGATIVE_INFINITY,p=Math.log,o=String.fromCharCode,s=Math.sin,i=Math.cos,d=Math.PI,l=Math.abs,u=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,W=Number.POSITIVE_INFINITY,$=Math.floor,h=Number.isInteger,_=Math.round,pe=Math.ceil,C=Math.sqrt,m=Math.exp,n=Math.tanh,de=Math.max,le=Math.min;(function(r,g,e,f){function y(a,e){function t(){this.constructor=a}bs(a,e),a.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}function x(p,e,t,n){return new(t||(t=Promise))(function(r,o){function a(t){try{s(n.next(t))}catch(t){o(t)}}function i(t){try{s(n.throw(t))}catch(t){o(t)}}function s(o){o.done?r(o.value):new t(function(e){e(o.value)}).then(a,i)}s((n=n.apply(p,e||[])).next())})}function R(p,e){function t(t){return function(a){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&t[0]?n.return:t[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,t[1])).done)return r;switch(n=0,r&&(t=[2&t[0],r.value]),t[0]){case 0:case 1:r=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,n=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(r=0<(r=s.trys).length&&r[r.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!r||t[1]>r[0]&&t[1]<r[3])){s.label=t[1];break}if(6===t[0]&&s.label<r[1]){s.label=r[1],r=t;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(t);break}r[2]&&s.ops.pop(),s.trys.pop();continue;}t=e.call(p,s)}catch(a){t=[6,a],n=0}finally{i=r=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,a])}}var s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i,n,r,d;return d={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d}function v(a,e){Cs[a]=e}function S(a){a in Cs||(Cs[a]=E(a));var e=Cs[a];return e.isContextLost()?(delete Cs[a],S(a)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Cs[a])}function E(a){if(1!==a&&2!==a)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete Cs[a]},!1),1===a?e.getContext("webgl",Rs)||e.getContext("experimental-webgl",Rs):e.getContext("webgl2",Rs)}function k(){var t=navigator.userAgent||navigator.vendor||window.opera;return /(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}function w(a){for(var e=a.length,t=0,o=0;0<e;)o=0|Math.random()*e,t=a[--e],a[e]=a[o],a[o]=t}function I(a,e,t){return de(a,le(e,t))}function N(t){return 0==t%2?t:t+1}function T(a){for(var e=0,t=0;t<a.length;t++)e+=a[t];return e}function D(a,e){var t=Math.random();return e*t+(1-t)*a}function A(a,o){if(!a)throw new Error("string"==typeof o?o:o())}function O(a,e,t){void 0===t&&(t=""),A(L(a,e),function(){return t+" Shapes "+a+" and "+e+" must match"})}function P(t){A(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function F(a,e){if(void 0===e&&(e=[]),null==e&&(e=[]),Array.isArray(a)||ee(a))for(var t=0;t<a.length;++t)F(a[t],e);else e.push(a);return e}function U(a){if(0===a.length)return 1;for(var e=a[0],t=1;t<a.length;t++)e*=a[t];return e}function L(a,e){if(a===e)return!0;if(null==a||null==e)return!1;if(a.length!==e.length)return!1;for(var t=0;t<a.length;t++)if(a[t]!==e[t])return!1;return!0}function M(t){return 0==t%1}function z(a){if(null!=n)return n(a);if(a===1/0)return 1;if(a===-1/0)return-1;var e=m(2*a);return(e-1)/(e+1)}function G(a){var e=pe(C(a));return[e,pe(a/e)]}function V(a,e){return e<=a.length?a:a+" ".repeat(e-a.length)}function H(p,e,t){return void 0===e&&(e=function(){return 0}),new Promise(function(n,r){var o=0,a=function(){if(p())n();else{var i=e(++o);null!=t&&o>=t?r():setTimeout(a,i)}};a()})}function q(s,e){for(var t=1,n=-1,r=0;r<s.length;++r)if(0<=s[r])t*=s[r];else if(-1===s[r]){if(-1!==n)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+r);n=r}else if(0>s[r])throw Error("Shapes can not be < 0. Found "+s[r]+" at dim "+r);if(-1===n){if(0<e&&e!==t)throw Error("Size("+e+") must match the product of shape "+s);return s}if(0===t)throw Error("Cannot infer the missing size in ["+s+"] when there are 0 elements");if(0!=e%t)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=s.slice();return o[n]=e/t,o}function K(a,e){var t=e.length;return A((a=null==a?e.map(function(a,e){return e}):[].concat(a)).every(function(a){return a>=-t&&a<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+a}),A(a.every(function(t){return M(t)}),function(){return"All values in axis param must be integers but got axis "+a}),a.map(function(a){return 0>a?t+a:a})}function j(s,e){for(var t=[],p=[],d=null==e?null:K(e,s).sort(),o=0,a=0;a<s.length;++a){if(null!=d){if(d[o]===a&&1!==s[a])throw new Error("Can't squeeze axis "+a+" since its dim '"+s[a]+"' is not 1");(null==d[o]||d[o]>a)&&1===s[a]&&(t.push(s[a]),p.push(a)),d[o]<=a&&o++}1!==s[a]&&(t.push(s[a]),p.push(a))}return{newShape:t,keptDims:p}}function X(a,e){var t=null;if(null==a||"float32"===a)t=new Float32Array(e);else if("int32"===a)t=new Int32Array(e);else{if("bool"!==a)throw new Error("Unknown data type "+a);t=new Uint8Array(e)}return t}function Y(a,e){var t=null;if(null==a||"float32"===a)t=new Float32Array(e);else if("int32"===a)t=new Int32Array(e);else if("bool"===a)t=new Uint8Array(e);else{if("string"!==a)throw new Error("Unknown data type "+a);t=Array(e)}return t}function Q(a,e,t){if("float32"===e)for(var n=0,r;n<a.length;n++)if(r=a[n],isNaN(r)||!isFinite(r))throw Error("The result of the '"+t+"' is "+r+".")}function Z(a,e){for(var t=0,o;t<a.length;t++)if(o=a[t],isNaN(o)||!isFinite(o))throw Error("A tensor of type "+e+" being uploaded contains "+o+".")}function J(a,e){return"complex64"!==e&&("float32"!==e||"complex64"===a)&&("int32"!==e||"float32"===a||"complex64"===a)&&("bool"!==e||"bool"!==a)}function ee(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function te(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function ae(a){if(null==a)return 0;var o=0;return a.forEach(function(t){return o+=2*t.length}),o}function oe(t){return"string"==typeof t||t instanceof String}function ne(t){return"boolean"==typeof t}function re(t){return"number"==typeof t}function se(t){return Array.isArray(t)?se(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":re(t)?"float32":oe(t)?"string":ne(t)?"bool":"float32"}function ie(t){return!!(t&&t.constructor&&t.call&&t.apply)}function ue(a,e){for(var t=e;t<a;++t)if(0==a%t)return t;return a}function ce(a){var e=a.length;if(2>e)return[];var t=Array(e-1);t[e-2]=a[e-1];for(var o=e-3;0<=o;--o)t[o]=t[o+1]*a[o+1];return t}function he(a,e,t){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(a)&&(a=F(a)),t&&Z(a,e),fe(a,e))return a;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(a);if("int32"===e)return new Int32Array(a);if("bool"===e){for(var n=new Uint8Array(a.length),r=0;r<n.length;++r)0!==_(a[r])&&(n[r]=1);return n}throw new Error("Unknown data type "+e)}function me(p,e,t){var n=[];if(1===e.length)for(var r=e[0],o=0;o<r;o++)n[o]=t[p+o];else{r=e[0];var a=e.slice(1),i=a.reduce(function(a,e){return a*e});for(o=0;o<r;o++)n[o]=me(p+o*i,a,t)}return n}function ge(a,e){if(0===a.length)return e[0];var t=a.reduce(function(a,e){return a*e});if(0===t)return[];if(t!==e.length)throw new Error("["+a+"] does not match the input size.");return me(0,a,e)}function fe(a,e){return a instanceof Float32Array&&"float32"===e||a instanceof Int32Array&&"int32"===e||a instanceof Uint8Array&&"bool"===e}function ye(a,e){for(var t=xe(a,e),o=0;o<t.length;o++)t[o]=1;return t}function xe(a,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(a);if("int32"===e)return new Int32Array(a);if("bool"===e)return new Uint8Array(a);throw new Error("Unknown data type "+e)}function be(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof r){var t=r.hrtime();return 1e3*t[0]+t[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function ve(t){t.forEach(function(e){A(h(e)&&0<=e,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function Ce(p,e,t,n){var r=ce(e),o=Re(p,e,t,r),a=e.length,i=_e(p,e,t,r,o),s=["Tensor"];return n&&(s.push("  dtype: "+t),s.push("  rank: "+a),s.push("  shape: ["+e+"]"),s.push("  values:")),s.push(i.map(function(t){return"    "+t}).join("\n")),s.join("\n")}function Re(d,e,t,n){var r=U(e),o=n[n.length-1],a=Array(o).fill(0),i=e.length,s="complex64"===t?ke(d):d;if(1<i)for(var u=0;u<r/o;u++)for(var c=u*o,l=0;l<o;l++)a[l]=de(a[l],Se(s[c+l],0,t).length);return a}function Se(a,e,t){return V(Array.isArray(a)?parseFloat(a[0].toFixed(Is))+" + "+parseFloat(a[1].toFixed(Is))+"j":oe(a)?"'"+a+"'":"bool"===t?Ee(a):parseFloat(a.toFixed(Is)).toString(),e)}function Ee(t){return 0===t?"false":"true"}function _e(c,e,b,t,n,o){void 0===o&&(o=!0);var a="complex64"===b?2:1,r=e[0],s=e.length;if(0===s)return"complex64"===b?[Se(ke(c)[0],0,b)]:"bool"===b?[Ee(c[0])]:[c[0].toString()];if(1===s){if(r>ks){var i=Array.from(c.slice(0,ws*a)),l=Array.from(c.slice(r-ws*a,r));return"complex64"===b&&(i=ke(i),l=ke(l)),["["+i.map(function(a,e){return Se(a,n[e],b)}).join(", ")+", ..., "+l.map(function(a,e){return Se(a,n[r-ws+e],b)}).join(", ")+"]"]}return["["+("complex64"===b?ke(c):Array.from(c)).map(function(a,e){return Se(a,n[e],b)}).join(", ")+"]"]}var p=e.slice(1),d=t.slice(1),u=t[0]*a,h=[];if(r>ks){for(var m=0,g;m<ws;m++)g=(f=m*u)+u,h.push.apply(h,_e(c.slice(f,g),p,b,d,n,!1));for(h.push("..."),m=r-ws;m<r;m++)g=(f=m*u)+u,h.push.apply(h,_e(c.slice(f,g),p,b,d,n,m===r-1))}else for(m=0;m<r;m++){var f;g=(f=m*u)+u,h.push.apply(h,_e(c.slice(f,g),p,b,d,n,m===r-1))}var y=2===s?",":"";for(h[0]="["+h[0]+y,m=1;m<h.length-1;m++)h[m]=" "+h[m]+y;var x=",\n";for(m=2;m<s;m++)x+="\n";return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":x),h}function ke(a){for(var e=[],t=0;t<a.length;t+=2)e.push([a[t],a[t+1]]);return e}function we(t){Ts=t}function Ie(y,e,t){for(var n={},r={},o=0;o<e.length;o++)n[e[o].id]=!0;for(o=0;o<y.length;o++){var a=(h=y[o]).inputs;for(var i in a){for(var s=a[i],u=!1,c=0;c<e.length;c++)if(n[s.id]){h.outputs.forEach(function(t){return n[t.id]=!0}),u=!0,r[h.id]=!0;break}if(u)break}}var l={};l[t.id]=!0;var p={};for(o=y.length-1;0<=o;o--)for(a=(h=y[o]).inputs,c=0;c<h.outputs.length;c++)if(l[h.outputs[c].id]){for(var i in a)l[a[i].id]=!0,p[h.id]=!0;break}var d=[];for(o=0;o<y.length;o++){var h;if(r[(h=y[o]).id]&&p[h.id]){var f={};for(var i in h.inputs){var m=h.inputs[i];n[m.id]&&(f[i]=m)}var g=Object.assign({},h);g.inputs=f,g.outputs=h.outputs,d.push(g)}}return d}function Ne(p,e,d){for(var t=function(t){var n=e[t],o=[];if(n.outputs.forEach(function(e){var t=p[e.id];if(null!=t)o.push(t);else{var a=Os.make(e.shape,{values:xe(e.size,e.dtype)},e.dtype);o.push(a)}}),null==n.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+n.name+".");var l=n.gradient(1===n.outputs.length?o[0]:o),a=function(e){if(!(e in l))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(l)+".");var t=d(function(){return l[e]()});if("float32"!==t.dtype)throw new Error("Error in gradient for op "+n.name+". The gradient of input "+e+" must have 'float32' dtype, but has '"+t.dtype+"'");var o=n.inputs[e];if(!L(t.shape,o.shape))throw new Error("Error in gradient for op "+n.name+". The gradient of input '"+e+"' has shape '"+t.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==p[o.id])p[o.id]=t;else{var a=p[o.id];p[o.id]=a.add(t),a.dispose()}};for(var r in n.inputs)a(r)},a=e.length-1;0<=a;a--)t(a)}function Te(a,e){if("string"===a||"string"===e){if("string"===a&&"string"===e)return"string";throw new Error("Can not upcast "+a+" with "+e)}return zs[a][e]}function De(t){return Te(t,"int32")}function Ae(a,e){if(a.dtype===e.dtype)return[a,e];var t=Te(a.dtype,e.dtype);return[a.cast(t),e.cast(t)]}function Oe(a,e){A(a.dtype===e.dtype,function(){return"The dtypes of the first("+a.dtype+") and second("+e.dtype+") input must match"})}function Pe(a){var e=[];return Fe(a,e,new Set),e}function Fe(s,e,t){if(null!=s)if(s instanceof Os)e.push(s);else if(Be(s)){var n=s;for(var r in n){var o=n[r];t.has(o)||(t.add(o),Fe(o,e,t))}}}function Be(t){return Array.isArray(t)||"object"==typeof t}function Le(a){var e=ye(U(a),"float32");return Os.make(a,{values:e})}function Me(t){try{if(null!=S(t))return!0}catch(t){return!1}return!1}function We(a){if(null==Qs){var e=S(a);Qs=e.getParameter(e.MAX_TEXTURE_SIZE)}return Qs}function Ue(a){if(null==Zs){var e=S(a);Zs=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return le(16,Zs)}function ze(a){if(0===a)return 0;var e=S(a);return Ke(e,"EXT_disjoint_timer_query_webgl2")&&2===a?2:Ke(e,"EXT_disjoint_timer_query")?1:0}function Ge(a){if(0===a)return!1;var e=S(a);if(1===a){if(!Ke(e,"OES_texture_float"))return!1;}else if(!Ke(e,"EXT_color_buffer_float"))return!1;return je(e,a)}function Ve(a){if(0===a)return!1;var e=S(a);if(1===a){if(!Ke(e,"OES_texture_float"))return!1;if(!Ke(e,"WEBGL_color_buffer_float"))return!1}else if(!Ke(e,"EXT_color_buffer_float"))return!1;return je(e,a)}function He(t){return 2===t&&null!=S(t).fenceSync}function qe(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function $e(){var a={};if("undefined"==typeof window||void 0===window.location||void 0===window.location.search)return a;var e=Xe(window.location.search);if($s in e){var s={};e[$s].split(",").forEach(function(a){var e=a.split(":"),t=e[0],n=e[1];s[t]=n}),qs.forEach(function(e){e.name in s&&(console.log("Setting feature override from URL "+e.name+": "+s[e.name]),e.type===Hs.NUMBER?a[e.name]=+s[e.name]:e.type===Hs.BOOLEAN?a[e.name]="true"===s[e.name]:e.type===Hs.STRING?a[e.name]=s[e.name]:console.warn("Unknown URL param: "+e.name+"."))})}return a}function Ke(a,e){return null!=a.getExtension(e)}function je(s,e){var t=s.createFramebuffer(),n=s.createTexture();s.bindTexture(s.TEXTURE_2D,n);var r=2===e?s.RGBA32F:s.RGBA;s.texImage2D(s.TEXTURE_2D,0,r,1,1,0,s.RGBA,s.FLOAT,null),s.bindFramebuffer(s.FRAMEBUFFER,t),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0);var o=s.checkFramebufferStatus(s.FRAMEBUFFER)===s.FRAMEBUFFER_COMPLETE;return s.bindTexture(s.TEXTURE_2D,null),s.bindFramebuffer(s.FRAMEBUFFER,null),s.deleteTexture(n),s.deleteFramebuffer(t),o}function Xe(a){var e={};return a.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];return Ye(e,t[0],t[1]),t.join("=")}),e}function Ye(a,e,t){a[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Qe(){return window.screen.height*window.screen.width*window.devicePixelRatio*Ks/1024}function Ze(){if(null==Js){var t;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof g)t=g;else{if("undefined"==typeof r)throw new Error("Could not find a global object");t=r}Js=t}return Js}function Je(t){ei.get("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function et(a){var e=a;if(ee(a))return[a.length];if(!Array.isArray(a))return[];for(var t=[];Array.isArray(e)||ee(e);)t.push(e.length),e=e[0];return Array.isArray(a)&&ei.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&tt(a,t,[]),t}function tt(a,e,t){if(t=t||[],Array.isArray(a)||ee(a)){A(0<e.length,function(){return"Element arr["+t.join("][")+"] should be a primitive, but is an array of "+a.length+" elements"}),A(a.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" elements, but has "+a.length+" elements"});for(var n=e.slice(1),r=0;r<a.length;++r)tt(a[r],n,t.concat(r))}else A(0===e.length,function(){return"Element arr["+t.join("][")+"] is a primitive, but should be an array/TypedArray of "+e[0]+" elements"})}function at(a,e,t,o){if(null!=a&&("numeric"!==a&&a!==e||"numeric"===a&&"string"===e))throw new Error("Argument '"+t+"' passed to '"+o+"' must be "+a+" tensor, but got "+e+" tensor")}function ot(p,d,t,n){if(void 0===n&&(n="numeric"),p instanceof Os)return at(n,p.dtype,d,t),p;var r=se(p);if("string"!==r&&0<=["bool","int32","float32"].indexOf(n)&&(r=n),at(n,r,d,t),null==p||!ee(p)&&!Array.isArray(p)&&"number"!=typeof p&&"boolean"!=typeof p&&"string"!=typeof p){var o=null==p?"null":p.constructor.name;throw new Error("Argument '"+d+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=et(p);ee(p)||Array.isArray(p)||(p=[p]);var i="string"===r?F(p):he(p,r,ei.get("DEBUG"));return Os.make(a,{values:i},r)}function nt(a,o,t,e){if(void 0===e&&(e="numeric"),!Array.isArray(a))throw new Error("Argument "+o+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return a.map(function(a,e){return ot(a,o+"["+e+"]",t)},e)}function rt(p,e){if(A(ie(p),function(){return"The f passed in variableGrads(f) must be a function"}),A(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof Ps}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}),null==e)for(var t in e=[],ei.engine.registeredVariables)e.push(ei.engine.registeredVariables[t]);var n=e.length;A(0<(e=e.filter(function(t){return t.trainable})).length,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+n+" variables is trainable."});var r=ei.engine.gradients(p,e,null,!0),o=r.value,d=r.grads;A(d.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),A(0===o.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+o.rank+" tensor"});var i={};return e.forEach(function(a,e){null!=d[e]&&(i[a.name]=d[e])}),{value:o,grads:i}}function st(t){return ei.engine.customGrad(t)}function it(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];ei.get("IS_TEST")||console.warn.apply(console,a)}function pt(s,e,t,n){void 0===n&&(n=!0);var r=[];if(n)(r=r.concat(e.slice(0))).push(s[0]/t),r=r.concat(s.slice(1));else{r=r.concat(s[0]);for(var o=e.length,a=0;a<o;++a)r=r.concat([s[a+1]/e[a],e[a]]);r=r.concat(s.slice(o+1))}return r}function dt(s,e,t){void 0===t&&(t=!0);var n=[];if(t){n.push(e);for(var r=e+1;r<s;++r)r<=2*e?(n.push(r),n.push(r-(e+1))):n.push(r)}else{var o=[],a=[];for(r=1;r<s;++r)r>=2*e+1||1==r%2?a.push(r):o.push(r);n.push.apply(n,o),n.push(0),n.push.apply(n,a)}return n}function lt(s,e,t,n){void 0===n&&(n=!0);var r=[];n?r.push(s[0]/t):r.push(s[0]*t);for(var o=1;o<s.length;++o)o<=e.length?n?r.push(e[o-1]*s[o]):r.push(s[o]/e[o-1]):r.push(s[o]);return r}function ut(a,e){for(var t=[0],o=0;o<e;++o)t.push(a[o][0]);return t}function ct(a,e,t){for(var n=a.slice(0,1),r=0;r<t;++r)n.push(a[r+1]-e[r][0]-e[r][1]);return n}function ht(a,e){for(var t=0;t<a.length;++t)if(a[a.length-t-1]!==e-1-t)return!1;return!0}function mt(p,e,t){for(var n=p.length+e.length,r=[],o=0,a=0,i=0;i<n;i++)-1===t.indexOf(i)?r.push(p[o++]):r.push(e[a++]);return r}function gt(a,e){for(var t=[],n=a.length,r=0;r<n;r++)-1===e.indexOf(r)&&t.push(a[r]);return[t,e.map(function(e){return a[e]})]}function ft(a,e){return mt(a,e.map(function(){return 1}),e)}function yt(a,e,t){A(ht(e,t),function(){return a+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function xt(a,e){if(ht(a,e))return null;for(var t=[],o=0;o<e;++o)-1===a.indexOf(o)&&t.push(o);return a.forEach(function(a){return t.push(a)}),t}function bt(t){return t.map(function(a,e){return[e,a]}).sort(function(a,e){return a[1]-e[1]}).map(function(t){return t[0]})}function vt(a,e){for(var t=[],o=e-a;o<e;++o)t.push(o);return t}function Ct(a,s){var i=a[0].length;a.forEach(function(a,e){A(a.length===i,function(){return"Error in concat"+i+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+i+")"})}),A(0<=s&&s<i,function(){return"Error in concat"+i+"D: axis must be between 0 and "+(i-1)+"."});var t=a[0];a.forEach(function(n,e){for(var o=0;o<i;o++)A(o===s||n[o]===t[o],function(){return"Error in concat"+i+"D: Shape of tensors["+e+"] ("+n+") does not match the shape of the rest ("+t+") along the non-concatenated axis "+e+"."})})}function Rt(a,e){for(var t=a[0].slice(),o=1;o<a.length;o++)t[e]+=a[o][e];return t}function St(p,e){if(1>p.rank)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+p.rank+".");if(1>e.rank)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>p.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+p.rank);if(0===p.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+p.shape+".");for(var t=e.shape,n=t[t.length-1],r=1,o=0;o<t.length-1;++o)r*=t[o];var a=p.shape,i=t.slice();i.pop();var s=1;for(o=n;o<p.rank;++o)s*=a[o],i.push(a[o]);var d=ce(p.shape).map(function(t){return t/s}).concat([1]).slice(0,n);return[i,r,s,d]}function Et(t){return t<=ii?t:ue(t,$(C(t)))}function _t(s,e,t){var n=1<e.rank?e.shape[e.rank-1]:1,r=1<e.rank?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+s+", sliceDim: "+n+", and batchDim: "+r+".";if(t.rank<r)throw new Error(o+" update.rank < "+r+". ");if(s.length<n+(t.rank-r))throw new Error(o+" Output shape length < "+(n+(t.rank-r)));if(t.rank!==r+s.length-n)throw new Error(o+" update.rank != "+(r+s.length-n));for(var a=0;a<r;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-r;++a)if(t.shape[a+r]!==s[a+n])throw new Error(o+" updates.shape["+(a+r)+"] ("+t.shape[a+r]+") != shape["+(a+r)+"] ("+s[a+r]+")")}function kt(a,e,t){if(1>e.rank)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(1>a.rank)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+a.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(1>t.length)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(0===t.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===a.size)throw new Error("Updates specified for empty output. updates shape: "+a.shape)}_t(t,e,a)}function wt(p,e,t){for(var n=1<e.rank?e.shape[e.rank-1]:1,d=t.length,o=1,l=n;l<d;++l)o*=t[l];var i=1>n?1:n;return{sliceRank:n,numUpdates:e.size/i,sliceSize:o,strides:ce(t.slice(0,n)).concat([1]),outputSize:U(t)}}function It(a,e){var t=!1,o;for(a<=ii?(o=a,t=!0):o=ue(a,$(C(a)));!t;)o>e||o===a?t=!0:o=ue(a,o+1);return o}function Nt(s,e,t){for(var n=[],r=s.length,o=0;o<r;o++)o===e?n.push(t):n.push(s[o]);return n}function Tt(p,e,t){for(var n=p.shape[t],d=[],l=1,u=1,c=0;c<t;c++)d.push(p.shape[c]),l*=p.shape[c];for(c=0;c<e.rank;c++)d.push(e.shape[c]);for(c=t+1;c<p.rank;c++)d.push(p.shape[c]),u*=p.shape[c];return{batchSize:l,sliceSize:u,dimSize:n,outputShape:d}}function Dt(a,e,t){A(a.rank===e.length,function(){return"Error in slice"+a.rank+"D: Length of begin "+e+" must match the rank of the array ("+a.rank+")."}),A(a.rank===t.length,function(){return"Error in slice"+a.rank+"D: Length of size "+t+" must match the rank of the array ("+a.rank+")."});for(var n=function(o){A(e[o]+t[o]<=a.shape[o],function(){return"Error in slice"+a.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+a.shape[o]+")"})},r=0;r<a.rank;++r)n(r)}function At(m,e,t,g,n,o,a,r,s){if(void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===s&&(s=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==r)throw new Error("new axis mask is not yet supported");for(var i=[],u=[],l=[],p=0;p<m.length;p++)i[p]=Ot(n,e,g,m,p),u[p]=Pt(o,t,g,m,p),s&1<<p&&(u[p]=i[p]+1,l.push(p));var d=Array(m.length).fill(0);return d=d.map(function(r,e){for(var t=0,n=g[e]||1,o=i[e];0<n?!(o>=u[e]):!(o<=u[e]);o+=n)t+=1;return t}),[i,d,l]}function Ot(p,e,t,n,r){var o=e[r],a=t[r]||1;(p&1<<r||null==o)&&(o=0<a?c:u);var i=n[r];return 0>o&&(o+=i),o=I(0,o,i-1)}function Pt(p,e,t,n,r){var o=e[r],a=t[r]||1;(p&1<<r||null==o)&&(o=0<a?u:c);var i=n[r];return 0>o&&(o+=i),o=0<a?I(0,o,i):I(-1,o,i-1)}function Ft(a,e,t){for(var n=t.length,r=0;r<t.length;r++)if(1<t[r]){n=r;break}for(r=n+1;r<t.length;r++)if(0<e[r]||t[r]!==a[r])return!1;return!0}function Bt(a,e){for(var t=0<a.length?a[a.length-1]:1,o=0;o<a.length-1;o++)t+=a[o]*e[o];return t}function Lt(a){var e=Object.keys(a);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var s=e[0],t=a[s];s.endsWith("_")&&(s=s.substring(0,s.length-1));var r=function(){for(var a=[],e=0;e<arguments.length;e++)a[e]=arguments[e];ei.engine.startScope(s);try{var n=t.apply(void 0,a);return n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ei.engine.endScope(n),n}catch(t){throw ei.engine.endScope(null),t}};return Object.defineProperty(r,"name",{value:s,configurable:!0}),r}function Mt(p,d,t){if(null==t&&(t=se(p)),"complex64"===t)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ee(p)&&!Array.isArray(p)&&"number"!=typeof p&&"boolean"!=typeof p&&"string"!=typeof p)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");var n=et(p);if(null!=d){ve(d);var r=U(d),o=U(n);A(r===o,function(){return"Based on the provided shape, ["+d+"], the tensor should have "+r+" values but has "+o});for(var a=0;a<n.length;++a){var i=n[a],s=a!==n.length-1||i!==U(d.slice(a));A(n[a]===d[a]||!s,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+d+"). "})}}return ee(p)||Array.isArray(p)||(p=[p]),d=d||n,p="string"===t?F(p):he(p,t,ei.get("DEBUG")),Os.make(d,{values:p},t)}function Wt(a,e){if((ee(a)||Array.isArray(a))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return Mt(a,[],e)}function Ut(a,e){P(a);var t=et(a);if(1!==t.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Mt(a,t,e)}function zt(a,e,t){if(P(a),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var o=et(a);if(2!==o.length&&1!==o.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Mt(a,e=e||o,t)}function Gt(a,e,t){if(P(a),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var o=et(a);if(3!==o.length&&1!==o.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Mt(a,e=e||o,t)}function Vt(a,e,t){if(P(a),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var o=et(a);if(4!==o.length&&1!==o.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Mt(a,e=e||o,t)}function Ht(a,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=Ht(a,"float32"),n=Ht(a,"float32");return li(t,n)}var r=ye(U(a),e);return Os.make(a,{values:r},e)}function qt(a,e){if(void 0===e&&(e="float32"),"complex64"===e){var t=qt(a,"float32"),n=qt(a,"float32");return li(t,n)}var r=xe(U(a),e);return Os.make(a,{values:r},e)}function $t(a,e,t){return ei.engine.runKernel(function(o){return o.fill(a,e,t)},{})}function Kt(s,e,t,n){if(void 0===t&&(t=1),void 0===n&&(n="float32"),0===t)throw new Error("Cannot have a step of zero");if(s===e||s<e&&0>t||e<s&&1<t)return qt([0],n);var r=xe(l(pe((e-s)/t)),n);e<s&&1===t&&(t=-1),r[0]=s;for(var o=1;o<r.length;o++)r[o]=r[o-1]+t;return Ut(r,n)}function jt(p,e,t){if("complex64"===e){if("complex64"===p.dtype)return p.clone();var n=qt(p.shape),r=p.toFloat(),o=t.complex(r,n);return n.dispose(),r.dispose(),o}if(!J(p.dtype,e))return Os.make(p.shape,{dataId:p.dataId},e);if("complex64"===p.dtype){var a=t.real(p);return o=a.cast(e),a.dispose(),o}if("int32"===e)return t.int(p);if("bool"===e){var i=Wt(0,p.dtype);return o=t.notEqual(p,i),i.dispose(),o}throw new Error("Error in Cast: unknown dtype argument ("+e+")")}function Xt(a,e){return Os.make(e,{dataId:a.dataId},a.dtype)}function Yt(a,e){if(a.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+a.length+", imag: "+e.length+".");for(var t=new Float32Array(2*a.length),o=0;o<t.length;o+=2)t[o]=a[o/2],t[o+1]=e[o/2];return t}function Qt(a){for(var e=new Float32Array(a.length/2),o=new Float32Array(a.length/2),s=0;s<a.length;s+=2)e[s/2]=a[s],o[s/2]=a[s+1];return{real:e,imag:o}}function Zt(a){for(var e=pe(a.length/4),t=new Float32Array(e),s=new Float32Array(e),i=0;i<a.length;i+=4)t[$(i/4)]=a[i],s[$(i/4)]=a[i+1];return{real:t,imag:s}}function Jt(a){for(var e=$(a.length/4),t=new Float32Array(e),s=new Float32Array(e),i=2;i<a.length;i+=4)t[$(i/4)]=a[i],s[$(i/4)]=a[i+1];return{real:t,imag:s}}function ea(a,e){return{real:a[2*e],imag:a[2*e+1]}}function ta(a,e,t,o){a[2*o]=e,a[2*o+1]=t}function aa(p,e){for(var t=new Float32Array(p/2),l=new Float32Array(p/2),u=0,o;u<pe(p/2);u++)o=(e?2:-2)*d*(u/p),t[u]=i(o),l[u]=s(o);return{real:t,imag:l}}function oa(a,e,t){var o=(t?2:-2)*d*(a/e);return{real:i(o),imag:s(o)}}function na(h,e,t,n,r){for(var o=Array.from(e).map(function(a,o){return{score:a,boxIndex:o}}).filter(function(t){return t.score>r}).sort(function(a,e){return e.score-a.score}),a=[],i=0;i<o.length;i++){var s=o[i],u=s.score,c=s.boxIndex;if(u<r)break;for(var l=!1,m=a.length-1;0<=m;--m)if(ra(h,c,a[m])>=n){l=!0;break}if(!l&&(a.push(c),a.length>=t))break}return Ut(a,"int32")}function ra(b,e,t){var n=b.subarray(4*e,4*e+4),r=b.subarray(4*t,4*t+4),o=le(n[0],n[2]),a=le(n[1],n[3]),i=de(n[0],n[2]),s=de(n[1],n[3]),u=le(r[0],r[2]),c=le(r[1],r[3]),l=de(r[0],r[2]),p=de(r[1],r[3]),d=(i-o)*(s-a),h=(l-u)*(p-c);if(0>=d||0>=h)return 0;var f=de(o,u),m=de(a,c),g=le(i,l),v=le(s,p),y=de(g-f,0)*de(v-m,0);return y/(d+h-y)}function sa(s,e,i){var n=Array(s.rank).fill(0),r=s.shape.slice();return e.map(function(e){r[i]=e;var t=s.slice(n,r);return n[i]+=e,t})}function ia(o,e,t,n){for(var r=e[e.length-1],a=[o.length/r,r],i=a[0],s=a[1],u=X(t,i*n),c=X("int32",i*n),l=0;l<i;l++){for(var p=l*s,d=o.subarray(p,p+s),h=[],f=0;f<d.length;f++)h.push({value:d[f],index:f});h.sort(function(a,e){return e.value-a.value});var b=l*n,g=u.subarray(b,b+n),v=c.subarray(b,b+n);for(f=0;f<n;f++)g[f]=h[f].value,v[f]=h[f].index}var y=e.slice();return y[y.length-1]=n,[Mt(u,y,t),Mt(c,y,"int32")]}function pa(a,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return a+"."+e})}function da(a,e){return 1===e?[a]:pa(a,e)}function la(a,e){if(1===a)return"rc";for(var t="",o=0;o<a;o++)t+=e[o],o<a-1&&(t+=",");return t}function ua(s,e){for(var t=s.length,n=[],r=0;r<t;r++){var o=t-1-r,a=s[o]||1;1<(e[e.length-1-r]||1)&&1===a&&n.unshift(o)}return n}function ca(s,e){for(var t=[],n=0;n<e.length;n++){var r=s[s.length-n-1],o=e.length-n-1,a=e[o];(null==r||1===r&&1<a)&&t.unshift(o)}return t}function ha(s,e){for(var t=[],n=de(s.length,e.length),r=0,o;r<n;r++){o=s[s.length-r-1],null==o&&(o=1);var a=e[e.length-r-1];if(null==a&&(a=1),1==o)t.unshift(a);else if(1===a)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+s+" and "+e+".");t.unshift(o)}}return t}function ma(){var p,d,l,h,m,g,f,y,x,b;return 2===ei.get("WEBGL_VERSION")?(p="#version 300 es",d="in",l="out",h="in",m="texture",g="outputColor",f="out vec4 outputColor;",y="\n      const float NAN = uintBitsToFloat(uint(0x7fc00000));\n    ",x="\n      const float INFINITY = uintBitsToFloat(uint(0x7f800000));\n    ",b="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(p="",d="attribute",l="varying",h="varying",m="texture2D",g="gl_FragColor",f="",y="\n      uniform float NAN;\n\n      bool isnan(float val) {\n        return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n      }\n      bvec4 isnan(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",x="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",b="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:p,attribute:d,varyingVs:l,varyingFs:h,texture2D:m,output:g,defineOutput:f,defineSpecialNaN:y,defineSpecialInf:x,defineRound:b}}function ga(a,e,s){void 0===s&&(s="index");var n=ce(e);return n.map(function(e,t){return"int "+a[t]+" = "+s+" / "+e+"; "+(t===n.length-1?"int "+a[t+1]+" = "+s+" - "+a[t]+" * "+e:"index -= "+a[t]+" * "+e)+";"}).join("")}function fa(t){return 1===t.length?""+t[0]:"vec"+t.length+"("+t.join(",")+")"}function ya(p,e){if(p.length!==e.length)throw new Error("Vectors to be dotted must be of the same length -got "+p.length+" and "+e.length);for(var t=[],n=$(p.length/4),r=p.length%4,o=0;o<n;o++){var a=p.slice(4*o,4*o+4),i=e.slice(4*o,4*o+4);t.push(fa(a)+", "+fa(i))}return 0!=r&&(a=p.slice(4*n),i=e.slice(4*n),1===a.length&&(a=a.map(function(t){return"float("+t+")"}),i=i.map(function(t){return"float("+t+")"})),t.push(fa(a)+", "+fa(i))),t.map(function(t){return"dot("+t+")"}).join("+")}function xa(h,m,e,t){var n=[];h.forEach(function(a){var e=U(a.shapeInfo.logicalShape);a.shapeInfo.isUniform?n.push("uniform float "+a.name+(1<e?"["+e+"]":"")+";"):(n.push("uniform sampler2D "+a.name+";"),n.push("uniform int offset"+a.name+";"))});var o=n.join("\n"),r=h.map(function(a){return Ca(a,m,t)}).join("\n"),s=m.texShape,u=ma(),l=Ea(u),p=wa(u),d,a;return m.isPacked?(d=Ra(m.logicalShape,s),a=ka(u)):(d=Sa(m.logicalShape,s),a=_a(u)),t&&(p+=Ci),[p,l,a,o,d,r,e].join("\n")}function ba(a){var e=a.shapeInfo.logicalShape;switch(e.length){case 0:return za(a);case 1:return Va(a);case 2:return qa(a);case 3:return Ka(a);case 4:return Xa(a);case 5:return Ya(a);case 6:return Qa(a);default:throw new Error(e.length+"-D input sampling is not yet supported");}}function va(t){switch(t.shapeInfo.logicalShape.length){case 0:return Ua(t);case 1:return Ga(t);case 2:return Ha(t);case 3:return $a(t);default:return ja(t);}}function Ca(s,e,t){void 0===t&&(t=!1);var n="";n+=t?va(s):ba(s);var r=s.shapeInfo.logicalShape,o=e.logicalShape;return r.length<=o.length&&(n+=t?Ja(s,e):eo(s,e)),n}function Ra(a,e){switch(a.length){case 0:return Ia();case 1:return Na(a,e);case 2:return La(a,e);case 3:return Da(a,e);default:return Oa(a,e);}}function Sa(a,e){switch(a.length){case 0:return Ia();case 1:return Ta(a,e);case 2:return Ma(a,e);case 3:return Aa(a,e);case 4:return Pa(a,e);case 5:return Fa(a,e);case 6:return Ba(a,e);default:throw new Error(a.length+"-D output sampling is not yet supported");}}function Ea(t){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+t.texture2D+"(textureSampler, uv).r;\n    }\n  "}function _a(t){return"\n    void setOutput(float val) {\n      "+t.output+" = vec4(val, 0, 0, 0);\n    }\n  "}function ka(t){return"\n    void setOutput(vec4 val) {\n      "+t.output+" = val;\n    }\n  "}function wa(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+xi+"\n    "+bi+"\n    "+vi+"\n  "}function Ia(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function Na(a,e){var t=[pe(e[0]/2),pe(e[1]/2)];return 1===t[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}function Ta(a,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}function Da(a,e){var t=[pe(e[0]/2),pe(e[1]/2)],n=pe(a[2]/2),r=n*pe(a[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      int b = index / "+r+";\n      index -= b * "+r+";\n\n      int r = 2 * (index / "+n+");\n      int c = imod(index, "+n+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}function Aa(a,e){var t=ga(["r","c","d"],a);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+t+"\n      return ivec3(r, c, d);\n    }\n  "}function Oa(p,e){for(var t=[pe(e[0]/2),pe(e[1]/2)],n=pe(p[p.length-1]/2),r=n*pe(p[p.length-2]/2),o=r,a="",i="b, r, c",s=2;s<p.length-1;s++)a="\n      int b"+s+" = index / "+(o*=p[p.length-s-1])+";\n      index -= b"+s+" * "+o+";\n    "+a,i="b"+s+", "+i;return"\n    ivec"+p.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+r+";\n      index -= b * "+r+";\n\n      int r = 2 * (index / "+n+");\n      int c = imod(index, "+n+") * 2;\n\n      return ivec"+p.length+"("+i+");\n    }\n  "}function Pa(a,e){var t=ga(["r","c","d","d2"],a);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+t+"\n      return ivec4(r, c, d, d2);\n    }\n  "}function Fa(a,e){var t=ga(["r","c","d","d2","d3"],a);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+t+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}function Ba(a,e){var t=ga(["r","c","d","d2","d3","d4"],a);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+t+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}function La(a,e){var t=[pe(e[0]/2),pe(e[1]/2)];if(L(a,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ";var o=pe(a[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = 2 * (index / "+o+");\n      int c = imod(index, "+o+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}function Ma(a,e){return L(a,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===a[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===a[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+a[1]+";\n      int c = index - r * "+a[1]+";\n      return ivec2(r, c);\n    }\n  "}function Wa(t){return"offset"+t}function Ua(a){var e=a.name;return"\n    vec4 get"+e.charAt(0).toUpperCase()+e.slice(1)+"() {\n      return "+ma().texture2D+"("+e+", halfCR);\n    }\n  "}function za(s){var e=s.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);if(s.shapeInfo.isUniform)return"float "+t+"() {return "+e+";}";var n=s.shapeInfo.texShape,r=n[0],o=n[1];if(1===r&&1===o)return"\n      float "+t+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=s.shapeInfo.texShape;return"\n    float "+t+"() {\n      vec2 uv = uvFromFlat("+a[0]+", "+a[1]+", "+Wa(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}function Ga(s){var e=s.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=s.shapeInfo.texShape,r=[pe(n[0]/2),pe(n[1]/2)],o=ma();return"\n    vec4 "+t+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+r[0]+", "+r[1]+", index);\n      return "+o.texture2D+"("+e+", uv);\n    }\n  "}function Va(s){var e=s.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1);if(s.shapeInfo.isUniform)return"\n      float "+t+"(int index) {\n        "+Za(s)+"\n      }\n    ";var n=s.shapeInfo.texShape,r=n[0],o=n[1];if(1===o&&1===r)return"\n      float "+t+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=Wa(e);return 1===o?"\n      float "+t+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+r+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===r?"\n      float "+t+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+o+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+t+"(int index) {\n      vec2 uv = uvFromFlat("+r+", "+o+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}function Ha(p){var e=p.shapeInfo.logicalShape,t=p.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=p.shapeInfo.texShape,o=r[0],a=r[1],i=ma();if(null!=r&&L(e,r))return"\n      vec4 "+n+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+o+".0);\n\n        return "+i.texture2D+"("+t+", uv);\n      }\n    ";var s=[pe(r[0]/2),pe(r[1]/2)];return"\n    vec4 "+n+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+pe(e[1]/2)+", "+s[0]+", "+s[1]+", row, col);\n      return "+i.texture2D+"("+t+", uv);\n    }\n  "}function qa(h){var e=h.shapeInfo.logicalShape,t=h.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=h.shapeInfo.texShape;if(null!=r&&L(e,r)){var o=r[0];return"\n    float "+n+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+r[1]+".0, "+o+".0);\n      return sampleTexture("+t+", uv);\n    }\n  "}var a=j(e),i=a.newShape,s=a.keptDims,u=i;if(u.length<e.length)return"\n      "+ba(ao(h,u))+"\n      float "+n+"(int row, int col) {\n        return "+n+"("+oo(["row","col"],s)+");\n      }\n    ";if(h.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+e[1]+", 1)));\n        "+Za(h)+"\n      }\n    ";var c=r[0],l=r[1],p=Wa(t);return 1===l?"\n    float "+n+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+c+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ":1===c?"\n    float "+n+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+l+".0, 0.5);\n      return sampleTexture("+t+", uv);\n    }\n  ":"\n  float "+n+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+e[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+c+", "+l+", index);\n    return sampleTexture("+t+", uv);\n  }\n"}function $a(p){var e=p.shapeInfo.logicalShape,t=p.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=p.shapeInfo.texShape,o=[pe(r[0]/2),pe(r[1]/2)];if(1===e[0])return"\n        "+va(ao(p,e.slice(1)))+"\n        vec4 "+n+"(int b, int row, int col) {\n          return "+n+"("+oo(["b","row","col"],[1,2])+");\n        }\n      ";var a=o[0],i=o[1],s=pe(e[2]/2);return"\n    vec4 "+n+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+a+", "+i+", "+s*pe(e[1]/2)+", "+s+", b, row, col);\n      return "+ma().texture2D+"("+t+", uv);\n    }\n  "}function Ka(m){var e=m.shapeInfo.logicalShape,t=m.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[1]*e[2],o=e[2],a=j(e),i=a.newShape,s=a.keptDims,u=i;if(u.length<e.length)return"\n        "+ba(ao(m,u))+"\n        float "+n+"(int row, int col, int depth) {\n          return "+n+"("+oo(["row","col","depth"],s)+");\n        }\n      ";if(m.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+r+", "+o+", 1)));\n        "+Za(m)+"\n      }\n    ";var c=m.shapeInfo.texShape,l=c[0],p=c[1],d=m.shapeInfo.flatOffset;return p===r&&null==d?"\n        float "+n+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+o+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+p+".0, "+l+".0);\n          return sampleTexture("+t+", uv);\n        }\n      ":p===o&&null==d?"\n    float "+n+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+e[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+p+".0, "+l+".0);\n      return sampleTexture("+t+", uv);\n    }\n  ":"\n      float "+n+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+r+" + col * "+o+" + depth + "+Wa(t)+";\n        vec2 uv = uvFromFlat("+l+", "+p+", index);\n        return sampleTexture("+t+", uv);\n      }\n  "}function ja(m){for(var e=m.shapeInfo.logicalShape,t=e.length,n=m.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=m.shapeInfo.texShape,a=[pe(o[0]/2),pe(o[1]/2)],i=a[0],s=a[1],u=pe(e[t-1]/2),c=u*pe(e[t-2]/2),l="int b, int row, int col",p="b * "+c+" + (row / 2) * "+u+" + (col / 2)",d=2;d<t-1;d++)l="int b"+d+", "+l,p="b"+d+" * "+(c*=e[t-d-1])+" + "+p;return"\n    vec4 "+r+"("+l+") {\n      int index = "+p+";\n      int texR = index / "+s+";\n      int texC = index - texR * "+s+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+s+", "+i+");\n      return "+ma().texture2D+"("+n+", uv);\n    }\n  "}function Xa(m){var e=m.shapeInfo.logicalShape,t=m.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[3],o=e[2]*r,a=e[1]*o,i=j(e),s=i.newShape,u=i.keptDims;if(s.length<e.length)return"\n      "+ba(ao(m,s))+"\n      float "+n+"(int row, int col, int depth, int depth2) {\n        return "+n+"("+oo(["row","col","depth","depth2"],u)+");\n      }\n    ";if(m.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+a+", "+o+", "+r+", 1)));\n        "+Za(m)+"\n      }\n    ";var c=m.shapeInfo.flatOffset,l=m.shapeInfo.texShape,p=l[0],d=l[1];return d===a&&null==c?"\n      float "+n+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+o+", "+r+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+p+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":d===r&&null==c?"\n      float "+n+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+e[1]*e[2]+", "+e[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+p+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+a+" + col * "+o+" +\n          depth * "+r+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+d+", index + "+Wa(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}function Ya(m){var e=m.shapeInfo.logicalShape,t=m.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,a=e[2]*o,i=e[1]*a,s=j(e),u=s.newShape,c=s.keptDims;if(u.length<e.length)return"\n      "+ba(ao(m,u))+"\n      float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+n+"("+oo(["row","col","depth","depth2","depth3"],c)+");\n      }\n    ";if(m.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+i+", "+a+", "+o+", "+r+")) +\n          depth3;\n        "+Za(m)+"\n      }\n    ";var l=m.shapeInfo.flatOffset,p=m.shapeInfo.texShape,d=p[0],h=p[1];return h===i&&null==l?"\n      float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+a+", "+o+", "+r+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+h+".0, "+d+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":h===r&&null==l?"\n      float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]+",\n               "+e[2]*e[3]+", "+e[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+h+".0, "+d+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" + depth * "+o+" +\n          depth2 * "+r+" + depth3 + "+Wa(t)+";\n      vec2 uv = uvFromFlat("+d+", "+h+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}function Qa(g){var e=g.shapeInfo.logicalShape,t=g.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=j(e),o=r.newShape,a=r.keptDims;if(o.length<e.length)return"\n      "+ba(ao(g,o))+"\n      float "+n+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+n+"("+oo(["row","col","depth","depth2","depth3","depth4"],a)+");\n      }\n    ";var i=e[5],s=e[4]*i,u=e[3]*s,c=e[2]*u,l=e[1]*c;if(g.shapeInfo.isUniform)return"\n      float "+n+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+i+", 1)));\n        "+Za(g)+"\n      }\n    ";var p=g.shapeInfo.flatOffset,d=g.shapeInfo.texShape,h=d[0],f=d[1];return f===l&&null==p?"\n      float "+n+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+c+", "+u+", "+s+", "+i+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+h+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":f===i&&null==p?"\n      float "+n+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]*e[4]+",\n               "+e[2]*e[3]*e[4]+",\n               "+e[3]*e[4]+",\n               "+e[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+h+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+l+" + col * "+c+" + depth * "+u+" +\n          depth2 * "+s+" + depth3 * "+i+" + depth4 + "+Wa(t)+";\n      vec2 uv = uvFromFlat("+h+", "+f+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}function Za(a){var e=a.name,t=U(a.shapeInfo.logicalShape);return 2>t?"return "+e+";":"\n    for (int i = 0; i < "+t+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function Ja(a,e){var t=a.name,r=t.charAt(0).toUpperCase()+t.slice(1),o=a.shapeInfo.logicalShape.length,i=e.logicalShape.length,s=ua(a.shapeInfo.logicalShape,e.logicalShape),u=to(i),c=i-o,l=["x","y","z","w","u","v"],p;p=0===o?"":2>i&&1<=s.length?"coords = 0;":s.map(function(t){return"coords."+l[t+c]+" = 0;"}).join("\n");var n="";n=2>i&&0<o?"coords":a.shapeInfo.logicalShape.map(function(a,e){return"coords."+l[e+c]}).join(", ");var d="return outputValue;";if(1===o&&1<i)d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";else if(0===o&&0<i)d=1===i?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(s.length){var h=o-2,g=o-1;-1<s.indexOf(h)&&-1<s.indexOf(g)?d="return vec4(outputValue.x);":-1<s.indexOf(h)?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":-1<s.indexOf(g)&&(d="return vec4(outputValue.xx, outputValue.zz);")}return"\n    vec4 "+("get"+r+"AtOutCoords")+"() {\n      "+u+" coords = getOutputCoords();\n      "+p+"\n      vec4 outputValue = get"+r+"("+n+");\n      "+d+"\n    }\n  "}function eo(h,e){var t=h.name,n=t.charAt(0).toUpperCase()+t.slice(1),r="get"+n+"AtOutCoords",o=e.texShape,a=h.shapeInfo.texShape,i=h.shapeInfo.logicalShape.length,s=e.logicalShape.length;if(!h.shapeInfo.isUniform&&i===s&&null==h.shapeInfo.flatOffset&&L(a,o))return"\n      float "+r+"() {\n        return sampleTexture("+t+", resultUV);\n      }\n    ";var u=to(s),c=ua(h.shapeInfo.logicalShape,e.logicalShape),l=s-i,p=["x","y","z","w","u","v"];return"\n    float "+r+"() {\n      "+u+" coords = getOutputCoords();\n      "+(0===i?"":2>s&&1<=c.length?"coords = 0;":c.map(function(t){return"coords."+p[t+l]+" = 0;"}).join("\n"))+"\n      return get"+n+"("+(2>s&&0<i?"coords":h.shapeInfo.logicalShape.map(function(a,e){return"coords."+p[e+l]}).join(", "))+");\n    }\n  "}function to(t){if(1>=t)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function ao(a,e){var t=JSON.parse(JSON.stringify(a));return t.shapeInfo.logicalShape=e,t}function oo(a,e){return e.map(function(e){return a[e]}).join(", ")}function no(a,e){if(1===a)return""+e;if(2===a)return e+".x, "+e+".y";if(3===a)return e+".x, "+e+".y, "+e+".z";if(4===a)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}function ro(a,e){if(1===a)return""+e;if(2===a)return e+".y";if(3===a)return e+".z";if(4===a)return e+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}function so(s,e){var t=s.length;if(4<t)throw Error("Gather for rank "+t+" is not yet supported");if(1===t)return"int(getIndices(resRC))";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],o=0;o<s.length;o++)o===e?r.push("int(getIndices("+n[o]+"))"):r.push(""+n[o]);return r.join()}function po(a,e){return[e,a]}function lo(a,e){return a*e}function uo(a,e){if(0!=a%e)throw new Error("unpackedSize ("+a+") must be a multiple of "+e);return a/e}function co(s,e,t){var n=lo(s.length,t);if(e.length<n)throw new Error("unpackedArray length ("+e.length+") must be >= "+n);for(var r=0,o=0;o<s.length;++o)e[r]=s[o],r+=t}function ho(s,e,t){var n=uo(s.length,t);if(e.length<n)throw new Error("matrix length ("+e.length+") must be >= "+n);for(var r=0,o=0;o<s.length;o+=t)e[r++]=s[o]}function mo(a,e){return[de(1,pe(e/2)),de(1,pe(a/2))]}function go(a,e){var t=mo(a,e);return 4*(t[0]*t[1])}function fo(b,e,t,n,r){for(var o=1==n%2,a=1==t%2,i=$(n/2),s=$(t/2),u=pe(n/2),c=u*pe(t/2),l=N(t)*N(n),p=0;p<e;p++){for(var d=p*t*n,h=p*l,f=o?4:0,m=n,g=h,v=0;v<s;++v){for(var y=2*v*n,x=0,C;x<i;++x)C=d+y+2*x,r[g]=b[C],r[g+1]=b[C+1],r[g+2]=b[C+m],r[g+3]=b[C+m+1],g+=4;g+=f}if(o){C=d+n-1,g=h+4*(u-1);for(f=4*u,v=0;v<s;++v)r[g]=b[C],r[g+2]=b[C+n],C+=2*n,g+=f}if(a){for(C=d+(t-1)*n,g=h+4*(c-u),x=0;x<i;++x)r[g++]=b[C++],r[g++]=b[C++],g+=2;o&&a&&(r[h+l-4]=b[C])}}return r}function yo(s,e,t,n,r){var o=t*n;if(r.length<o)throw new Error("matrix length ("+r.length+") must be >= "+o);for(var a=1==n%2,i=$(n/2),u=$(t/2),c=pe(n/2),l=c*pe(t/2),p=N(t)*N(n),d=0;d<e;d++){for(var h=d*t*n,f=d*p,m=a?4:0,g=n+(a?1:0),v=f,y=h,x=h+n,C=0;C<u;++C){for(var R=0;R<i;++R)r[y++]=s[v++],r[y++]=s[v++],r[x++]=s[v++],r[x++]=s[v++];v+=m,y+=g,x+=g}if(a){v=f+4*(c-1);var b=h+n-1;for(m=4*c,g=2*n,C=0;C<u;++C)r[b]=s[v],r[b+n]=s[v+2],v+=m,b+=g}if(1==t%2){for(v=f+4*(l-c),b=h+(t-1)*n,R=0;R<i;++R)r[b++]=s[v++],r[b++]=s[v++],v+=2;a&&(r[h+t*n-1]=s[v])}}return r}function xo(a,e,t){var o=t();return e&&bo(a),o}function bo(a){var e=a.getError();if(e!==a.NO_ERROR)throw new Error("WebGL Error: "+Co(a,e))}function vo(t){return!!(ei.get("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||lp<l(t)&&l(t)<up)}function Co(a,e){return e===a.NO_ERROR?"NO_ERROR":e===a.INVALID_ENUM?"INVALID_ENUM":e===a.INVALID_VALUE?"INVALID_VALUE":e===a.INVALID_OPERATION?"INVALID_OPERATION":e===a.INVALID_FRAMEBUFFER_OPERATION?"INVALID_FRAMEBUFFER_OPERATION":e===a.OUT_OF_MEMORY?"OUT_OF_MEMORY":e===a.CONTEXT_LOST_WEBGL?"CONTEXT_LOST_WEBGL":"Unknown error code "+e}function Ro(a,e,t){return Ho(a,e,function(){return a.getExtension(t)},"Extension \""+t+"\" not supported on this browser.")}function So(a,e,t){var o=Ho(a,e,function(){return a.createShader(a.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(xo(a,e,function(){return a.shaderSource(o,t)}),xo(a,e,function(){return a.compileShader(o)}),!1===a.getShaderParameter(o,a.COMPILE_STATUS))throw console.log(a.getShaderInfoLog(o)),new Error("Failed to compile vertex shader.");return o}function Eo(a,e,t){var o=Ho(a,e,function(){return a.createShader(a.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(xo(a,e,function(){return a.shaderSource(o,t)}),xo(a,e,function(){return a.compileShader(o)}),!1===a.getShaderParameter(o,a.COMPILE_STATUS))throw _o(t,a.getShaderInfoLog(o)),new Error("Failed to compile fragment shader.");return o}function _o(d,e){var t=cp.exec(e);if(null==t)return console.log("Couldn't parse line number in error: "+e),void console.log(d);for(var n=+t[1],r=d.split("\n"),o=r.length.toString().length+2,a=r.map(function(a,e){return V((e+1).toString(),o)+a}),i=0,s=0;s<a.length;s++)i=de(a[s].length,i);var u=a.slice(0,n-1),c=a.slice(n-1,n),l=a.slice(n);console.log(u.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+V(c[0],i),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}function ko(a,e){return Ho(a,e,function(){return a.createProgram()},"Unable to create WebGLProgram.")}function wo(a,e,t){if(xo(a,e,function(){return a.linkProgram(t)}),!1===a.getProgramParameter(t,a.LINK_STATUS))throw console.log(a.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Io(a,e,t){if(xo(a,e,function(){return a.validateProgram(t)}),!1===a.getProgramParameter(t,a.VALIDATE_STATUS))throw console.log(a.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function No(a,e,t){var o=Ho(a,e,function(){return a.createBuffer()},"Unable to create WebGLBuffer");return xo(a,e,function(){return a.bindBuffer(a.ARRAY_BUFFER,o)}),xo(a,e,function(){return a.bufferData(a.ARRAY_BUFFER,t,a.STATIC_DRAW)}),o}function To(a,e,t){var o=Ho(a,e,function(){return a.createBuffer()},"Unable to create WebGLBuffer");return xo(a,e,function(){return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,o)}),xo(a,e,function(){return a.bufferData(a.ELEMENT_ARRAY_BUFFER,t,a.STATIC_DRAW)}),o}function Do(){return 2===ei.get("WEBGL_VERSION")?1:4}function Ao(a,e){return Ho(a,e,function(){return a.createTexture()},"Unable to create WebGLTexture.")}function Oo(a,e){var t=ei.get("WEBGL_MAX_TEXTURE_SIZE");if(0>=a||0>=e){var o="["+a+"x"+e+"]";throw new Error("Requested texture size "+o+" is invalid.")}if(a>t||e>t)throw o="["+a+"x"+e+"]",new Error("Requested texture size "+o+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]."))}function Po(a,e){return Ho(a,e,function(){return a.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Fo(p,e,t,n,r,o,a,i){var s=p.getAttribLocation(t,n);return-1!==s&&(xo(p,e,function(){return p.bindBuffer(p.ARRAY_BUFFER,r)}),xo(p,e,function(){return p.vertexAttribPointer(s,o,p.FLOAT,!1,a,i)}),xo(p,e,function(){return p.enableVertexAttribArray(s)}),!0)}function Bo(a,e,t,o){qo(a,o),xo(a,e,function(){return a.activeTexture(a.TEXTURE0+o)}),xo(a,e,function(){return a.bindTexture(a.TEXTURE_2D,t)})}function Lo(a,e,t,o){return Ho(a,e,function(){return a.getUniformLocation(t,o)},"uniform \""+o+"\" not present in program.")}function Mo(a,e,t){return a.getUniformLocation(e,t)}function Wo(s,e,t,n,r,o){xo(s,e,function(){return Bo(s,e,n,o)}),xo(s,e,function(){return s.uniform1i(r,o)})}function Uo(a,e,t,o){xo(a,e,function(){return a.bindFramebuffer(a.FRAMEBUFFER,o)}),xo(a,e,function(){return a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0)})}function zo(a,e,t){xo(a,e,function(){return a.bindFramebuffer(a.FRAMEBUFFER,t)}),xo(a,e,function(){return a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0)})}function Go(a){var e=a.checkFramebufferStatus(a.FRAMEBUFFER);if(e!==a.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Vo(a,e))}function Vo(a,e){return e===a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?"FRAMEBUFFER_INCOMPLETE_ATTACHMENT":e===a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT":e===a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?"FRAMEBUFFER_INCOMPLETE_DIMENSIONS":e===a.FRAMEBUFFER_UNSUPPORTED?"FRAMEBUFFER_UNSUPPORTED":"unknown error "+e}function Ho(a,e,t,n){var r=xo(a,e,function(){return t()});if(null==r)throw new Error(n);return r}function qo(a,e){var t=a.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,o=e+a.TEXTURE0;if(o<a.TEXTURE0||o>t)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+t+"].")}function $o(a,e){return void 0===e&&(e=2),U(a.slice(0,a.length-e))}function Ko(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[1<t.length?t[t.length-2]:1,t[t.length-1]]}function jo(p,e){var t;void 0===e&&(e=!1);var n=ei.get("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,1===(p=p.map(function(e,t){return t>=p.length-2?N(p[t]):p[t]})).length&&(p=[2,p[0]])),2!==p.length){var r=j(p);p=r.newShape}var o=U(p);if(1>=p.length&&o<=n)return[1,o];if(2===p.length&&p[0]<=n&&p[1]<=n)return p;if(3===p.length&&p[0]*p[1]<=n&&p[2]<=n)return[p[0]*p[1],p[2]];if(3===p.length&&p[0]<=n&&p[1]*p[2]<=n)return[p[0],p[1]*p[2]];if(4===p.length&&p[0]*p[1]*p[2]<=n&&p[3]<=n)return[p[0]*p[1]*p[2],p[3]];if(4===p.length&&p[0]<=n&&p[1]*p[2]*p[3]<=n)return[p[0],p[1]*p[2]*p[3]];if(e){var a=$o(p),i=2,s=2;return p.length&&(i=(t=Ko(p))[0],s=t[1]),G(o=a*(i/2)*(s/2)).map(function(t){return 2*t})}return G(o)}function Xo(t){return 0==t%2}function Yo(a,e){if(L(a=a.slice(-2),e=e.slice(-2)))return!0;if(!a.length||!e.length)return!0;if(0===a[0]||0===a[1]||0===e[0]||0===e[1])return!0;if(a.length!==e.length){var t=a.slice(-1)[0],o=e.slice(-1)[0];if(t===o)return!0;if(Xo(t)&&Xo(o)&&(1===a[0]||1===e[0]))return!0}return a[1]===e[1]&&Xo(a[0])&&Xo(e[0])}function Qo(a,e){var t=ma();return So(a,e,t.version+"\n    precision highp float;\n    "+t.attribute+" vec3 clipSpacePos;\n    "+t.attribute+" vec2 uv;\n    "+t.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Zo(a,e){return No(a,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Jo(a,e){return To(a,e,new Uint16Array([0,1,2,2,1,3]))}function en(p,e){var t=p,d,l,h,m,g,f,y,x;return 2===ei.get("WEBGL_VERSION")?(d=t.R32F,l=t.R16F,h=t.RGBA16F,m=t.RGBA32F,g=t.RED,f=4,y=1,x=t.HALF_FLOAT):(d=p.RGBA,l=p.RGBA,h=p.RGBA,m=t.RGBA,g=p.RGBA,f=4,y=4,x=null==e?null:e.HALF_FLOAT_OES),{internalFormatFloat:d,internalFormatHalfFloat:l,internalFormatPackedHalfFloat:h,internalFormatPackedFloat:m,textureFormatFloat:g,downloadTextureFormat:p.RGBA,downloadUnpackNumChannels:f,defaultNumChannels:y,textureTypeHalfFloat:x}}function tn(p,e,t,n,r,o,a){Oo(t,n);var i=Ao(p,e),s=p.TEXTURE_2D;return xo(p,e,function(){return p.bindTexture(s,i)}),xo(p,e,function(){return p.texParameteri(s,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE)}),xo(p,e,function(){return p.texParameteri(s,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE)}),xo(p,e,function(){return p.texParameteri(s,p.TEXTURE_MIN_FILTER,p.NEAREST)}),xo(p,e,function(){return p.texParameteri(s,p.TEXTURE_MAG_FILTER,p.NEAREST)}),xo(p,e,function(){return p.texImage2D(s,0,r,t,n,0,o,a,null)}),xo(p,e,function(){return p.bindTexture(p.TEXTURE_2D,null)}),i}function an(s,e,t,n,r){var o=po(t,n);return tn(s,e,o[0],o[1],r.internalFormatFloat,r.textureFormatFloat,s.FLOAT)}function on(s,e,t,n,r){var o=po(t,n);return tn(s,e,o[0],o[1],r.internalFormatHalfFloat,r.textureFormatFloat,r.textureTypeHalfFloat)}function nn(o,e,t,n){var r=po(t,n);return tn(o,e,r[0],r[1],o.RGBA,o.RGBA,o.UNSIGNED_BYTE)}function rn(s,e,t,n,r){var o=mo(t,n);return tn(s,e,o[0],o[1],r.internalFormatPackedFloat,s.RGBA,s.FLOAT)}function sn(s,e,t,n,r){var o=mo(t,n);return tn(s,e,o[0],o[1],r.internalFormatPackedHalfFloat,s.RGBA,r.textureTypeHalfFloat)}function pn(a,e,t,o){return xo(a,e,function(){return a.bindBuffer(a.ARRAY_BUFFER,o)}),Fo(a,e,t,"clipSpacePos",o,3,20,0)&&Fo(a,e,t,"uv",o,2,20,12)}function dn(a,e,t,o){xo(a,e,function(){return a.bindTexture(a.TEXTURE_2D,t)}),xo(a,e,function(){return a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,o)}),xo(a,e,function(){return a.bindTexture(a.TEXTURE_2D,null)})}function ln(s,e,t,n,r,o,a){Oo(n,r),xo(s,e,function(){return s.bindTexture(s.TEXTURE_2D,t)}),xo(s,e,function(){return s.texSubImage2D(s.TEXTURE_2D,0,0,0,n,r,a,s.FLOAT,o)}),xo(s,e,function(){return s.bindTexture(s.TEXTURE_2D,null)})}function un(h,e,t,n,r,o,a,i){var s=po(n,r),c=s[0],l=s[1],p=n*r,d;1===i.defaultNumChannels&&p===o.length?d=o:co(o,d=new Float32Array(p*a),a),ln(h,e,t,c,l,d,i.textureFormatFloat)}function cn(c,e,t,n,r,o,a,i,s){var u=mo(a,i),l=u[0],p=u[1],d=new Float32Array(go(a,i));fo(s,n,r,o,d),ln(c,e,t,l,p,d,c.RGBA)}function hn(p,e,t,n,r,o){var a=t;if(2===ei.get("WEBGL_VERSION")){var i=p,s=i.createBuffer();xo(p,e,function(){return p.bindBuffer(i.PIXEL_PACK_BUFFER,s)});var d=4*lo(n*r,o.downloadUnpackNumChannels);xo(p,e,function(){return p.bufferData(i.PIXEL_PACK_BUFFER,d,i.STREAM_READ)}),xo(p,e,function(){return i.readPixels(0,0,r,n,p.RGBA,p.FLOAT,0)}),xo(p,e,function(){return p.bindBuffer(i.PIXEL_PACK_BUFFER,null)}),a=s}return a}function mn(p,e,t,n,r){var o=p,a=new Float32Array(lo(t*n,r.downloadUnpackNumChannels));o.bindBuffer(o.PIXEL_PACK_BUFFER,e),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,a),o.bindBuffer(o.PIXEL_PACK_BUFFER,null);var i=new Float32Array(t*n);return ho(a,i,r.downloadUnpackNumChannels),i}function gn(p,e,t,n,r){var o=po(t,n),a=o[0],i=o[1],s=new Float32Array(lo(t*n,r.downloadUnpackNumChannels));xo(p,e,function(){return p.readPixels(0,0,a,i,r.downloadTextureFormat,p.FLOAT,s)});var d=new Float32Array(t*n);return ho(s,d,r.downloadUnpackNumChannels),d}function fn(p,e,t,n,r){var o=po(t,n),a=o[0],i=o[1],s=new Uint8Array(lo(t*n,4));return xo(p,e,function(){return p.readPixels(0,0,a,i,r.downloadTextureFormat,p.UNSIGNED_BYTE,s)}),new Float32Array(s.buffer)}function yn(s,e,t,n,r,o,a){var i=s,p=new Float32Array(go(o,a));i.bindBuffer(i.PIXEL_PACK_BUFFER,e),i.getBufferSubData(i.PIXEL_PACK_BUFFER,0,p),i.bindBuffer(i.PIXEL_PACK_BUFFER,null);var d=new Float32Array(U([t,n,r]));return yo(p,t,n,r,d),d}function xn(s,e,t,n,r,o,a){var i=mo(o,a),u=i[0],c=i[1],l=new Float32Array(go(o,a));xo(s,e,function(){return s.readPixels(0,0,u,c,s.RGBA,s.FLOAT,l)});var p=new Float32Array(U([t,n,r]));return yo(l,t,n,r,p)}function bn(a){for(var e=0;e<a.length&&!!a[e]();++e);return e-1}function vn(m,g,e,n){var r=g.userCode,o=e.map(function(t,e){var a={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&0<t.texData.slice.flatOffset&&(a.flatOffset=t.texData.slice.flatOffset),{name:g.variableNames[e],shapeInfo:a}}),a=o.map(function(t){return t.shapeInfo}),y={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},x=xa(o,y,r,g.usesPackedTextures),b=m.createProgram(x),v=null,C=null;1===ei.get("WEBGL_VERSION")&&(v=m.getUniformLocation(b,"INFINITY",!1),C=m.getUniformLocation(b,"NAN",!1));for(var R={},S=0,h;S<g.variableNames.length;S++)h=g.variableNames[S],R[h]=m.getUniformLocation(b,h,!1),R["offset"+h]=m.getUniformLocation(b,"offset"+h,!1);return{program:g,source:x,webGLProgram:b,uniformLocations:R,inShapeInfos:a,outShapeInfo:y,infLoc:v,nanLoc:C}}function Cn(a,p){if(a.length!==p.length)throw Error("Binary was compiled with "+a.length+" inputs, but was executed with "+p.length+" inputs");a.forEach(function(t,e){var n=t.logicalShape,r=p[e],o=r.shape;if(!L(n,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+n+" and "+o+" must match");if(!t.isUniform||!r.isUniform){var a=t.texShape,i=r.isUniform?null:r.texData.texShape;if(!L(a,i))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+i+" must match")}})}function Rn(p,e,t,n,r){Cn(e.inShapeInfos,t),Cn([e.outShapeInfo],[n]);var o=n.texData.texture,a=n.texData.texShape;n.texData.isPacked?p.setOutputPackedMatrixTexture(o,a[0],a[1]):p.setOutputMatrixTexture(o,a[0],a[1]),p.setProgram(e.webGLProgram),1===ei.get("WEBGL_VERSION")&&(null!==e.infLoc&&p.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&p.gl.uniform1f(e.nanLoc,NaN)),t.forEach(function(t,n){var r=e.program.variableNames[n],o=e.uniformLocations[r],a=e.uniformLocations["offset"+r];if(null!=o)if(!t.isUniform)null!=t.texData.slice&&null!=a&&p.gl.uniform1i(a,t.texData.slice.flatOffset),p.setInputMatrixTexture(t.texData.texture,o,n);else if(2>U(t.shape))p.gl.uniform1f(o,t.uniformValues[0]);else{var i=t.uniformValues;i instanceof Float32Array||(i=new Float32Array(i)),p.gl.uniform1fv(o,i)}}),null!=r&&r(p,e.webGLProgram),p.executeProgram()}function Sn(s,e,t){var i="";e.concat(t).forEach(function(a){var e=null!=a.texData&&null!=a.texData.slice&&0<a.texData.slice.flatOffset,t=a.isUniform?"uniform":a.texData.texShape;i+=a.shape+"_"+t+"_"+e});var n=s.userCode,o=s.constructor.name;return o+="_"+i+"_"+n}function En(s,e){for(var t=[],n=0;1>=n;n++)for(var r=0;1>=r;r++){for(var o=(0===n?"r":"rp1")+", "+(0===r?"c":"cp1"),a=2;a<s;a++)o=e[e.length-1-a]+","+o;t.push(o)}return t}function _n(a,e,t){if(1===a)return"rc > "+e[0];for(var n="",r=a-2;r<a;r++)n+=t[r]+" >= "+e[r],r<a-1&&(n+="||");return n}function kn(a,e,t,n){if(1===a)return"";var r=n.slice(-2);return"\n    int r = "+r[0]+";\n    int c = "+r[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+t+";\n  "}function wn(a,e){var t=a.length,o=En(t,e);return 1===t?"getA(rc),\n            rc + 1 >= "+a[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+o[0]+"),\n          cEdge ? 0. : getA("+o[1]+"),\n          rEdge ? 0. : getA("+o[2]+"),\n          rEdge || cEdge ? 0. : getA("+o[3]+")"}function In(t){return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+ya(["coords.x","coords.y","coords.z"],ce(t).map(function(t){return t.toString()}).concat(["1."]))+");\n    }\n  "}function Nn(t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+ga(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  "}function Tn(t){if(1===t)return"sourceLoc";if(6>=t)return Up.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}function Dn(a,e){if(a===pp.UPLOAD)return e?dp.PACKED_2X2_FLOAT32:dp.UNPACKED_FLOAT32;if(a===pp.RENDER||null==a)return e?ei.get("WEBGL_RENDER_FLOAT32_ENABLED")?dp.PACKED_2X2_FLOAT32:dp.PACKED_2X2_FLOAT16:ei.get("WEBGL_RENDER_FLOAT32_ENABLED")?dp.UNPACKED_FLOAT32:dp.UNPACKED_FLOAT16;if(a===pp.DOWNLOAD||a===pp.PIXELS)return dp.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+a)}function An(a,e,t){return a[0]+"_"+a[1]+"_"+e+"_"+t}function On(a){var e=a.length;if(5<e)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+a[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],r=0;r<a.length;r++)n.push("imod("+t[r]+", "+a[r]+")");return n.join()}function Pn(a){var e=a.length;if(6<e)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=Array(e),r=0;r<a.length;r++)n[a[r]]=t[r];return n.join()}function Fn(t){return void 0===t&&(t=0),ad+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}function Bn(a,e){return a(e={exports:{}},e.exports),e.exports}function Ln(a,e,t){return void 0===e&&(e="float32"),e=e||"float32",ve(a),new Ns(a,e,t)}function Mn(p,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var r=Ln(p,"int32"),o=Ln([t.length,p.length],"int32");for(n=0;n<t.length;n++){var a=r.indexToLoc(t[n]),i=n*p.length;o.values.set(a,i)}return o.toTensor()}function Wn(t){return t in Qd?Qd[t]:(Qd[t]={},Qd[t])}function Un(a,e){if(void 0===e&&(e=!1),"linear"===a)return e?id:od;if("relu"===a)return e?pd:nd;throw new Error("Activation "+a+" has not been implemented for the WebGL backend.")}function zn(a,e){if("float32"===e||"complex64"===e)return a;if("int32"===e||"bool"===e){for(var t="int32"===e?new Int32Array(a.length):new Uint8Array(a.length),o=0;o<t.length;++o)t[o]=_(a[o]);return t}throw new Error("Unknown dtype "+e)}function Gn(t){return t instanceof Float32Array?t:new Float32Array(t)}function Vn(p,e,t,n,r,o){var a=ot(p,"x","batchNorm"),d=ot(e,"mean","batchNorm"),u=ot(t,"variance","batchNorm"),l,i;return null!=r&&(l=ot(r,"scale","batchNorm")),null!=n&&(i=ot(n,"offset","batchNorm")),A(2===a.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+a.rank+"."}),A(2===d.rank||1===d.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+d.rank+"."}),A(2===u.rank||1===u.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+u.rank+"."}),null!=l&&A(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=i&&A(2===i.rank||1===i.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+i.rank+"."}),$n(a,d,u,i,l,o)}function Hn(p,e,t,n,r,o){var a=ot(p,"x","batchNorm"),d=ot(e,"mean","batchNorm"),u=ot(t,"variance","batchNorm"),l,i;return null!=r&&(l=ot(r,"scale","batchNorm")),null!=n&&(i=ot(n,"offset","batchNorm")),A(3===a.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+a.rank+"."}),A(3===d.rank||1===d.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+d.rank+"."}),A(3===u.rank||1===u.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+u.rank+"."}),null!=l&&A(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=i&&A(3===i.rank||1===i.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+i.rank+"."}),$n(a,d,u,i,l,o)}function qn(p,e,t,n,r,o){var a=ot(p,"x","batchNorm"),d=ot(e,"mean","batchNorm"),u=ot(t,"variance","batchNorm"),l,i;return null!=r&&(l=ot(r,"scale","batchNorm")),null!=n&&(i=ot(n,"offset","batchNorm")),A(4===a.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+a.rank+"."}),A(4===d.rank||1===d.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+d.rank+"."}),A(4===u.rank||1===u.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+u.rank+"."}),null!=l&&A(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=i&&A(4===i.rank||1===i.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+i.rank+"."}),$n(a,d,u,i,l,o)}function $n(d,e,t,n,r,g){null==g&&(g=.001);var a=ot(d,"x","batchNorm"),o=ot(e,"mean","batchNorm"),h=ot(t,"variance","batchNorm"),m,f,y;return null!=r&&(m=ot(r,"scale","batchNorm")),null!=n&&(f=ot(n,"offset","batchNorm")),A(o.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),A(null==f||o.rank===f.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),A(null==m||o.rank===m.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),y=0===a.rank||1===a.rank?a.as4D(1,1,1,a.size):2===a.rank?a.as4D(1,1,a.shape[0],a.shape[1]):3===a.rank?a.as4D(1,a.shape[0],a.shape[1],a.shape[2]):a,ei.engine.runKernel(function(r,e){var t=r.batchNormalization(y,Kn(o),Kn(h),g,Kn(m),Kn(f));return e([a,o,h,m]),t},{$x:a,$mean:o,$variance:h,$scale:m,$offset:f},function(a,e){var t=e[0],u=e[1],n=e[2],o=e[3],r=null==o?Wt(1):o,s=ca(u.shape,y.shape),i=[];if(1===u.rank){for(var l=0;l<y.shape.length-1;++l)i.push(y.shape[l]);i.push(1)}var p=t.sub(u),d=a.mul(r),c=Cl(n.add(Wt(g))),h=c.mul(c).mul(c).mul(Wt(-.5));return{$x:function(){return 1===u.rank?a.mul(jd(c.as4D(1,1,1,u.shape[0]),i)).mul(r).reshape(t.shape):a.mul(c).mul(r).reshape(t.shape)},$mean:function(){var t=c.mul(Wt(-1)).mul(d);return 1===u.rank&&(t=t.sum(s)),t.reshape(u.shape)},$variance:function(){var t=h.mul(p).mul(d);return 1===u.rank&&(t=t.sum(s)),t.reshape(u.shape)},$scale:function(){var e=p.mul(c),t=a.mul(e);return 1===u.rank&&(t=t.sum(s)),t.reshape(u.shape)},$offset:function(){var e=a;return 1===u.rank&&(e=e.sum(s)),e.reshape(u.shape)}}}).reshape(a.shape)}function Kn(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function jn(){Je("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Xn(p,e,t,n,r,o,a){void 0===a&&(a="channelsLast");var i=er(e),d=i[0],u=i[1],l;if("channelsLast"===a)l=[d,u,p[3],p[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);l=[d,u,p[1],p[1]]}return Yn(p,l,t,n,r,o,!1,a)}function Yn(k,I,D,n,r,o,a,i){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var O=[-1,-1,-1,-1],u=O[0],P=O[1],F=O[2],B=O[3];if("channelsLast"===i)u=k[0],P=k[1],F=k[2],B=k[3];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);u=k[0],B=k[1],P=k[2],F=k[3]}var L=I[0],M=I[1],W=I[3],g=er(D),v=g[0],U=g[1],z=er(n),E=z[0],G=z[1],V=ar(L,E),H=ar(M,G),q=or(r,P,F,v,U,V,H,o),C=q.padInfo,$=q.outHeight,K=q.outWidth,j=a?W*B:W,X;return"channelsFirst"===i?X=[u,j,$,K]:"channelsLast"==i&&(X=[u,$,K,j]),{batchSize:u,dataFormat:i,inHeight:P,inWidth:F,inChannels:B,outHeight:$,outWidth:K,outChannels:j,padInfo:C,strideHeight:v,strideWidth:U,filterHeight:L,filterWidth:M,effectiveFilterHeight:V,effectiveFilterWidth:H,dilationHeight:E,dilationWidth:G,inShape:k,outShape:X,filterShape:I}}function Qn(D,O,P,n,r,o,a){void 0===o&&(o=!1),void 0===a&&(a="channelsLast");var F=[-1,-1,-1,-1,-1],s=F[0],B=F[1],L=F[2],M=F[3],W=F[4];if("channelsLast"===a)s=D[0],B=D[1],L=D[2],M=D[3],W=D[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=D[0],W=D[1],B=D[2],L=D[3],M=D[4]}var U=O[0],z=O[1],G=O[2],V=O[4],v=tr(P),y=v[0],H=v[1],q=v[2],$=tr(n),b=$[0],K=$[1],j=$[2],X=nr(r,B,L,M,y,H,q,ar(U,b),ar(z,K),ar(G,j)),A=X.padInfo,Y=X.outDepth,Q=X.outHeight,Z=X.outWidth,J=o?V*W:V,ee;return"channelsFirst"===a?ee=[s,J,Y,Q,Z]:"channelsLast"==a&&(ee=[s,Y,Q,Z,J]),{batchSize:s,dataFormat:a,inDepth:B,inHeight:L,inWidth:M,inChannels:W,outDepth:Y,outHeight:Q,outWidth:Z,outChannels:J,padInfo:A,strideDepth:y,strideHeight:H,strideWidth:q,filterDepth:U,filterHeight:z,filterWidth:G,dilationDepth:b,dilationHeight:K,dilationWidth:j,inShape:D,outShape:ee,filterShape:O}}function Zn(p,e,t,n,r,o){null==r&&(r=Jn(p,e,n));var a=p[0],i=p[1],s=rr((a-e+2*r)/n+1,o);A(M(s),function(){return"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters"});var d=rr((i-e+2*r)/n+1,o);return A(M(d),function(){return"The output # of columns ("+d+") must be an integer. Change the stride and/or zero pad parameters"}),[s,d,t]}function Jn(a,e,t,n){void 0===n&&(n=1);var r=ar(e,n);return $((a[0]*(t-1)-t+r)/2)}function er(t){return"number"==typeof t?[t,t]:t}function tr(t){return"number"==typeof t?[t,t,t]:t}function ar(a,e){return 1>=e?a:a+(a-1)*(e-1)}function or(m,y,t,n,r,o,a,i){var s,x,b;if("number"==typeof m){s={top:m,bottom:m,left:m,right:m,type:0===m?"VALID":"NUMBER"};var v=Zn([y,t,1],o,1,n,m,i);x=v[0],b=v[1]}else if("same"===m){x=pe(y/n),b=pe(t/r);var p=de(0,(x-1)*n+o-y),d=de(0,(b-1)*r+a-t),h=$(p/2),C=$(d/2);s={top:h,bottom:p-h,left:C,right:d-C,type:"SAME"}}else{if("valid"!==m)throw Error("Unknown padding parameter: "+m);s={top:0,bottom:0,left:0,right:0,type:"VALID"},x=pe((y-o+1)/n),b=pe((t-a+1)/r)}return{padInfo:s,outHeight:x,outWidth:b}}function nr(y,e,t,n,r,o,a,i,s,u){var c,b,C,R;if("same"===y){var S=((b=pe(e/r))-1)*r+i-e,f=((C=pe(t/o))-1)*o+s-t,m=((R=pe(n/a))-1)*a+u-n,g=$(S/2),E=$(f/2),_=$(m/2);c={top:E,bottom:f-E,left:_,right:m-_,front:g,back:S-g,type:"SAME"}}else{if("valid"!==y)throw Error("Unknown padding parameter: "+y);c={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},b=pe((e-i+1)/r),C=pe((t-s+1)/o),R=pe((n-u+1)/a)}return{padInfo:c,outDepth:b,outHeight:C,outWidth:R}}function rr(a,e){if(!e)return a;switch(e){case"round":return _(a);case"ceil":return pe(a);case"floor":return $(a);default:throw new Error("Unknown roundingMode "+e);}}function sr(a){var e=er(a),t=e[0],o=e[1];return 1===t&&1===o}function ir(a,e){return sr(a)||sr(e)}function pr(h,e,m,t,r,o){A(h.length===e.rank,function(){return"Length of inShape ("+h.length+") and rank of dy ("+e.rank+") must match"});var a=h,i=e,g=!1;3===e.rank&&(g=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,h[0],h[1],h[2]]);var u=a[3],c=i.shape[3];A(4===a.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),A(4===i.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+i.rank}),A(4===m.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+m.rank}),A(u===m.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+u+") must match input depth for filter "+m.shape[2]+"."}),A(c===m.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+m.shape[3]+"."}),null!=o&&A(M(r),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Yn(a,m.shape,t,1,r,o),p=ei.engine.runKernel(function(a,e){var t=a.conv2dDerInput(i,m,l);return e([m,i]),t},{dy4D:i,filter:m},function(a,e){var s=e[0],n=e[1];return{dy4D:function(){return Hl(a,s,t,r,"NHWC",1,o)},filter:function(){return $l(a,n,s.shape,t,r,o)}}});return g?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function dr(p,e,t,n,r,o){var a=p;3===p.rank&&(a=p.as4D(1,p.shape[0],p.shape[1],p.shape[2]));var d=e;3===d.rank&&(d=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),A(4===a.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),A(4===d.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+d.shape+"."}),A(4===t.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}),A(a.shape[3]===t[2],function(){return"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+t[2]+"."}),A(d.shape[3]===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+d.shape[3]+") must match output depth for filter ("+t[3]+")."}),null!=o&&A(M(r),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Yn(a.shape,t,n,1,r,o);return ei.engine.runKernel(function(t){return t.conv2dDerFilter(a,d,l)},{x4D:a,dy4D:d})}function lr(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function ur(a){var e=lr(a),t=e[0],n=e[1],r=e[2];return 1===t&&1===n&&1===r}function cr(a,e){return ur(a)||ur(e)}function hr(s,e,t,n){var r=e,p=!1;3===e.rank&&(p=!0,r=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=ei.engine.runKernel(function(a){return a.depthwiseConv2DDerInput(r,t,n)},{dy4D:r});return p?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}function mr(s,e,t,n){var r=s;3===s.rank&&(r=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),ei.engine.runKernel(function(t){return t.depthwiseConv2DDerFilter(r,i,n)},{x4D:r,dy4D:i})}function gr(d,e,t,n,r){A(d.length===e.rank,function(){return"Length of inShape ("+d.length+") and rank of dy ("+e.rank+") must match"});var o=d,a=e,h=!1;4===e.rank&&(h=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,d[0],d[1],d[2],d[3]]);var s=o[4],u=a.shape[4];A(5===o.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),A(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),A(5===t.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),A(s===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+s+") must match input depth for filter "+t.shape[3]+"."}),A(u===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+t.shape[4]+"."});var c=Qn(o,t.shape,n,1,r),l=ei.engine.runKernel(function(o){return o.conv3dDerInput(a,t,c)},{dy5D:a});return h?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}function fr(p,e,t,n,r){var o=p;4===p.rank&&(o=p.as5D(1,p.shape[0],p.shape[1],p.shape[2],p.shape[3]));var d=e;4===d.rank&&(d=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),A(5===o.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+o.shape+"."}),A(5===d.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+d.shape+"."}),A(5===t.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+t+"."}),A(o.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input "+o.shape[4]+") must match input depth in filter ("+t[3]+"."}),A(d.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy ("+d.shape[4]+") must match output depth for filter ("+t[4]+")."});var l=Qn(o.shape,t,n,1,r);return ei.engine.runKernel(function(t){return t.conv3dDerFilter(o,d,l)},{x5D:o,dy5D:d})}function yr(p,d,t,n,r,e){var a=ot(p,"x","maxPool"),o=a,i=!1;3===a.rank&&(i=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==n&&(n=[1,1]),A(4===o.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+o.rank+"."}),A(ir(t,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}),null!=e&&A(M(r),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+r+"."});var u=Xn(o.shape,d,t,n,r,e),c=ei.engine.runKernel(function(a,e){var t=a.maxPool(o,u);return e([o,t]),t},{x:o},function(o,e){var a=e[0],i=e[1];return{x:function(){return br(o,a,i,d,t,n,r)}}});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function xr(p,d,t,n,r,e){var a=ot(p,"x","avgPool","float32");null==n&&(n=[1,1]),A(ir(t,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"});var o=a,i=!1;3===a.rank&&(i=!0,o=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(4===o.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+o.rank+"."}),null!=e&&A(M(r),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+e+" but got pad "+r+"."});var u=Xn(o.shape,d,t,n,r,e),c=ei.engine.runKernel(function(t){return t.avgPool(o,u)},{x:o},function(a){return{x:function(){return vr(a,o,d,t,n,r)}}});return c=c.cast(a.dtype),i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function br(d,e,t,n,r,o,a,i){var s=ot(d,"dy","maxPoolBackprop"),h=ot(e,"input","maxPoolBackprop"),m=ot(t,"output","maxPoolBackprop");A(h.rank===s.rank,function(){return"Rank of input ("+h.rank+") does not match rank of dy ("+s.rank+")"}),null==o&&(o=[1,1]),A(ir(r,o),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),A(4===s.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."}),A(4===h.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+h.rank+"."}),null!=i&&A(M(a),function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var l=Xn(h.shape,n,r,o,a,i);return ei.engine.runKernel(function(t){return t.maxPoolBackprop(s,h,m,l)},{$dy:s,$input:h})}function vr(h,e,t,n,r,o){var a=ot(h,"dy","avgPoolBackprop"),i=ot(e,"input","avgPoolBackprop");A(i.rank===a.rank,function(){return"Rank of input ("+i.rank+") does not match rank of dy ("+a.rank+")"}),null==r&&(r=[1,1]),A(ir(n,r),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=i,m=a,g=!1;3===i.rank&&(g=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]),m=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(4===m.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+m.rank+"."}),A(4===s.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+"."});var l=Xn(s.shape,t,n,r,o),p=ei.engine.runKernel(function(t){return t.avgPoolBackprop(m,s,l)},{dy4D:m,input4D:s});return g?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Cr(p,e,t){var n=t.map(function(t){return t[0]}),r=t.map(function(t){return t[1]}),o=p.concat(n,r),a=e.map(function(a,e){return(a-o[e]%a)%a}),i=r.map(function(o,e){return o+a[e]});return[e.map(function(a,e){return[n[e],i[e]]}),e.map(function(o,e){return[0,a[e]]})]}function Rr(a,s){var e=a.map(function(t,e){return t+(t-1)*(s[e]-1)}).map(function(t){return t-1}),n=e.map(function(t){return $(t/2)}),r=e.map(function(a,e){return a-n[e]});return e.map(function(a,e){return[n[e],r[e]]})}function Sr(a,e,t,n,s){return e.rank<t.rank&&(e=e.reshape(ft(e.shape,n))),a.rank<t.rank&&(a=a.reshape(ft(a.shape,n))),{$x:function(){var o=a.mul(t.equal(e).cast(a.dtype));return null==s?o:o.transpose(s)}}}function Er(a,e,t){if(void 0===t&&(t=null),0===a.rank)return a.abs();if(1!==a.rank&&null===t)return Er(a.reshape([-1]),e,t);if(1===a.rank||"number"==typeof t||Array.isArray(t)&&1===t.length){if(1===e)return a.abs().sum(t);if(e===1/0)return a.abs().max(t);if(e===-1/0)return a.abs().min(t);if("euclidean"===e||2===e)return a.abs().pow(Wt(2,"int32")).sum(t).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&2===t.length){if(1===e)return a.abs().sum(t[0]).max(t[1]-1);if(e===1/0)return a.abs().sum(t[1]).max(t[0]);if(e===-1/0)return a.abs().sum(t[1]).min(t[0]);if("fro"===e||"euclidean"===e)return a.square().sum(t).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}function _r(a,e){for(var t=[],o=a;o<e;++o)t.push(o);return t}function kr(a){for(var e=[],t=0;t<a.length;++t)for(var o=0;o<a[t].length;++o)e.push(a[t][o]);return e}function wr(p,e){for(var t=Gu(e,mi(e)),n=gc(p,t),r=ku(e,Wt(0,"int32")),o=n.rank-r.rank,a=0;a<o;++a)r=Ad(r,a+1);r=ac(r,Ht(n.shape,"bool"));var i=mi(n);return sc(r,n,i)}function Ir(s,e,t,n){if("int32"!==s.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(2<s.rank)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var r=0<s.rank?s.shape[0]:1,o=1<s.rank?s.shape[1]:1;if(t.length!==o)throw new Error("outputShape has incorrect number of elements:, "+t.length+", should be: "+o+".");var a=e.size;if(0!==e.rank&&(1!==e.rank||a!==r))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+r+"]");if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Nr(p,e,t){void 0===t&&(t=Tc.SUM_BY_NONZERO_WEIGHTS);var n=ot(p,"losses","computeWeightedLoss"),r=null;null!=e&&(r=ot(e,"weights","computeWeightedLoss"));var o=null==r?n:n.mul(r);if(t===Tc.NONE)return o;if(t===Tc.SUM)return o.sum();if(t===Tc.MEAN){if(null==r)return o.mean();var a=n.size/r.size,i=o.sum().div(r.sum());return 1<a?i.div(Wt(a)):i}if(t===Tc.SUM_BY_NONZERO_WEIGHTS){if(null==r)return o.sum().div(Wt(n.size));var s=r.mul(Ht(n.shape)).notEqual(Wt(0)).sum().toFloat();return o.sum().div(s)}throw Error("Unknown reduction: "+t)}function Tr(p,e,t,n){void 0===n&&(n=Tc.SUM_BY_NONZERO_WEIGHTS);var r=ot(p,"labels","absoluteDifference"),o=ot(e,"predictions","absoluteDifference"),a=null;null!=t&&(a=ot(t,"weights","absoluteDifference")),O(r.shape,o.shape,"Error in absoluteDifference: ");var i=r.sub(o).abs();return Ac(i,a,n)}function Dr(p,e,t,n){void 0===n&&(n=Tc.SUM_BY_NONZERO_WEIGHTS);var r=ot(p,"labels","meanSquaredError"),o=ot(e,"predictions","meanSquaredError"),a=null;null!=t&&(a=ot(t,"weights","meanSquaredError")),O(r.shape,o.shape,"Error in meanSquaredError: ");var i=r.squaredDifference(o);return Ac(i,a,n)}function Ar(p,e,t,n,r){void 0===r&&(r=Tc.SUM_BY_NONZERO_WEIGHTS);var o=ot(p,"labels","cosineDistance"),a=ot(e,"predictions","cosineDistance"),i=null;null!=n&&(i=ot(n,"weights","cosineDistance")),O(o.shape,a.shape,"Error in cosineDistance: ");var s=Wt(1).sub(o.mul(a).sum(t,!0));return Ac(s,i,r)}function Or(p,e,t,n){void 0===n&&(n=Tc.SUM_BY_NONZERO_WEIGHTS);var r=ot(p,"labels","hingeLoss"),o=ot(e,"predictions","hingeLoss"),a=null;null!=t&&(a=ot(t,"weights","hingeLoss")),O(r.shape,o.shape,"Error in hingeLoss: ");var i=Wt(1);r=Wt(2).mul(r).sub(i);var s=i.sub(r.mul(o)).relu();return Ac(s,a,n)}function Pr(p,e,t,n,r){void 0===n&&(n=1e-7),void 0===r&&(r=Tc.SUM_BY_NONZERO_WEIGHTS);var o=ot(p,"labels","logLoss"),a=ot(e,"predictions","logLoss"),i=null;null!=t&&(i=ot(t,"weights","logLoss")),O(o.shape,a.shape,"Error in logLoss: ");var s=Wt(1),d=Wt(n),u=o.mul(a.add(d).log()).neg().sub(s.sub(o).mul(s.sub(a).add(d).log()));return Ac(u,i,r)}function Fr(s,e){var t=ot(s,"labels","sigmoidCrossEntropyWithLogits"),n=ot(e,"logits","sigmoidCrossEntropyWithLogits");O(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var r=n.relu(),o=n.mul(t),a=n.abs().neg().exp().log1p();return r.sub(o).add(a)}function Br(d,e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=Tc.SUM_BY_NONZERO_WEIGHTS);var o=ot(d,"multiClassLabels","sigmoidCrossEntropy"),a=ot(e,"logits","sigmoidCrossEntropy"),i=null;if(null!=t&&(i=ot(t,"weights","sigmoidCrossEntropy")),O(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),0<n){var s=Wt(n),u=Wt(1),c=Wt(.5);o=o.mul(u.sub(s)).add(c.mul(s))}var l=Fr(o,a);return Ac(l,i,r)}function Lr(h,e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=Tc.SUM_BY_NONZERO_WEIGHTS);var o=ot(h,"labels","huberLoss"),a=ot(e,"predictions","huberLoss"),i=null;null!=t&&(i=ot(t,"weights","huberLoss")),O(o.shape,a.shape,"Error in huberLoss: ");var s=Wt(n),u=a.sub(o).abs(),c=Hu(u,s),l=u.sub(c),p=Wt(.5).mul(c.square()).add(s.mul(l));return Ac(p,i,r)}function Mr(a,e,s){if(void 0===s&&(s=-1),-1===s&&(s=e.rank-1),s!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+s);return st(function(n,e,t){var r=e.logSumExp([s],!0),o=e.toFloat().sub(r);return t([n,o]),{value:o.mul(n).neg().sum([s]),gradFunc:function(n,e){var t=e[0],r=e[1],o=ft(n.shape,[s]);return[n.reshape(o).mul(t.toFloat().sub(r.exp())),n.reshape(o).mul(r.exp().sub(t.toFloat()))]}}})(a,e)}function Wr(d,e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=Tc.SUM_BY_NONZERO_WEIGHTS);var o=ot(d,"onehotLabels","softmaxCrossEntropy"),a=ot(e,"logits","softmaxCrossEntropy"),i=null;if(null!=t&&(i=ot(t,"weights","softmaxCrossEntropy")),O(o.shape,a.shape,"Error in softmaxCrossEntropy: "),0<n){var s=Wt(n),u=Wt(1),c=Wt(o.shape[1]);o=o.mul(u.sub(s)).add(s.div(c))}var l=Mr(o,a);return Ac(l,i,r)}function Ur(p,e){return void 0===e&&(e=!1),ei.engine.tidy(function(){if(2!==p.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+p.shape.length+"D Tensor.");for(var y=p.shape[0],n=p.shape[1],r=Od(y),o=p.clone(),a=zt([[1]],[1,1]),i=a.clone(),s=y>=n?n:y,d=function(s){var e=o,p=i,d=r,l;l=ei.engine.tidy(function(){var e=o.slice([s,s],[y-s,1]),t=e.norm(),u=o.slice([s,s],[1,1]),c=u.sign().neg(),l=u.sub(c.mul(t)),p=e.div(l);i=1===p.shape[0]?a.clone():a.concat(p.slice([1,0],[p.shape[0]-1,p.shape[1]]),0);var d=c.matMul(l).div(t).neg(),h=o.slice([s,0],[y-s,n]),f=d.mul(i);o=0===s?h.sub(f.matMul(i.transpose().matMul(h))):o.slice([0,0],[s,n]).concat(h.sub(f.matMul(i.transpose().matMul(h))),0);var m=r.slice([0,s],[y,r.shape[1]-s]);return r=0===s?m.sub(m.matMul(i).matMul(f.transpose())):r.slice([0,0],[y,s]).concat(m.sub(m.matMul(i).matMul(f.transpose())),1),[i,o,r]}),i=l[0],o=l[1],r=l[2],ni([e,p,d])},u=0;u<s;++u)d(u);return!e&&y>n&&(r=r.slice([0,0],[y,n]),o=o.slice([0,0],[n,n])),[r,o]})}function zr(s,e,t,i,p){null==i&&(i=.5),null==p&&(p=B);var d=s.shape[0];return t=le(t,d),A(0<=i&&1>=i,function(){return"iouThreshold must be in [0, 1], but was '"+i+"'"}),A(2===s.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+s.rank+"'"}),A(4===s.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+s.shape[1]}),A(1===e.rank,function(){return"scores must be a 1D tensor"}),A(e.shape[0]===d,function(){return"scores has incompatible shape with boxes. Expected "+d+", but was "+e.shape[0]}),{maxOutputSize:t,iouThreshold:i,scoreThreshold:p}}function Gr(a,e,t){if("linear"===e)return a.linear(t);if("relu"===e)return a.relu(t);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}function Vr(m,e){for(var g={},n=0,t=function(e){var t=e.name,o=e.dtype,a=e.shape,r=U(a),s;if(("quantization"in e)){var i=e.quantization;if("uint8"!==i.dtype&&"uint16"!==i.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+i.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var u=eh[i.dtype],l=m.slice(n,n+r*u),p="uint8"===i.dtype?new Uint8Array(l):new Uint16Array(l);if("float32"===o)s=Float32Array.from(p,function(t){return t*i.scale+i.min});else{if("int32"!==o)throw new Error("Unsupported dtype in weight '"+t+"': "+o);s=Int32Array.from(p,function(t){return _(t*i.scale+i.min)})}n+=r*u}else{var d=eh[o];if(l=m.slice(n,n+r*d),"float32"===o)s=new Float32Array(l);else if("int32"===o)s=new Int32Array(l);else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+t+"': "+o);s=new Uint8Array(l)}n+=r*d}var c;if("float32"===o)c=Mt(s,a,"float32");else if("int32"===o)c=Mt(s,a,"int32");else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+t+"': "+o);c=Mt(s,a,"bool")}g[t]=c},o=0,a=e;o<a.length;o++)t(a[o]);return g}function Hr(a){if(null===a)throw new Error("Invalid input value: "+JSON.stringify(a));var s=0,t=[];a.forEach(function(a){if(s+=a.byteLength,t.push(a.byteLength===a.buffer.byteLength?a:new a.constructor(a)),!(a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+a.constructor.name)});var n=new Uint8Array(s),r=0;return t.forEach(function(t){n.set(new Uint8Array(t.buffer),r),r+=t.byteLength}),n.buffer}function $r(t){return th?f.byteLength(t):new Blob([t]).size}function Kr(t){return th?f.from(t).toString("base64"):btoa(o.apply(null,new Uint8Array(t)))}function jr(a){if(th){var e=f.from(a,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(a),n=new Uint8Array(t.length),r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function Xr(a){var o=0;a.forEach(function(t){o+=t.byteLength});var t=new Uint8Array(o),n=0;return a.forEach(function(a){t.set(new Uint8Array(a),n),n+=a.byteLength}),t.buffer}function Yr(a){for(a=a.trim();a.endsWith("/");)a=a.slice(0,a.length-1);var e=a.split("/");return e[e.length-1]}function Qr(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:$r(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:$r(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}function Zr(t){if(-1===t.indexOf(oh))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+nh.getSchemes().join(","));return{scheme:t.split(oh)[0],path:t.split(oh)[1]}}function Jr(h,e,t){return void 0===t&&(t=!1),x(this,void 0,void 0,function(){var m,r,o,a,i,s,u,c,l;return R(this,function(p){switch(p.label){case 0:return A(h!==e,function(){return"Old path and new path are the same: '"+h+"'"}),A(0<(m=ah.getLoadHandlers(h)).length,function(){return"Copying failed because no load handler is found for source URL "+h+"."}),A(2>m.length,function(){return"Copying failed because more than one ("+m.length+") load handlers for source URL "+h+"."}),r=m[0],A(0<(o=ah.getSaveHandlers(e)).length,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),A(2>o.length,function(){return"Copying failed because more than one ("+m.length+") save handlers for destination URL "+e+"."}),a=o[0],i=Zr(h).scheme,s=Zr(h).path,u=i===Zr(h).scheme,[4,r.load()];case 1:return c=p.sent(),t&&u?[4,nh.getManager(i).removeModel(s)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[4,a.save(c)];case 4:return l=p.sent(),!t||u?[3,6]:[4,nh.getManager(i).removeModel(s)];case 5:p.sent(),p.label=6;case 6:return[2,l.modelArtifactsInfo];}})})}function es(){if(!ei.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var a=window,e=a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB||a.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ts(a){var e=a.result;e.createObjectStore(ih,{keyPath:"modelPath"}),e.createObjectStore(ph,{keyPath:"modelPath"})}function as(t){return new dh(t)}function os(t){return t.startsWith(dh.URL_SCHEME)?t.slice(dh.URL_SCHEME.length):t}function ns(t){return{info:[hh,t,mh].join(ch),topology:[hh,t,gh].join(ch),weightSpecs:[hh,t,fh].join(ch),weightData:[hh,t,yh].join(ch),modelMetadata:[hh,t,xh].join(ch)}}function rs(a){var e=a.split(ch);if(3>e.length)throw new Error("Invalid key format: "+a);return e.slice(1,e.length-1).join(ch)}function ss(t){return t.startsWith(bh.URL_SCHEME)?t.slice(bh.URL_SCHEME.length):t}function is(t){return new bh(t)}function ps(t){return void 0===t&&(t="model"),new Rh(t)}function ds(s,e,t,n){!function(t){A(null!=t&&Array.isArray(t)&&0<t.length,function(){return"promises must be a none empty array"})}(s),function(a,e){A(0<=a&&1>=a,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+a}),A(0<=e&&1>=e,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),A(e>=a,function(){return"startFraction must be no more than endFraction, but got startFraction "+a+" and endFraction "+e})}(t=null==t?0:t,n=null==n?1:n);var r=0;return Promise.all(s.map(function(o){return o.then(function(o){var a=t+ ++r/s.length*(n-t);return e(a),o}),o}))}function ls(d,h){return x(this,void 0,void 0,function(){var t,e,n,o,a,r,s,i,u;return R(this,function(l){switch(l.label){case 0:return null==h&&(h={}),t=null==h.fetchFunc?fetch:h.fetchFunc,e=d.map(function(a){return t(a,h.requestInit)}),n=0,o=.5,null==h.onProgress?[4,Promise.all(e)]:[3,2];case 1:return a=l.sent(),[3,4];case 2:return[4,ds(e,h.onProgress,n,o)];case 3:a=l.sent(),l.label=4;case 4:return r=a.map(function(t){return t.arrayBuffer()}),s=.5,i=1,null==h.onProgress?[4,Promise.all(r)]:[3,6];case 5:return u=l.sent(),[3,8];case 6:return[4,ds(r,h.onProgress,s,i)];case 7:u=l.sent(),l.label=8;case 8:return[2,u];}})})}function us(m){var e=this;return function(g,a,y){return void 0===a&&(a=""),x(e,void 0,void 0,function(){var o,x,r,t,e,n,s,b,i,p;return R(this,function(d){switch(d.label){case 0:if(o=g.map(function(){return!1}),x={},r=null==y?[]:y.map(function(){return!1}),t=[],g.forEach(function(a,s){var n=0;a.weights.forEach(function(a){var i="quantization"in a?a.quantization.dtype:a.dtype,p=eh[i]*U(a.shape),d=function(){o[s]=!0,null==x[s]&&(x[s]=[]),x[s].push({manifestEntry:a,groupOffset:n,sizeBytes:p})};null==y?d():y.forEach(function(e,t){e===a.name&&(d(),r[t]=!0)}),t.push(a.name),n+=p})}),!r.every(function(t){return t}))throw e=y.filter(function(a,e){return!r[e]}),new Error("Could not find weights in manifest with names: "+e.join(", ")+". \nManifest JSON has weights with names: "+t.join(", ")+".");return n=o.reduce(function(a,e,t){return e&&a.push(t),a},[]),s=[],n.forEach(function(t){g[t].paths.forEach(function(o){var e=a+(a.endsWith("/")?"":"/")+o;s.push(e)})}),[4,m(s)];case 1:return b=d.sent(),i={},p=0,n.forEach(function(a){for(var e=g[a].paths.length,t=0,n=0;n<e;n++)t+=b[p+n].byteLength;for(var o=new ArrayBuffer(t),r=new Uint8Array(o),s=0,d=0,u;d<e;d++)u=new Uint8Array(b[p+d]),r.set(u,s),s+=u.byteLength;x[a].forEach(function(a){var e=Vr(o.slice(a.groupOffset,a.groupOffset+a.sizeBytes),[a.manifestEntry]);for(var t in e)i[t]=e[t]}),p+=e}),[2,i];}})})}}function cs(a){var e=a.lastIndexOf("/"),t=a.lastIndexOf("?");return[a.substring(0,e)+"/",t>e?a.substring(t):""]}function hs(t){return null!=t.match(Eh.URL_SCHEME_REGEX)}function ms(a,e){return new Eh(a,e)}function gs(t){A(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),A("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),A(0<t.className.length,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Oh.register(t)}function fs(a,e,o){return null==o&&(o=ei.get("TEST_EPSILON")),ys(a,"number"==typeof e||"boolean"==typeof e?[e]:e,function(a,e){return xs(a,+e,o)})}function ys(p,e,t){if(!(p instanceof Os||e instanceof Os)){var n=p.constructor.name,r=e.constructor.name;if(n!==r)throw new Error("Arrays are of different type actual: "+n+" vs expected: "+r)}else if(p instanceof Os&&e instanceof Os){if(p.dtype!==e.dtype)throw new Error("Arrays are of different type actual: "+p.dtype+" vs expected: "+e.dtype+".");if(!L(p.shape,e.shape))throw new Error("Arrays are of different shape actual: "+p.shape+" vs expected: "+e.shape+".")}var o,a;if(o=p instanceof Os?p.dataSync():p,a=e instanceof Os?e.dataSync():e,o.length!==a.length)throw new Error("Arrays have different lengths actual: "+o.length+" vs expected: "+a.length+".\nActual:   "+o+".\nExpected: "+a+".");for(var i=0;i<a.length;++i){var s=o[i],d=a[i];if(!t(s,d))throw new Error("Arrays differ: actual["+i+"] = "+s+", expected["+i+"] = "+d+".\nActual:   "+o+".\nExpected: "+a+".")}}function xs(a,e,t){return isNaN(a)&&isNaN(e)||!(isNaN(a)||isNaN(e)||l(a-e)>t)}a.d(t,"d",function(){return Dh}),a.d(t,"i",function(){return Ih}),a.d(t,"a",function(){return Os}),a.d(t,"b",function(){return Ps}),a.d(t,"h",function(){return jc}),a.d(t,"e",function(){return ud}),a.d(t,"f",function(){return Hl}),a.d(t,"o",function(){return jl}),a.d(t,"j",function(){return nu}),a.d(t,"c",function(){return Fu}),a.d(t,"k",function(){return ju}),a.d(t,"r",function(){return ec}),a.d(t,"m",function(){return lc}),a.d(t,"l",function(){return Bd}),a.d(t,"q",function(){return Kd}),a.d(t,"x",function(){return Yd}),a.d(t,"g",function(){return $t}),a.d(t,"n",function(){return Wt}),a.d(t,"s",function(){return Mt}),a.d(t,"t",function(){return Ut}),a.d(t,"u",function(){return zt}),a.d(t,"v",function(){return Vt}),a.d(t,"p",function(){return pi}),a.d(t,"w",function(){return ai});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var bs=function(a,e){return(bs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,e){a.__proto__=e}||function(a,e){for(var t in e)e.hasOwnProperty(t)&&(a[t]=e[t])})(a,e)},vs=function(){return(vs=Object.assign||function(a){for(var e=1,n=arguments.length,r;e<n;e++)for(var t in r=arguments[e])Object.prototype.hasOwnProperty.call(r,t)&&(a[t]=r[t]);return a}).apply(this,arguments)},Cs={},Rs={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0},Ss=Object.freeze({shuffle:w,clamp:I,nearestLargerEven:N,sum:T,randUniform:D,distSquared:function(a,e){for(var t=0,n=0,r;n<a.length;n++)r=+a[n]-+e[n],t+=r*r;return t},assert:A,assertShapesMatch:O,assertNonNull:P,flatten:F,sizeFromShape:U,isScalarShape:function(t){return 0===t.length},arraysEqual:L,isInt:M,tanh:z,sizeToSquarishShape:G,createShuffledIndices:function(a){for(var e=new Uint32Array(a),t=0;t<a;++t)e[t]=t;return w(e),e},rightPad:V,repeatedTry:H,inferFromImplicitShape:q,parseAxisParam:K,squeezeShape:j,getTypedArrayFromDType:X,getArrayFromDType:Y,checkComputationForErrors:Q,checkConversionForErrors:Z,hasEncodingLoss:J,isTypedArray:ee,bytesPerElement:te,bytesFromStringArray:ae,isString:oe,isBoolean:ne,isNumber:re,inferDtype:se,isFunction:ie,nearestDivisor:ue,computeStrides:ce,toTypedArray:he,toNestedArray:ge,makeOnesTypedArray:ye,makeZerosTypedArray:xe,now:be,assertNonNegativeIntegerDimensions:ve}),Es=function(){function t(a,o){this.backendTimer=a,this.logger=o,null==o&&(this.logger=new _s)}return t.prototype.profileKernel=function(s,e){var i=this,a=this.backendTimer.time(function(){t=e()}),t;return(Array.isArray(t)?t:[t]).forEach(function(e){var t=e.dataSync();Q(t,e.dtype,s),a.then(function(n){var o="";null!=n.getExtraProfileInfo&&(o=n.getExtraProfileInfo()),i.logger.logKernelProfile(s,e,t,n.kernelMs,o)})}),t},t}(),_s=function(){function t(){}return t.prototype.logKernelProfile=function(p,e,t,n,r){var o=V(n+"ms",9),a=V(p,25),i=e.rank,s=e.size,d=V(e.shape.toString(),14);console.log("%c"+a+"\t%c"+o+"\t%c"+i+"D "+d+"\t%c"+s+"\t%c"+r,"font-weight:bold","color:red","color:blue","color: orange","color: green")},t}(),ks=20,ws=3,Is=7,Ns=function(){function t(a,s,t){var n=this;if(this.dtype=s,this.shape=a.slice(),this.size=U(a),null!=t){var r=t.length;A(r===this.size,function(){return"Length of values '"+r+"' does not match the size inferred by the shape '"+n.size+"'."})}if("complex64"===s)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=t||Y(s,this.size),this.strides=ce(a)}return t.prototype.set=function(a){for(var e=this,t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length&&(t=[0]),A(t.length===this.rank,function(){return"The number of provided coordinates ("+t.length+") must match the rank ("+e.rank+")"});var r=this.locToIndex(t);this.values[r]=a},t.prototype.get=function(){for(var p=[],e=0;e<arguments.length;e++)p[e]=arguments[e];0===p.length&&(p=[0]);for(var t=0,n=0,r=p,o;n<r.length;n++){if(o=r[n],0>o||o>=this.shape[t]){var a="Requested out of range element at "+p+".   Buffer shape="+this.shape;throw new Error(a)}t++}for(var i=p[p.length-1],s=0;s<p.length-1;++s)i+=this.strides[s]*p[s];return this.values[i]},t.prototype.locToIndex=function(a){if(0===this.rank)return 0;if(1===this.rank)return a[0];for(var e=a[a.length-1],t=0;t<a.length-1;++t)e+=this.strides[t]*a[t];return e},t.prototype.indexToLoc=function(a){if(0===this.rank)return[];if(1===this.rank)return[a];for(var e=Array(this.shape.length),t=0;t<e.length-1;++t)e[t]=$(a/this.strides[t]),a-=e[t]*this.strides[t];return e[e.length-1]=a,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return Os.make(this.shape,{values:this.values},this.dtype)},t}(),Ts=null,Ds=null,As=null,Os=function(){function a(a,s,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=a.slice(),this.dtype=s||"float32",this.size=U(a),this.strides=ce(a),this.dataId=null==n?{}:n,this.id=Ts().nextTensorId(),this.rankType=5>this.rank?this.rank.toString():"higher",Ts().registerTensor(this,r),null!=t&&Ts().write(this.dataId,t)}return a.make=function(e,t,n,r){return new a(e,n,t.values,t.dataId,r)},a.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},a.prototype.asScalar=function(){return this.throwIfDisposed(),A(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},a.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},a.prototype.as2D=function(a,e){return this.throwIfDisposed(),this.reshape([a,e])},a.prototype.as3D=function(a,e,t){return this.throwIfDisposed(),this.reshape([a,e,t])},a.prototype.as4D=function(a,e,t,o){return this.throwIfDisposed(),this.reshape([a,e,t,o])},a.prototype.as5D=function(a,e,t,n,r){return this.throwIfDisposed(),this.reshape([a,e,t,n,r])},a.prototype.asType=function(t){return this.throwIfDisposed(),Ds.cast(this,t)},Object.defineProperty(a.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),a.prototype.buffer=function(){return x(this,void 0,void 0,function(){var a;return R(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return a=e.sent(),[2,Ds.buffer(this.shape,this.dtype,a)];}})})},a.prototype.bufferSync=function(){return Ds.buffer(this.shape,this.dtype,this.dataSync())},a.prototype.array=function(){return x(this,void 0,void 0,function(){var a;return R(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return a=e.sent(),[2,ge(this.shape,a)];}})})},a.prototype.arraySync=function(){return ge(this.shape,this.dataSync())},a.prototype.data=function(){return x(this,void 0,void 0,function(){return R(this,function(){return this.throwIfDisposed(),[2,Ts().read(this.dataId)]})})},a.prototype.dataSync=function(){return this.throwIfDisposed(),Ts().readSync(this.dataId)},a.prototype.dispose=function(){this.isDisposed||(Ts().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(a.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),a.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},a.prototype.toFloat=function(){return this.asType("float32")},a.prototype.toInt=function(){return this.asType("int32")},a.prototype.toBool=function(){return this.asType("bool")},a.prototype.print=function(t){return void 0===t&&(t=!1),Ds.print(this,t)},a.prototype.reshape=function(t){return this.throwIfDisposed(),Ds.reshape(this,t)},a.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},a.prototype.expandDims=function(t){return void 0===t&&(t=0),Ds.expandDims(this,t)},a.prototype.cumsum=function(a,e,t){return void 0===a&&(a=0),void 0===e&&(e=!1),void 0===t&&(t=!1),Ds.cumsum(this,a,e,t)},a.prototype.squeeze=function(t){return this.throwIfDisposed(),Ds.squeeze(this,t)},a.prototype.clone=function(){return this.throwIfDisposed(),Ds.clone(this)},a.prototype.oneHot=function(a,e,t){return this.throwIfDisposed(),Ds.oneHot(this,a,e,t)},a.prototype.toString=function(t){return void 0===t&&(t=!1),Ce(this.dataSync(),this.shape,this.dtype,t)},a.prototype.tile=function(t){return this.throwIfDisposed(),Ds.tile(this,t)},a.prototype.gather=function(a,e){return void 0===e&&(e=0),this.throwIfDisposed(),Ds.gather(this,a,e)},a.prototype.matMul=function(a,e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),this.throwIfDisposed(),Ds.matMul(this,a,e,t)},a.prototype.dot=function(t){return this.throwIfDisposed(),Ds.dot(this,t)},a.prototype.norm=function(a,e,t){return void 0===a&&(a="euclidean"),void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),Ds.norm(this,a,e,t)},a.prototype.slice=function(a,e){return this.throwIfDisposed(),Ds.slice(this,a,e)},a.prototype.reverse=function(t){return this.throwIfDisposed(),Ds.reverse(this,t)},a.prototype.concat=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),e instanceof a&&(e=[e]),Ds.concat([this].concat(e),t)},a.prototype.split=function(a,e){return void 0===e&&(e=0),this.throwIfDisposed(),Ds.split(this,a,e)},a.prototype.stack=function(a,e){return void 0===e&&(e=0),Ds.stack([this,a],e)},a.prototype.unstack=function(t){return void 0===t&&(t=0),Ds.unstack(this,t)},a.prototype.pad=function(a,e){return void 0===e&&(e=0),Ds.pad(this,a,e)},a.prototype.batchNormalization=function(a,e,t,n,r){return void 0===t&&(t=.001),As("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(a,e,r,n,t)},a.prototype.batchNorm=function(a,e,t,n,r){return void 0===r&&(r=.001),this.throwIfDisposed(),Ds.batchNorm(this,a,e,t,n,r)},a.prototype.all=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ds.all(this,a,e)},a.prototype.any=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ds.any(this,a,e)},a.prototype.logSumExp=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ds.logSumExp(this,a,e)},a.prototype.sum=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ds.sum(this,a,e)},a.prototype.prod=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ds.prod(this,a,e)},a.prototype.mean=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ds.mean(this,a,e)},a.prototype.min=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ds.min(this,a,e)},a.prototype.max=function(a,e){return void 0===a&&(a=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ds.max(this,a,e)},a.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Ds.argMin(this,t)},a.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Ds.argMax(this,t)},a.prototype.cast=function(t){return this.throwIfDisposed(),Ds.cast(this,t)},a.prototype.add=function(t){return this.throwIfDisposed(),Ds.add(this,t)},a.prototype.addStrict=function(t){return this.throwIfDisposed(),Ds.addStrict(this,t)},a.prototype.atan2=function(t){return this.throwIfDisposed(),Ds.atan2(this,t)},a.prototype.sub=function(t){return this.throwIfDisposed(),Ds.sub(this,t)},a.prototype.subStrict=function(t){return this.throwIfDisposed(),Ds.subStrict(this,t)},a.prototype.pow=function(t){return this.throwIfDisposed(),Ds.pow(this,t)},a.prototype.powStrict=function(t){return this.throwIfDisposed(),Ds.powStrict(this,t)},a.prototype.mul=function(t){return this.throwIfDisposed(),Ds.mul(this,t)},a.prototype.mulStrict=function(t){return this.throwIfDisposed(),Ds.mulStrict(this,t)},a.prototype.div=function(t){return this.throwIfDisposed(),Ds.div(this,t)},a.prototype.floorDiv=function(t){return this.throwIfDisposed(),Ds.floorDiv(this,t)},a.prototype.divStrict=function(t){return this.throwIfDisposed(),Ds.divStrict(this,t)},a.prototype.minimum=function(t){return this.throwIfDisposed(),Ds.minimum(this,t)},a.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Ds.minimumStrict(this,t)},a.prototype.maximum=function(t){return this.throwIfDisposed(),Ds.maximum(this,t)},a.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Ds.maximumStrict(this,t)},a.prototype.mod=function(t){return this.throwIfDisposed(),Ds.mod(this,t)},a.prototype.modStrict=function(t){return this.throwIfDisposed(),Ds.modStrict(this,t)},a.prototype.squaredDifference=function(t){return this.throwIfDisposed(),Ds.squaredDifference(this,t)},a.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Ds.squaredDifferenceStrict(this,t)},a.prototype.transpose=function(t){return this.throwIfDisposed(),Ds.transpose(this,t)},a.prototype.notEqual=function(t){return this.throwIfDisposed(),Ds.notEqual(this,t)},a.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Ds.notEqualStrict(this,t)},a.prototype.less=function(t){return this.throwIfDisposed(),Ds.less(this,t)},a.prototype.lessStrict=function(t){return this.throwIfDisposed(),Ds.lessStrict(this,t)},a.prototype.equal=function(t){return this.throwIfDisposed(),Ds.equal(this,t)},a.prototype.equalStrict=function(t){return this.throwIfDisposed(),Ds.equalStrict(this,t)},a.prototype.lessEqual=function(t){return this.throwIfDisposed(),Ds.lessEqual(this,t)},a.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Ds.lessEqualStrict(this,t)},a.prototype.greater=function(t){return this.throwIfDisposed(),Ds.greater(this,t)},a.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Ds.greaterStrict(this,t)},a.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Ds.greaterEqual(this,t)},a.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Ds.greaterEqualStrict(this,t)},a.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Ds.logicalAnd(this,t)},a.prototype.logicalOr=function(t){return this.throwIfDisposed(),Ds.logicalOr(this,t)},a.prototype.logicalNot=function(){return this.throwIfDisposed(),Ds.logicalNot(this)},a.prototype.logicalXor=function(t){return this.throwIfDisposed(),Ds.logicalXor(this,t)},a.prototype.where=function(a,e){return this.throwIfDisposed(),Ds.where(a,this,e)},a.prototype.neg=function(){return this.throwIfDisposed(),Ds.neg(this)},a.prototype.ceil=function(){return this.throwIfDisposed(),Ds.ceil(this)},a.prototype.floor=function(){return this.throwIfDisposed(),Ds.floor(this)},a.prototype.sign=function(){return this.throwIfDisposed(),Ds.sign(this)},a.prototype.exp=function(){return this.throwIfDisposed(),Ds.exp(this)},a.prototype.expm1=function(){return this.throwIfDisposed(),Ds.expm1(this)},a.prototype.log=function(){return this.throwIfDisposed(),Ds.log(this)},a.prototype.log1p=function(){return this.throwIfDisposed(),Ds.log1p(this)},a.prototype.sqrt=function(){return this.throwIfDisposed(),Ds.sqrt(this)},a.prototype.rsqrt=function(){return this.throwIfDisposed(),Ds.rsqrt(this)},a.prototype.square=function(){return this.throwIfDisposed(),Ds.square(this)},a.prototype.reciprocal=function(){return this.throwIfDisposed(),Ds.reciprocal(this)},a.prototype.abs=function(){return this.throwIfDisposed(),Ds.abs(this)},a.prototype.clipByValue=function(a,e){return this.throwIfDisposed(),Ds.clipByValue(this,a,e)},a.prototype.relu=function(){return this.throwIfDisposed(),Ds.relu(this)},a.prototype.elu=function(){return this.throwIfDisposed(),Ds.elu(this)},a.prototype.selu=function(){return this.throwIfDisposed(),Ds.selu(this)},a.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),Ds.leakyRelu(this,t)},a.prototype.prelu=function(t){return this.throwIfDisposed(),Ds.prelu(this,t)},a.prototype.sigmoid=function(){return this.throwIfDisposed(),Ds.sigmoid(this)},a.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ds.logSigmoid(this)},a.prototype.softplus=function(){return this.throwIfDisposed(),Ds.softplus(this)},a.prototype.zerosLike=function(){return this.throwIfDisposed(),Ds.zerosLike(this)},a.prototype.onesLike=function(){return this.throwIfDisposed(),Ds.onesLike(this)},a.prototype.sin=function(){return this.throwIfDisposed(),Ds.sin(this)},a.prototype.cos=function(){return this.throwIfDisposed(),Ds.cos(this)},a.prototype.tan=function(){return this.throwIfDisposed(),Ds.tan(this)},a.prototype.asin=function(){return this.throwIfDisposed(),Ds.asin(this)},a.prototype.acos=function(){return this.throwIfDisposed(),Ds.acos(this)},a.prototype.atan=function(){return this.throwIfDisposed(),Ds.atan(this)},a.prototype.sinh=function(){return this.throwIfDisposed(),Ds.sinh(this)},a.prototype.cosh=function(){return this.throwIfDisposed(),Ds.cosh(this)},a.prototype.tanh=function(){return this.throwIfDisposed(),Ds.tanh(this)},a.prototype.asinh=function(){return this.throwIfDisposed(),Ds.asinh(this)},a.prototype.acosh=function(){return this.throwIfDisposed(),Ds.acosh(this)},a.prototype.atanh=function(){return this.throwIfDisposed(),Ds.atanh(this)},a.prototype.erf=function(){return this.throwIfDisposed(),Ds.erf(this)},a.prototype.round=function(){return this.throwIfDisposed(),Ds.round(this)},a.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),Ds.step(this,t)},a.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Ds.softmax(this,t)},a.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Ds.logSoftmax(this,t)},a.prototype.resizeBilinear=function(a,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Ds.image.resizeBilinear(this,a,e)},a.prototype.resizeNearestNeighbor=function(a,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Ds.image.resizeNearestNeighbor(this,a,e)},a.prototype.conv1d=function(s,e,t,n,r,o){return void 0===n&&(n="NWC"),void 0===r&&(r=1),this.throwIfDisposed(),Ds.conv1d(this,s,e,t,n,r,o)},a.prototype.conv2d=function(s,e,t,n,r,o){return void 0===n&&(n="NHWC"),void 0===r&&(r=[1,1]),this.throwIfDisposed(),Ds.conv2d(this,s,e,t,n,r,o)},a.prototype.conv2dTranspose=function(a,e,t,n,r){return this.throwIfDisposed(),Ds.conv2dTranspose(this,a,e,t,n,r)},a.prototype.depthwiseConv2D=function(s,e,t,n,r,o){return void 0===n&&(n="NHWC"),void 0===r&&(r=[1,1]),this.throwIfDisposed(),Ds.depthwiseConv2d(this,s,e,t,n,r,o)},a.prototype.separableConv2d=function(s,e,t,n,r,o){return void 0===r&&(r=[1,1]),void 0===o&&(o="NHWC"),this.throwIfDisposed(),Ds.separableConv2d(this,s,e,t,n,r,o)},a.prototype.avgPool=function(a,e,t,o){return this.throwIfDisposed(),Ds.avgPool(this,a,e,t,o)},a.prototype.maxPool=function(a,e,t,o){return this.throwIfDisposed(),Ds.maxPool(this,a,e,t,o)},a.prototype.localResponseNormalization=function(a,e,t,o){return void 0===a&&(a=5),void 0===e&&(e=1),void 0===t&&(t=1),void 0===o&&(o=.5),Ds.localResponseNormalization(this,a,e,t,o)},a.prototype.pool=function(a,e,t,n,r){return this.throwIfDisposed(),Ds.pool(this,a,e,t,n,r)},a.prototype.variable=function(a,e,t){return void 0===a&&(a=!0),this.throwIfDisposed(),Ps.variable(this,a,e,t)},a.prototype.unsortedSegmentSum=function(a,e){return this.throwIfDisposed(),Ds.unsortedSegmentSum(this,a,e)},a.prototype.batchToSpaceND=function(a,e){return this.throwIfDisposed(),Ds.batchToSpaceND(this,a,e)},a.prototype.spaceToBatchND=function(a,e){return this.throwIfDisposed(),Ds.spaceToBatchND(this,a,e)},a.prototype.topk=function(a,e){return void 0===a&&(a=1),void 0===e&&(e=!0),this.throwIfDisposed(),Ds.topk(this,a,e)},a.prototype.stridedSlice=function(p,e,t,n,r,o,a,i){return void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),this.throwIfDisposed(),Ds.stridedSlice(this,p,e,t,n,r,o,a,i)},a.prototype.depthToSpace=function(a,e){return this.throwIfDisposed(),Ds.depthToSpace(this,a,e)},a.prototype.fft=function(){return this.throwIfDisposed(),Ds.spectral.fft(this)},a.prototype.ifft=function(){return this.throwIfDisposed(),Ds.spectral.ifft(this)},a.prototype.rfft=function(){return this.throwIfDisposed(),Ds.spectral.rfft(this)},a.prototype.irfft=function(){return this.throwIfDisposed(),Ds.spectral.irfft(this)},a}();Object.defineProperty(Os,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var Ps=function(a){function s(e,s,n){void 0===s&&(s=!0);var r=a.call(this,e.shape,e.dtype,null,e.dataId)||this;r.trainable=s,r.name=n,null==r.name&&(r.name=Ts().nextVariableId().toString());try{Ts().registerVariable(r)}catch(t){throw Ts().disposeTensor(r),t}return r}return y(s,a),s.variable=function(t,e,a,n){return void 0===e&&(e=!0),null!=n&&n!==t.dtype&&(t=t.asType(n)),new s(t,e,a)},s.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!L(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Ts().disposeTensor(this),this.dataId=t.dataId,Ts().registerTensor(this)},s}(Os);Object.defineProperty(Ps,Symbol.hasInstance,{value:function(t){return t instanceof Os&&null!=t.assign&&t.assign instanceof Function}});var Fs=Ps.variable,Bs,Ls,Ms,Ws,Us;!function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(Bs||(Bs={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Ls||(Ls={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Ms||(Ms={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Ws||(Ws={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Us||(Us={}));var zs={float32:Ws,int32:Ls,bool:Ms,complex64:Us},Gs=Object.freeze({makeTypesMatch:Ae,assertTypesMatch:Oe,isTensorInList:function(a,e){for(var t=0;t<e.length;t++)if(e[t].id===a.id)return!0;return!1},getTensorsInContainer:Pe}),Vs=function(){function t(a,o,t){this.backend=a,this.safeMode=o,this.debugMode=t,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiler=new Es(a),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.moveData=function(t){this.write(t,this.readSync(t))},t.prototype.tidy=function(a,s){var i=this,r=null,o;if(null==s){if("function"!=typeof a)throw new Error("Please provide a function to tidy()");s=a}else{if("string"!=typeof a&&!(a instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof s)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=a}return this.scopedRun(function(){return i.startScope(r)},function(){return i.endScope(o)},function(){return(o=s())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o})},t.prototype.scopedRun=function(a,o,e){a();try{var t=e();return o(),t}catch(t){throw o(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(a){var e=Os.make(a.shape,{dataId:a.dataId},a.dtype);return this.addTapeNode([a],e,function(t){return[t.toFloat()]}),e},t.prototype.runKernel=function(d,h,m){var n=this,o=[],g=this.isTapeOn(),e=null==this.activeScope?"":this.activeScope.name,i=function(t){g&&(o=t.map(function(t){return n.keep(n.clone(t))}))},u=this.numBytes,c=this.numTensors,l;if(this.scopedRun(function(){return n.kernelDepth++},function(){return n.kernelDepth--},function(){l=n.debugMode()?n.profiler.profileKernel(e,function(){return d(n.backend,i)}):d(n.backend,i)}),g){var r={id:this.nextTapeNodeId++,name:e,inputs:h,outputs:Array.isArray(l)?l:[l],saved:o};null!=m&&(r.gradient=function(t){return m(t,o)}),this.activeTape.push(r)}return this.profiling&&this.activeProfile.kernels.push({name:e,bytesAdded:this.numBytes-u,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-c,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(h).map(function(t){return h[t].shape}),outputShape:Array.isArray(l)?l.map(function(t){return t.shape}):l.shape}),l},t.prototype.registerTensor=function(a,e){var t=this.tensorInfo.has(a.dataId)?this.tensorInfo.get(a.dataId).refCount:0;if(this.numTensors++,"string"===a.dtype&&this.numStringTensors++,0===t){this.numDataBuffers++;var o=0;"complex64"!==a.dtype&&"string"!==a.dtype&&(o=a.size*te(a.dtype)),this.tensorInfo.set(a.dataId,{backend:null==e?this.backend:e,dtype:a.dtype,shape:a.shape,bytes:o,refCount:0}),this.numBytes+=o,null==e?this.backend.register(a.dataId,a.shape,a.dtype):e.register(a.dataId,a.shape,a.dtype)}this.tensorInfo.get(a.dataId).refCount++,a instanceof Ps||this.track(a)},t.prototype.registerVariable=function(t){if(null!=this.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(a){if(this.tensorInfo.has(a.dataId)){this.numTensors--,"string"===a.dtype&&this.numStringTensors--;var e=this.tensorInfo.get(a.dataId);1>=e.refCount?("complex64"!==a.dtype&&(this.numBytes-=e.bytes),this.numDataBuffers--,e.backend.disposeData(a.dataId),this.tensorInfo.delete(a.dataId)):this.tensorInfo.get(a.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var a in this.registeredVariables){var e=this.registeredVariables[a];this.disposeTensor(e),delete this.registeredVariables[a]}},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,0<this.numStringTensors&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(a){return x(this,void 0,void 0,function(){var e,t;return R(this,function(){return this.profiling=!0,e=this.numBytes,t=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=a(),this.profiling=!1,this.activeProfile.peakBytes=de.apply(Math,this.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-e,this.activeProfile.newTensors=this.numTensors-t,[2,this.activeProfile]})})},t.prototype.isTapeOn=function(){return 0<this.gradientDepth&&0===this.kernelDepth},t.prototype.addTapeNode=function(a,e,s){var n={};a.forEach(function(a,e){n[e]=a});var t={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:n,outputs:[e],gradient:function(a){var o={};return s(a).forEach(function(t,e){o[e]=function(){return t}}),o}};this.activeTape.push(t)},t.prototype.keep=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return t.kept=!0,t},t.prototype.startTape=function(){0===this.gradientDepth&&(this.activeTape=[]),this.gradientDepth++},t.prototype.endTape=function(){this.gradientDepth--},t.prototype.startScope=function(a){var e={track:[],name:"unnamed scope",id:this.nextScopeId++};a&&(e.name=a),this.scopeStack.push(e),this.activeScope=e},t.prototype.endScope=function(s){for(var p=this,e=Pe(s),t=new Set(e.map(function(t){return t.id})),n=0,o;n<this.activeScope.track.length;n++)o=this.activeScope.track[n],o.kept||t.has(o.id)||o.dispose();var a=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?null:this.scopeStack[this.scopeStack.length-1],e.forEach(function(t){t.kept||t.scopeId!==a.id||p.track(t)})},t.prototype.gradients=function(s,p,t,e){var n=this;if(void 0===e&&(e=!1),A(0<p.length,function(){return"gradients() received an empty list of xs."}),null!=t&&"float32"!==t.dtype)throw new Error("dy must have 'float32' dtype, but has '"+t.dtype+"'");var o=this.scopedRun(function(){return n.startTape()},function(){return n.endTape()},function(){return n.tidy("forward",s)});A(o instanceof Os,function(){return"The result y returned by f() must be a tensor."});var d=Ie(this.activeTape,p,o);if(!e&&0===d.length&&0<p.length)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var s={};s[o.id]=null==t?Le(o.shape):t,Ne(s,d,function(t){return n.tidy(t)});var e=p.map(function(e){return s[e.id]});return 0===n.gradientDepth&&(n.activeTape.forEach(function(a){for(var e in a.saved)a.saved[e].dispose()}),n.activeTape=null),{value:o,grads:e}})},t.prototype.customGrad=function(a){var e=this;return A(ie(a),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var s=[],t=0,r;t<arguments.length;t++)s[t]=arguments[t];A(s.every(function(t){return t instanceof Os}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return s.forEach(function(a,e){o[e]=a}),e.runKernel(function(e,t){return A((r=a.apply(void 0,s.concat([t]))).value instanceof Os,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),A(ie(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},o,function(n,e){var t=r.gradFunc(n,e),o=Array.isArray(t)?t:[t];A(o.length===s.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),A(o.every(function(t){return t instanceof Os}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return o.forEach(function(o,e){a[e]=function(){return o}}),a})}},t.prototype.write=function(a,e){var t=this.tensorInfo.get(a);if("string"===t.dtype){var o=ae(e);this.numBytes+=o-t.bytes,t.bytes=o}this.backend!==t.backend&&(t.backend.disposeData(a),t.backend=this.backend,this.backend.register(a,t.shape,t.dtype)),this.backend.write(a,e)},t.prototype.readSync=function(t){return this.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.tensorInfo.get(t).backend.read(t)},t.prototype.fromPixels=function(a,e){return this.backend.fromPixels(a,e)},t.prototype.time=function(a){return x(this,void 0,void 0,function(){var e,t;return R(this,function(o){switch(o.label){case 0:return e=be(),[4,this.backend.time(a)];case 1:return(t=o.sent()).wallMs=be()-e,[2,t];}})})},t.prototype.track=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return null!=this.activeScope&&(t.scopeId=this.activeScope.id,this.activeScope.track.push(t)),t},t.nextTensorId=0,t.nextVariableId=0,t}(),Hs;!function(t){t[t.NUMBER=0]="NUMBER",t[t.BOOLEAN=1]="BOOLEAN",t[t.STRING=2]="STRING"}(Hs||(Hs={}));var qs=[{name:"DEBUG",type:Hs.BOOLEAN},{name:"IS_BROWSER",type:Hs.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:Hs.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:Hs.BOOLEAN},{name:"WEBGL_PACK",type:Hs.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:Hs.BOOLEAN},{name:"WEBGL_PACK_CLIP",type:Hs.BOOLEAN},{name:"WEBGL_PACK_DEPTHWISECONV",type:Hs.BOOLEAN},{name:"WEBGL_PACK_BINARY_OPERATIONS",type:Hs.BOOLEAN},{name:"WEBGL_PACK_ARRAY_OPERATIONS",type:Hs.BOOLEAN},{name:"WEBGL_PACK_IMAGE_OPERATIONS",type:Hs.BOOLEAN},{name:"WEBGL_PACK_REDUCE",type:Hs.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:Hs.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:Hs.NUMBER},{name:"WEBGL_NUM_MB_BEFORE_PAGING",type:Hs.NUMBER},{name:"WEBGL_MAX_TEXTURES_IN_SHADER",type:Hs.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:Hs.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:Hs.BOOLEAN},{name:"WEBGL_VERSION",type:Hs.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:Hs.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:Hs.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:Hs.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:Hs.NUMBER},{name:"BACKEND",type:Hs.STRING},{name:"EPSILON",type:Hs.NUMBER},{name:"PROD",type:Hs.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:Hs.BOOLEAN},{name:"DEPRECATION_WARNINGS_ENABLED",type:Hs.BOOLEAN}],$s="tfjsflags",Ks=600,js=1e-4,Xs=1e-7,Ys=function(){function t(t){this.features={},this.registry={},this.registryFactory={},null!=t&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return t.setBackend=function(a,e){if(void 0===e&&(e=!1),!(a in ei.registry))throw new Error("Backend name '"+a+"' not found in registry");ei.engine.backend=ei.findBackend(a),ei.backendName=a},t.getBackend=function(){return ei.initEngine(),ei.backendName},t.disposeVariables=function(){ei.engine.disposeVariables()},t.memory=function(){return ei.engine.memory()},t.profile=function(t){return ei.engine.profile(t)},t.tidy=function(a,e){return ei.engine.tidy(a,e)},t.dispose=function(t){Pe(t).forEach(function(t){return t.dispose()})},t.keep=function(t){return ei.engine.keep(t)},t.time=function(t){return ei.engine.time(t)},t.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},t.prototype.getFeatures=function(){return this.features},t.prototype.set=function(a,e){this.features[a]=e},t.prototype.getBestBackendName=function(){var a=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(e){return{name:e,entry:a.registry[e]}}).sort(function(a,e){return e.entry.priority-a.entry.priority})[0].name},t.prototype.evaluateFeature=function(a){if("DEBUG"===a)return!1;if("IS_BROWSER"===a)return"undefined"!=typeof window;if("IS_NODE"===a)return"undefined"!=typeof r&&void 0!==r.versions&&void 0!==r.versions.node;if("IS_CHROME"===a)return qe();if("WEBGL_CPU_FORWARD"===a)return!0;if("WEBGL_PACK"===a)return 0!==this.get("WEBGL_VERSION");if("WEBGL_PACK_BATCHNORMALIZATION"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_CLIP"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_DEPTHWISECONV"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_BINARY_OPERATIONS"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_ARRAY_OPERATIONS"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_IMAGE_OPERATIONS"===a)return this.get("WEBGL_PACK");if("WEBGL_PACK_REDUCE"===a)return this.get("WEBGL_PACK");if("WEBGL_LAZILY_UNPACK"===a)return this.get("WEBGL_PACK");if("WEBGL_CONV_IM2COL"===a)return this.get("WEBGL_PACK");if("WEBGL_NUM_MB_BEFORE_PAGING"===a)return this.get("PROD")||!this.get("IS_BROWSER")?W:Qe();if("WEBGL_MAX_TEXTURE_SIZE"===a)return We(this.get("WEBGL_VERSION"));if("WEBGL_MAX_TEXTURES_IN_SHADER"===a)return Ue(this.get("WEBGL_VERSION"));if("IS_TEST"===a)return!1;if("BACKEND"===a)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===a){var e=this.get("WEBGL_VERSION");return 0===e?0:ze(e)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===a)return 0<this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")&&!k();if("HAS_WEBGL"===a)return 0<this.get("WEBGL_VERSION");if("WEBGL_VERSION"===a)return Me(2)?2:Me(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===a)return Ge(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===a)return Ve(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===a)return He(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===a)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?4:0;if("TEST_EPSILON"===a)return 32===this.backend.floatPrecision()?.001:.1;if("EPSILON"===a)return 32===this.backend.floatPrecision()?Xs:js;if("PROD"===a)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===a)return!this.get("PROD");if("DEPRECATION_WARNINGS_ENABLED"===a)return!0;throw new Error("Unknown feature "+a+".")},t.prototype.setFeatures=function(t){this.features=Object.assign({},t)},t.prototype.reset=function(){this.features=$e(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(t.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),t.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t]:null},t.prototype.registerBackend=function(a,e,t){var s=this;if(void 0===t&&(t=1),a in this.registry)return console.warn(a+" backend was already registered. Reusing existing backend"),!1;try{var r=e();return r.setDataMover({moveData:function(t){return s.engine.moveData(t)}}),this.registry[a]={backend:r,priority:t},this.registryFactory[a]=e,!0}catch(e){return console.warn("Registration of backend "+a+" failed"),console.warn(e.stack||e.message),!1}},t.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(t.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),t.prototype.initEngine=function(){var a=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var e=this.findBackend(this.backendName);this.globalEngine=new Vs(e,!1,function(){return a.get("DEBUG")})}},Object.defineProperty(t.prototype,"global",{get:function(){return Ze()},enumerable:!0,configurable:!0}),t}(),Qs,Zs,Js;(function(t){As=t})(Je);var ei=function(){var t=Ze();return null==t.ENV&&(t.ENV=new Ys($e())),we(function(){return t.ENV.engine}),t.ENV}(),ti=Object.freeze({EPSILON_FLOAT16:js,EPSILON_FLOAT32:Xs,Environment:Ys,enableProdMode:function(){ei.set("PROD",!0)},enableDebugMode:function(){ei.set("DEBUG",!0)},disableDeprecationWarnings:function(){ei.set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")},deprecationWarn:Je,ENV:ei}),ai=Ys.tidy,oi=Ys.keep,ni=Ys.dispose,ri=Ys.time,si=Ys.profile,ii=30,pi=Lt({softmax_:function(a,s){void 0===s&&(s=-1);var e=ot(a,"logits","softmax");if(-1===s&&(s=e.rank-1),s!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+s);return st(function(t,e){var a=t.logSumExp([s],!0),n=t.toFloat().sub(a).exp();return e([n]),{value:n,gradFunc:function(t,e){var a=e[0],n=t.mul(a);return n.sub(n.sum([s],!0).mul(a))}}})(e)}}),di=Lt({logSoftmax_:function(a,s){void 0===s&&(s=-1);var e=ot(a,"logits","logSoftmax");if(-1===s&&(s=e.rank-1),s!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+s);return st(function(t,e){var n=t.max(s,!0),r=t.sub(n),o=r.toFloat().sub(r.exp().sum(s,!0).log());return e([o]),{value:o,gradFunc:function(t,e){var a=e[0].exp();return t.sub(t.sum(s,!0).mul(a))}}})(e)}}),li=Lt({complex_:function(a,e){var t=ot(a,"real","complex"),o=ot(e,"imag","complex");return O(t.shape,o.shape,"real and imag shapes, "+t.shape+" and "+o.shape+", must match in call to tf.complex()."),ei.engine.runKernel(function(a){return a.complex(t,o)},{$real:t,$imag:o})}}),ui=Lt({real_:function(a){var o=ot(a,"input","real");return ei.engine.runKernel(function(t){return t.real(o)},{$input:o})}}),ci=Lt({imag_:function(a){var o=ot(a,"input","imag");return ei.engine.runKernel(function(t){return t.imag(o)},{$input:o})}}),hi=Lt({onesLike_:function(a){var o=ot(a,"x","onesLike");if("complex64"===o.dtype){var e=hi(ui(o)),n=mi(ci(o));return li(e,n)}return ei.engine.runKernel(function(t){return t.onesLike(o)},{$x:o},null)}}),mi=Lt({zerosLike_:function(a){var o=ot(a,"x","zerosLike");return ei.engine.runKernel(function(t){return t.zerosLike(o)},{$x:o},null)}}),gi=function(){function t(t){this.dataMover=t,this.data=new WeakMap}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},t.prototype.set=function(a,e){this.data.set(a,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.data.delete(t)},t}(),fi=function(){function t(){}return t.prototype.time=function(){throw new Error("Not yet implemented.")},t.prototype.read=function(){throw new Error("Not yet implemented.")},t.prototype.readSync=function(){throw new Error("Not yet implemented.")},t.prototype.disposeData=function(){throw new Error("Not yet implemented.")},t.prototype.write=function(){throw new Error("Not yet implemented.")},t.prototype.fromPixels=function(){throw new Error("Not yet implemented.")},t.prototype.register=function(){throw new Error("Not yet implemented.")},t.prototype.memory=function(){throw new Error("Not yet implemented.")},t.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},t.prototype.batchMatMul=function(){throw new Error("Not yet implemented")},t.prototype.fusedBatchMatMul=function(){throw new Error("Not yet implemented")},t.prototype.slice=function(){throw new Error("Not yet implemented")},t.prototype.stridedSlice=function(){throw new Error("Not yet implemented")},t.prototype.unstack=function(){throw new Error("Not yet implemented")},t.prototype.reverse=function(){throw new Error("Not yet implemented")},t.prototype.concat=function(){throw new Error("Not yet implemented")},t.prototype.neg=function(){throw new Error("Not yet implemented")},t.prototype.add=function(){throw new Error("Not yet implemented")},t.prototype.addN=function(){throw new Error("Not yet implemented")},t.prototype.subtract=function(){throw new Error("Not yet implemented")},t.prototype.multiply=function(){throw new Error("Not yet implemented")},t.prototype.realDivide=function(){throw new Error("Not yet implemented")},t.prototype.floorDiv=function(){throw new Error("Not yet implemented")},t.prototype.sum=function(){throw new Error("Not yet implemented")},t.prototype.prod=function(){throw new Error("Not yet implemented")},t.prototype.unsortedSegmentSum=function(){throw new Error("Not yet implemented")},t.prototype.argMin=function(){throw new Error("Not yet implemented")},t.prototype.argMax=function(){throw new Error("Not yet implemented")},t.prototype.equal=function(){throw new Error("Not yet implemented")},t.prototype.notEqual=function(){throw new Error("Not yet implemented")},t.prototype.less=function(){throw new Error("Not yet implemented")},t.prototype.lessEqual=function(){throw new Error("Not yet implemented")},t.prototype.greater=function(){throw new Error("Not yet implemented")},t.prototype.greaterEqual=function(){throw new Error("Not yet implemented")},t.prototype.logicalNot=function(){throw new Error("Not yet implemented")},t.prototype.logicalAnd=function(){throw new Error("Not yet implemented")},t.prototype.logicalOr=function(){throw new Error("Not yet implemented")},t.prototype.where=function(){throw new Error("Not yet implemented")},t.prototype.select=function(){throw new Error("Not yet implemented")},t.prototype.topk=function(){throw new Error("Not yet implemented")},t.prototype.min=function(){throw new Error("Not yet implemented")},t.prototype.minimum=function(){throw new Error("Not yet implemented")},t.prototype.mod=function(){throw new Error("Not yet implemented")},t.prototype.max=function(){throw new Error("Not yet implemented")},t.prototype.maximum=function(){throw new Error("Not yet implemented")},t.prototype.all=function(){throw new Error("Not yet implemented")},t.prototype.any=function(){throw new Error("Not yet implemented")},t.prototype.squaredDifference=function(){throw new Error("Not yet implemented")},t.prototype.ceil=function(){throw new Error("Not yet implemented")},t.prototype.floor=function(){throw new Error("Not yet implemented")},t.prototype.round=function(){throw new Error("Not yet implemented")},t.prototype.sign=function(){throw new Error("Not yet implemented")},t.prototype.isNaN=function(){throw new Error("Not yet implemented")},t.prototype.isInf=function(){throw new Error("Not yet implemented")},t.prototype.isFinite=function(){throw new Error("Not yet implemented")},t.prototype.pow=function(){throw new Error("Not yet implemented")},t.prototype.exp=function(){throw new Error("Not yet implemented")},t.prototype.expm1=function(){throw new Error("Not yet implemented")},t.prototype.log=function(){throw new Error("Not yet implemented")},t.prototype.log1p=function(){throw new Error("Not yet implemented")},t.prototype.sqrt=function(){throw new Error("Not yet implemented")},t.prototype.rsqrt=function(){throw new Error("Not yet implemented")},t.prototype.square=function(){throw new Error("Not yet implemented")},t.prototype.reciprocal=function(){throw new Error("Not yet implemented")},t.prototype.relu=function(){throw new Error("Not yet implemented")},t.prototype.prelu=function(){throw new Error("Not yet implemented")},t.prototype.elu=function(){throw new Error("Not yet implemented")},t.prototype.eluDer=function(){throw new Error("Not yet implemented")},t.prototype.selu=function(){throw new Error("Not yet implemented")},t.prototype.int=function(){throw new Error("Not yet implemented")},t.prototype.clip=function(){throw new Error("Not yet implemented")},t.prototype.abs=function(){throw new Error("Not yet implemented")},t.prototype.complexAbs=function(){throw new Error("Not yet implemented")},t.prototype.sigmoid=function(){throw new Error("Not yet implemented")},t.prototype.softplus=function(){throw new Error("Not yet implemented")},t.prototype.sin=function(){throw new Error("Not yet implemented")},t.prototype.cos=function(){throw new Error("Not yet implemented")},t.prototype.tan=function(){throw new Error("Not yet implemented")},t.prototype.asin=function(){throw new Error("Not yet implemented")},t.prototype.acos=function(){throw new Error("Not yet implemented")},t.prototype.atan=function(){throw new Error("Not yet implemented")},t.prototype.atan2=function(){throw new Error("Not yet implemented")},t.prototype.sinh=function(){throw new Error("Not yet implemented")},t.prototype.cosh=function(){throw new Error("Not yet implemented")},t.prototype.tanh=function(){throw new Error("Not yet implemented")},t.prototype.asinh=function(){throw new Error("Not yet implemented")},t.prototype.acosh=function(){throw new Error("Not yet implemented")},t.prototype.atanh=function(){throw new Error("Not yet implemented")},t.prototype.erf=function(){throw new Error("Not yet implemented")},t.prototype.step=function(){throw new Error("Not yet implemented")},t.prototype.conv2d=function(){throw new Error("Not yet implemented")},t.prototype.conv2dDerInput=function(){throw new Error("Not yet implemented")},t.prototype.conv2dDerFilter=function(){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2D=function(){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerInput=function(){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerFilter=function(){throw new Error("Not yet implemented")},t.prototype.conv3d=function(){throw new Error("Not yet implemented")},t.prototype.conv3dDerInput=function(){throw new Error("Not yet implemented")},t.prototype.conv3dDerFilter=function(){throw new Error("Not yet implemented")},t.prototype.maxPool=function(){throw new Error("Not yet implemented")},t.prototype.maxPoolBackprop=function(){throw new Error("Not yet implemented")},t.prototype.avgPool=function(){throw new Error("Not yet implemented")},t.prototype.avgPoolBackprop=function(){throw new Error("Not yet implemented")},t.prototype.reshape=function(){throw new Error("Not yet implemented")},t.prototype.cast=function(){throw new Error("Not yet implemented")},t.prototype.tile=function(){throw new Error("Not yet implemented")},t.prototype.pad=function(){throw new Error("Not yet implemented")},t.prototype.transpose=function(){throw new Error("Not yet implemented")},t.prototype.gather=function(){throw new Error("Not yet implemented")},t.prototype.gatherND=function(){throw new Error("Not yet implemented")},t.prototype.scatterND=function(){throw new Error("Not yet implemented")},t.prototype.batchToSpaceND=function(){throw new Error("Not yet implemented")},t.prototype.spaceToBatchND=function(){throw new Error("Not yet implemented")},t.prototype.resizeBilinear=function(){throw new Error("Not yet implemented")},t.prototype.resizeBilinearBackprop=function(){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighbor=function(){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighborBackprop=function(){throw new Error("Not yet implemented")},t.prototype.batchNormalization=function(){throw new Error("Not yet implemented")},t.prototype.localResponseNormalization4D=function(){throw new Error("Not yet implemented")},t.prototype.LRNGrad=function(){throw new Error("Not yet implemented")},t.prototype.multinomial=function(){throw new Error("Not yet implemented")},t.prototype.oneHot=function(){throw new Error("Not yet implemented")},t.prototype.cumsum=function(){throw new Error("Not yet implemented")},t.prototype.nonMaxSuppression=function(){throw new Error("Not yet implemented")},t.prototype.fft=function(){throw new Error("Not yet implemented")},t.prototype.ifft=function(){throw new Error("Not yet implemented")},t.prototype.complex=function(){throw new Error("Not yet implemented")},t.prototype.real=function(){throw new Error("Not yet implemented")},t.prototype.imag=function(){throw new Error("Not yet implemented")},t.prototype.cropAndResize=function(){throw new Error("Not yet implemented")},t.prototype.depthToSpace=function(){throw new Error("Not yet implemented")},t.prototype.split=function(){throw new Error("Not yet implemented")},t.prototype.sparseToDense=function(){throw new Error("Not yet implemented")},t.prototype.fill=function(){throw new Error("Not yet implemented.")},t.prototype.onesLike=function(){throw new Error("Not yet implemented")},t.prototype.zerosLike=function(){throw new Error("Not yet implemented")},t.prototype.setDataMover=function(){throw new Error("Not yet implemented")},t.prototype.dispose=function(){throw new Error("Not yet implemented")},t}(),yi=function(){return function(p,e,t){this.variableNames=["A"];var n=p.windowSize,r=p.batchSize,o=p.inSize,a=pe(o/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[r,a];var i="max"===e?">":"<",s=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+n+"; i++) {\n          int inIdx = "+s+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+i+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}}(),xi="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",bi="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",vi="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Ci="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n",Ri=function(){return function(C,e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,A(2<C.length,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var r=C[C.length-1],o=pe(r/e);this.outputShape=C.slice(0,-1),1<o&&this.outputShape.push(o),n||this.variableNames.push("bestIndicesA");var a=this.outputShape,u=a.length,c=to(u),l=da("coords",u),p,i;if(1===o){var s=to(i=u+1);p="\n        "+s+" sourceLocR = "+s+"("+l.join()+", 0);\n        ++"+l[u-1]+";\n        "+s+" sourceLocG = "+s+"("+l.join()+", 0);\n        ++"+l[u-2]+";\n        "+s+" sourceLocA = "+s+"("+l.join()+", 0);\n        --"+l[u-1]+";\n        "+s+" sourceLocB = "+s+"("+l.join()+", 0);\n        --"+l[u-2]+";"}else i=u,p="\n        "+c+" sourceLocR = coords;\n        ++"+l[u-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+l[u-2]+";\n        "+c+" sourceLocA = coords;\n        --"+l[u-1]+";\n        "+c+" sourceLocB = coords;\n        --"+l[u-2]+";";var d=["x","y","z","w","u","v"].slice(0,i),h="."+d[i-1],f=d.map(function(t){return"int "+t}),m=da("sourceLocR",i-1).concat("inIdx.r"),g=da("sourceLocG",i-1).concat("inIdx.g"),v=da("sourceLocB",i-1).concat("inIdx.b"),y=da("sourceLocA",i-1).concat("inIdx.a"),x="max"===t?"greaterThan":"lessThan",R=n?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",S="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+v.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",b=n?"":"\n      float getBestIndicesAChannel("+f.join()+") {\n        return getChannel(getBestIndicesA("+d.join()+"),\n                                          vec2("+d.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+f.join()+") {\n        return getChannel(getA("+d.join()+"),\n                               vec2("+d.slice(-2).join()+"));\n      }\n      "+b+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+l[u-1]+" < "+(a[u-1]-1)+";\n        bool hasNextRow = "+l[u-2]+" < "+(a[u-2]-1)+";\n        "+p+"\n        ivec4 srcIdx = ivec4(sourceLocR"+h+", sourceLocG"+h+",\n          sourceLocB"+h+", sourceLocA"+h+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+S+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+R+"\n          vec4 candidate = "+S+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+x+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "}}(),Si=function(){return function(p){this.variableNames=["dy"],this.outputShape=p.inShape;var e=p.filterHeight,t=p.filterWidth,n=p.strideHeight,r=p.strideWidth,o=p.dilationHeight,a=p.dilationWidth,i=p.effectiveFilterHeight,s=p.effectiveFilterWidth,d=i-1-p.padInfo.top,u=s-1-p.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+d+", "+u+");\n      const float avgMultiplier = float("+1/(e*t)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n            wR += "+o+") {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+p.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+s+";\n            wC+= "+a+") {\n            float dyC = float(dyCCorner + wC) / "+r+".0;\n\n            if (dyC < 0.0 || dyC >= "+p.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Ei=function(){return function(p,e,t,n,r,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ha(p,e),ha(p,t);var a="0.0";null!=n&&(ha(p,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var i="1.0";null!=r&&(ha(p,r),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=p,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+i+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "}}(),_i=function(){return function(p,e,t,n,r,o){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],ha(p,e),ha(p,t);var a="vec4(0.0)";null!=n&&(ha(p,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var i="vec4(1.0)";null!=r&&(ha(p,r),this.variableNames.push("scale"),i="getScaleAtOutCoords()"),this.outputShape=p,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+i+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "}}(),ki={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},wi=function(){return function(a,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ha(e,t),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+a+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "}}(),Ii="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",Ni="return a + b;",Ti="return a - b;",Di="return a * b;",Ai="return (a - b) * (a - b);",Oi=function(){return function(a,e,t){this.variableNames=["A","B"],this.outputShape=ha(e,t),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+a+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}}(),Pi="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n",Fi=function(){return function(a,e,t){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=ha(e,t),this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+a+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}}(),Bi=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, min, max));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a,e){var t=this;return function(n,r){null==t.minLoc&&(t.minLoc=n.getUniformLocationNoThrow(r,"min"),t.maxLoc=n.getUniformLocationNoThrow(r,"max")),n.gl.uniform1f(t.minLoc,a),n.gl.uniform1f(t.maxLoc,e)}},t}(),Li=function(){function t(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t,this.userCode="\n      uniform float min;\n      uniform float max;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(min), vec4(max)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a,e){var t=this;return function(n,r){null==t.minLoc&&(t.minLoc=n.getUniformLocationNoThrow(r,"min"),t.maxLoc=n.getUniformLocationNoThrow(r,"max")),n.gl.uniform1f(t.minLoc,a),n.gl.uniform1f(t.maxLoc,e)}},t}(),Mi=function(){return function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}(),Wi=function(){return function(s){this.outputShape=[],this.outputShape=Rt(s,1),this.variableNames=s.map(function(a,e){return"T"+e});var e=Array(s.length-1);e[0]=s[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+s[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var r=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+r+"));")}var o=e.length,a=e[e.length-1];n.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+n.join("\n        ")+"\n      }\n    "}}(),Ui=function(){return function(m,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Rt(m,e);var t=this.outputShape,n=t.length,r=to(n),o=da("coords",n),a=["x","y","z","w","u","v"].slice(0,n);this.variableNames=m.map(function(a,e){return"T"+e});var i=Array(m.length-1);i[0]=m[0][e];for(var s=1;s<i.length;s++)i[s]=i[s-1]+m[s][e];var u=a[e],c="vec2("+a.slice(-2).join()+")",l=a.join(),p="if ("+u+" < "+i[0]+")\n          return getChannel(getT0("+l+"), "+c+");";for(s=1;s<i.length;s++){var d=i[s-1];p+="\n        else if ("+u+" < "+i[s]+") {\n          "+u+" -= "+d+";\n          return getChannel(getT"+s+"("+l+"), "+c+");\n        }"}var h=i.length;p+="\n        else {\n          "+u+" -= "+i[i.length-1]+";\n          return getChannel(getT"+h+"("+l+"), "+c+");\n        }",this.userCode="\n      float getValue("+a.map(function(t){return"int "+t})+") {\n        "+p+"\n      }\n\n      void main() {\n        "+r+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n        if (++"+o[n-1]+" < "+t[n-1]+") {\n          result.g = getValue("+o+");\n        }\n        if (++"+o[n-2]+" < "+t[n-2]+") {\n          result.a = getValue("+o+");\n        }\n        if ("+o[n-2]+" < "+t[n-2]+" &&\n            --"+o[n-1]+" < "+t[n-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "}}(),zi=function(){return function(a){this.variableNames=["x","dy"],this.outputShape=a.filterShape;var e=a.strideHeight,t=a.strideWidth,n=a.padInfo.top,r=a.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+a.batchSize+"; b++) {\n          for (int yR = 0; yR < "+a.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+n+";\n\n            if (xR < 0 || xR >= "+a.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+a.outWidth+"; yC++) {\n              int xC = wC + yC * "+t+" - "+r+";\n\n              if (xC < 0 || xC >= "+a.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Gi=function(){return function(s){this.variableNames=["dy","W"],this.outputShape=s.inShape;var e=s.filterHeight,t=s.filterWidth,n=s.strideHeight,r=s.strideWidth,o=e-1-s.padInfo.top,a=t-1-s.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+s.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r+".0;\n\n            if (dyC < 0.0 || dyC >= "+s.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+s.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Vi=function(){return function(s){this.variableNames=["x","dy"],this.outputShape=s.filterShape;var e=s.strideDepth,t=s.strideHeight,n=s.strideWidth,r=s.padInfo.front,o=s.padInfo.top,a=s.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+s.batchSize+"; b++) {\n          for (int yF = 0; yF < "+s.outDepth+"; yF++) {\n            int xF = wF + yF * "+e+" - "+r+";\n\n            if (xF < 0 || xF >= "+s.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+s.outHeight+"; yR++) {\n              int xR = wR + yR * "+t+" - "+o+";\n\n              if (xR < 0 || xR >= "+s.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+s.outWidth+"; yC++) {\n                int xC = wC + yC * "+n+" - "+a+";\n\n                if (xC < 0 || xC >= "+s.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Hi=function(){return function(p){this.variableNames=["dy","W"],this.outputShape=p.inShape;var e=p.filterDepth,t=p.filterHeight,n=p.filterWidth,r=p.strideDepth,o=p.strideHeight,a=p.strideWidth,i=e-1-p.padInfo.front,s=t-1-p.padInfo.top,d=n-1-p.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+i+", "+s+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+r+".0;\n\n          if (dyF < 0.0 || dyF >= "+p.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+t+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+o+".0;\n\n            if (dyR < 0.0 || dyR >= "+p.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+t+" - 1 - wR;\n\n            for (int wC = 0; wC < "+n+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+p.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+n+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+p.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),qi=function(){return function(s){this.variableNames=["x","dy"],this.outputShape=s.filterShape;var e=s.strideHeight,t=s.strideWidth,n=s.padInfo.top,r=s.padInfo.left,o=s.outChannels/s.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+o+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+s.batchSize+"; b++) {\n          for (int yR = 0; yR < "+s.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+n+";\n\n            if (xR < 0 || xR >= "+s.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+s.outWidth+"; yC++) {\n              int xC = wC + yC * "+t+" - "+r+";\n\n              if (xC < 0 || xC >= "+s.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),$i=function(){return function(p){this.variableNames=["dy","W"],this.outputShape=p.inShape;var e=p.filterHeight,t=p.filterWidth,n=p.strideHeight,r=p.strideWidth,o=e-1-p.padInfo.top,a=t-1-p.padInfo.left,i=p.outChannels/p.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n+".0;\n\n          if (dyR < 0.0 || dyR >= "+p.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+t+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+r+".0;\n\n            if (dyC < 0.0 || dyC >= "+p.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+t+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+i+"; dm++) {\n              int d2 = d1 * "+i+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Ki=function(){return function(p){this.variableNames=["x","W"],this.outputShape=p.outShape;var e=p.padInfo.top,t=p.padInfo.left,n=p.strideHeight,r=p.strideWidth,o=p.dilationHeight,a=p.dilationWidth,i=p.filterHeight,s=p.filterWidth,d=4*$(p.inChannels/4),u=p.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+n+", "+r+");\n      const ivec2 pads = ivec2("+e+", "+t+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+"; wR++) {\n          int xR = xRCorner + wR * "+o+";\n\n          if (xR < 0 || xR >= "+p.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+s+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+p.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1==u)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+d+") *\n                getW(wR, wC, "+d+", d2);\n            } else if ("+(2==u)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+d+"),\n                getX(batch, xR, xC, "+d+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3==u)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+d+"),\n                getX(batch, xR, xC, "+d+" + 1),\n                getX(batch, xR, xC, "+d+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),ji=function(){return function(m){this.variableNames=["x","W"],this.outputShape=m.outShape;var e=m.padInfo.front,t=m.padInfo.top,n=m.padInfo.left,r=m.strideDepth,o=m.strideHeight,a=m.strideWidth,i=m.dilationDepth,s=m.dilationHeight,u=m.dilationWidth,c=m.filterDepth,l=m.filterHeight,p=m.filterWidth,d=4*$(m.inChannels/4),h=m.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+r+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+t+", "+n+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+c+"; wF++) {\n          int xF = xFCorner + wF * "+i+";\n\n          if (xF < 0 || xF >= "+m.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+l+"; wR++) {\n            int xR = xRCorner + wR * "+s+";\n\n            if (xR < 0 || xR >= "+m.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+p+"; wC++) {\n              int xC = xCCorner + wC * "+u+";\n\n              if (xC < 0 || xC >= "+m.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1==h)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+d+") *\n                  getW(wF, wR, wC, "+d+", d2);\n              } else if ("+(2==h)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3==h)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1),\n                  getX(batch, xF, xR, xC, "+d+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2),\n                  getW(wF, wR, wC, "+d+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Xi=function(){return function(d){this.variableNames=["x","W"],this.outputShape=d.outShape;var e=d.inHeight,t=d.inWidth,n=d.padInfo.top,r=d.padInfo.left,o=d.strideHeight,a=d.strideWidth,i=d.dilationHeight,s=d.dilationWidth,u=d.filterHeight,c=d.filterWidth,l=d.outChannels/d.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+n+", "+r+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+l+";\n        int q = d2 - d1 * "+l+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+u+"; wR++) {\n          int xR = xRCorner + wR * "+i+";\n\n          if (xR < 0 || xR >= "+e+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+s+";\n\n            if (xC < 0 || xC >= "+t+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),Yi=function(){return function(y){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=y.outShape;for(var e=y.inHeight,t=y.inWidth,n=y.padInfo.top,r=y.padInfo.left,o=y.strideHeight,a=y.strideWidth,i=y.dilationHeight,s=y.dilationWidth,u=y.filterHeight,c=y.filterWidth,l=c,p="int xR; int xC; int xCOffset;",d=0;d<u;d++)for(var h=0;h<c;h++)p+="\n          vec4 xTexelR"+d+"C"+2*h+" = vec4(0.);\n          vec4 wR"+d+"C"+h+" = vec4(0.);\n          vec4 xR"+d+"C"+h+" = vec4(0.);";for(d=0;d<u;d++)for(var f=0;f<l;f++){if(!(p+="\n          xR = xRCorner + "+d*i+";\n          xC = xCCorner + "+(h=2*f)*s+";\n        ",1===a))h<c&&(p+="\n              if(xR >= 0 && xR < "+e+") {\n            ",1==r%2?(p+="\n                xCOffset = xC + 1 - "+a+";\n                if(xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+d+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+h+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+t+") {\n                  xTexelR"+d+"C"+(h+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+d+"C"+(h+2)+" = vec4(0.);\n                }\n\n                xR"+d+"C"+h+" = vec4(\n                  xTexelR"+d+"C"+h+".zw, xTexelR"+d+"C"+(h+2)+".zw);\n              ",h+1<c&&(p+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+a+";\n                  if(xCOffset >= 0 && xCOffset < "+t+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+d+"C"+(h+1)+" = vec4(xTexelR"+d+"C"+(h+2)+".xy, final.xy);\n                ")):(p+="\n                if(xC >= 0 && xC < "+t+") {\n                  xTexelR"+d+"C"+h+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+d+"C"+h+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+a+";\n                if(xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+d+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+(h+2)+" = vec4(0.);\n                }\n\n                xR"+d+"C"+h+" = vec4(\n                  xTexelR"+d+"C"+h+".xy, xTexelR"+d+"C"+(h+2)+".xy);\n              ",h+1<c&&(p+="\n                  xR"+d+"C"+(h+1)+" = vec4(\n                    xTexelR"+d+"C"+h+".zw, xTexelR"+d+"C"+(h+2)+".zw);\n                ")),p+="}");else if(h<c&&(p+=1==r%2?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+t+") {\n                  xTexelR"+d+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+d+"C"+h+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+e+" && xCOffset >= 0 && xCOffset < "+t+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n                  xR"+d+"C"+h+" = vec4(previous.zw, xTexelR"+d+"C"+h+".xy);\n                } else {\n                  xR"+d+"C"+h+" = vec4(0, 0, xTexelR"+d+"C"+h+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+e+" && xC >= 0 && xC < "+t+") {\n                  xTexelR"+d+"C"+h+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+d+"C"+h+" = vec4(0.);\n                }\n\n                xR"+d+"C"+h+" = xTexelR"+d+"C"+h+";\n              ",h+1<c)){var m=0==r%2?N(s):s;0==s%2&&1==r%2||0!=s%2&&1!=r%2?(p+="\n                  xCOffset = xC + "+r%2+" + "+m+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+t+") {\n                    xTexelR"+d+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",1<s&&(p+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+e+" &&\n                      xCOffset >= 0 && xCOffset < "+t+") {\n                      xTexelR"+d+"C"+h+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+d+"C"+h+" = vec4(0.);\n                    }\n                  "),p+="\n                  xR"+d+"C"+(h+1)+" = vec4(\n                    xTexelR"+d+"C"+h+".zw, xTexelR"+d+"C"+(h+2)+".xy);\n                "):p+="\n                  xCOffset = xC + "+m+";\n\n                  if(xR >= 0 && xR < "+e+" &&\n                    xCOffset >= 0 && xCOffset < "+t+") {\n                    xTexelR"+d+"C"+(h+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+d+"C"+(h+1)+" = xTexelR"+d+"C"+(h+2)+";\n                "}h<c&&(p+="\n            vec4 wTexelR"+d+"C"+h+" = getW("+d+", "+h+", d1, q);\n            wR"+d+"C"+h+" = vec4(wTexelR"+d+"C"+h+".xz, wTexelR"+d+"C"+h+".xz);\n          ",h+1<c&&(p+="\n              vec4 wTexelR"+d+"C"+(h+1)+" = getW("+d+", "+(h+1)+", d1, q);\n              wR"+d+"C"+(h+1)+" =\n                vec4(wTexelR"+d+"C"+(h+1)+".xz, wTexelR"+d+"C"+(h+1)+".xz);"))}for(d=0;d<u;d++)for(h=0;h<c;h++)p+="result += xR"+d+"C"+h+" * wR"+d+"C"+h+";";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+n+", "+r+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 result = vec4(0.);\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "}}(),Qi=function(){return function(C,e,t,n,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=C[0],a=C[1],i=C[2],s=C[3],u=e[0],c=t[0],l=t[1];this.outputShape=[u,c,l,s];var p="bilinear"===n?1:0,d=[a-1+".0",i-1+".0"],h=d[0],f=d[1],m=1<c?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+h+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+h],g=m[0],v=m[1],y=m[2],x=1<l?[""+(i-1)/(l-1),"(x2-x1) * width_ratio","x1*"+f+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+f],R=x[0],S=x[1],b=x[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+R+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+v+";\n        float width_scale = "+S+";\n\n        float in_y = "+y+";\n        if( in_y < 0.0 || in_y > "+h+" ) {\n          setOutput(float("+r+"));\n          return;\n        }\n        float in_x = "+b+";\n        if( in_x < 0.0 || in_x > "+f+" ) {\n          setOutput(float("+r+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+p+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "}}(),Zi=function(){return function(s,e,t){this.variableNames=["x"],this.outputShape=s;var n=s.length,r=s[s.length-1],o=t?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(t?"return "+r+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+to(n)+" coords = getOutputCoords();\n        int end = "+ro(n,"coords")+";\n        float val = 0.0;\n        for (int i = "+r+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+ro(n,"coords")+" = idx;\n          val += getX("+no(n,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}}(),Ji=function(){function t(a,o,t){this.variableNames=["x"],this.outputShape=[],this.outputShape=a,this.blockSize=o,this.dataFormat=t,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+o+";\n      int offset_h = imod(h, "+o+");\n      int in_w = w / "+o+";\n      int offset_w = imod(w, "+o+");\n      int offset_d = (offset_h * "+o+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),ep=function(){return function(a){this.variableNames=["A"];var e=ma();this.outputShape=a,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isnan(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "}}(),tp={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"},ap=function(){return function(s,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var r=t?"2.0 * "+d:"-2.0 * "+d,o=t?n+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+r+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+s+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+n+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+n+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+o+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "}}(),np=function(){function t(t){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a){var e=this;return function(t,o){null==e.valueLoc&&(e.valueLoc=t.getUniformLocationNoThrow(o,"value")),t.gl.uniform1f(e.valueLoc,a)}},t}(),rp=function(){return function(a){this.variableNames=["A"];var e=ma(),t=a[0],o=a[1];this.outputShape=a,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+o+".0, "+t+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}}(),sp=function(){return function(s,e,t){this.variableNames=["A","indices"];var n=s.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var r=to(this.rank),o=so(s,t);this.userCode="\n      void main() {\n        "+r+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "}}(),ip=function(){return function(s,e,t){this.sliceDim=s,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=to(e.length),r=to(t.length),o=1<this.sliceDim?"strides[j]":"strides";this.userCode="\n        "+n+" strides = "+n+"("+this.strides+");\n         void main() {\n          "+r+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+o+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "}}(),pp,dp;!function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(pp||(pp={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(dp||(dp={}));var lp=5.96e-8,up=65504,cp=/ERROR: [0-9]+:([0-9]+):/g,hp=Object.freeze({callAndCheck:xo,canBeRepresented:vo,getWebGLErrorMessage:Co,getExtensionOrThrow:Ro,createVertexShader:So,createFragmentShader:Eo,createProgram:ko,linkProgram:wo,validateProgram:Io,createStaticVertexBuffer:No,createStaticIndexBuffer:To,getNumChannels:Do,createTexture:Ao,validateTextureSize:Oo,createFramebuffer:Po,bindVertexBufferToProgramAttribute:Fo,bindTextureUnit:Bo,unbindTextureUnit:function(a,e,t){qo(a,t),xo(a,e,function(){return a.activeTexture(a.TEXTURE0+t)}),xo(a,e,function(){return a.bindTexture(a.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Lo,getProgramUniformLocation:Mo,bindTextureToProgramUniformSampler:Wo,bindCanvasToFramebuffer:function(a,e){xo(a,e,function(){return a.bindFramebuffer(a.FRAMEBUFFER,null)}),xo(a,e,function(){return a.viewport(0,0,a.canvas.width,a.canvas.height)}),xo(a,e,function(){return a.scissor(0,0,a.canvas.width,a.canvas.height)})},bindColorTextureToFramebuffer:Uo,unbindColorTextureFromFramebuffer:zo,validateFramebuffer:Go,getFramebufferErrorMessage:Vo,getBatchDim:$o,getRowsCols:Ko,getTextureShapeFromLogicalShape:jo,isReshapeFree:Yo}),mp=Object.freeze({createVertexShader:Qo,createVertexBuffer:Zo,createIndexBuffer:Jo,getTextureConfig:en,createFloat32MatrixTexture:an,createFloat16MatrixTexture:on,createUnsignedBytesMatrixTexture:nn,createPackedMatrixTexture:rn,createFloat16PackedMatrixTexture:sn,bindVertexProgramAttributeStreams:pn,uploadPixelDataToTexture:dn,uploadMatrixToTexture:un,uploadMatrixToPackedTexture:cn,maybeCreateBufferFromOutputTexture:hn,downloadFloat32MatrixFromBuffer:mn,downloadFloat32MatrixFromOutputTexture:gn,downloadByteEncodedFloatMatrixFromOutputTexture:fn,downloadPackedMatrixFromBuffer:yn,downloadMatrixFromPackedOutputTexture:xn}),gp=function(){function t(a){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var o=ei.get("WEBGL_VERSION");null==a?this.gl=S(o):(this.gl=a,v(o,a)),1===ei.get("WEBGL_VERSION")?(this.textureFloatExtension=Ro(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),ei.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Ro(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Ro(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=Zo(this.gl,this.debug),this.indexBuffer=Jo(this.gl,this.debug),this.framebuffer=Po(this.gl,this.debug),this.textureConfig=en(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return ei.get("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var a=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;xo(e,this.debug,function(){return e.finish()}),xo(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),xo(e,this.debug,function(){return e.deleteFramebuffer(a.framebuffer)}),xo(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),xo(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),xo(e,this.debug,function(){return e.deleteBuffer(a.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(a,e){return this.throwIfDisposed(),an(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(a,e){return this.throwIfDisposed(),on(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(a,e){return this.throwIfDisposed(),nn(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(a,e){this.throwIfDisposed(),dn(this.gl,this.debug,a,e)},t.prototype.createFloat16PackedMatrixTexture=function(a,e){return this.throwIfDisposed(),sn(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(a,e){return this.throwIfDisposed(),rn(this.gl,this.debug,a,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(a){var e=this;this.throwIfDisposed(),this.outputTexture===a&&(zo(this.gl,this.debug,this.framebuffer),this.outputTexture=null),xo(this.gl,this.debug,function(){return e.gl.deleteTexture(a)})},t.prototype.uploadMatrixToTexture=function(a,e,t,n){this.throwIfDisposed();var r=Do();return un(this.gl,this.debug,a,e,t,n,r,this.textureConfig)},t.prototype.uploadMatrixToPackedTexture=function(s,e,t,n,r,o,a){return this.throwIfDisposed(),cn(this.gl,this.debug,s,e,t,n,r,o,a,this.textureConfig)},t.prototype.downloadFloat32MatrixFromOutputTexture=function(a,e,t){var o=this;return this.downloadMatrixDriver(a,function(){return gn(o.gl,o.debug,e,t,o.textureConfig)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(a,e,t){var o=this;return this.downloadMatrixDriver(a,function(){return fn(o.gl,o.debug,e,t,o.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(s,e,t,n,r,o){return yn(this.gl,s,e,t,n,r,o,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(a,e,t){return mn(this.gl,a,e,t,this.textureConfig)},t.prototype.maybeCreateBufferFromTexture=function(a,e,t){this.bindTextureToFrameBuffer(a);var o=hn(this.gl,this.debug,a,e,t,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(s){var e=this,r,i;if(ei.get("WEBGL_FENCE_API_ENABLED")){var p=s,o=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);s.flush(),i=function(){var t=p.clientWaitSync(o,0,0);return t===p.ALREADY_SIGNALED||t===p.CONDITION_SATISFIED},r=o}else 0<ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?(r=this.beginQuery(),this.endQuery(),i=function(){return e.isQueryAvailable(r,ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):i=function(){return!0};return{query:r,isFencePassed:i}},t.prototype.downloadMatrixFromPackedTexture=function(s,e,t,n,r,o){var a=this;return this.downloadMatrixDriver(s,function(){return xn(a.gl,a.debug,e,t,n,r,o,a.textureConfig)})},t.prototype.createProgram=function(a){this.throwIfDisposed();var e=this.gl,t=Eo(e,this.debug,a),n=Qo(e,this.debug),r=ko(e,this.debug);return xo(e,this.debug,function(){return e.attachShader(r,n)}),xo(e,this.debug,function(){return e.attachShader(r,t)}),wo(e,this.debug,r),this.debug&&Io(e,this.debug,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=pn(e,this.debug,this.program,this.vertexBuffer)),r},t.prototype.deleteProgram=function(a){var e=this;this.throwIfDisposed(),a===this.program&&(this.program=null),null!=a&&xo(this.gl,this.debug,function(){return e.gl.deleteProgram(a)})},t.prototype.setProgram=function(a){var e=this;this.throwIfDisposed(),this.program=a,null!=this.program&&this.debug&&Io(this.gl,this.debug,this.program),xo(this.gl,this.debug,function(){return e.gl.useProgram(a)})},t.prototype.getUniformLocation=function(a,e,t){return void 0===t&&(t=!0),this.throwIfDisposed(),t?Lo(this.gl,this.debug,a,e):Mo(this.gl,a,e)},t.prototype.getAttributeLocation=function(a,e){var t=this;return this.throwIfDisposed(),xo(this.gl,this.debug,function(){return t.gl.getAttribLocation(a,e)})},t.prototype.getUniformLocationNoThrow=function(a,e){return this.throwIfDisposed(),this.gl.getUniformLocation(a,e)},t.prototype.setInputMatrixTexture=function(a,e,t){this.throwIfDisposed(),this.throwIfNoProgram(),Wo(this.gl,this.debug,this.program,a,e,t)},t.prototype.setOutputMatrixTexture=function(a,e,t){this.setOutputMatrixTextureDriver(a,t,e)},t.prototype.setOutputPackedMatrixTexture=function(s,e,t){this.throwIfDisposed();var n=mo(e,t),r=n[0],o=n[1];this.setOutputMatrixTextureDriver(s,r,o)},t.prototype.setOutputMatrixWriteRegion=function(a,e,t,o){this.setOutputMatrixWriteRegionDriver(t,a,o,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Io(this.gl,this.debug,this.program),Go(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),xo(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),xo(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Ro(this.gl,this.debug,2===ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var a=this.gl,e=this.getQueryTimerExtensionWebGL2(),t=a.createQuery();return a.beginQuery(e.TIME_ELAPSED_EXT,t),t}var n=this.getQueryTimerExtensionWebGL1(),r=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,r),r},t.prototype.endQuery=function(){if(2!==ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var a=this.getQueryTimerExtensionWebGL1();a.endQueryEXT(a.TIME_ELAPSED_EXT)}else{var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(a){return x(this,void 0,void 0,function(){var e=this;return R(this,function(t){switch(t.label){case 0:return[4,H(function(){return e.disposed||e.isQueryAvailable(a,ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return t.sent(),[2,this.getQueryTime(a,ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))];}})})},t.prototype.getQueryTime=function(a,e){if(0===e)return null;if(2===e){var t=this.gl;return t.getQueryParameter(a,t.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(a,o.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(a,e){if(0===e)return!0;if(2===e){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.getQueryParameter(a,t.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}return r=(n=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(a,n.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint},t.prototype.pollFence=function(a){var e=this;return new Promise(function(t){e.addItemToPoll(function(){return a.isFencePassed()},function(){return t()})})},t.prototype.pollItems=function(){for(var a=bn(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=a;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(a+1)},t.prototype.addItemToPoll=function(a,o){var r=this;this.itemsToPoll.push({isDoneFn:a,resolveFn:o}),1<this.itemsToPoll.length||H(function(){return r.pollItems(),0===r.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Uo(this.gl,this.debug,t,this.framebuffer),this.debug&&Go(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null==this.outputTexture?zo(this.gl,this.debug,this.framebuffer):(Uo(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Go(this.gl))},t.prototype.downloadMatrixDriver=function(a,e){this.bindTextureToFrameBuffer(a);var t=e();return this.unbindTextureToFrameBuffer(),t},t.prototype.setOutputMatrixTextureDriver=function(a,e,t){this.throwIfDisposed();var o=this.gl;Uo(o,this.debug,a,this.framebuffer),this.debug&&Go(o),this.outputTexture=a,xo(o,this.debug,function(){return o.viewport(0,0,e,t)}),xo(o,this.debug,function(){return o.scissor(0,0,e,t)})},t.prototype.setOutputMatrixWriteRegionDriver=function(a,e,t,n){var r=this;this.throwIfDisposed(),xo(this.gl,this.debug,function(){return r.gl.scissor(a,e,t,n)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}(),fp=function(){return function(m,e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=m;var n=t.filterWidth,r=t.inChannels,o=t.strideWidth,a=t.strideHeight,i=t.padInfo,s=t.outWidth,u=t.dilationWidth,c=t.dilationHeight,l=i.left,p=i.top,d=r*n,h=ma();this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+m[1]+" || pos >= "+m[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+s+")) * "+a+" - "+p+";\n            int d0 = offsetY + "+c+" * (pos / "+d+");\n\n            if(d0 >= "+e[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+s+".) * "+o+". - "+l+".);\n            int d1 = offsetX + "+u+" * (int(mod(float(pos), "+d+".) / "+r+".));\n\n            if(d1 >= "+e[1]+" || d1 < 0) continue;\n\n            vec2 innerDims = vec2(d1, int(mod(float(pos), "+r+".)));\n            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),\n                                              int(innerDims.y)), innerDims);\n          }\n        }\n\n        "+h.output+" = result;\n      }\n    "}}(),yp=function(){return function(p,e,t,n,r){this.variableNames=["x"],this.outputShape=[];var o=e,i=p[3]-1,s;this.outputShape=p;var a="float("+t+") + float("+n+") * sum";s=.5===r?"inversesqrt("+a+")":1===r?"1.0/("+a+")":"exp(log("+a+") * float(-"+r+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+i+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+s+";\n        setOutput(val);\n      }\n    "}}(),xp=function(){return function(a,e,t,n,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=a,this.depth=a[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=r,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+n+") * norm + float("+t+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+n+")\n                * float("+r+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+r+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "}}(),bp=function(){return function(p){this.variableNames=["dy","maxPos"],this.outputShape=p.inShape;var e=p.strideHeight,t=p.strideWidth,n=p.dilationHeight,r=p.effectiveFilterHeight,o=p.effectiveFilterWidth,a=r-1-p.padInfo.top,i=o-1-p.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+r+";\n          wR += "+n+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+p.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+t+".0;\n\n            if (dyC < 0.0 || dyC >= "+p.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(r*o-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}}(),vp=function(){return function(m,e,t,n,r,o){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var a=t?m[1]:m[2],i=pe(a/2),s=t?"i * 2, rc.y":"rc.y, i * 2",u=n?"rc.z, i * 2":"i * 2, rc.z",c=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],l=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",d="";o&&(p="vec4 activation(vec4 x) {\n        "+o+"\n      }",d="result = activation(result);");var h=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+i+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+i+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+s+");\n          vec4 b = getMatrixB(rc.x, "+u+");\n\n          result += ("+c[0]+" * "+l[0]+") + ("+c[1]+" * "+l[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+h+"\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "}}(),Cp=function(){function t(a,o,t){this.variableNames=["probs"],this.outputShape=[a,t],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(o-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(o-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a){var e=this;return function(t,o){null==e.seedLoc&&(e.seedLoc=t.getUniformLocation(o,"seed")),t.gl.uniform1f(e.seedLoc,a)}},t}(),Rp=function(){return function(a,e,t,o){this.variableNames=["indices"],this.outputShape=[a,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+o+"), float("+t+"),\n                      float(index == coords.y)));\n      }\n    "}}(),Sp=function(){return function(s){this.variableNames=["A"],this.isPackShader=!0,this.outputShape=s;var e=s.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var t=da("rc",e),n=to(e),r=_n(e,s,t),o=kn(e,s[s.length-1],s[s.length-2],t),a=wn(s,t);this.userCode="\n        void main() {\n          "+n+" rc = getOutputCoords();\n\n          if("+r+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}}}(),Ep=function(){return function(p,e,t){this.variableNames=["x"],this.outputShape=e.map(function(e,t){return e[0]+p[t]+e[1]});var n=p.length,r=to(n),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,t){return e[0]+p[t]}).join(","),i=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=1===n?"\n        int start = "+o+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+t+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ":"\n      "+r+" start = "+r+"("+o+");\n      "+r+" end = "+r+"("+a+");\n\n      void main() {\n        "+r+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+t+"));\n        } else {\n          "+r+" coords = outC - start;\n          setOutput(getX("+i+"));\n        }\n      }\n    "}}(),_p=function(){return function(g,e,t){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(e,t){return e[0]+g[t]+e[1]});for(var n=g.length,r=to(n),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,t){return e[0]+g[t]}).join(","),i=da("rc",n),s=da("source",n),u=i[n-1]+" < "+this.outputShape[n-1],c=1===n?"source":"vec2("+s.slice(-2).join()+")",l=[r+" rc = outputLoc;",i[n-1]+" += 1;\n       if("+u+") {\n      ",1===n?"":"}\n       rc = outputLoc;\n       "+i[n-2]+" += 1;\n       if("+i[n-2]+" < "+this.outputShape[n-2]+") {",1===n?"":"  "+i[n-1]+" += 1;\n         if("+u+") {"],p=1===n?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",h=0,f=1===n?2:4;h<f;h++)d+="\n        "+l[h]+"\n        if ("+p+") {\n          result["+h+"] = float("+t+");\n        } else {\n          "+r+" source = rc - start;\n          result["+h+"] = getChannel(getX("+s.join()+"), "+c+");\n        }\n      ";d+=1===n?"} ":"}}",this.userCode="\n      const "+r+" start = "+r+"("+o+");\n      const "+r+" end = "+r+"("+a+");\n\n      void main() {\n        "+r+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+d+"\n        setOutput(result);\n      }\n    "}}(),kp=function(){return function(y,e,t){if(this.variableNames=["x"],"avg"===e&&t)throw new Error("Cannot compute positions for average pool.");var n=y.filterWidth,r=y.strideHeight,o=y.strideWidth,a=y.dilationHeight,i=y.dilationWidth,s=y.effectiveFilterHeight,u=y.effectiveFilterWidth,c=y.padInfo.top,l=y.padInfo.left;this.outputShape=y.outShape;var p="avg"===e,d="0.0";if(p||(d="-1.0 / 1e-20"),t)this.userCode="\n        const ivec2 strides = ivec2("+r+", "+o+");\n        const ivec2 pads = ivec2("+c+", "+l+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+s+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+y.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+u+";\n                wC += "+i+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+y.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+u+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var h=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(h="avgValue / count");var f=4*$(n/4),m=n%4,g="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+r+", "+o+");\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float initializationValue = "+d+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+y.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+d+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+y.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC += 4) {\n            int xC = xCCorner + wC * "+i+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+i+", d),\n              getValue(batch, xR, xC + 2 * "+i+", d),\n              getValue(batch, xR, xC + 3 * "+i+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+f+";\n          if ("+(1==m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2==m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+i+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3==m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+i+", d),\n              getValue(batch, xR, xC + 2 * "+i+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+h+");\n      }\n    "}}}(),wp=function(){return function(m,e){this.variableNames=["x"];var t=m.windowSize,n=m.batchSize,r=m.inSize,o=pe(r/t);this.outputShape=[n,o];var a="0.0",i="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",i="min"):"max"==e&&(a="-1.0 / 1e-20",i="max");var s=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?s="sumValue":"prod"===e?s="prodValue":"all"===e?s="allValue":"any"==e&&(s="anyValue");var u=4*$(t/4),c=t%4,l="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+i+"(values, minMaxValue);\n      }\n    ",p="vec4";"all"===e?(a="1.0",l="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"==e&&(a="0.0",l="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var d="";0<r%t&&(d="\n        if (inIdx < 0 || inIdx >= "+r+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+t+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+u+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+u+";\n        if ("+(1==c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+l+"\n        } else if ("+(2==c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+l+"\n        } else if ("+(3==c)+") {\n          "+p+" values = "+p+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+l+"\n        }\n        setOutput("+s+");\n      }\n    "}}(),Ip=function(){return function(a,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=a;for(var t="",n=0,r;4>n;n++)r="thisRC = rc;",1==n%2&&(r+="thisRC.z += 1;"),1<n&&(r+="thisRC.y += 1;"),t+="\n        "+r+"\n        "+(0<n?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+n+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(0<n?"}":"")+"\n      ";this.userCode="\n      "+Nn(e)+"\n      "+In(a)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+a[1]+";\n        int cols = "+a[2]+";\n\n        "+t+"\n\n        setOutput(result);\n      }\n    "}}(),Np=function(){return function(y,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,r=n[1],o=n[2],a=y.shape,i=a[1],s=a[2],u=[t&&1<i?r-1:r,t&&1<s?o-1:o],c=[t&&1<i?i-1:i,t&&1<s?s-1:s],l=u[0]/c[0],p=u[1]/c[1],d=1/l,h=1/p,f=2*pe(d)+2,m=2*pe(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+l+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+f+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+i+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+s+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(r-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}}(),Tp=function(){return function(p,e,t,n){this.variableNames=["A"],this.outputShape=[];var r=p[0],o=p[1],a=p[2],i=p[3];this.outputShape=[r,e,t,i];var s=[n&&1<e?o-1:o,n&&1<t?a-1:a],d=[n&&1<e?e-1:e,n&&1<t?t-1:t];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+s[0]/d[0]+",\n          "+s[1]/d[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}}(),Dp=function(){return function(p,e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var r=p[0],o=p[1],a=p[2],i=p[3];this.outputShape=[r,e,t,i];var s=[n&&1<e?o-1:o,n&&1<t?a-1:a],d=[n&&1<e?e-1:e,n&&1<t?t-1:t];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/d[0]+",\n          "+s[1]/d[1]+",\n          "+s[1]/d[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n        \n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(i-1)+"; \n        bool hasNextRow = coords.z < "+(t-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "}}(),Ap=function(){return function(y,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,r=n[1],o=n[2],a=y.shape,i=a[1],s=a[2],u=[t&&1<i?r-1:r,t&&1<s?o-1:o],c=[t&&1<i?i-1:i,t&&1<s?s-1:s],l=u[0]/c[0],p=u[1]/c[1],d=1/l,h=1/p,f=2*pe(d)+2,m=2*pe(h)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+l+");\n        const float widthScale = float("+p+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+h+");\n\n        const int winHeight = int("+f+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+i+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+s+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+u[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+u[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+r+") - 1),\n                "+t+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+t+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}}(),Op=function(){return function(p,e,t,n){this.variableNames=["A"],this.outputShape=[];var r=p[0],o=p[1],a=p[2],i=p[3];this.outputShape=[r,e,t,i];var s=[n&&1<e?o-1:o,n&&1<t?a-1:a],d=[n&&1<e?e-1:e,n&&1<t?t-1:t],u=n?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+s[0]/d[0]+",\n          "+s[1]/d[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+u+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "}}(),Pp=function(){return function(a,e){this.variableNames=["x"];var t=a.length;if(4<t)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=a,1!==t){var n=a.map(function(t,o){return function(t){return-1!==e.indexOf(t)&&1!==a[t]?a[t]+" - coords["+t+"] - 1":"coords["+t+"]"}(o)}).join(","),r=to(t);this.userCode="\n      void main() {\n        "+r+" coords = getOutputCoords();\n        setOutput(getX("+n+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+a[0]+" - coord - 1));\n        }\n      "}}(),Fp=function(){return function(p,e){function t(t){var a=p.map(function(a,n){return function(t,a){return-1!==e.indexOf(t)&&1!==p[t]?p[t]+" - "+a[t]+" - 1":""+a[t]}(n,t)});return"getChannel(getX("+a.join(",")+"), vec2("+a.slice(-2).join(",")+"))"}this.variableNames=["x"],this.usesPackedTextures=!0;var s=p.length;if(4<s)throw new Error("WebGL backend: Reverse of rank-"+s+" tensor is not yet supported");this.outputShape=p;var n=da("rc",s),r=n[s-1]+" + 1 < "+this.outputShape[s-1],o=n[s-2]+" + 1 < "+this.outputShape[s-2],a=to(s);this.userCode=1===s?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+p[0]+" - rc - 1), rc);\n          if("+r+"){\n              result.g = getChannel(getX("+p[0]+" - (rc  + 1) - 1), rc + 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(a){return t(a)}(n.slice())+";\n          if("+r+"){\n            result.g = "+function(a){return a[s-1]="("+a[s-1]+" + 1)",t(a)}(n.slice())+";\n          }\n          if("+o+") {\n            result.b = "+function(a){return a[s-2]="("+a[s-2]+" + 1)",t(a)}(n.slice())+";\n            if("+r+") {\n              result.a = "+function(a){return a[s-1]="("+a[s-1]+" + 1)",a[s-2]="("+a[s-2]+" + 1)",t(a)}(n.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "}}(),Bp=function(){return function(m,e,t,n,r,o,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var i=to(r.length),s=to(o.length),u="";1===t?u="i":2==t&&(u="i, j");var c="getIndices("+u+")",l="";1===n?l="i":2==n&&(l="i, coords[1]");var p="getUpdates("+l+")",d=1<e?"strides[j]":"strides";this.userCode="\n        "+i+" strides = "+i+"("+r+");\n\n        void main() {\n          "+s+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+m+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+c+");\n              flattenedIndex += index * "+d+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+p+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "}}(),Lp=function(){return function(t){this.variableNames=["x","segmentIds"];var e=t.windowSize,n=t.batchSize,r=t.inSize,o=t.numSegments,a=o*pe(r/e);this.outputShape=[n,a];var i=4*$(e/4),s=e%4,d="\n        sumValue += dot(values, segFilter);\n    ",u="";0<r%e&&(u="\n        if (inIdx < 0 || inIdx >= "+r+") {\n          return initializationValue;\n        }\n      ");var l="";0<r%e&&(l="\n        if (inIdx < 0 || inIdx >= "+r+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+u+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+l+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+i+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+i+";\n        if ("+(1==s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+d+"\n        } else if ("+(2==s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+d+"\n        } else if ("+(3==s)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+d+"\n        }\n        setOutput(sumValue);\n      }\n    "}}(),Mp=function(){return function(p,e,t){var n,r;if(this.variableNames=["c","a","b"],this.outputShape=e,4<t)throw Error("Where for rank "+t+" is not yet supported");if(1===t)r="resRC",n="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=[],s=0;s<e.length;s++)i.push(""+o[s]),s<p&&a.push(""+o[s]);n=a.join(),r=i.join()}var d=to(t);this.userCode="\n      void main() {\n        "+d+" resRC = getOutputCoords();\n        float cVal = getC("+n+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+r+"));\n        } else {\n          setOutput(getB("+r+"));\n        }\n      }\n    "}}(),Wp=function(){function t(a){this.variableNames=["source"],this.outputShape=a,this.rank=a.length;var s=to(this.rank),n="uniform int start["+this.rank+"];",r=Tn(this.rank),o;o="\n        "+s+" sourceLoc;\n        "+s+" coords = getOutputCoords();\n        "+a.map(function(a,e){return"sourceLoc."+Up[e]+" = start["+e+"] + coords."+Up[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+n+"\n      void main() {\n        "+o+"\n        setOutput(getSource("+r+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a){var e=this;if(a.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+a.length+")");return function(t,o){null==e.startLoc&&(e.startLoc=t.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||t.gl.uniform1iv(e.startLoc,a)}},t}(),Up=["x","y","z","w","u","v"],zp=function(){function t(p){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=p,this.rank=p.length;var d=to(this.rank),l=da("coords",this.rank),n=da("sourceLoc",this.rank),t=1===this.rank?"sourceLoc":"vec2("+n.slice(-2).join()+")",o="getChannel(getSource("+n.join()+"), "+t+")",a="\n      result.x = "+o+";\n      if (++"+l[this.rank-1]+" < "+p[this.rank-1]+") {\n        ++"+n[this.rank-1]+";\n        result.y = "+o+";\n        --"+n[this.rank-1]+";\n      }\n    ",r=1===this.rank?"":"\n      --"+l[this.rank-1]+";\n      if (++"+l[this.rank-2]+" < "+p[this.rank-2]+") {\n        ++"+n[this.rank-2]+";\n        result.z = "+o+";\n        if (++"+l[this.rank-1]+" < "+p[this.rank-1]+") {\n          ++"+n[this.rank-1]+";\n          result.w = "+o+";\n        }\n      }\n    ",s=4>=this.rank?"sourceLoc = coords +\n            "+d+"("+p.map(function(a,e){return"start["+e+"]"}).join()+");":p.map(function(a,e){return n[e]+" = "+l[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+d+" coords = getOutputCoords();\n        "+d+" sourceLoc;\n        "+s+" \n        vec4 result = vec4(0.);\n        "+a+"\n        "+r+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(a){var e=this;if(a.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+a.length+")");return function(t,o){null==e.startLoc&&(e.startLoc=t.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||t.gl.uniform1iv(e.startLoc,a)}},t}(),Gp=function(){return function(p,e,t,n){this.variableNames=["x"];var r=t.filter(function(a,e){return-1===n.indexOf(e)});this.outputShape=r;var o=t.length,a=to(t.length),i=to(r.length),s="";if(1===o)s="coords * strides + begin";else{var d=0;s=t.map(function(a,e){return-1===n.indexOf(e)?(d++,1===r.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(d-1)+"] * strides["+e+"] + begin["+e+"]"):"begin["+e+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+p+");\n      "+a+" strides = "+a+"("+e+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+s+"));\n      }\n    "}}(),Vp=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(s,e,t){var n=Dn(e,t),o=An(s,n,t),a;if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),0<this.freeTextures[o].length){this.numFreeTextures--,this.numUsedTextures++,this.log();var r=this.freeTextures[o].shift();return this.usedTextures[o].push(r),r}return this.numUsedTextures++,this.log(),n===dp.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(s[0],s[1]):n===dp.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(s[0],s[1]):n===dp.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(s[0],s[1]):n===dp.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(s[0],s[1]):n===dp.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(s[0],s[1])),this.usedTextures[o].push(a),a},t.prototype.releaseTexture=function(s,e,t,n){if(null!=this.freeTextures){var r=An(e,Dn(t,n),n);r in this.freeTextures||(this.freeTextures[r]=[]),this.freeTextures[r].push(s),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[r],a=o.indexOf(s);if(0>a)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(a,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var a=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){a.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){a.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}(),Hp=function(){return function(s,e){this.variableNames=["A"];for(var t=Array(s.length),n=0;n<t.length;n++)t[n]=s[n]*e[n];this.outputShape=t,this.rank=t.length;var r=to(this.rank),o=On(s);this.userCode="\n      void main() {\n        "+r+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "}}(),qp=function(){return function(s,e){this.variableNames=["A"];for(var t=Array(s.length),n=0;n<t.length;n++)t[n]=s[e[n]];this.outputShape=t,this.rank=t.length;var r=to(this.rank),o=Pn(e);this.userCode="\n    void main() {\n      "+r+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "}}(),$p=function(){return function(p,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var t=Array(p.length),n=0;n<t.length;n++)t[n]=p[e[n]];if(this.outputShape=t,this.rank=t.length,6<this.rank)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var r=to(this.rank),o=pa("rc",this.rank),a=Array(this.rank);for(n=0;n<e.length;n++)a[e[n]]=o[n];var i="vec2("+a.slice(-2).join()+")",s="++"+o[this.rank-1]+" < "+t[this.rank-1],d="getChannel(getA("+a.join()+"), "+i+")";this.userCode="\n    void main() {\n      "+r+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+d+";\n      if("+s+") {\n        result[1] = "+d+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+t[this.rank-2]+") {\n        result[2] = "+d+";\n        if("+s+") {\n          result[3] = "+d+";\n        }\n      }  \n      setOutput(result);\n    }\n    "}}(),Kp=.3275911,jp=.254829592,Xp=-.284496736,Yp=1.421413741,Qp=-1.453152027,Zp=1.061405429,Jp=1.7580993408473768,ed=1.0507009873554805,td=function(){return function(a,e){this.variableNames=["A"],this.outputShape=a,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}(),ad="if (isnan(x)) return x;",od="return x;",nd=ad+"\n  return (x < 0.0) ? 0.0 : x;\n",rd="return exp(x);",sd="return x;",id="return x;",pd="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",dd=function(){return function(a,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=a,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}}(),ld=function(){return function(s){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=s;var e=s.length,t=da("rc",e),n=to(e),r=la(e,t),o=t.slice(-2),a=1>=e?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+n+" rc = getOutputCoords();\n        vec4 packedInput = getA("+r+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "}}(),ud=Lt({concat_:function(s,i){void 0===i&&(i=0),A(1<=s.length,function(){return"Pass at least one tensor to concat"});var t=nt(s,"tensors","concat");i=K(i,t[0].shape)[0];var e=Rt(t.map(function(t){return t.shape}),i);if(0===U(e))return Mt([],e);if(1===(t=t.filter(function(t){return 0<t.size})).length)return t[0];var r=t.map(function(t){return t.shape});Ct(r,i);var o=t;return ei.engine.runKernel(function(a){return a.concat(t,i)},o,function(t){var e=r.map(function(t){return t[i]});return fd(t,e,i).map(function(t){return function(){return t}})})}}),cd=Lt({concat1d_:function(t){return ud(t,0)}}),hd=Lt({concat2d_:function(a,e){return ud(a,e)}}),md=Lt({concat3d_:function(a,e){return ud(a,e)}}),gd=Lt({concat4d_:function(a,e){return ud(a,e)}}),fd=Lt({split_:function(a,e,s){void 0===s&&(s=0);var n=ot(a,"x","split"),i;return s=K(s,n.shape)[0],"number"==typeof e?(A(0==n.shape[s]%e,function(){return"Number of splits must evenly divide the axis."}),i=Array(e).fill(n.shape[s]/e)):(A(n.shape[s]===e.reduce(function(a,e){return a+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),i=e),ei.engine.runKernel(function(t){return t.split(n,i,s)},{$x:n},function(t){return{$x:function(){return ud(t,s)}}})}}),yd="undefined"==typeof window?"undefined"==typeof g?"undefined"==typeof self?{}:self:g:window,xd=Bn(function(t){!function(a,e,t){function s(a,e){return e.c=a.c,e.s0=a.s0,e.s1=a.s1,e.s2=a.s2,e}function n(r,e){var t=new function(a){var o=this,e=(s=4022871197,function(t){t=t.toString();for(var e=0,a;e<t.length;e++)a=.02519603282416938*(s+=t.charCodeAt(e)),a-=s=a>>>0,s=(a*=s)>>>0,s+=4294967296*(a-=s);return 23283064365386963e-26*(s>>>0)}),s;o.next=function(){var t=2091639*o.s0+23283064365386963e-26*o.c;return o.s0=o.s1,o.s1=o.s2,o.s2=t-(o.c=0|t)},o.c=1,o.s0=e(" "),o.s1=e(" "),o.s2=e(" "),o.s0-=e(a),0>o.s0&&(o.s0+=1),o.s1-=e(a),0>o.s1&&(o.s1+=1),o.s2-=e(a),0>o.s2&&(o.s2+=1),e=null}(r),n=e&&e.state,i=t.next;return i.int32=function(){return 0|4294967296*t.next()},i.double=function(){return i()+11102230246251565e-32*(0|2097152*i())},i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.alea=n}(0,t,!1)}),bd=Bn(function(t){!function(a,e,t){function s(a,e){return e.x=a.x,e.y=a.y,e.z=a.z,e.w=a.w,e}function n(r,e){var t=new function(a){var o=this,e="";o.x=0,o.y=0,o.z=0,o.w=0,o.next=function(){var t=o.x^o.x<<11;return o.x=o.y,o.y=o.z,o.z=o.w,o.w^=o.w>>>19^t^t>>>8},a===(0|a)?o.x=a:e+=a;for(var t=0;t<e.length+64;t++)o.x^=0|e.charCodeAt(t),o.next()}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.xor128=n}(0,t,!1)}),vd=Bn(function(t){!function(a,e,t){function s(a,e){return e.x=a.x,e.y=a.y,e.z=a.z,e.w=a.w,e.v=a.v,e.d=a.d,e}function n(r,e){var t=new function(a){var o=this,e="";o.next=function(){var t=o.x^o.x>>>2;return o.x=o.y,o.y=o.z,o.z=o.w,o.w=o.v,0|(o.d=0|o.d+362437)+(o.v=o.v^o.v<<4^t^t<<1)},o.x=0,o.y=0,o.z=0,o.w=0,o.v=0,a===(0|a)?o.x=a:e+=a;for(var t=0;t<e.length+64;t++)o.x^=0|e.charCodeAt(t),t==e.length&&(o.d=o.x<<10^o.x>>>4),o.next()}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.xorwow=n}(0,t,!1)}),Cd=Bn(function(t){!function(a,e,t){function s(a,e){return e.x=a.x.slice(),e.i=a.i,e}function n(r,e){null==r&&(r=+new Date);var t=new function(a){var s=this;s.next=function(){var t=s.x,a=s.i,o,e;return o=t[a],e=(o^=o>>>7)^o<<24,e^=(o=t[7&a+1])^o>>>10,e^=(o=t[7&a+3])^o>>>3,e^=(o=t[7&a+4])^o<<7,o=t[7&a+7],e^=(o^=o<<13)^o<<9,t[a]=e,s.i=7&a+1,e},function(a,e){var t=[],o;if(e===(0|e))t[0]=e;else for(e=""+e,o=0;o<e.length;++o)t[7&o]=t[7&o]<<15^e.charCodeAt(o)+t[7&o+1]<<13;for(;8>t.length;)t.push(0);for(o=0;8>o&&0===t[o];++o);for(8==o?t[7]=-1:t[o],a.x=t,a.i=0,o=256;0<o;--o)a.next()}(s,a)}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&(n.x&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.xorshift7=n}(0,t,!1)}),Rd=Bn(function(t){!function(a,e,t){function s(a,e){return e.i=a.i,e.w=a.w,e.X=a.X.slice(),e}function n(r,e){null==r&&(r=+new Date);var t=new function(a){var s=this;s.next=function(){var t=s.w,r=s.X,o=s.i,a,e;return s.w=t=0|t+1640531527,e=r[127&o+34],a=r[o=127&o+1],e^=e<<13,a^=a<<17,e^=e>>>15,a^=a>>>12,e=r[o]=e^a,s.i=o,0|e+(t^t>>>16)},function(p,e){var t=[],s=128,d,n,r,o,a;for(e===(0|e)?(n=e,e=null):(e+="\0",n=0,s=de(s,e.length)),r=0,o=-32;o<s;++o)e&&(n^=e.charCodeAt((o+32)%e.length)),0===o&&(a=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,0<=o&&(a=0|a+1640531527,r=0==(d=t[127&o]^=n+a)?r+1:0);for(128<=r&&(t[127&(e&&e.length||0)]=-1),r=127,o=512;0<o;--o)n=t[127&r+34],d=t[r=127&r+1],n^=n<<13,d^=d<<17,n^=n>>>15,d^=d>>>12,t[r]=n^d;p.w=a,p.X=t,p.i=r}(s,a)}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&(n.X&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.xor4096=n}(0,t,!1)}),Sd=Bn(function(t){!function(a,e,t){function s(a,e){return e.a=a.a,e.b=a.b,e.c=a.c,e.d=a.d,e}function n(r,e){var t=new function(a){var s=this,e="";s.next=function(){var t=s.b,e=s.c,a=s.d,n=s.a;return t=t<<25^t>>>7^e,e=0|e-a,a=a<<24^a>>>8^n,n=0|n-t,s.b=t=t<<20^t>>>12^e,s.c=e=0|e-a,s.d=a<<16^e>>>16^n,s.a=0|n-t},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,a===$(a)?(s.a=0|a/4294967296,s.b=0|a):e+=a;for(var t=0;t<e.length+20;t++)s.b^=0|e.charCodeAt(t),s.next()}(r),n=e&&e.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do var a=((t.next()>>>11)+(t.next()>>>0)/4294967296)/2097152;while(0===a);return a},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}e&&e.exports?e.exports=n:t&&t.amd?t(function(){return n}):this.tychei=n}(0,t,!1)}),Ed=Bn(function(g){!function(b,C){function e(a,e,o){var r=[],g=t(function s(e,i){var n=[],o=typeof e,a;if(i&&"object"==o)for(a in e)try{n.push(s(e[a],i-1))}catch(t){}return n.length?n:"string"==o?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[a,h(b)]:null==a?function(){try{var t;return p&&(t=p.randomBytes)?t=t(m):(t=new Uint8Array(m),(d.crypto||d.msCrypto).getRandomValues(t)),h(t)}catch(t){var e=d.navigator,a=e&&e.plugins;return[+new Date,d,a,d.screen,h(b)]}}():a,3),r),y=new function(a){var e=a.length,p=this,n=0,o=p.i=p.j=0,r=p.S=[],s;for(e||(a=[e++]);n<m;)r[n]=n++;for(n=0;n<m;n++)r[n]=r[o=l&o+a[n%e]+(s=r[n])],r[o]=s;(p.g=function(a){for(var e=0,n=p.i,o=p.j,r=p.S,s;a--;)s=r[n=l&n+1],e=e*m+r[l&(r[n]=r[o=l&o+s])+(r[o]=s)];return p.i=n,p.j=o,e})(m)}(r),x=function(){for(var a=y.g(f),e=s,t=0;a<u;)a=(a+t)*m,e*=m,t=y.g(1);for(;a>=c;)a/=2,e/=2,t>>>=1;return(a+t)/e};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,t(h(y.S),b),(e.pass||o||function(a,e,t,r){return r&&(r.S&&n(r,y),a.state=function(){return n(y,{})}),t?(C[i]=a,e):a})(x,g,"global"in e?e.global:this==C,e.state)}function n(a,e){return e.i=a.i,e.j=a.j,e.S=a.S.slice(),e}function t(a,e){for(var t=a+"",r=0,o;r<t.length;)e[l&r]=l&(o^=19*e[l&r])+t.charCodeAt(r++);return h(e)}function h(t){return o.apply(0,t)}var d=this,m=256,f=6,i="random",s=C.pow(m,f),u=C.pow(2,52),c=2*u,l=m-1,p;if(C["seed"+i]=e,t(C.random(),b),g.exports){g.exports=e;try{p=a(142)}catch(t){}}else;}([],Math)});Ed.alea=xd,Ed.xor128=bd,Ed.xorwow=vd,Ed.xorshift7=Cd,Ed.xor4096=Rd,Ed.tychei=Sd;var _d=Ed.alea,kd=function(){function t(s,i,t,n,r){this.mean=s,this.stdDev=i,this.dtype=t,this.nextVal=NaN,this.truncated=n,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=r||Math.random();this.random=_d(o.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var d=this.nextVal;return this.nextVal=NaN,d}for(var e=!1,l,t;!e;){var n=void 0,o=void 0,a=void 0;do a=(n=2*this.random()-1)*n+(o=2*this.random()-1)*o;while(1<=a||0===a);var i=C(-2*p(a)/a);l=this.mean+this.stdDev*n*i,t=this.mean+this.stdDev*o*i,this.truncated&&!this.isValidTruncated(l)||(e=!0)}return this.truncated&&!this.isValidTruncated(t)||(this.nextVal=this.convertValue(t)),this.convertValue(l)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:_(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),wd=Lt({batchToSpaceND_:function(a,s,t){var n=ot(a,"x","batchToSpaceND"),e=s.reduce(function(a,e){return a*e});return A(n.rank>=1+s.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+s.length}),A(t.length===s.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+s.length}),A(0==n.shape[0]%e,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+s.join(" * ")+" === "+e}),ei.engine.runKernel(function(a){return a.batchToSpaceND(n,s,t)},{$x:n},function(a){return{$x:function(){return a.spaceToBatchND(s,t)}}})}}),Id=Lt({cast_:function(a,o){var t=ot(a,"x","cast");return ei.engine.runKernel(function(a){return a.cast(t,o)},{$x:t},function(t){return{$x:function(){return t.clone()}}})}}),Nd=Lt({clone_:function(a){var e=ot(a,"x","clone",null);return ei.engine.runKernel(function(){return Os.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),Td=Lt({cumsum_:function(p,d,t,n){void 0===d&&(d=0),void 0===t&&(t=!1),void 0===n&&(n=!1);var e=ot(p,"x","cumsum"),o=xt([d|=0],e.rank),a=e;null!=o&&(a=e.transpose(o));var l=vt(1,e.rank)[0],s=ei.engine.runKernel(function(o){return o.cumsum(a,l,t,n)},{permutedX:a},function(a){return{permutedX:function(){return a.cumsum(d,t,!n)}}});return null!=o&&(s=s.transpose(o)),s}}),Dd=Lt({depthToSpace_:function(s,p,t){void 0===t&&(t="NHWC");var n=ot(s,"x","depthToSpace"),e="NHWC"===t?n.shape[1]:n.shape[2],o="NHWC"===t?n.shape[2]:n.shape[3],a="NHWC"===t?n.shape[3]:n.shape[1];return A(0<=e*p,function(){return"Negative dimension size caused by overflow when multiplying\n      "+e+" and "+p+"  for depthToSpace with input shape\n      "+n.shape}),A(0<=o*p,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+p+" for depthToSpace with input shape\n          "+n.shape}),A(0==a%(p*p),function(){return"Dimension size must be evenly divisible by "+p*p+" but is "+a+" for depthToSpace with input shape "+n.shape}),ei.engine.runKernel(function(a){return a.depthToSpace(n,p,t)},{$x:n})}}),Ad=Lt({expandDims_:function(a,e){void 0===e&&(e=0);var t=ot(a,"x","expandDims");A(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var o=t.shape.slice();return 0>e&&(A(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),o.splice(e,0,1),Hd(t,o)}}),Od=Lt({eye_:function(p,e,t,n){void 0===n&&(n="float32"),null==e&&(e=p);for(var r=Ln([p,e],n),o=p<=e?p:e,a=0;a<o;++a)r.set(1,a,a);var i=r.toTensor().as2D(p,e);if(null==t)return i;if(1===t.length)return jd(Ad(i,0),[t[0],1,1]);if(2===t.length)return jd(Ad(Ad(i,0),0),[t[0],t[1],1,1]);if(3===t.length)return jd(Ad(Ad(Ad(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),Pd=Lt({multinomial_:function(p,d,t,n){void 0===n&&(n=!1);var e=ot(p,"logits","multinomial"),o=e.size,a=e.rank;if(2>o)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(2<a)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var r=1===a?e.as2D(1,-1):e,i=ei.engine.runKernel(function(a){return a.multinomial(r,n,d,t)},{logits2D:r});return 1===a?i.as1D():i}}),Fd=Lt({oneHot_:function(s,i,t,n){if(void 0===t&&(t=1),void 0===n&&(n=0),2>i)throw new Error("Error in oneHot: depth must be >=2, but it is "+i);var r=ot(s,"indices","oneHot","int32"),e=r.shape.concat([i]);return r=r.flatten(),ei.engine.runKernel(function(a){return a.oneHot(r,i,t,n)},{$indices:r},function(){return{$indices:function(){return qt(r.shape,"float32")}}}).reshape(e)}}),Bd=Lt({pad_:function(a,s,t){void 0===t&&(t=0);var n=ot(a,"x","pad");if(0===n.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=s.map(function(t){return t[0]});return ei.engine.runKernel(function(a){return a.pad(n,s,t)},{$x:n},function(t){return{$x:function(){return t.slice(i,n.shape)}}})}}),Ld=Lt({pad1d_:function(a,e,t){return void 0===t&&(t=0),A(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),Bd(a,[e],t)}}),Md=Lt({pad2d_:function(a,e,t){return void 0===t&&(t=0),A(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Bd(a,e,t)}}),Wd=Lt({pad3d_:function(a,e,t){return void 0===t&&(t=0),A(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Bd(a,e,t)}}),Ud=Lt({pad4d_:function(a,e,t){return void 0===t&&(t=0),A(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Bd(a,e,t)}}),zd=Lt({rand_:function(s,e,t){var n=U(s),r=null;if(null==t||"float32"===t)r=new Float32Array(n);else if("int32"===t)r=new Int32Array(n);else{if("bool"!==t)throw new Error("Unknown data type "+t);r=new Uint8Array(n)}for(var i=0;i<n;i++)r[i]=e();return Os.make(s,{values:r},t)}}),Gd=Lt({randomNormal_:function(p,e,t,n,r){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=n&&"bool"===n)throw new Error("Unsupported data type "+n);for(var o=new kd(e,t,n,!1,r),a=Ln(p,n),i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}}),Vd=Lt({randomUniform_:function(s,e,t,n){void 0===e&&(e=0),void 0===t&&(t=1),void 0===n&&(n="float32");for(var r=Ln(s,n),o=0;o<r.values.length;o++)r.values[o]=D(e,t);return r.toTensor()}}),Hd=Lt({reshape_:function(a,o){var t=ot(a,"x","reshape",null);return o=q(o,t.size),A(t.size===U(o),function(){return"new shape and old shape must have the same number of elements."}),ei.engine.runKernel(function(a){return a.reshape(t,o)},{$x:t},function(a){return{$x:function(){return a.reshape(t.shape)}}})}}),qd=Lt({spaceToBatchND_:function(a,s,t){var o=ot(a,"x","spaceToBatchND");return A(o.rank>=1+s.length,function(){return"input rank "+o.rank+" should be > than [blockShape] "+s.length}),A(t.length===s.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+s.length}),A(o.shape.reduce(function(a,e,n){return 0<n&&n<=s.length?a&&0==(e+t[n-1][0]+t[n-1][1])%s[n-1]:a},!0),function(){return"input spatial dimensions "+o.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+s.toString()}),ei.engine.runKernel(function(a){return a.spaceToBatchND(o,s,t)},{$x:o},function(a){return{$x:function(){return a.batchToSpaceND(s,t)}}})}}),$d=Lt({squeeze_:function(a,e){var t=ot(a,"x","squeeze");return Hd(t,j(t.shape,e).newShape)}}),Kd=Lt({stack_:function(s,p){void 0===p&&(p=0);var e=nt(s,"tensors","stack");if(A(1<=e.length,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(p);var t=e[0].rank,n=e[0].shape,o=e[0].dtype;A(p<=t,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(t){O(n,t.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(t){A(o===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=e.map(function(t){return t.expandDims(p)});return ud(a,p)}}),jd=Lt({tile_:function(a,p){var t=ot(a,"x","tile");return A(t.rank===p.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+p+"."}),ei.engine.runKernel(function(a,e){var n=a.tile(t,p);return e([t]),n},{$x:t},function(t,e){var d=e[0];return{$x:function(){var e=mi(d);if(1===d.rank)for(var n=0;n<p[0];++n)e=e.add(t.slice([n*d.shape[0]],[d.shape[0]]));else if(2===d.rank)for(n=0;n<p[0];++n)for(var o=0;o<p[1];++o)e=e.add(t.slice([n*d.shape[0],o*d.shape[1]],[d.shape[0],d.shape[1]]));else if(3===d.rank)for(n=0;n<p[0];++n)for(o=0;o<p[1];++o)for(var a=0;a<p[2];++a)e=e.add(t.slice([n*d.shape[0],o*d.shape[1],a*d.shape[2]],[d.shape[0],d.shape[1],d.shape[2]]));else{if(4!==d.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+d.rank+" tensors yet.");for(n=0;n<p[0];++n)for(o=0;o<p[1];++o)for(a=0;a<p[2];++a)for(var r=0;r<p[3];++r)e=e.add(t.slice([n*d.shape[0],o*d.shape[1],a*d.shape[2],r*d.shape[3]],[d.shape[0],d.shape[1],d.shape[2],d.shape[3]]))}return e}}})}}),Xd=Lt({truncatedNormal_:function(p,e,t,n,r){if(void 0===e&&(e=0),void 0===t&&(t=1),null!=n&&"bool"===n)throw new Error("Unsupported data type "+n);for(var o=new kd(e,t,n,!0,r),a=Ln(p,n),i=0;i<a.values.length;i++)a.values[i]=o.nextValue();return a.toTensor()}}),Yd=Lt({unstack_:function(a,o){void 0===o&&(o=0),o=o||0;var t=ot(a,"x","unstack");return A(o>=-t.shape.length&&o<t.shape.length,function(){return"Axis = "+o+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),0>o&&(o+=t.shape.length),ei.engine.runKernel(function(a){return a.unstack(t,o)},{$x:t},function(t){return{$x:function(){return Kd(t,o)}}})}}),Qd={},Zd=1e3,Jd=function(){function t(a){if(this.gpgpu=a,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.disposed=!1,1>ei.get("WEBGL_VERSION"))throw new Error("WebGL is not supported on this device");if(null==a){var o=S(ei.get("WEBGL_VERSION"));this.binaryCache=Wn(ei.get("WEBGL_VERSION")),this.gpgpu=new gp(o),this.canvas=o.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=a.gl.canvas;this.textureManager=new Vp(this.gpgpu)}return t.prototype.register=function(a,e,o){if(this.texData.has(a))throw new Error("Data buffer is already registered");this.texData.set(a,{shape:e,dtype:o})},t.prototype.setDataMover=function(t){this.texData=new gi(t)},t.prototype.fromPixels=function(s,e){if(null==s)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=[s.height,s.width],n=[s.height,s.width,e];if(ei.get("IS_BROWSER")){if(!(s instanceof HTMLVideoElement||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof ImageData))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+s.constructor.name);if(s instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=s.width,this.fromPixels2DContext.canvas.height=s.height,this.fromPixels2DContext.drawImage(s,0,0,s.width,s.height),s=this.fromPixels2DContext.canvas}}var r=this.makeTensorHandle(t,"int32");this.texData.get(r.dataId).usage=pp.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(r.dataId),s);var o=new rp(n),a=this.compileAndRun(o,[r]);return this.disposeData(r.dataId),a},t.prototype.makeTensorHandle=function(a,o){var r={};return this.register(r,a,o),{dataId:r,shape:a,dtype:o}},t.prototype.write=function(p,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");if(ei.get("DEBUG"))for(var t=0,n;t<e.length;t++)if(n=e[t],!vo(n))throw Error("The value "+n+" cannot be represented on this device.");var r=this.texData.get(p),o=r.texture,a=r.texShape,i=r.usage,s=r.dtype,d=r.isPacked;if("complex64"===s)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=o&&(this.releaseTexture(p,o,a,i,s,d),r.texture=null,r.texShape=null),r.usage=pp.UPLOAD,r.values=e},t.prototype.readSync=function(h){var m=this.texData.get(h),t=m.values,n=m.dtype,g=m.complexTensors,o=m.slice,a=m.shape;if(null!=o){var f=new td(a,sd),s=this.compileAndRun(f,[{dataId:h,shape:a,dtype:n}]),u=this.readSync(s.dataId);return s.dispose(),u}if(null!=t)return this.convertAndCacheOnCPU(h);if("string"===n)return t;var c=null!=this.activeTimers,d,l;return l=(c&&(d=performance.now()),"complex64"===n)?Yt(g.real.dataSync(),g.imag.dataSync()):this.getValuesFromTexture(h),c&&(this.downloadWaitMs+=performance.now()-d),this.convertAndCacheOnCPU(h,l)},t.prototype.read=function(_){return x(this,void 0,void 0,function(){var k,t,n,r,o,a,i,s,u,I,l,N,d,h,f,m,g,v,y,x,E,T,b,w;return R(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(_))return n=this.pendingRead.get(_),[2,new Promise(function(t){return n.push(t)})];if(r=this.texData.get(_),o=r.texture,a=r.values,i=r.texShape,s=r.isPacked,u=r.shape,I=r.slice,l=r.dtype,null!=I)return N=new td(u,sd),d=this.compileAndRun(N,[{dataId:_,shape:u,dtype:l}]),h=this.read(d.dataId),d.dispose(),[2,h];if(null!=a)return[2,this.convertAndCacheOnCPU(_)];if(this.pendingRead.set(_,[]),!ei.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===ei.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return f=i[1],m=i[0],s&&(k=mo(i[0],i[1]),f=k[0],m=k[1]),g=this.gpgpu.maybeCreateBufferFromTexture(o,m,f),[4,this.gpgpu.createAndWaitForFence()];case 1:return R.sent(),g instanceof WebGLTexture?v=this.getValuesFromTexture(_):(y=U(u),s?(x=$o(u),E=1,T=1,u.length&&(t=Ko(u),E=t[0],T=t[1]),v=this.gpgpu.downloadPackedMatrixFromBuffer(g,x,E,T,i[0],i[1]).subarray(0,y)):v=this.gpgpu.downloadFloat32MatrixFromBuffer(g,i[0],i[1]).subarray(0,y)),b=this.convertAndCacheOnCPU(_,v),w=this.pendingRead.get(_),this.pendingRead.delete(_),w.forEach(function(t){return t(b)}),this.pendingDisposal.has(_)&&(this.pendingDisposal.delete(_),this.disposeData(_)),[2,b];}})})},t.prototype.getValuesFromTexture=function(g){var y=this,n=this.texData.get(g),r=n.shape,x=n.dtype,b=n.texture,i=n.texShape,s=U(r),u;if(ei.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(g).isPacked){var t=$o(r),c=1,l=1;return r.length&&(c=(u=Ko(r))[0],l=u[1]),this.gpgpu.downloadMatrixFromPackedTexture(b,t,c,l,i[0],i[1]).subarray(0,s)}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(b,i[0],i[1]).subarray(0,s)}var p=this.makeTensorHandle(r,"float32");p.size=U(r),this.texData.get(p.dataId).usage=pp.DOWNLOAD;var d=ai(function(){var n=new ep(r);return y.compileAndRun(n,[{shape:r,dtype:x,dataId:g}],p,null,!1)}),h=this.texData.get(d.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture,h.texShape[0],h.texShape[1]).subarray(0,s);return this.disposeData(p.dataId),f},t.prototype.time=function(p){return x(this,void 0,void 0,function(){var e,t,n,r,o,a,i;return R(this,function(s){switch(s.label){case 0:return e=this.activeTimers,t=[],n=!1,null==this.programTimersStack?(this.programTimersStack=t,n=!0):this.activeTimers.push(t),this.activeTimers=t,p(),r=F(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),o=F(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,n&&(this.programTimersStack=null),[4,Promise.all(r)];case 1:return a=s.sent(),i={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:T(a),getExtraProfileInfo:function(){return a.map(function(a,n){return{name:o[n],ms:a}}).map(function(t){return t.name+": "+t.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,i];}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return 0<ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},t.prototype.endTimer=function(t){return 0<ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},t.prototype.getQueryTime=function(a){return x(this,void 0,void 0,function(){var e;return R(this,function(){return 0<ei.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?[2,this.gpgpu.waitForQueryAndGetTime(a)]:[2,(e=a).endMs-e.startMs]})})},t.prototype.disposeData=function(p){if(!this.pendingDisposal.has(p))if(this.pendingRead.has(p))this.pendingDisposal.add(p);else if(this.texData.has(p)){var e=this.texData.get(p),t=e.texture,n=e.dtype,r=e.texShape,o=e.usage,a=e.complexTensors,i=e.isPacked,s=e.slice;if(null!=t){var d=s&&s.origDataId||p,u=this.dataRefCount.get(d);1<u?this.dataRefCount.set(d,u-1):(this.dataRefCount.delete(d),this.releaseTexture(p,t,r,o,n,i),this.texData.delete(p))}null!=a&&(a.real.dispose(),a.imag.dispose())}},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getCPUBackend=function(){return ei.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=ei.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(a,o){var t=this;return void 0===o&&(o=128),null!=this.getCPUBackend()&&a.every(function(a){return null==t.texData.get(a.dataId).texture&&a.size<o})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.getCanvas=function(){return this.canvas},t.prototype.complex=function(a,e){var t=this.makeOutputArray(a.shape,"complex64");return this.texData.get(t.dataId).complexTensors={real:ei.engine.keep(a.clone()),imag:ei.engine.keep(e.clone())},t},t.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},t.prototype.slice=function(s,e,t){if(this.shouldExecuteOnCPU([s]))return this.cpuBackend.slice(s,e,t);var n=this.texData.get(s.dataId).isPacked,r=Ft(s.shape,e,t);if(n||!r){var p=ei.get("WEBGL_PACK_ARRAY_OPERATIONS")?new zp(t):new Wp(t),a=p.getCustomSetupFunc(e);return this.compileAndRun(p,[s],null,a)}return this.uploadToGPU(s.dataId),this.shallowSlice(s,e,t)},t.prototype.shallowSlice=function(p,e,t){var n=this.texData.get(p.dataId),r=Os.make(t,{},p.dtype,this),o=this.texData.get(r.dataId);Object.assign(o,n),o.shape=t,o.dtype=p.dtype;var a=Bt(e,p.strides);n.slice&&(a+=n.slice.flatOffset),o.slice={flatOffset:a,origDataId:n.slice&&n.slice.origDataId||p.dataId};var d=this.dataRefCount.get(o.slice.origDataId)||1;return this.dataRefCount.set(o.slice.origDataId,d+1),r},t.prototype.stridedSlice=function(m,e,t,n,r,o,a,i,s){if(this.shouldExecuteOnCPU([m]))return this.cpuBackend.stridedSlice(m,e,t,n,r,o,a,i,s);var u=At(m.shape,e,t,n,r,o,a,i,s),c=u[0],l=u[1],p=u[2],d=l.filter(function(a,e){return-1===p.indexOf(e)});if(d.some(function(t){return 0===t}))return Mt([],d);var h=new Gp(c,n,l,p);return this.compileAndRun(h,[m])},t.prototype.reverse=function(a,e){var t=ei.get("WEBGL_PACK_ARRAY_OPERATIONS")?new Fp(a.shape,e):new Pp(a.shape,e);return this.compileAndRun(t,[a])},t.prototype.concat=function(p,d){if(this.shouldExecuteOnCPU(p))return this.cpuBackend.concat(p,d);if(1===p.length)return p[0];if(p.length>ei.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=$(p.length/2),t=this.concat(p.slice(0,e),d),n=this.concat(p.slice(e),d);return this.concat([t,n],d)}if(ei.get("WEBGL_PACK_ARRAY_OPERATIONS")&&1<p[0].rank){var o=new Ui(p.map(function(t){return t.shape}),d);return this.compileAndRun(o,p)}var a=Rt(p.map(function(t){return t.shape}),d),r=p.map(function(t){return t.as2D(-1,U(t.shape.slice(d)))}),s=new Wi(r.map(function(t){return t.shape}));return this.compileAndRun(s,r).reshape(a)},t.prototype.neg=function(a){var e=new td(a.shape,"return -x;");return this.compileAndRun(e,[a])},t.prototype.batchMatMul=function(m,e,t,n){var r=t?m.shape[2]:m.shape[1],o=n?e.shape[1]:e.shape[2],a=t?m.shape[1]:m.shape[2],i=m.shape[0];if((1===r||1===o)&&a>Zd){t&&(m=m.transpose([0,2,1])),n&&(e=e.transpose([0,2,1]));var s=1===o?m:m.as3D(i,a,1),u=1===o?2:1,c=1===o?e.as3D(i,1,a):e;return this.multiply(s,c).sum(u,!0)}var l=Te(m.dtype,e.dtype),p=new vp(m.shape,[i,r,o],t,n),d=this.makePackedTensor(p.outputShape,l);return this.compileAndRun(p,[m,e],d)},t.prototype.fusedBatchMatMul=function(h,e,t,n,r,m){var a=t?h.shape[2]:h.shape[1],i=n?e.shape[1]:e.shape[2],s=h.shape[0],u=Te(h.dtype,e.dtype),c=new vp(h.shape,[s,a,i],t,n,!!r,m?Un(m,!0):null),l=this.makePackedTensor(c.outputShape,u),p=[h,e];return r&&p.push(r),this.compileAndRun(c,p,l)},t.prototype.multiply=function(d,e){if("complex64"===d.dtype){var t=this.texData.get(d.dataId),n=this.texData.get(e.dataId),r=new wi(ki.REAL,d.shape,e.shape),o=new wi(ki.IMAG,d.shape,e.shape),a=[this.makeComplexComponentTensorHandle(d,t.complexTensors.real),this.makeComplexComponentTensorHandle(d,t.complexTensors.imag),this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s);return i.dispose(),s.dispose(),u}if(this.shouldExecuteOnCPU([d,e]))return this.cpuBackend.multiply(d,e);if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(d,e,Di,d.dtype);var c=new Oi(Di,d.shape,e.shape),l=this.makeOutputArray(c.outputShape,d.dtype);return this.compileAndRun(c,[d,e],l)},t.prototype.batchNormalization=function(p,e,t,n,r,o){var a=[p,e,t],i=null;null!=o&&(i=o.shape,a.push(o));var s=null;if(null!=r&&(s=r.shape,a.push(r)),ei.get("WEBGL_PACK_BATCHNORMALIZATION")){var d=new _i(p.shape,e.shape,t.shape,i,s,n);return this.compileAndRun(d,a)}var u=new Ei(p.shape,e.shape,t.shape,i,s,n);return this.compileAndRun(u,a)},t.prototype.localResponseNormalization4D=function(s,e,t,n,r){var o=new yp(s.shape,e,t,n,r);return this.compileAndRun(o,[s])},t.prototype.LRNGrad=function(p,e,t,n,r,o,a){var i=new xp(e.shape,n,r,o,a);return this.compileAndRun(i,[e,t,p])},t.prototype.tile=function(a,e){var t=new Hp(a.shape,e);return this.compileAndRun(t,[a])},t.prototype.pad=function(a,e,t){var o=ei.get("WEBGL_PACK_ARRAY_OPERATIONS")?new _p(a.shape,e,t):new Ep(a.shape,e,t);return this.compileAndRun(o,[a])},t.prototype.transpose=function(a,e){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.transpose(a,e);var t=ei.get("WEBGL_PACK_ARRAY_OPERATIONS")?new $p(a.shape,e):new qp(a.shape,e);return this.compileAndRun(t,[a])},t.prototype.gather=function(a,e,t){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.gather(a,e,t);var o=new sp(a.shape,e.size,t);return this.compileAndRun(o,[a,e])},t.prototype.batchToSpaceND=function(p,e,t){A(4>=p.rank,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var n=e.reduce(function(a,e){return a*e}),r=pt(p.shape,e,n),o=dt(r.length,e.length),a=lt(p.shape,e,n),i=ut(t,e.length),s=ct(a,t,e.length);return p.reshape(r).transpose(o).reshape(a).slice(i,s)},t.prototype.spaceToBatchND=function(p,e,t){A(4>=p.rank,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var n=e.reduce(function(a,e){return a*e}),r=[[0,0]];r.push.apply(r,t);for(var o=1+e.length;o<p.shape.length;++o)r.push([0,0]);var a=p.pad(r),i=pt(a.shape,e,n,!1),s=dt(i.length,e.length,!1),d=lt(a.shape,e,n,!1);return a.reshape(i).transpose(s).reshape(d)},t.prototype.reduce=function(p,e,t){var n=p.shape[0],d=p.shape[1],h=Et(d),m=new wp({windowSize:h,inSize:d,batchSize:n},e),i=m.outputShape,s=i[0],u=i[1],c=this.makeOutputArray([s,u],t);return this.compileAndRun(m,[p],c),1===c.shape[1]?c:this.reduce(c,e,t)},t.prototype.argReduce=function(d,e,t){void 0===t&&(t=null);var n=d.shape[0],h=d.shape[1];null!=t&&(n=t.shape[0],h=t.shape[1]);var m=Et(h),g=new yi({windowSize:m,inSize:h,batchSize:n},e,null==t),i=g.outputShape,s=i[0],u=i[1],c=this.makeOutputArray([s,u],"int32"),l=[d];return null!=t&&l.push(t),this.compileAndRun(g,l,c),1===c.shape[1]?c:this.argReduce(d,e,c)},t.prototype.argReducePacked=function(p,e,t){void 0===t&&(t=null);var n=null==t?p.shape:t.shape,r=Et(n[n.length-1]),o=new Ri(n,r,e,null==t),a=this.makePackedTensor(o.outputShape,"int32"),i=null==t?[p]:[p,t];return this.compileAndRun(o,i,a),a.rank===p.rank?this.argReducePacked(p,e,a):a},t.prototype.sum=function(s,e){yt("sum",e,s.rank);var t=gt(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r),a=De(s.dtype);return this.reduce(o,"sum",a).reshape(n)},t.prototype.prod=function(s,e){if(this.shouldExecuteOnCPU([s]))return this.cpuBackend.prod(s,e);var t=gt(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r),a=De(s.dtype);return this.reduce(o,"prod",a).reshape(n)},t.prototype.unsortedSegmentSum=function(p,e,t){var n=0,r=xt([n],p.rank),o=p;null!=r&&(o=p.transpose(r),n=vt(1,p.rank)[0]);var a=Nt(o.shape,n,t),i=U([o.shape[n]]),s=o.as2D(-1,i),d=De(p.dtype),u=this.segOpCompute(s,"unsortedSegmentSum",e,d,t).reshape(a);return null!=r&&(u=u.transpose(bt(r))),u},t.prototype.segOpCompute=function(h,e,t,n,r){var m=h.shape[0],g=h.shape[1],f=It(g,r),y=new Lp({windowSize:f,inSize:g,batchSize:m,numSegments:r},e),u=y.outputShape,c=u[0],l=u[1],p=this.makeOutputArray([c,l],n);return this.compileAndRun(y,[h,t],p),p.shape[1]===r?p:(t=Kt(0,r).tile([g/f]),this.segOpCompute(p,e,t,n,r))},t.prototype.argMinMaxReduce=function(p,e,t){var n=[e];if(yt("arg"+t.charAt(0).toUpperCase()+t.slice(1),n,p.rank),!ei.get("WEBGL_PACK_REDUCE")||2>=p.rank){var r=gt(p.shape,n),o=r[0],a=U(r[1]),i=p.as2D(-1,a);return this.argReduce(i,t).reshape(o)}return this.argReducePacked(p,t)},t.prototype.argMin=function(a,e){return this.argMinMaxReduce(a,e,"min")},t.prototype.argMax=function(a,e){return this.argMinMaxReduce(a,e,"max")},t.prototype.cumsum=function(a,e,t,n){if(e!==a.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(a.rank-1)+" but got axis="+e);var r=new Zi(a.shape,t,n);return this.compileAndRun(r,[a])},t.prototype.equal=function(a,e){if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(equal(a, b));\n","bool");var t=new Oi("return float(a == b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.notEqual=function(a,e){if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(notEqual(a, b));\n","bool");var t=new Oi("return float(a != b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.less=function(a,e){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.less(a,e);if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(lessThan(a, b));\n","bool");var t=new Oi("return float(a < b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.lessEqual=function(a,e){if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var t=new Oi("return float(a <= b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.greater=function(a,e){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.greater(a,e);if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(greaterThan(a, b));\n","bool");var t=new Oi("return float(a > b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.greaterEqual=function(a,e){if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var t=new Oi("return float(a >= b);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.logicalNot=function(a){var e=new td(a.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[a])},t.prototype.logicalAnd=function(a,e){if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var t=new Oi("return float(a >= 1.0 && b >= 1.0);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.logicalOr=function(a,e){if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var t=new Oi("return float(a >= 1.0 || b >= 1.0);",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[a,e],o)},t.prototype.select=function(a,e,t){var n=new Mp(a.rank,e.shape,e.rank),r=this.makeOutputArray(n.outputShape,Te(e.dtype,t.dtype));return this.compileAndRun(n,[a,e,t],r)},t.prototype.where=function(a){it("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=a.dataSync();return Mn(a.shape,e)},t.prototype.topk=function(a,e,t){return ia(a.dataSync(),a.shape,a.dtype,e,t)},t.prototype.min=function(s,e){yt("min",e,s.rank);var t=gt(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r);return this.reduce(o,"min",o.dtype).reshape(n)},t.prototype.minimum=function(a,e){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.minimum(a,e);var t=ei.get("WEBGL_PACK_BINARY_OPERATIONS")?new Fi("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Pi+"\n  return result;\n",a.shape,e.shape):new Oi(Ii+"\n  return min(a, b);\n",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.mod=function(a,e){var t=ei.get("WEBGL_PACK_BINARY_OPERATIONS")?new Fi("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+Pi+"\n  return result;\n",a.shape,e.shape):new Oi("if (b == 0.0) return NAN;\n  return mod(a, b);",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.max=function(s,e){if(this.shouldExecuteOnCPU([s]))return this.cpuBackend.max(s,e);yt("max",e,s.rank);var t=gt(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r);return this.reduce(o,"max",o.dtype).reshape(n)},t.prototype.maximum=function(a,e){if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.maximum(a,e);var t=ei.get("WEBGL_PACK_BINARY_OPERATIONS")?new Fi("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Pi+"\n  return result;\n",a.shape,e.shape):new Oi(Ii+"\n  return max(a, b);\n",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.all=function(s,e){yt("all",e,s.rank);var t=gt(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r);return this.reduce(o,"all",o.dtype).reshape(n)},t.prototype.any=function(s,e){yt("any",e,s.rank);var t=gt(s.shape,e),n=t[0],r=U(t[1]),o=s.as2D(-1,r);return this.reduce(o,"any",o.dtype).reshape(n)},t.prototype.squaredDifference=function(a,e){var t=ei.get("WEBGL_PACK_BINARY_OPERATIONS")?new Fi(Ai,a.shape,e.shape):new Oi(Ai,a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.realDivide=function(a,e){var t=new Oi("if (a == b) return 1.0;\n  return a / b;",a.shape,e.shape),o=this.makeOutputArray(t.outputShape,"float32");return this.compileAndRun(t,[a,e],o)},t.prototype.floorDiv=function(a,e){if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,"\n  vec4 resultSign = sign(a) * sign(b);\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  ivec4 result = ia / ib;\n  ivec4 amodb = ia - ib * result;\n\n  // Vectorize INT_DIV\n  // if (resultSign < 0.0 && amodb != 0) result -= 1;\n  // return float(result);\n  return vec4(result -\n     ivec4(lessThan(resultSign, vec4(0.0))) * ivec4(notEqual(amodb, ivec4(0))));\n","int32");var t=new Oi("\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",a.shape,e.shape),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[a,e],n)},t.prototype.add=function(a,e){if("complex64"===a.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(a,e,Ni);if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.add(a,e);var t=Te(a.dtype,e.dtype);if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,Ni,t);var n=new Oi(Ni,a.shape,e.shape),r=this.makeOutputArray(n.outputShape,t);return this.compileAndRun(n,[a,e],r)},t.prototype.packedBinaryOp=function(s,e,t,n){var r=new Fi(t,s.shape,e.shape),o=this.makePackedTensor(r.outputShape,n);return this.compileAndRun(r,[s,e],o)},t.prototype.complexSeparableBinaryOp=function(p,e,t){var n=this,r=this.texData.get(p.dataId),o=this.texData.get(e.dataId),a=[[r.complexTensors.real,o.complexTensors.real],[r.complexTensors.imag,o.complexTensors.imag]].map(function(r){var o=r[0],a=r[1],i=n.makeComplexComponentTensorHandle(p,o),s=n.makeComplexComponentTensorHandle(e,a),d=new Oi(t,p.shape,e.shape),u=n.makeOutputArray(d.outputShape,Te(o.dtype,a.dtype));return n.compileAndRun(d,[i,s],u)}),i=a[0],s=a[1],d=this.complex(i,s);return i.dispose(),s.dispose(),d},t.prototype.makeComplexComponentTensorHandle=function(a,e){return{dataId:e.dataId,dtype:e.dtype,shape:a.shape}},t.prototype.addN=function(a){for(var e=a[0],t=1;t<a.length;t++)e=this.add(e,a[t]);return e},t.prototype.subtract=function(a,e){if("complex64"===a.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(a,e,Ti);if(this.shouldExecuteOnCPU([a,e]))return this.cpuBackend.subtract(a,e);var t=Te(a.dtype,e.dtype);if(ei.get("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(a,e,Ti,a.dtype);var n=new Oi(Ti,a.shape,e.shape),r=this.makeOutputArray(n.outputShape,t);return this.compileAndRun(n,[a,e],r)},t.prototype.pow=function(s,e){var t=ei.get("WEBGL_PACK_BINARY_OPERATIONS"),n=t?new Fi("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+Pi+"\n  return result;\n",s.shape,e.shape):new Oi("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",s.shape,e.shape),r=Te(s.dtype,e.dtype),o=t?this.makePackedTensor(n.outputShape,r):this.makeOutputArray(n.outputShape,r);return this.compileAndRun(n,[s,e],o)},t.prototype.ceil=function(a){var e=new td(a.shape,"return ceil(x);");return this.compileAndRun(e,[a])},t.prototype.floor=function(a){var e=new td(a.shape,"return floor(x);");return this.compileAndRun(e,[a])},t.prototype.sign=function(a){var e=new td(a.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[a])},t.prototype.isNaN=function(a){var e=new td(a.shape,"return float(isnan(x));"),t=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[a],t)},t.prototype.isInf=function(a){var e=new td(a.shape,"return float(isinf(x));"),t=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[a],t)},t.prototype.isFinite=function(a){var e=new td(a.shape,"return float(!isnan(x) && !isinf(x));"),t=this.makeOutputArray(e.outputShape,"bool");return this.compileAndRun(e,[a],t)},t.prototype.round=function(a){var e=new td(a.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[a])},t.prototype.exp=function(a){var e;return e=ei.get("WEBGL_PACK")?new dd(a.shape,rd):new td(a.shape,rd),this.compileAndRun(e,[a])},t.prototype.expm1=function(a){var e=new td(a.shape,"return exp(x) - 1.0;");return this.compileAndRun(e,[a])},t.prototype.log=function(a){var e;return e=ei.get("WEBGL_PACK")?new dd(a.shape,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n"):new td(a.shape,"if (x < 0.0) return NAN;\n  return log(x);"),this.compileAndRun(e,[a])},t.prototype.log1p=function(a){var e=new td(a.shape,"return log(1.0 + x);");return this.compileAndRun(e,[a])},t.prototype.sqrt=function(a){var e=new td(a.shape,"return sqrt(x);");return this.compileAndRun(e,[a])},t.prototype.rsqrt=function(a){if(this.shouldExecuteOnCPU([a]))return this.cpuBackend.rsqrt(a);var e=new td(a.shape,"return inversesqrt(x);");return this.compileAndRun(e,[a])},t.prototype.square=function(a){var e=new td(a.shape,"return x * x;");return this.compileAndRun(e,[a])},t.prototype.reciprocal=function(a){var e=new td(a.shape,"return 1.0 / x;");return this.compileAndRun(e,[a])},t.prototype.relu=function(a){var e;return e=ei.get("WEBGL_PACK")?new dd(a.shape,pd):new td(a.shape,nd),this.compileAndRun(e,[a])},t.prototype.prelu=function(a,e){var t=ei.get("WEBGL_PACK_BINARY_OPERATIONS")?new Fi("\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",a.shape,e.shape):new Oi("return (a < 0.) ? b * a : a;",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.elu=function(a){var e=new td(a.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(e,[a])},t.prototype.eluDer=function(a,e){var t=ei.get("WEBGL_PACK_BINARY_OPERATIONS")?new Fi("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",a.shape,e.shape):new Oi("return (b >= 1.0) ? a : a * (b + 1.0);",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.selu=function(a){var e=new td(a.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+Jp+";\n  float scale = "+ed+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[a])},t.prototype.int=function(a){var e=new td(a.shape,"return float(int(x));"),t=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[a],t)},t.prototype.clip=function(a,e,t){var n=(o=ei.get("WEBGL_PACK_CLIP")?new Li(a.shape):new Bi(a.shape)).getCustomSetupFunc(e,t),o;return this.compileAndRun(o,[a],null,n)},t.prototype.abs=function(a){var e=new td(a.shape,"return abs(x);");return this.compileAndRun(e,[a])},t.prototype.complexAbs=function(a){var e=this.texData.get(a.dataId),t=new Mi(a.shape),o=[this.makeComplexComponentTensorHandle(a,e.complexTensors.real),this.makeComplexComponentTensorHandle(a,e.complexTensors.imag)];return this.compileAndRun(t,o)},t.prototype.sigmoid=function(a){var e=new td(a.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[a])},t.prototype.softplus=function(a){var e=new td(a.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[a])},t.prototype.sin=function(a){var e=new td(a.shape,ad+"\n  return sin(x);\n");return this.compileAndRun(e,[a])},t.prototype.cos=function(a){var e=new td(a.shape,ad+"\n  return cos(x);\n");return this.compileAndRun(e,[a])},t.prototype.tan=function(a){var e=new td(a.shape,"return tan(x);");return this.compileAndRun(e,[a])},t.prototype.asin=function(a){var e=new td(a.shape,"return asin(x);");return this.compileAndRun(e,[a])},t.prototype.acos=function(a){var e=new td(a.shape,"return acos(x);");return this.compileAndRun(e,[a])},t.prototype.atan=function(a){var e=new td(a.shape,ad+"\n  return atan(x);\n");return this.compileAndRun(e,[a])},t.prototype.atan2=function(a,e){var t=ei.get("WEBGL_PACK_BINARY_OPERATIONS")?new Fi("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+Pi+"\n  return result;\n",a.shape,e.shape):new Oi(Ii+"\n  return atan(a, b);\n",a.shape,e.shape);return this.compileAndRun(t,[a,e])},t.prototype.sinh=function(a){var e=new td(a.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[a])},t.prototype.cosh=function(a){var e=new td(a.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[a])},t.prototype.tanh=function(a){var e=new td(a.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[a])},t.prototype.asinh=function(a){var e=new td(a.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[a])},t.prototype.acosh=function(a){var e=new td(a.shape,ad+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[a])},t.prototype.atanh=function(a){var e=new td(a.shape,ad+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[a])},t.prototype.erf=function(a){var e=new td(a.shape,"\n  // Error function is calculated approximately with elementary function.\n  // See \"Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables\", Abramowitz and Stegun.\n  float p = "+Kp+";\n  float a1 = "+jp+";\n  float a2 = "+Xp+";\n  float a3 = "+Yp+";\n  float a4 = "+Qp+";\n  float a5 = "+Zp+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n");return this.compileAndRun(e,[a])},t.prototype.step=function(a,e){var t=new td(a.shape,Fn(e));return this.compileAndRun(t,[a])},t.prototype.conv2dByMatMul=function(u,e,t){var n=u.shape,r=this.texData.get(u.dataId),o=t.inChannels,a=n[0]*n[1]*n[2],i=t.outChannels,s=0!=n[2]%2&&!!r.isPacked;if((1==a||1===i)&&o>Zd||!ei.get("WEBGL_LAZILY_UNPACK")||!ei.get("WEBGL_PACK_BINARY_OPERATIONS")||!s){var y=this.reshape(u,[1,n[0]*n[1]*n[2],t.inChannels]),l=this.reshape(e,[1,t.inChannels,t.outChannels]);return this.reshape(this.batchMatMul(y,l,!1,!1),t.outShape)}var p=Os.make([1,n[0]*n[1]*(n[2]+1),t.inChannels],{dataId:u.dataId},u.dtype,this),d=r.shape;r.shape=r.shape.slice(),r.shape[r.shape.length-2]++,A(Yo(r.shape,p.shape),function(){return"packed reshape "+r.shape+" to "+p.shape+" isn't free"});var h=this.reshape(e,[1,t.inChannels,t.outChannels]),f=this.batchMatMul(p,h,!1,!1),m=this.texData.get(f.dataId);return A(m.isPacked,function(){return"batchMatMul result is expected to be packed"}),r.shape=d,m.shape=t.outShape,Os.make(t.outShape,{dataId:f.dataId},f.dtype,this)},t.prototype.conv2dWithIm2Row=function(g,e,t){var n=t.filterWidth,r=t.filterHeight,o=t.inChannels,a=t.outWidth,i=t.outHeight,s=n*r*o,u=i*a,c=[s,u],l=g.squeeze([0]),p=e.reshape([1,s,-1]),d=new fp(c,l.shape,t),h=this.compileAndRun(d,[l]).reshape([1,c[0],c[1]]),f=new vp(h.shape,[1,u,t.outChannels],!0,!1);return this.compileAndRun(f,[h,p]).reshape([1,i,a,t.outChannels])},t.prototype.conv2d=function(a,e,t){if(1===t.filterHeight&&1===t.filterWidth&&1===t.dilationHeight&&1===t.dilationWidth&&1===t.strideHeight&&1===t.strideWidth&&("SAME"===t.padInfo.type||"VALID"===t.padInfo.type))return this.conv2dByMatMul(a,e,t);if(ei.get("WEBGL_CONV_IM2COL")&&1===a.shape[0])return this.conv2dWithIm2Row(a,e,t);var o=new Ki(t);return this.compileAndRun(o,[a,e])},t.prototype.conv2dDerInput=function(a,e,t){var o=new Gi(t);return this.compileAndRun(o,[a,e])},t.prototype.conv2dDerFilter=function(a,e,t){var o=new zi(t);return this.compileAndRun(o,[a,e])},t.prototype.depthwiseConv2D=function(a,e,t){var o;return ei.get("WEBGL_PACK_DEPTHWISECONV")&&2>=t.strideWidth&&1==t.outChannels/t.inChannels?(o=new Yi(t),this.compileAndRun(o,[a,e],this.makePackedTensor(t.outShape,a.dtype))):(o=new Xi(t),this.compileAndRun(o,[a,e]))},t.prototype.depthwiseConv2DDerInput=function(a,e,t){var o=new $i(t);return this.compileAndRun(o,[a,e])},t.prototype.depthwiseConv2DDerFilter=function(a,e,t){var o=new qi(t);return this.compileAndRun(o,[a,e])},t.prototype.conv3d=function(a,e,t){var o=new ji(t);return this.compileAndRun(o,[a,e])},t.prototype.conv3dDerInput=function(a,e,t){var o=new Hi(t);return this.compileAndRun(o,[a,e])},t.prototype.conv3dDerFilter=function(a,e,t){var o=new Vi(t);return this.compileAndRun(o,[a,e])},t.prototype.maxPool=function(a,e){var t=new kp(e,"max",!1),o=this.makeOutputArray(t.outputShape,a.dtype);return this.compileAndRun(t,[a],o)},t.prototype.avgPool=function(a,e){var t=new kp(e,"avg",!1),o=this.makeOutputArray(t.outputShape,"float32");return this.compileAndRun(t,[a],o)},t.prototype.maxPoolBackprop=function(p,e,t,n){var r=new kp(n,"max",!0),o=this.compileAndRun(r,[e]),a=new bp(n),i=this.makeOutputArray(a.outputShape,e.dtype),s=this.compileAndRun(a,[p,o],i);return o.dispose(),s},t.prototype.avgPoolBackprop=function(a,e,t){var n=new Si(t),r=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[a],r)},t.prototype.cast=function(a,e){return jt(a,e,this)},t.prototype.unstack=function(p,e){for(var t=p.shape[e],n=Array(p.rank-1),r=0,o=0;o<p.rank;o++)o!==e&&(n[r++]=p.shape[o]);var a=Array(p.rank).fill(0),i=p.shape.slice();i[e]=1;var s=Array(t);for(o=0;o<s.length;o++)a[e]=o,s[o]=this.slice(p,a,i).reshape(n);return s},t.prototype.reshape=function(a,e){var t=this.texData.get(a.dataId);return!t.isPacked||Yo(a.shape,e)||null!==t.texture&&Yo(t.shape,e)?Xt(a,e):this.packedReshape(a,e)},t.prototype.resizeBilinear=function(a,e,t,n){var r=ei.get("WEBGL_PACK_IMAGE_OPERATIONS")?new Dp(a.shape,e,t,n):new Tp(a.shape,e,t,n);return this.compileAndRun(r,[a])},t.prototype.resizeBilinearBackprop=function(a,e,t){var o=new Np(a,e,t);return this.compileAndRun(o,[a])},t.prototype.resizeNearestNeighbor=function(a,e,t,n){var r=new Op(a.shape,e,t,n);return this.compileAndRun(r,[a])},t.prototype.resizeNearestNeighborBackprop=function(a,e,t){var o=new Ap(a,e,t);return this.compileAndRun(o,[a])},t.prototype.multinomial=function(p,e,t,n){var r=e?p:pi(p),o=r.shape[0],a=r.shape[1],i=new Cp(o,a,t),s=this.makeOutputArray(i.outputShape,"int32"),d=i.getCustomSetupFunc(n);return this.compileAndRun(i,[r],s,d)},t.prototype.oneHot=function(a,e,t,n){var r=new Rp(a.size,e,t,n);return this.compileAndRun(r,[a])},t.prototype.nonMaxSuppression=function(a,e,t,n,r){return it("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),na(a.dataSync(),e.dataSync(),t,n,r)},t.prototype.cropAndResize=function(s,e,t,n,r,o){var a=new Qi(s.shape,e.shape,n,r,o);return this.compileAndRun(a,[s,e,t])},t.prototype.depthToSpace=function(p,e,t){A(1<e,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var n=p.shape[0],r="NHWC"===t?p.shape[1]:p.shape[2],o="NHWC"===t?p.shape[2]:p.shape[3],a="NHWC"===t?p.shape[3]:p.shape[1],i=r*e,s=o*e,d=a/(e*e),u=new Ji("NHWC"===t?[n,i,s,d]:[n,d,i,s],e,t);return this.compileAndRun(u,[p])},t.prototype.split=function(a,e,t){return sa(a,e,t)},t.prototype.scatterND=function(c,e,t){var n=wt(e,c,t),r=n.sliceRank,o=n.numUpdates,a=n.sliceSize,i=n.strides,s=n.outputSize,u=c.reshape([o,r]),l=e.reshape([o,a]);if(0===s)return Xt(Mt([]),t);var p=Wt(0),d=new Bp(o,r,u.rank,l.rank,i,[s/a,a]);return this.compileAndRun(d,[l,u,p]).reshape(t)},t.prototype.sparseToDense=function(p,e,t,n){var r=wt(e,p,t),o=r.sliceRank,a=r.numUpdates,i=r.strides,s=r.outputSize,d=new Bp(a,o,p.rank,e.rank,i,[s,1],!1);return this.compileAndRun(d,[e,p,n]).reshape(t)},t.prototype.fft=function(t){return this.fftImpl(t,!1)},t.prototype.ifft=function(t){return this.fftImpl(t,!0)},t.prototype.fftImpl=function(p,e){var t=this.texData.get(p.dataId),n=new ap(tp.REAL,p.shape,e),r=new ap(tp.IMAG,p.shape,e),o=[this.makeComplexComponentTensorHandle(p,t.complexTensors.real),this.makeComplexComponentTensorHandle(p,t.complexTensors.imag)],a=this.compileAndRun(n,o),i=this.compileAndRun(r,o),s=this.complex(a,i).as2D(p.shape[0],p.shape[1]);return a.dispose(),i.dispose(),s},t.prototype.gatherND=function(d,e){var t=e.shape,n=t[t.length-1],r=St(d,e),o=r[0],a=r[1],i=r[2],s=r[3],u=e.reshape([a,n]),c=d.reshape([d.size/i,i]),l=new ip(n,s,[a,i]);return this.compileAndRun(l,[c,u]).reshape(o)},t.prototype.fill=function(s,e,t){if("string"===(t=t||se(e))){var n=Y(t,U(s));return n.fill(e),Os.make(s,{values:n},t)}var p=new np(s,e),o=p.getCustomSetupFunc(e),a=this.makeOutputArray(s,t);return this.compileAndRun(p,[],a,o)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},t.prototype.makeOutputArray=function(a,e){return Os.make(a,{},e,this)},t.prototype.makePackedTensor=function(a,e){var t=Os.make(a,{},e,this);return this.texData.get(t.dataId).isPacked=!0,t},t.prototype.unpackTensor=function(a){var e=new ld(a.shape);return this.compileAndRun(e,[a],Os.make(e.outputShape,{},a.dtype,this))},t.prototype.packTensor=function(a){var e=new Sp(a.shape);return this.compileAndRun(e,[a],this.makePackedTensor(a.shape,a.dtype))},t.prototype.packedReshape=function(a,e){var t=a.reshape([$o(a.shape)].concat(Ko(a.shape))),n=[$o(e)].concat(Ko(e)),r=new Ip(n,t.shape);return this.compileAndRun(r,[t]).reshape(e)},t.prototype.compileAndRun=function(y,e,t,n,r){var x=this;if(void 0===r&&(r=!0),null==t&&(t=y.usesPackedTextures?this.makePackedTensor(y.outputShape,e[0].dtype):this.makeOutputArray(y.outputShape,e[0].dtype)),0===t.size)return this.texData.get(t.dataId).values=X(t.dtype,0),t;var a=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var t=x.texData.get(e.dataId);if(null==t.texture){if(!y.usesPackedTextures&&U(e.shape)<=ei.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:x.readSync(e.dataId)};y.usesPackedTextures&&(t.isPacked=!0,t.shape=e.shape)}else if(!!t.isPacked!=!!y.usesPackedTextures)e=t.isPacked?x.unpackTensor(e):x.packTensor(e),t=x.texData.get(e.dataId);else if(t.isPacked&&!Yo(t.shape,e.shape)){var a=e,r=e.shape;e.shape=t.shape,e=x.packedReshape(e,r),t=x.texData.get(e.dataId),a.shape=r}return x.uploadToGPU(e.dataId),{shape:e.shape,texData:t,isUniform:!1}});this.uploadToGPU(t.dataId);var o={shape:t.shape,texData:this.texData.get(t.dataId),isUniform:!1},i=Sn(y,a,o),u=this.getAndSaveBinary(i,function(){return vn(x.gpgpu,y,a,o)}),l=null!=this.activeTimers,p;l&&(p=this.startTimer()),Rn(this.gpgpu,u,a,o,n);var s=1024*ei.get("WEBGL_NUM_MB_BEFORE_PAGING");if(r&&this.numBytesInGPU>s)for(var d=this.numBytesInGPU-s;0<d&&0<this.lruDataGPU.length;){var c=this.lruDataGPU.shift(),h=this.texData.get(c),m=h.texShape,g=h.dtype;d-=this.computeBytes(m,g),this.read(c)}return l&&(p=this.endTimer(p),this.activeTimers.push({name:y.constructor.name,query:this.getQueryTime(p)})),ei.get("WEBGL_LAZILY_UNPACK")||!this.texData.get(t.dataId).isPacked||y.isPackShader?t:this.unpackTensor(t)},t.prototype.getAndSaveBinary=function(a,e){return a in this.binaryCache||(this.binaryCache[a]=e()),this.binaryCache[a]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var a=this;return ai(function(){var e=ei.get("DEBUG");ei.set("DEBUG",!1);var t=a.abs(Wt(1e-8)).dataSync()[0];return ei.set("DEBUG",e),0<t?32:16})},t.prototype.uploadToGPU=function(g){var e=this.texData.get(g),n=e.shape,r=e.dtype,o=e.values,a=e.texture,i=e.usage,s=e.isPacked,u;if(null==a){var t=null!=this.activeTimers,l;t&&(l=performance.now());var c=jo(n,s);e.texShape=c;var p=this.acquireTexture(g,c,i,r,s);if(e.texture=p,null!=o){if(s){var d=$o(n),h=1,f=1;n.length&&(h=(u=Ko(n))[0],f=u[1]),this.gpgpu.uploadMatrixToPackedTexture(p,d,h,f,c[0],c[1],Gn(o))}else this.gpgpu.uploadMatrixToTexture(p,c[0],c[1],Gn(o));e.values=null,t&&(this.uploadWaitMs+=performance.now()-l)}}else ei.get("WEBGL_NUM_MB_BEFORE_PAGING")<W&&0<=this.lruDataGPU.indexOf(g)&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(g),1),this.lruDataGPU.push(g))},t.prototype.convertAndCacheOnCPU=function(p,e){var t=this.texData.get(p),n=t.texture,r=t.texShape,o=t.dtype,a=t.usage,i=t.isPacked;return null!=n&&(this.releaseTexture(p,n,r,a,o,i),t.texture=null,t.texShape=null,t.isPacked=!1),t.usage=pp.UPLOAD,null!=e&&(t.values=zn(e,o)),t.values},t.prototype.releaseTexture=function(s,e,t,n,r,o){if(ei.get("WEBGL_NUM_MB_BEFORE_PAGING")<W){var a=this.lruDataGPU.indexOf(s);0<=a&&this.lruDataGPU.splice(a,1)}this.numBytesInGPU-=this.computeBytes(t,r),this.textureManager.releaseTexture(e,t,n,o)},t.prototype.acquireTexture=function(a,e,t,n,r){return ei.get("WEBGL_NUM_MB_BEFORE_PAGING")<W&&this.lruDataGPU.push(a),this.numBytesInGPU+=this.computeBytes(e,n),this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(a,e){return a[0]*a[1]*te(e)},t}();ei.get("IS_BROWSER")&&ei.registerBackend("webgl",function(){return new Jd},2);var el=Lt({abs_:function(a){var o=ot(a,"x","abs");return"complex64"===o.dtype?ei.engine.runKernel(function(t){return t.complexAbs(o)},{$x:o}):ei.engine.runKernel(function(t,e){var a=t.abs(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.toFloat().step(-1))}}})}}),tl=Lt({acos_:function(a){var o=ot(a,"x","acos");return ei.engine.runKernel(function(t,e){var a=t.acos(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.divStrict(Wt(1).sub(t.toFloat().square()).sqrt()).neg()}}})}}),al=Lt({acosh_:function(a){var o=ot(a,"x","acosh");return ei.engine.runKernel(function(t,e){var a=t.acosh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.divStrict(t.toFloat().square().sub(1).sqrt())}}})}}),ol=Lt({asin_:function(a){var o=ot(a,"x","asin");return ei.engine.runKernel(function(t,e){var a=t.asin(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.divStrict(Wt(1).sub(t.toFloat().square()).sqrt())}}})}}),nl=Lt({asinh_:function(a){var o=ot(a,"x","asinh");return ei.engine.runKernel(function(t,e){var a=t.asinh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.divStrict(Wt(1).add(t.toFloat().square()).sqrt())}}})}}),rl=Lt({atan_:function(a){var o=ot(a,"x","atan");return ei.engine.runKernel(function(t,e){var a=t.atan(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.toFloat().square().add(1))}}})}}),sl=Lt({atanh_:function(a){var o=ot(a,"x","atanh");return ei.engine.runKernel(function(t,e){var a=t.atanh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(Wt(1).sub(t.toFloat().square()))}}})}}),il=Lt({ceil_:function(a){var o=ot(a,"x","ceil");return ei.engine.runKernel(function(t){return t.ceil(o)},{$x:o},function(t){return{$x:function(){return mi(t)}}})}}),pl=Lt({clipByValue_:function(a,s,t){var n=ot(a,"x","clipByValue");return A(s<=t,function(){return"Error in clip: min ("+s+") must be less than or equal to max ("+t+")."}),ei.engine.runKernel(function(r,e){var o=r.clip(n,s,t);return e([n]),o},{$x:n},function(a,e){var n=e[0];return{$x:function(){return a.where(n.greaterEqual(s).logicalAnd(n.lessEqual(t)),mi(a))}}})}}),dl=Lt({cos_:function(a){var o=ot(a,"x","cos");return ei.engine.runKernel(function(t,e){var a=t.cos(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return t.toFloat().sin().neg().mul(a)}}})}}),ll=Lt({cosh_:function(a){var o=ot(a,"x","cosh");return ei.engine.runKernel(function(t,e){var a=t.cosh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return t.toFloat().sinh().mulStrict(a)}}})}}),ul=Lt({erf_:function(a){var o=ot(a,"x","erf");return A("int32"===o.dtype||"float32"===o.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===o.dtype&&(o=o.toFloat()),ei.engine.runKernel(function(t,e){var a=t.erf(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.square().neg().exp().mul(2/C(Math.PI)))}}})}}),cl=Lt({exp_:function(a){var o=ot(a,"x","exp");return ei.engine.runKernel(function(t,e){var a=t.exp(o);return e([a]),a},{$x:o},function(a,e){return{$x:function(){return a.mulStrict(e[0])}}})}}),hl=Lt({expm1_:function(a){var o=ot(a,"x","expm1");return ei.engine.runKernel(function(t,e){var a=t.expm1(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.exp())}}})}}),ml=Lt({floor_:function(a){var o=ot(a,"x","floor");return ei.engine.runKernel(function(t){return t.floor(o)},{$x:o},function(t){return{$x:function(){return mi(t)}}})}}),gl=Lt({log_:function(a){var o=ot(a,"x","log");return ei.engine.runKernel(function(t,e){var a=t.log(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.toFloat())}}})}}),fl=Lt({log1p_:function(a){var o=ot(a,"x","log1p");return ei.engine.runKernel(function(t,e){var a=t.log1p(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.add(1))}}})}}),yl=Lt({logSigmoid_:function(a){var o=ot(a,"x","logSigmoid");return ei.engine.runKernel(function(t,e){var a=t.softplus(o.neg()).neg();return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.neg().sigmoid())}}})}}),xl=Lt({neg_:function(a){var o=ot(a,"x","neg");return ei.engine.runKernel(function(t){return t.neg(o)},{$x:o},function(t){return{$x:function(){return t.neg()}}})}}),bl=Lt({reciprocal_:function(a){var o=ot(a,"x","reciprocal");return ei.engine.runKernel(function(t,e){var a=t.reciprocal(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.square().neg())}}})}}),vl=Lt({round_:function(a){var o=ot(a,"x","round");return ei.engine.runKernel(function(t){return t.round(o)},{$x:o},function(t){return{$x:function(){return mi(t)}}})}}),Cl=Lt({rsqrt_:function(a){var o=ot(a,"x","rsqrt");return ei.engine.runKernel(function(t,e){var a=t.rsqrt(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.pow(1.5).mul(2)).neg()}}})}}),Rl=Lt({sigmoid_:function(a){var o=ot(a,"x","sigmoid");return ei.engine.runKernel(function(t,e){var a=t.sigmoid(o);return e([a]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.mul(Wt(1).sub(t)))}}})}}),Sl=Lt({sign_:function(a){var o=ot(a,"x","sign");return ei.engine.runKernel(function(t){return t.sign(o)},{$x:o},function(t){return{$x:function(){return mi(t)}}})}}),El=Lt({isNaN_:function(a){var o=ot(a,"x","isNaN");return ei.engine.runKernel(function(t){return t.isNaN(o)},{$x:o},function(t){return{$x:function(){return mi(t)}}})}}),_l=Lt({isInf_:function(a){var o=ot(a,"x","isInf");return ei.engine.runKernel(function(t){return t.isInf(o)},{$x:o},function(t){return{$x:function(){return mi(t)}}})}}),kl=Lt({isFinite_:function(a){var o=ot(a,"x","isFinite");return ei.engine.runKernel(function(t){return t.isFinite(o)},{$x:o},function(t){return{$x:function(){return mi(t)}}})}}),wl=Lt({sin_:function(a){var o=ot(a,"x","sin");return ei.engine.runKernel(function(t,e){var a=t.sin(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return t.toFloat().cos().mul(a)}}})}}),Il=Lt({sinh_:function(a){var o=ot(a,"x","sinh");return ei.engine.runKernel(function(t,e){var a=t.sinh(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return t.toFloat().cosh().mulStrict(a)}}})}}),Nl=Lt({softplus_:function(a){var o=ot(a,"x","softplus");return ei.engine.runKernel(function(t,e){var a=t.softplus(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.sigmoid())}}})}}),Tl=Lt({sqrt_:function(a){var o=ot(a,"x","sqrt");return ei.engine.runKernel(function(t,e){var a=t.sqrt(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.toFloat().sqrt().mul(2))}}})}}),Dl=Lt({square_:function(a){var o=ot(a,"x","square");return ei.engine.runKernel(function(t,e){return e([o]),t.square(o)},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mul(t.toFloat().mul(2))}}})}}),Al=Lt({step_:function(a,o){void 0===o&&(o=0);var t=ot(a,"x","step");return ei.engine.runKernel(function(a){return a.step(t,o)},{$x:t},function(t){return{$x:function(){return mi(t)}}})}}),Ol=Lt({tan_:function(a){var o=ot(a,"x","tan");return ei.engine.runKernel(function(t,e){var a=t.tan(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.div(t.cos().square())}}})}}),Pl=Lt({tanh_:function(a){var o=ot(a,"x","tanh");return ei.engine.runKernel(function(t,e){var a=t.tanh(o);return e([a]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return Wt(1).sub(t.square()).mulStrict(a)}}})}}),Fl=Lt({batchNormalization2d_:function(s,e,t,n,r,o){return void 0===n&&(n=.001),jn(),Vn(s,e,t,o,r,n)}}),Bl=Lt({batchNormalization3d_:function(s,e,t,n,r,o){return void 0===n&&(n=.001),jn(),Hn(s,e,t,o,r,n)}}),Ll=Lt({batchNormalization4d_:function(s,e,t,n,r,o){return void 0===n&&(n=.001),jn(),qn(s,e,t,o,r,n)}}),Ml=Lt({batchNormalization_:function(s,e,t,n,r,o){return void 0===n&&(n=.001),jn(),$n(s,e,t,o,r,n)}}),Wl=Lt({batchNorm_:$n}),Ul=Lt({batchNorm2d_:Vn}),zl=Lt({batchNorm3d_:Hn}),Gl=Lt({batchNorm4d_:qn}),Vl=Lt({conv1d_:function(m,e,t,n,r,o,a){void 0===r&&(r="NWC"),void 0===o&&(o=1);var i=ot(m,"x","conv1d"),s=ot(e,"filter","conv1d"),u=i,c=!1;2===i.rank&&(c=!0,u=i.as3D(1,i.shape[0],i.shape[1])),A(3===u.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."}),A(3===s.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+s.rank+"."}),null!=a&&A(M(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),A(u.shape[2]===s.shape[1],function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+s.shape[1]+"."}),A(ir(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),A("NWC"===r,function(){return"Error in conv1d: got dataFormat of "+r+" but only NWC is currently supported."});var l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),p=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),d=Hl(p,l,[1,t],n,"NHWC",[1,o],a);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),Hl=Lt({conv2d_:function(h,e,t,n,r,m,a){void 0===r&&(r="NHWC"),void 0===m&&(m=[1,1]);var o=ot(h,"x","conv2d"),s=ot(e,"filter","conv2d"),i=o,g=!1;3===o.rank&&(g=!0,i=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),A(4===i.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+i.rank+"."}),A(4===s.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+s.rank+"."}),null!=a&&A(M(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),A(i.shape[3]===s.shape[2],function(){return"Error in conv2d: depth of input ("+i.shape[3]+") must match input depth for filter "+s.shape[2]+"."}),A(ir(t,m),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+m+"'"}),A("NHWC"===r,function(){return"Error in conv2d: got dataFormat of "+r+" but only NHWC is currently supported."});var l=Yn(i.shape,s.shape,t,m,n,a),p=ei.engine.runKernel(function(a,e){var t=a.conv2d(i,s,l);return e([s,i]),t},{x:i,$filter:s},function(a,e){var r=e,o=r[0],i=r[1];return A(sr(m),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+m+"'"}),{x:function(){return pr(i.shape,a,o,t,n)},$filter:function(){return dr(i,a,o.shape,t,n)}}});return g?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),ql=Lt({conv3d_:function(d,e,t,n,r,h){void 0===r&&(r="NHWC"),void 0===h&&(h=[1,1,1]);var a=ot(d,"x","conv3d"),o=ot(e,"filter","conv3d"),i=a,m=!1;4===a.rank&&(m=!0,i=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),A(5===i.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+i.rank+"."}),A(5===o.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+o.rank+"."}),A(i.shape[4]===o.shape[3],function(){return"Error in conv3d: depth of input ("+i.shape[4]+") must match input depth for filter "+o.shape[3]+"."}),A(cr(t,h),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+h+"'"}),A("NHWC"===r,function(){return"Error in conv3d: got dataFormat of "+r+" but only NHWC is currently supported."});var c=Qn(i.shape,o.shape,t,h,n),l=ei.engine.runKernel(function(a,e){var t=a.conv3d(i,o,c);return e([i,o]),t},{x:i,$filter:o},function(a,e){A(ur(h),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+h+"'"});var r=e[0],o=e[1];return{x:function(){return gr(r.shape,a,o,t,n)},$filter:function(){return fr(r,a,o.shape,t,n)}}});return m?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}}),$l=Lt({conv2dDerFilter_:dr}),Kl=Lt({depthwiseConv2d_:function(h,e,t,n,r,o,a){void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]);var i=ot(h,"x","depthwiseConv2d"),s=ot(e,"filter","depthwiseConv2d"),m=i,g=!1;3===i.rank&&(g=!0,m=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),A(4===m.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),A(4===s.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+s.rank+"."}),A(m.shape[3]===s.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+s.shape[2]+"."}),null==o&&(o=[1,1]),A(ir(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),null!=a&&A(M(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var l=Yn(m.shape,s.shape,t,o,n,a,!0),p=ei.engine.runKernel(function(a,e){var t=a.depthwiseConv2D(m,s,l);return e([m,s]),t},{x:m,$filter:s},function(a,e){A(sr(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var t=e[0],n=e[1];return{x:function(){return hr(t.shape,a,n,l)},$filter:function(){return mr(t,a,n.shape,l)}}});return g?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),jl=Lt({separableConv2d_:function(g,e,t,n,r,o,a){void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC");var i=ot(g,"x","separableConv2d"),s=ot(e,"depthwiseFilter","separableConv2d"),u=ot(t,"pointwiseFilter","separableConv2d"),c=i,l=!1;if(3===i.rank&&(l=!0,c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(4===c.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),A(4===s.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+s.rank+"."}),A(4===u.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+s.rank+"."}),A(1===u.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."}),A(1===u.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."});var p=s.shape[2],d=s.shape[3];A(u.shape[2]===p*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*d+", but got "+u.shape[2]+"."});var h=Kl(c,s,n,r,a,o),f=Hl(h,u,1,"valid",a);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),Xl=Lt({conv2dTranspose_:function(s,e,t,n,r,o){return pr(t,ot(s,"x","conv2dTranspose"),ot(e,"filter","conv2dTranspose"),n,r,o)}}),Yl=Lt({matMul_:function(y,e,x,b){var t;void 0===x&&(x=!1),void 0===b&&(b=!1);var o=ot(y,"a","matMul"),a=ot(e,"b","matMul");t=Ae(o,a),o=t[0],a=t[1];var i=x?o.shape[o.rank-2]:o.shape[o.rank-1],s=b?a.shape[a.rank-1]:a.shape[a.rank-2],u=x?o.shape[o.rank-1]:o.shape[o.rank-2],c=b?a.shape[a.rank-2]:a.shape[a.rank-1],l=o.shape.slice(0,-2),p=a.shape.slice(0,-2),d=U(l),h=U(p);A(2<=o.rank&&2<=a.rank&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),A(L(l,p),function(){return"Error in matMul: outer dimensions ("+l+") and ("+p+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),A(i===s,function(){return"Error in matMul: inner shapes ("+i+") and ("+s+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+x+" and transposeB="+b+" must match."});var f=o.shape.slice(0,-2).concat([u,c]),m=x?o.as3D(d,i,u):o.as3D(d,u,i),C=b?a.as3D(h,c,s):a.as3D(h,s,c);return ei.engine.runKernel(function(a,e){var t=a.batchMatMul(m,C,x,b);return e([m,C]),t},{$a:m,$b:C},function(s,e){var t=e,o=t[0],a=t[1];return x||b?!x&&b?{$a:function(){return s.matMul(a,!1,!1)},$b:function(){return s.matMul(o,!0,!1)}}:x&&!b?{$a:function(){return a.matMul(s,!1,!0)},$b:function(){return o.matMul(s,!1,!1)}}:{$a:function(){return a.matMul(s,!0,!0)},$b:function(){return s.matMul(o,!0,!0)}}:{$a:function(){return s.matMul(a,!1,!0)},$b:function(){return o.matMul(s,!0,!1)}}}).reshape(f)}}),Ql=Lt({dot_:function(s,e){var t=ot(s,"t1","dot"),n=ot(e,"t2","dot");A((1===t.rank||2===t.rank)&&(1===n.rank||2===n.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."});var r=1===t.rank?t.size:t.shape[1],o=1===n.rank?n.size:n.shape[0];return A(r===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+r+" and "+o+"."}),1===t.rank&&1===n.rank?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():1===t.rank&&2===n.rank?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():2===t.rank&&1===n.rank?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),Zl=Lt({outerProduct_:function(a,e){var t=ot(a,"v1","outerProduct"),o=ot(e,"v2","outerProduct");return A(1===t.rank&&1===o.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+o.rank+"."}),t.as2D(-1,1).matMul(o.as2D(1,-1))}}),Jl=Lt({reverse_:function(a,e){var t=ot(a,"x","reverse");if(0===t.rank)return t.clone();var o=K(e,t.shape);return ei.engine.runKernel(function(a){return a.reverse(t,o)},{$x:t},function(t){return{$x:function(){return t.reverse(o)}}}).reshapeAs(t)}}),eu=Lt({reverse1d_:function(a){var e=ot(a,"x","reverse");return A(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Jl(e,0)}}),tu=Lt({reverse2d_:function(a,e){var t=ot(a,"x","reverse");return A(2===t.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Jl(t,e)}}),au=Lt({reverse3d_:function(a,e){var t=ot(a,"x","reverse");return A(3===t.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Jl(t,e)}}),ou=Lt({reverse4d_:function(a,e){var t=ot(a,"x","reverse");return A(4===t.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Jl(t,e)}}),nu=Lt({maxPool_:function(a,e,t,n,r){return yr(a,e,t,1,n,r)}}),ru=Lt({avgPool_:function(a,e,t,n,r){return xr(a,e,t,1,n,r)}}),su=Lt({pool_:function(b,e,t,n,r,o){null==r&&(r=[1,1]),null==o&&(o=1),0===n&&(n="valid");var a=ot(b,"x","maxPool"),i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(ir(o,r),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+r+"'"});var u=Xn(i.shape,e,o,r,n),l=[u.dilationHeight,u.dilationWidth],p;p="same"===n?Rr([u.filterHeight,u.filterWidth],l):[[0,0],[0,0]];var c=1===l[0]&&1===l[1],d=Cr([u.inHeight,u.inWidth],l,p),h=d[0],f=d[1],m=c?n:"valid",g=c?i:qd(i,l,h),v=("avg"===t?function(){return xr(g,e,o,1,m)}:function(){return yr(g,e,o,1,m)})(),y=c?v:wd(v,l,f);return s?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),iu=Lt({slice_:function(s,e,p){var d=ot(s,"x","slice"),l,r;if(0===d.rank)throw new Error("Slicing scalar is not possible");l="number"==typeof e?[e].concat(Array(d.rank-1).fill(0)):e.length<d.rank?e.concat(Array(d.rank-e.length).fill(0)):e.slice(),r=(r=null==p?Array(d.rank).fill(-1):"number"==typeof p?[p].concat(Array(d.rank-1).fill(-1)):p.length<d.rank?p.concat(Array(d.rank-p.length).fill(-1)):p).map(function(a,e){return 0<=a?a:(A(-1==a,function(){return"Bad value in size"}),d.shape[e]-l[e])}),Dt(d,l,r);var o=d.shape;return ei.engine.runKernel(function(t){return t.slice(d,l,r)},{$x:d},function(a){for(var e=[],t=0;t<a.rank;t++)e.push([l[t],o[t]-l[t]-r[t]]);return{$x:function(){return a.pad(e)}}})}}),pu=Lt({slice1d_:function(a,e,t){var o=ot(a,"x","slice1d");return A(1===o.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+o.rank+" tensor"}),iu(o,[e],[t])}}),du=Lt({slice2d_:function(a,e,t){var o=ot(a,"x","slice2d");return A(2===o.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+o.rank+" tensor"}),iu(o,e,t)}}),lu=Lt({slice3d_:function(a,e,t){var o=ot(a,"x","slice3d");return A(3===o.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+o.rank+" tensor"}),iu(o,e,t)}}),uu=Lt({slice4d_:function(a,e,t){var o=ot(a,"x","slice4d");return A(4===o.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+o.rank+" tensor"}),iu(o,e,t)}}),cu=Lt({all_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=ot(p,"x","all","bool"),d=K(e,n.shape),o=d,a=xt(o,n.rank);null!=a&&(n=n.transpose(a),o=vt(o.length,n.rank));var i=ei.engine.runKernel(function(t){return t.all(n,o)},{$x:n});if(t){var s=ft(i.shape,d);return i.reshape(s)}return i}}),hu=Lt({any_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=ot(p,"x","any","bool"),d=K(e,n.shape),o=d,a=xt(o,n.rank);null!=a&&(n=n.transpose(a),o=vt(o.length,n.rank));var i=ei.engine.runKernel(function(t){return t.any(n,o)},{$x:n});if(t){var s=ft(i.shape,d);return i.reshape(s)}return i}}),mu=Lt({argMax_:function(a,e){void 0===e&&(e=0);var s=ot(a,"x","argMax");null==e&&(e=0);var i=K(e,s.shape),t=xt(i,s.rank);return null!=t&&(s=s.transpose(t),i=vt(i.length,s.rank)),ei.engine.runKernel(function(a,e){var t=a.argMax(s,i[0]);return e([s]),t},{$x:s},function(a,e){var t=e[0];return{$x:function(){return mi(t)}}})}}),gu=Lt({argMin_:function(a,e){void 0===e&&(e=0);var s=ot(a,"x","argMin");null==e&&(e=0);var i=K(e,s.shape),t=xt(i,s.rank);return null!=t&&(s=s.transpose(t),i=vt(i.length,s.rank)),ei.engine.runKernel(function(a,e){var t=a.argMin(s,i[0]);return e([s]),t},{$x:s},function(a,e){var t=e[0];return{$x:function(){return mi(t)}}})}}),fu=Lt({logSumExp_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=ot(p,"x","logSumExp"),r=K(e,n.shape),o=n.max(r,!0),a=n.sub(o).exp().sum(r).log(),i=o.reshape(a.shape).add(a);if(t){var s=ft(i.shape,r);return i.reshape(s)}return i}}),yu=Lt({max_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var d=ot(p,"x","max"),l=d,o=K(e,d.shape),a=o,n=xt(a,d.rank);null!=n&&(d=d.transpose(n),a=vt(a.length,d.rank));var s=ei.engine.runKernel(function(o,e){var t=o.max(d,a);return e([l,t]),t},{$x:d},function(a,e){return Sr(a,e[1],e[0],o,n)});if(t){var i=ft(s.shape,o);s=s.reshape(i)}return s}}),xu=Lt({mean_:function(s,i,t){void 0===i&&(i=null),void 0===t&&(t=!1);var e=ot(s,"x","mean"),r=K(i,e.shape),o=U(gt(e.shape,r)[1]);return st(function(a){var e=Wt(o);return{value:(e.dtype===a.dtype?a:a.cast(e.dtype)).div(e).sum(i,t),gradFunc:function(e){var t=a.shape.slice();return r.forEach(function(a){t[a]=1}),e.reshape(t).mul(Ht(a.shape,"float32")).div(o)}}})(e)}}),bu=Lt({min_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var d=ot(p,"x","min"),l=d,o=K(e,d.shape),a=o,n=xt(a,d.rank);null!=n&&(d=d.transpose(n),a=vt(a.length,d.rank));var s=ei.engine.runKernel(function(o,e){var t=o.min(d,a);return e([l,t]),t},{$x:d},function(a,e){return Sr(a,e[1],e[0],o,n)});if(t){var i=ft(s.shape,o);s=s.reshape(i)}return s}}),vu=Lt({moments_:function(s,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=K(e,(s=ot(s,"x","moments")).shape),r=s.mean(n,t),i=r.shape;return t||(i=ft(r.shape,n)),{mean:r,variance:s.toFloat().sub(r.reshape(i)).square().mean(n,t)}}}),Cu=Lt({sum_:function(a,e,p){void 0===e&&(e=null),void 0===p&&(p=!1);var t=ot(a,"x","sum");"bool"===t.dtype&&(t=t.toInt());var d=K(e,t.shape);return st(function(o){var e=xt(d,o.rank),t=d,n=o;null!=e&&(n=o.transpose(e),t=vt(t.length,o.rank));var r=ei.engine.runKernel(function(a){return a.sum(n,t)},{permutedX:n});if(p){var l=ft(r.shape,d);r=r.reshape(l)}return{value:r,gradFunc:function(e){var t=o.shape.slice();return d.forEach(function(a){t[a]=1}),e.reshape(t).mul(Ht(o.shape,"float32"))}}})(t)}}),Ru=Lt({prod_:function(p,e,t){void 0===e&&(e=null),void 0===t&&(t=!1);var n=ot(p,"x","prod");"bool"===n.dtype&&(n=n.toInt());var r=K(e,n.shape),o=xt(r,n.rank),a=r,i=n;null!=o&&(i=n.transpose(o),a=vt(a.length,n.rank));var d=ei.engine.runKernel(function(t){return t.prod(i,a)},{permutedX:i});if(t){var l=ft(d.shape,r);d=d.reshape(l)}return d}}),Su=Lt({equal_:function(a,e){var t=ot(a,"a","equal"),s=ot(e,"b","equal"),i;return i=Ae(t,s),t=i[0],s=i[1],ha(t.shape,s.shape),ei.engine.runKernel(function(a){return a.equal(t,s)},{$a:t,$b:s})}}),Eu=Lt({equalStrict_:function(a,e){var t=ot(a,"a","equalStrict"),o=ot(e,"b","equalStrict");return O(t.shape,o.shape,"Error in equalStrict: "),t.equal(o)}}),_u=Lt({greater_:function(a,e){var t=ot(a,"a","greater"),s=ot(e,"b","greater"),i;return i=Ae(t,s),t=i[0],s=i[1],ha(t.shape,s.shape),ei.engine.runKernel(function(a){return a.greater(t,s)},{$a:t,$b:s})}}),ku=Lt({greaterEqual_:function(a,e){var s=ot(a,"a","greaterEqual"),i=ot(e,"b","greaterEqual"),t;return t=Ae(s,i),s=t[0],i=t[1],ha(s.shape,i.shape),ei.engine.runKernel(function(a,e){var t=a.greaterEqual(s,i);return e([s,i]),t},{$a:s,$b:i},function(a,e){var t=e[0],o=e[1];return{$a:function(){return mi(t)},$b:function(){return mi(o)}}})}}),wu=Lt({greaterEqualStrict_:function(a,e){var t=ot(a,"a","greaterEqualStrict"),o=ot(e,"b","greaterEqualStrict");return O(t.shape,o.shape,"Error in greaterEqualStrict: "),t.greaterEqual(o)}}),Iu=Lt({greaterStrict_:function(a,e){var t=ot(a,"a","greaterStrict"),o=ot(e,"b","greaterStrict");return O(t.shape,o.shape,"Error in greaterStrict: "),t.greater(o)}}),Nu=Lt({less_:function(a,e){var t=ot(a,"a","less"),s=ot(e,"b","less"),i;return i=Ae(t,s),t=i[0],s=i[1],ha(t.shape,s.shape),ei.engine.runKernel(function(a){return a.less(t,s)},{$a:t,$b:s})}}),Tu=Lt({lessEqual_:function(a,e){var t=ot(a,"a","lessEqual"),s=ot(e,"b","lessEqual"),i;return i=Ae(t,s),t=i[0],s=i[1],ha(t.shape,s.shape),ei.engine.runKernel(function(a){return a.lessEqual(t,s)},{$a:t,$b:s})}}),Du=Lt({lessEqualStrict_:function(a,e){var t=ot(a,"a","lessEqualStrict"),o=ot(e,"b","lessEqualStrict");return O(t.shape,o.shape,"Error in lessEqualStrict: "),t.lessEqual(o)}}),Au=Lt({lessStrict_:function(a,e){var t=ot(a,"a","lessStrict"),o=ot(e,"b","lessStrict");return O(t.shape,o.shape,"Error in lessStrict: "),t.less(o)}}),Ou=Lt({notEqual_:function(a,e){var t=ot(a,"a","notEqual"),s=ot(e,"b","notEqual"),i;return i=Ae(t,s),t=i[0],s=i[1],ha(t.shape,s.shape),ei.engine.runKernel(function(a){return a.notEqual(t,s)},{$a:t,$b:s})}}),Pu=Lt({notEqualStrict_:function(a,e){var t=ot(a,"a","notEqualStrict"),o=ot(e,"b","notEqualStrict");return O(t.shape,o.shape,"Error in notEqualStrict: "),t.notEqual(o)}}),Fu=Lt({add_:function(s,e){var i=ot(s,"a","add"),p=ot(e,"b","add"),t;t=Ae(i,p),i=t[0],p=t[1];var d=ha(i.shape,p.shape);return ei.engine.runKernel(function(t){return t.add(i,p)},{$a:i,$b:p},function(a){return{$a:function(){var e=a,t=ca(i.shape,d);return 0<t.length&&(e=e.sum(t)),e.reshape(i.shape)},$b:function(){var e=a,t=ca(p.shape,d);return 0<t.length&&(e=e.sum(t)),e.reshape(p.shape)}}})}}),Bu=Lt({addN_:function(a){A(Array.isArray(a),function(){return"The argument passed to tf.addN() must be a list of tensors"}),A(1<=a.length,function(){return"Must pass at least one tensor to tf.addN(), but got "+a.length});var o=a.map(function(a,e){return ot(a,"tensors"+e,"addN")}),t=o[0];o.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),o.forEach(function(a){if(!L(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});return ei.engine.runKernel(function(t){return t.addN(o)},o,function(t){var e={};return o.forEach(function(a,o){e[o]=function(){return t.clone()}}),e})}}),Lu=Lt({addStrict_:function(a,e){var t=ot(a,"a","addStrict"),o=ot(e,"b","addStrict");return O(t.shape,o.shape,"Error in addStrict: "),t.add(o)}}),Mu=Lt({atan2_:function(s,e){var i=ot(s,"a","atan2"),p=ot(e,"b","atan2"),t;t=Ae(i,p),i=t[0],p=t[1];var d=ha(i.shape,p.shape);return ei.engine.runKernel(function(a,e){var t=a.atan2(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=Fu(s.square(),n.square()),t=a.mul(n.div(e)),o=ca(s.shape,d);return 0<o.length&&(t=t.sum(o)),t.reshape(s.shape)},$b:function(){var e=Fu(s.square(),n.square()),t=xl(a.mul(s.div(e))),o=ca(n.shape,d);return 0<o.length&&(t=t.sum(o)),t.reshape(n.shape)}}})}}),Wu=Lt({div_:function(s,e){var i=ot(s,"a","div"),p=ot(e,"b","div"),t;if(t=Ae(i,p),i=t[0],p=t[1],"int32"===i.dtype&&"int32"===p.dtype)return zu(i,p);var d=ha(i.shape,p.shape);return ei.engine.runKernel(function(a,e){var t=a.realDivide(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=a.div(n.toFloat()),t=ca(s.shape,d);return 0<t.length?e.sum(t).reshape(s.shape):e},$b:function(){var e=a.mul(s.toFloat()),t=ca(n.shape,d);0<t.length&&(e=e.sum(t).reshape(n.shape));var o=n.square();return e.div(o.toFloat()).neg()}}})}}),Uu=Lt({divStrict_:function(a,e){var t=ot(a,"a","div"),o=ot(e,"b","div");return O(t.shape,o.shape,"Error in divideStrict: "),t.div(o)}}),zu=Lt({floorDiv_:function(s,e){var i=ot(s,"a","floorDiv"),p=ot(e,"b","floorDiv"),t;t=Ae(i,p),i=t[0],p=t[1];var d=ha(i.shape,p.shape);return ei.engine.runKernel(function(a,e){var t=a.floorDiv(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=a.div(n.toFloat()),t=ca(s.shape,d);return 0<t.length?e.sum(t).reshape(s.shape):e},$b:function(){var e=a.mul(s.toFloat()),t=ca(n.shape,d);0<t.length&&(e=e.sum(t).reshape(n.shape));var o=n.square();return e.div(o.toFloat()).neg()}}})}}),Gu=Lt({maximum_:function(a,e){var s=ot(a,"a","maximum"),i=ot(e,"b","maximum"),t;return t=Ae(s,i),s=t[0],i=t[1],"bool"===s.dtype&&(s=s.toInt(),i=i.toInt()),ha(s.shape,i.shape),ei.engine.runKernel(function(a,e){var t=a.maximum(s,i);return e([s,i]),t},{$a:s,$b:i},function(a,e){var t=e[0],o=e[1];return{$a:function(){return a.mul(t.greaterEqual(o).toFloat())},$b:function(){return a.mul(t.less(o).toFloat())}}})}}),Vu=Lt({maximumStrict_:function(a,e){var t=ot(a,"a","maximumStrict"),o=ot(e,"b","maximumStrict");return O(t.shape,o.shape,"Error in maximumStrict: "),t.maximum(o)}}),Hu=Lt({minimum_:function(a,e){var s=ot(a,"a","minimum"),i=ot(e,"b","minimum"),t;return t=Ae(s,i),s=t[0],i=t[1],"bool"===s.dtype&&(s=s.toInt(),i=i.toInt()),ha(s.shape,i.shape),ei.engine.runKernel(function(a,e){var t=a.minimum(s,i);return e([s,i]),t},{$a:s,$b:i},function(a,e){var t=e[0],o=e[1];return{$a:function(){return a.mul(t.lessEqual(o).toFloat())},$b:function(){return a.mul(t.greater(o).toFloat())}}})}}),qu=Lt({minimumStrict_:function(a,e){var t=ot(a,"a","minimumStrict"),o=ot(e,"b","minimumStrict");return O(t.shape,o.shape,"Error in minimumStrict: "),t.minimum(o)}}),$u=Lt({mod_:function(s,e){var i=ot(s,"a","mod"),p=ot(e,"b","mod"),t;t=Ae(i,p),i=t[0],p=t[1];var d=ha(i.shape,p.shape);return ei.engine.runKernel(function(a,e){var t=a.mod(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=ca(s.shape,d);return 0<e.length?a.sum(e).reshape(s.shape):a},$b:function(){var e=a.mul(s.div(n).floor().neg()),t=ca(n.shape,d);return 0<t.length?e.sum(t).reshape(n.shape):e}}})}}),Ku=Lt({modStrict_:function(a,e){var t=ot(a,"a","modStrict"),o=ot(e,"b","modStrict");return O(t.shape,o.shape,"Error in modStrict: "),t.mod(o)}}),ju=Lt({mul_:function(s,e){var i=ot(s,"a","mul"),p=ot(e,"b","mul"),t;t=Ae(i,p),i=t[0],p=t[1];var d=ha(i.shape,p.shape);return ei.engine.runKernel(function(a,e){var t=a.multiply(i,p);return e([i,p]),t},{$a:i,$b:p},function(a,e){var s=e[0],n=e[1];return{$a:function(){var e=a.mul(n.toFloat()),t=ca(s.shape,d);return 0<t.length?e.sum(t).reshape(s.shape):e},$b:function(){var e=a.mul(s.toFloat()),t=ca(n.shape,d);return 0<t.length?e.sum(t).reshape(n.shape):e}}})}}),Xu=Lt({mulStrict_:function(a,e){var t=ot(a,"a","mul"),o=ot(e,"b","mul");return O(t.shape,o.shape,"Error in multiplyStrict: "),t.mul(o)}}),Yu=Lt({pow_:function(a,e){var s=ot(a,"base","pow"),i=ot(e,"exp","pow"),p=ha(s.shape,i.shape);return a=s.cast(Te(s.dtype,i.dtype)),e=i.cast(Te(s.dtype,i.dtype)),ei.engine.runKernel(function(a,e){var t=a.pow(s,i);return e([s,i,t]),t},{$base:s,$exp:i},function(o,e){var d=e[0],n=e[1],r=e[2];return{$base:function(){var e=n.toFloat(),t=o.mul(e.mul(d.pow(e.sub(Wt(1))))),a=ca(d.shape,p);return 0<a.length&&(t=t.sum(a)),t.reshape(d.shape)},$exp:function(){var e=d.greater(0),t=d.log().where(e,mi(d)),a=o.mul(r.mul(t)),s=ca(n.shape,p);return 0<s.length&&(a=a.sum(s)),a.reshape(n.shape)}}})}}),Qu=Lt({powStrict_:function(a,e){return O(a.shape,e.shape,"Error in powStrict: "),a.pow(e)}}),Zu=Lt({squaredDifference_:function(a,e){var s=ot(a,"a","squaredDifference"),i=ot(e,"b","squaredDifference"),t;return t=Ae(s,i),s=t[0],i=t[1],ha(s.shape,i.shape),ei.engine.runKernel(function(a,e){var t=a.squaredDifference(s,i);return e([s,i]),t},{$a:s,$b:i},function(a,e){var t=e[0],n=e[1],r=Wt(2);return{$a:function(){return a.mul(t.sub(n).mul(r))},$b:function(){return a.mul(n.sub(t).mul(r))}}})}}),Ju=Lt({squaredDifferenceStrict_:function(a,e){var t=ot(a,"a","squaredDifferenceStrict"),o=ot(e,"b","squaredDifferenceStrict");return O(t.shape,o.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(o)}}),ec=Lt({sub_:function(s,e){var i=ot(s,"a","sub"),p=ot(e,"b","sub"),t;t=Ae(i,p),i=t[0],p=t[1];var d=ha(i.shape,p.shape);return ei.engine.runKernel(function(t){return t.subtract(i,p)},{$a:i,$b:p},function(a){return{$a:function(){var e=a,t=ca(i.shape,d);return 0<t.length&&(e=e.sum(t)),e.reshape(i.shape)},$b:function(){var e=a,t=ca(p.shape,d);return 0<t.length&&(e=e.sum(t)),e.neg().reshape(p.shape)}}})}}),tc=Lt({subStrict_:function(a,e){var t=ot(a,"a","subStrict"),o=ot(e,"b","subStrict");return O(t.shape,o.shape,"Error in subStrict: "),t.sub(o)}}),ac=Lt({logicalAnd_:function(a,e){var t=ot(a,"a","logicalAnd","bool"),o=ot(e,"b","logicalAnd","bool");return ha(t.shape,o.shape),ei.engine.runKernel(function(a){return a.logicalAnd(t,o)},{$a:t,$b:o})}}),oc=Lt({logicalNot_:function(a){var o=ot(a,"x","logicalNot","bool");return ei.engine.runKernel(function(t){return t.logicalNot(o)},{$x:o})}}),nc=Lt({logicalOr_:function(a,e){var t=ot(a,"a","logicalOr","bool"),o=ot(e,"b","logicalOr","bool");return ha(t.shape,o.shape),ei.engine.runKernel(function(a){return a.logicalOr(t,o)},{$a:t,$b:o})}}),rc=Lt({logicalXor_:function(a,e){var t=ot(a,"a","logicalXor","bool"),o=ot(e,"b","logicalXor","bool");return ha(t.shape,o.shape),nc(a,e).logicalAnd(ac(a,e).logicalNot())}}),sc=Lt({where_:function(s,e,t){var i=ot(e,"a","where"),p=ot(t,"b","where"),d=ot(s,"condition","where","bool");return O(i.shape,p.shape,"Error in where: "),1===d.rank?A(d.shape[0]===i.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):O(d.shape,p.shape,"Error in where: "),ei.engine.runKernel(function(a,e){var t=a.select(d,i,p);return e([d]),t},{$condition:d,$a:i,$b:p},function(a,e){var t=e[0];return{$condition:function(){return mi(t).toFloat()},$a:function(){return a.mul(t.cast(a.dtype))},$b:function(){return a.mul(t.logicalNot().cast(a.dtype))}}})}}),ic=Lt({elu_:function(a){var o=ot(a,"x","elu");return ei.engine.runKernel(function(t,e){var a=t.elu(o);return e([a]),a},{$x:o},function(a,o){var r=o[0];return{$x:function(){return ei.engine.runKernel(function(e){return e.eluDer(a,r)},{dy:a,y:r})}}})}}),pc=Lt({leakyRelu_:function(a,e){void 0===e&&(e=.2);var t=ot(a,"x","leakyRelu");return Gu(Wt(e).mul(t),t)}}),dc=Lt({prelu_:function(a,e){var s=ot(a,"x","prelu"),i=ot(e,"alpha","prelu");return ei.engine.runKernel(function(a,e){var t=a.prelu(s,i);return e([s,i]),t},{$x:s,$alpha:i},function(s,e){var i=e[0],n=e[1],r=i.greater(0);return{$x:function(){return sc(r,s,s.mul(n))},$alpha:function(){var e=sc(r,mi(s),s.mul(i)),t=ca(n.shape,s.shape);return 0<t.length&&(e=e.sum(t)),e.reshape(n.shape)}}})}}),lc=Lt({relu_:function(a){var o=ot(a,"x","relu");return"bool"===o.dtype?o.toInt():ei.engine.runKernel(function(t,e){var a=t.relu(o);return e([o]),a},{$x:o},function(a,e){var t=e[0];return{$x:function(){return a.mulStrict(t.step().toFloat())}}})}}),uc=Lt({selu_:function(a){var o=ot(a,"x","selu");return ei.engine.runKernel(function(t,e){var a=t.selu(o);return e([o]),a},{$x:o},function(s,e){var p=e[0];return{$x:function(){var e=p.greater(Wt(0)),t=Wt(Jp),n=Wt(ed),o=s.mul(n),a=s.mul(t).mul(p.toFloat().exp());return sc(e,o,a)}}})}}),cc=Lt({transpose_:function(a,o){var t=ot(a,"x","transpose");return(null==o&&(o=t.shape.map(function(a,e){return e}).reverse()),A(t.rank===o.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+o+"."}),o.forEach(function(a){A(0<=a&&a<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+o})}),1>=t.rank)?t.clone():ei.engine.runKernel(function(a){return a.transpose(t,o)},{$x:t},function(t){var e=bt(o);return{$x:function(){return t.transpose(e)}}})}}),hc=Lt({localResponseNormalization_:function(p,d,t,n,r){void 0===d&&(d=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5);var e=ot(p,"x","localResponseNormalization");A(4===e.rank||3===e.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+e.rank+"."}),A(M(d),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+d+"."});var o=e,a=!1;3===e.rank&&(a=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=ei.engine.runKernel(function(i,e){var a=i.localResponseNormalization4D(o,d,t,n,r);return e([o,a]),a},{x4D:o},function(o,e){var p=e[0],i=e[1];return{x4D:function(){return ei.engine.runKernel(function(e){return e.LRNGrad(o,p,i,d,t,n,r)},{})}}});return a?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),mc=Lt({norm_:function(s,e,t,n){void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1);var r=Er(s=ot(s,"x","norm"),e,t),o=r.shape;if(n){var a=K(t,s.shape);o=ft(r.shape,a)}return r.reshape(o)}}),gc=Lt({gather_:function(s,e,x){void 0===x&&(x=0);var n=ot(s,"x","gather"),i=ot(e,"indices","gather","int32");x=K(x,n.shape)[0];var t=Tt(n,i,x);return ei.engine.runKernel(function(o,e){var t=o.gather(n,i.flatten(),x);return e([i]),t},{$x:n},function(r,e){var b=e[0];return{$x:function(){var e=n.shape,t=b.size,a=e.slice(0,x),o=a.length,s=e.slice(x,e.length).slice(1),i=s.length,u=_r(0,o),l=_r(o+1,o+1+i),p=kr([a,[t],s]),d=r.reshape(p),c=b.reshape([t]),h=kr([[o],u,l]),m=d.transpose(h),g=fc(m,c,n.shape[x]),f=bt(h);return g=g.transpose(f)}}}).reshape(t.outputShape)}}),fc=Lt({unsortedSegmentSum_:function(a,e,s){var n=ot(a,"x","unsortedSegmentSum"),i=ot(e,"segmentIds","unsortedSegmentSum","int32");return A(M(s),function(){return"numSegments must be of dtype int"}),ei.engine.runKernel(function(o,e){var t=o.unsortedSegmentSum(n,i,s);return e([i]),t},{$x:n},function(a,e){var t=e[0];return{$x:function(){return wr(a,t)}}})}}),yc=Lt({basicLSTMCell_:function(b,e,t,n,r,o){var a=ot(b,"forgetBias","basicLSTMCell"),i=ot(e,"lstmKernel","basicLSTMCell"),s=ot(t,"lstmBias","basicLSTMCell"),u=ot(n,"data","basicLSTMCell"),c=ot(r,"c","basicLSTMCell"),l=ot(o,"h","basicLSTMCell"),p=u.concat(l,1).matMul(i).add(s),d=p.shape[0],h=p.shape[1]/4,f=[d,h],m=p.slice([0,0],f),g=p.slice([0,h],f),v=p.slice([0,2*h],f),y=p.slice([0,3*h],f),x=m.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(a.add(v).sigmoid()));return[x,x.tanh().mulStrict(y.sigmoid())]}}),xc=Lt({multiRNNCell_:function(h,e,t,n){for(var r=ot(e,"data","multiRNNCell"),o=nt(t,"c","multiRNNCell"),a=nt(n,"h","multiRNNCell"),i=r,s=[],u=0,c;u<h.length;u++)c=h[u](i,o[u],a[u]),s.push(c[0]),s.push(c[1]),i=c[1];var l=[],p=[];for(u=0;u<s.length;u+=2)l.push(s[u]),p.push(s[u+1]);return[l,p]}}),bc=Lt({movingAverage_:function(d,e,t,n,r){void 0===r&&(r=!0);var o=ot(d,"v","movingAverage"),a=ot(e,"x","movingAverage"),i=ot(t,"decay","movingAverage");Oe(o,a),A(L(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var s=Wt(1),u=s.sub(i),c=a.sub(o).mul(u);if(r){A(null!=n,function(){return"When using zeroDebias: true, step is required."});var l=ot(n,"step","movingAverage");c=c.div(s.sub(Yu(i,l)))}return o.add(c)}}),vc=Lt({stridedSlice_:function(m,g,t,n,r,o,a,i,s){if(void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==i)throw new Error("new axis mask is not yet supported");var u=ot(m,"x","stridedSlice");if(n.every(function(t){return 1===t})){var e=At(u.shape,g,t,n,r,o,a,i,s),l=e[0],p=e[1],d=e[2],h=p.filter(function(a,e){return-1===d.indexOf(e)});return iu(u,l,p).reshape(h)}return ei.engine.runKernel(function(p){return p.stridedSlice(u,g,t,n,r,o,a,i,s)},{$x:u})}}),Cc=Lt({topk_:function(s,i,t){void 0===i&&(i=1),void 0===t&&(t=!0);var n=ot(s,"x","topk");if(0===n.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var e=n.shape[n.shape.length-1];if(i>e)throw new Error("'k' passed to topk() must be <= the last dimension ("+e+") but got "+i);var o=ei.engine.runKernel(function(a){return a.topk(n,i,t)},{$x:n});return{values:o[0],indices:o[1]}}}),Rc=Lt({scatterND_:function(a,e,t){var n=ot(a,"indices","scatterND","int32"),s=ot(e,"updates","scatterND");return kt(s,n,t),ei.engine.runKernel(function(a){return a.scatterND(n,s,t)},{$indices:n,$updates:s})}}),Sc=Lt({fft_:function(a){A("complex64"===a.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+a.dtype+"."});var o=a.shape[a.shape.length-1],t=a.size/o,n=a.as2D(t,o);return ei.engine.runKernel(function(t){return t.fft(n)},{input:a}).reshape(a.shape)}}),Ec=Lt({ifft_:function(a){A("complex64"===a.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+a.dtype+"."});var o=a.shape[a.shape.length-1],t=a.size/o,n=a.as2D(t,o);return ei.engine.runKernel(function(t){return t.ifft(n)},{input:a}).reshape(a.shape)}}),_c=Lt({rfft_:function(d){A("float32"===d.dtype,function(){return"The dtype for rfft() must be real value but got "+d.dtype});var e=d.shape[d.shape.length-1],t=d.size/e,n=d.zerosLike(),r=li(d,n).as2D(t,e),o=Sc(r),a=$(e/2)+1,i=ui(o),s=ci(o),u=i.split([a,e-a],i.shape.length-1),c=s.split([a,e-a],s.shape.length-1),l=d.shape.slice();return l[d.shape.length-1]=a,li(u[0],c[0]).reshape(l)}}),kc=Lt({irfft_:function(d){var e=d.shape[d.shape.length-1],t=d.size/e;if(2>=e){var n=d.as2D(t,e),r=Ec(n);return ui(r)}var o=[t,2*(e-1)],a=ui(d).as2D(t,e),i=ci(d).as2D(t,e),s=a.slice([0,1],[t,e-2]).reverse(1),u=i.slice([0,1],[t,e-2]).reverse(1).mul(Wt(-1)),c=a.concat(s,1),l=i.concat(u,1);return n=li(c,l).as2D(o[0],o[1]),r=Ec(n),ui(r)}}),wc=Object.freeze({fft:Sc,ifft:Ec,rfft:_c,irfft:kc}),Ic=Lt({sparseToDense_:function(s,e,t,n){void 0===n&&(n=0);var r=ot(s,"sparseIndices","sparseToDense","int32"),p=ot(e,"sparseValues","sparseToDense"),d=ot(n,"defaultValue","sparseToDense",p.dtype);return Ir(r,p,t,d),ei.engine.runKernel(function(a){return a.sparseToDense(r,p,t,d)},{$sparseIndices:r,$sparseValues:p,$defaultValue:d})}}),Nc=Lt({gatherND_:function(a,e){var t=ot(e,"indices","gatherND","int32"),o=ot(a,"x","gatherND");return ei.engine.runKernel(function(a){return a.gatherND(o,t)},{$x:o,$indices:t})}}),Tc;!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Tc||(Tc={}));var Dc=Lt({absoluteDifference_:Tr}),Ac=Lt({computeWeightedLoss_:Nr}),Oc=Lt({cosineDistance_:Ar}),Pc=Lt({hingeLoss_:Or}),Fc=Lt({huberLoss_:Lr}),Bc=Lt({logLoss_:Pr}),Lc=Lt({meanSquaredError_:Dr}),Mc=Lt({sigmoidCrossEntropy_:Br}),Wc=Lt({softmaxCrossEntropy_:Wr}),Uc=Object.freeze({get Reduction(){return Tc},absoluteDifference:Dc,computeWeightedLoss:Ac,cosineDistance:Oc,hingeLoss:Pc,huberLoss:Fc,logLoss:Bc,meanSquaredError:Lc,sigmoidCrossEntropy:Mc,softmaxCrossEntropy:Wc}),zc=Lt({gramSchmidt_:function(p){var e;if(Array.isArray(p)){e=!1,A(null!=p&&0<p.length,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var d=p[0].shape[0],t=function(e){A(p[e].shape[0]===d,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+p[e].shape[0]+" vs. "+d+")"})},n=1;n<p.length;++n)t(n)}else e=!0,p=fd(p,p.shape[0],0).map(function(t){return $d(t,[0])});A(p.length<=p[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+p.length+") exceeds number of dimensions ("+p[0].shape[0]+")."});var o=[],a=p,r=function(s){o.push(ei.engine.tidy(function(){var e=a[s];if(0<s)for(var t=0,n;t<s;++t)n=Cu(o[t].mulStrict(e)).mul(o[t]),e=e.sub(n);return e.div(mc(e,"euclidean"))}))};for(n=0;n<p.length;++n)r(n);return e?Kd(o,0):o}}),Gc=Lt({qr_:function(a,s){if(void 0===s&&(s=!1),2>a.rank)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+a.rank);if(2===a.rank)return Ur(a,s);var e=a.shape.slice(0,a.shape.length-2).reduce(function(a,e){return a*e}),t=[],r=[];return Yd(a.reshape([e,a.shape[a.shape.length-2],a.shape[a.shape.length-1]]),0).forEach(function(o){var e=Ur(o,s),n=e[0],a=e[1];t.push(n),r.push(a)}),[Kd(t,0).reshape(a.shape),Kd(r,0).reshape(a.shape)]}}),Vc=Object.freeze({gramSchmidt:zc,qr:Gc}),Hc=Lt({resizeBilinear_:function(p,e,d){void 0===d&&(d=!1);var t=ot(p,"images","resizeBilinear");A(3===t.rank||4===t.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+t.rank+"."}),A(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var n=t,r=!1;3===t.rank&&(r=!0,n=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=e[0],i=e[1],s=ei.engine.runKernel(function(o,e){return e([n]),o.resizeBilinear(n,a,i,d)},{batchImages:n},function(a,e){return{batchImages:function(){return ei.engine.runKernel(function(t){return t.resizeBilinearBackprop(a,e[0],d)},{})}}});return r?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),qc=Lt({resizeNearestNeighbor_:function(p,e,d){void 0===d&&(d=!1);var t=ot(p,"images","resizeNearestNeighbor");A(3===t.rank||4===t.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+t.rank+"."}),A(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),A("float32"===t.dtype||"int32"===t.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var n=t,r=!1;3===t.rank&&(r=!0,n=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=e[0],i=e[1],s=ei.engine.runKernel(function(o,e){return e([n]),o.resizeNearestNeighbor(n,a,i,d)},{batchImages:n},function(a,e){return{batchImages:function(){return ei.engine.runKernel(function(t){return t.resizeNearestNeighborBackprop(a,e[0],d)},{})}}});return r?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),$c=Lt({nonMaxSuppression_:function(p,e,t,n,r){void 0===n&&(n=.5),void 0===r&&(r=B);var o=ot(p,"boxes","nonMaxSuppression"),d=ot(e,"scores","nonMaxSuppression"),i=zr(o,d,t,n,r);return t=i.maxOutputSize,n=i.iouThreshold,r=i.scoreThreshold,ei.engine.runKernel(function(a){return a.nonMaxSuppression(o,d,t,n,r)},{$boxes:o})}}),Kc=Lt({cropAndResize_:function(p,e,t,n,r,o){var a=ot(p,"image","cropAndResize","float32"),d=ot(e,"boxes","cropAndResize","float32"),l=ot(t,"boxInd","cropAndResize","int32");r=r||"bilinear",o=o||0;var u=d.shape[0];return A(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),A(2===d.rank&&4===d.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+d.shape+"."}),A(1===l.rank&&l.shape[0]===u,function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+d.shape+"."}),A(2===n.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),A(1<=n[0]&&1<=n[1],function(){return"cropSize must be atleast [1,1], but was "+n}),A("bilinear"===r||"nearest"===r,function(){return"method must be bilinear or nearest, but was "+r}),ei.engine.runKernel(function(t){return t.cropAndResize(a,d,l,n,r,o)},{$image:a,$boxes:d})}}),jc=Object.freeze({resizeBilinear:Hc,resizeNearestNeighbor:qc,nonMaxSuppression:$c,nonMaxSuppressionAsync:function(d,e,t,n,r){return void 0===n&&(n=.5),void 0===r&&(r=B),x(this,void 0,void 0,function(){var o,a,i,s,u,c;return R(this,function(l){switch(l.label){case 0:return o=ot(d,"boxes","nonMaxSuppressionAsync"),a=ot(e,"scores","nonMaxSuppressionAsync"),i=zr(o,a,t,n,r),t=i.maxOutputSize,n=i.iouThreshold,r=i.scoreThreshold,[4,o.data()];case 1:return s=l.sent(),[4,a.data()];case 2:return u=l.sent(),c=na(s,u,t,n,r),o!==d&&o.dispose(),a!==e&&a.dispose(),[2,c];}})})},cropAndResize:Kc}),Xc=Lt({matMul_:function(b,e,C,R,S,_){var t;void 0===C&&(C=!1),void 0===R&&(R=!1),void 0===_&&(_="linear");var a=ot(b,"a","fused matMul"),o=ot(e,"b","fused matMul");t=Ae(a,o),a=t[0],o=t[1];var s=C?a.shape[a.rank-2]:a.shape[a.rank-1],i=R?o.shape[o.rank-1]:o.shape[o.rank-2],l=C?a.shape[a.rank-1]:a.shape[a.rank-2],p=R?o.shape[o.rank-2]:o.shape[o.rank-1],d=a.shape.slice(0,-2),u=o.shape.slice(0,-2),c=U(d),h=U(u);A(2<=a.rank&&2<=o.rank&&a.rank===o.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+o.rank+"."}),A(L(d,u),function(){return"Error in fused matMul: outer dimensions ("+d+") and ("+u+") of Tensors with shapes "+a.shape+" and "+o.shape+" must match."}),A(s===i,function(){return"Error in fused matMul: inner shapes ("+s+") and ("+i+") of Tensors with shapes "+a.shape+" and "+o.shape+" and transposeA="+C+" and transposeB="+R+" must match."});var m=a.shape.slice(0,-2).concat([l,p]),g=C?a.as3D(c,s,l):a.as3D(c,l,s),f=R?o.as3D(h,p,i):o.as3D(h,i,p),y;null!=S&&ha(m,(y=Ae(y=ot(S,"bias","fused matMul"),a)[0]).shape);var v={$a:g,$b:f};return null!=S&&(v.$bias=y),ei.engine.runKernel(function(a,e){var t=a.fusedBatchMatMul(g,f,C,R,y,_);return e([g,f,t]),t},v,function(a,e){var t=e[0],o=e[1],s=e[2],p;if(null==_||"linear"===_)p=a;else{if("relu"!==_)throw new Error("Gradient for activation "+_+" has not been implemented yet.");p=a.mul(s.step())}var i={};return null!=S&&(i={$bias:function(){var a=p,e=ca(y.shape,p.shape);return 0<e.length&&(a=a.sum(e)),a.reshape(y.shape)}}),C||R?!C&&R?Object.assign({$a:function(){return p.matMul(o,!1,!1)},$b:function(){return p.matMul(t,!0,!1)}},i):C&&!R?Object.assign({$a:function(){return o.matMul(p,!1,!0)},$b:function(){return t.matMul(p,!1,!1)}},i):Object.assign({$a:function(){return o.matMul(p,!0,!0)},$b:function(){return p.matMul(t,!0,!0)}},i):Object.assign({$a:function(){return p.matMul(o,!1,!0)},$b:function(){return t.matMul(p,!0,!1)}},i)}).reshape(m)}}),Yc=Object.freeze({matMul:Xc}),Qc=Object.freeze({image:jc,linalg:Vc,losses:Uc,spectral:wc,fused:Yc,op:Lt,batchNormalization2d:Fl,batchNormalization3d:Bl,batchNormalization4d:Ll,batchNormalization:Ml,batchNorm:Wl,batchNorm2d:Ul,batchNorm3d:zl,batchNorm4d:Gl,complex:li,real:ui,imag:ci,concat:ud,concat1d:cd,concat2d:hd,concat3d:md,concat4d:gd,split:fd,conv1d:Vl,conv2d:Hl,conv3d:ql,conv2dDerFilter:$l,depthwiseConv2d:Kl,separableConv2d:jl,conv2dTranspose:Xl,matMul:Yl,dot:Ql,outerProduct:Zl,reverse:Jl,reverse1d:eu,reverse2d:tu,reverse3d:au,reverse4d:ou,maxPool:nu,avgPool:ru,pool:su,slice:iu,slice1d:pu,slice2d:du,slice3d:lu,slice4d:uu,abs:el,acos:tl,acosh:al,asin:ol,asinh:nl,atan:rl,atanh:sl,ceil:il,clipByValue:pl,cos:dl,cosh:ll,erf:ul,exp:cl,expm1:hl,floor:ml,log:gl,log1p:fl,logSigmoid:yl,neg:xl,reciprocal:bl,round:vl,rsqrt:Cl,sigmoid:Rl,sign:Sl,isNaN:El,isInf:_l,isFinite:kl,sin:wl,sinh:Il,softplus:Nl,sqrt:Tl,square:Dl,step:Al,tan:Ol,tanh:Pl,all:cu,any:hu,argMax:mu,argMin:gu,logSumExp:fu,max:yu,mean:xu,min:bu,moments:vu,sum:Cu,prod:Ru,equal:Su,equalStrict:Eu,greater:_u,greaterEqual:ku,greaterEqualStrict:wu,greaterStrict:Iu,less:Nu,lessEqual:Tu,lessEqualStrict:Du,lessStrict:Au,notEqual:Ou,notEqualStrict:Pu,add:Fu,addN:Bu,addStrict:Lu,atan2:Mu,div:Wu,divStrict:Uu,floorDiv:zu,maximum:Gu,maximumStrict:Vu,minimum:Hu,minimumStrict:qu,mod:$u,modStrict:Ku,mul:ju,mulStrict:Xu,pow:Yu,powStrict:Qu,squaredDifference:Zu,squaredDifferenceStrict:Ju,sub:ec,subStrict:tc,elu:ic,leakyRelu:pc,prelu:dc,relu:lc,selu:uc,logicalAnd:ac,logicalNot:oc,logicalOr:nc,logicalXor:rc,where:sc,whereAsync:function(a){return x(this,void 0,void 0,function(){var e,t,n;return R(this,function(r){switch(r.label){case 0:return[4,(e=ot(a,"condition","whereAsync","bool")).data()];case 1:return t=r.sent(),n=Mn(e.shape,t),a!==e&&e.dispose(),[2,n];}})})},buffer:Ln,print:function(a,e){void 0===e&&(e=!1),console.log(a.toString(e))},batchToSpaceND:wd,cast:Id,clone:Nd,cumsum:Td,depthToSpace:Dd,expandDims:Ad,eye:Od,multinomial:Pd,oneHot:Fd,pad:Bd,pad1d:Ld,pad2d:Md,pad3d:Wd,pad4d:Ud,rand:zd,randomNormal:Gd,randomUniform:Vd,reshape:Hd,spaceToBatchND:qd,squeeze:$d,stack:Kd,tile:jd,truncatedNormal:Xd,unstack:Yd,setdiff1dAsync:function(h,e){return x(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,c,d;return R(this,function(p){switch(p.label){case 0:return t=ot(h,"x","setdiff1d"),n=ot(e,"y","setdiff1d"),A(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),A(1===t.rank,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),A(1===n.rank,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return r=p.sent(),[4,n.data()];case 2:for(o=p.sent(),a=new Set(o),i=0,c=0;c<r.length;c++)a.has(r[c])||i++;for(s=new Ns([i],t.dtype),u=new Ns([i],"int32"),c=0,d=0;c<r.length;c++)a.has(r[c])||(s.values[d]=r[c],u.values[d]=c,d++);return[2,[s.toTensor(),u.toTensor()]];}})})},fill:$t,linspace:function(r,e,t){if(0===t)throw new Error("Cannot request zero samples");var n=xe(t,"float32");n[0]=r;for(var o=1;o<n.length;o++)n[o]=n[o-1]+(e-r)/(t-1);return Ut(n,"float32")},ones:Ht,range:Kt,scalar:Wt,tensor:Mt,tensor1d:Ut,tensor2d:zt,tensor3d:Gt,tensor4d:Vt,tensor5d:function(a,e,t){if(P(a),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var o=et(a);if(5!==o.length&&1!==o.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Mt(a,e=e||o,t)},tensor6d:function(a,e,t){if(P(a),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var o=et(a);if(6!==o.length&&1!==o.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===o.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Mt(a,e=e||o,t)},zeros:qt,onesLike:hi,zerosLike:mi,transpose:cc,softmax:pi,logSoftmax:di,localResponseNormalization:hc,norm:mc,gather:gc,unsortedSegmentSum:fc,basicLSTMCell:yc,multiRNNCell:xc,movingAverage:bc,stridedSlice:vc,topk:Cc,scatterND:Rc,fft:Sc,ifft:Ec,rfft:_c,irfft:kc,sparseToDense:Ic,gatherND:Nc}),Zc=function(){function t(){this.blockSize=48,this.firstUse=!0,ei.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return t.prototype.setDataMover=function(t){this.data=new gi(t)},t.prototype.register=function(a,e,t){if(this.firstUse&&(this.firstUse=!1,ei.get("IS_NODE")&&it("\n============================\nHi there \uD83D\uDC4B. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(a))throw new Error("Data buffer is already registered");this.data.set(a,{dtype:t})},t.prototype.write=function(a,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(a).values=e},t.prototype.fromPixels=function(s,e){if(null==s)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t,n;if(ei.get("IS_NODE")&&null==s.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=s.getContext)t=s.getContext("2d").getImageData(0,0,s.width,s.height).data;else if(s instanceof ImageData)t=s.data;else{if(!(s instanceof HTMLImageElement||s instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+s.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=s.width,this.fromPixels2DContext.canvas.height=s.height,this.fromPixels2DContext.drawImage(s,0,0,s.width,s.height),t=this.fromPixels2DContext.getImageData(0,0,s.width,s.height).data}if(4===e)n=new Int32Array(t);else{var r=s.width*s.height;n=new Int32Array(r*e);for(var o=0;o<r;o++)for(var a=0;a<e;++a)n[o*e+a]=t[4*o+a]}return Gt(n,[s.height,s.width,e],"int32")},t.prototype.read=function(t){return x(this,void 0,void 0,function(){return R(this,function(){return[2,this.readSync(t)]})})},t.prototype.readSync=function(a){var e=this.data.get(a),t=e.dtype,o=e.complexTensors;return"complex64"===t?Yt(o.real.dataSync(),o.imag.dataSync()):this.data.get(a).values},t.prototype.disposeData=function(a){if(this.data.has(a)){var e=this.data.get(a).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(a)}},t.prototype.time=function(a){return x(this,void 0,void 0,function(){var e;return R(this,function(){return e=be(),a(),[2,{kernelMs:be()-e}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(a,e){var t=Os.make(a.shape,{},"complex64");return this.data.get(t.dataId).complexTensors={real:ei.engine.keep(a.clone()),imag:ei.engine.keep(e.clone())},t},t.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},t.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},t.prototype.assertNotComplex=function(a,e){Array.isArray(a)||(a=[a]),a.forEach(function(t){null!=t&&A("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})},t.prototype.slice=function(p,d,e){if(this.assertNotComplex(p,"slice"),Ft(p.shape,d,e)){var t=Bt(d,p.strides),n=U(e);return Mt(p.dataSync().subarray(t,t+n),e,p.dtype)}for(var o=Ln(e,p.dtype),a=p.bufferSync(),r=0,s;r<o.size;++r)s=o.indexToLoc(r).map(function(t,e){return t+d[e]}),o.values[r]=a.get.apply(a,s);return o.toTensor()},t.prototype.stridedSlice=function(b,e,t,n,r,o,a,i,s){this.assertNotComplex(b,"stridedSlice");var u=At(b.shape,e,t,n,r,o,a,i,s),c=u[0],l=u[1],p=u[2],d=l.filter(function(a,e){return-1===p.indexOf(e)});if(d.some(function(t){return 0===t}))return Mt([],d);for(var h=Ln(l,b.dtype),f=b.bufferSync(),m=0;m<h.size;m++){for(var g=h.indexToLoc(m),v=Array(g.length),y=0;y<v.length;y++)v[y]=g[y]*n[y]+c[y];h.set.apply(h,[f.get.apply(f,v)].concat(g))}return h.toTensor().reshape(d)},t.prototype.unstack=function(p,e){for(var t=p.shape[e],n=Array(p.rank-1),r=0,o=0;o<p.rank;o++)o!==e&&(n[r++]=p.shape[o]);var a=Array(p.rank).fill(0),i=p.shape.slice();i[e]=1;var s=Array(t);for(o=0;o<s.length;o++)a[e]=o,s[o]=this.slice(p,a,i).reshape(n);return s},t.prototype.reverse=function(s,e){this.assertNotComplex(s,"reverse");for(var t=Ln(s.shape,s.dtype),n=s.bufferSync(),r=function(r){var o=t.indexToLoc(r),a=o.slice();e.forEach(function(e){return a[e]=s.shape[e]-1-a[e]}),t.set.apply(t,[n.get.apply(n,a)].concat(o))},o=0;o<t.size;o++)r(o);return t.toTensor()},t.prototype.concat=function(p,d){this.assertNotComplex(p,"concat");var e=p.map(function(t){var e=U(t.shape.slice(d));return t.as2D(-1,e)}),l=Rt(e.map(function(t){return t.shape}),1),r=Ln(l,p[0].dtype).values;if(1===e[0].shape[0]){var t=0;e.forEach(function(a){r.set(a.dataSync(),t),t+=a.size})}else{var o=0;e.forEach(function(i){for(var e=i.dataSync(),t=0,n=0;n<i.shape[0];++n)for(var a=n*l[1]+o,s=0;s<i.shape[1];++s)r[a+s]=e[t++];o+=i.shape[1]})}var a=Rt(p.map(function(t){return t.shape}),d);return Mt(r,a,p[0].dtype)},t.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(Wt(-1),t)},t.prototype.add=function(a,e){return"complex64"===a.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),e.cast("complex64"),function(a,e,t,o){return{real:a+t,imag:e+o}}):this.broadcastedBinaryOp(a,e,Te(a.dtype,e.dtype),function(a,e){return a+e})},t.prototype.addN=function(s){this.assertNotComplex(s,"addN");for(var e=s.map(function(t){return t.dataSync()}),t=Ln(s[0].shape,s[0].dtype),n=t.values,r=0;r<s.length;r++)for(var o=e[r],a=0;a<n.length;a++)n[a]+=o[a];return t.toTensor()},t.prototype.subtract=function(a,e){return"complex64"===a.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),e.cast("complex64"),function(a,e,t,o){return{real:a-t,imag:e-o}}):this.broadcastedBinaryOp(a,e,Te(a.dtype,e.dtype),function(a,e){return a-e})},t.prototype.pow=function(a,e){return this.assertNotComplex([a,e],"pow"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return b(a,e)})},t.prototype.batchMatMul=function(y,e,t,n){this.assertNotComplex([y,e],"matMul");for(var r=t?y.shape[1]:y.shape[2],o=t?y.shape[2]:y.shape[1],a=n?e.shape[1]:e.shape[2],i=y.shape[0],s=y.dataSync(),u=e.dataSync(),c=t?[y.strides[0],1,y.strides[1]]:[y.strides[0],y.strides[1],1],l=c[0],p=c[1],d=c[2],h=n?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],f=h[0],m=h[1],g=h[2],v=Ln([i,o,a],y.dtype),x=v.values,E=this.blockSize,T=0;T<i;T++)for(var b=0;b<o;b+=E)for(var w=0;w<a;w+=E)for(var S=0;S<r;S+=E)for(var C=le(b+E,o),A=le(w+E,a),N=le(S+E,r),_=b;_<C;_++)for(var R=w;R<A;R++){for(var I=0,k=S;k<N;k++)I+=s[T*l+_*p+k*d]*u[k*f+R*m+T*g];x[T*(o*a)+(_*a+R)]+=I}return v.toTensor()},t.prototype.fusedBatchMatMul=function(s,e,t,n,r,o){var a=this.batchMatMul(s,e,t,n);return r&&(a=this.add(a,r)),o&&(a=Gr(this,o,a)),a},t.prototype.multiply=function(a,e){return"complex64"===a.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(a.cast("complex64"),e.cast("complex64"),function(a,e,t,o){return{real:a*t-e*o,imag:a*o+e*t}}):this.broadcastedBinaryOp(a,e,Te(a.dtype,e.dtype),function(a,e){return a*e})},t.prototype.realDivide=function(a,e){return this.assertNotComplex([a,e],"realDivide"),this.broadcastedBinaryOp(a,e,"float32",function(a,e){return a/e})},t.prototype.floorDiv=function(a,e){return this.assertNotComplex([a,e],"floorDiv"),this.broadcastedBinaryOp(a,e,"int32",function(a,e){return $(a/e)})},t.prototype.sum=function(h,e){this.assertNotComplex(h,"sum"),yt("sum",e,h.rank);for(var t=gt(h.shape,e),n=t[0],r=t[1],o=qt(n,Te(h.dtype,"int32")),a=U(r),i=o.dataSync(),s=h.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=0,p=0;p<a;++p)l+=s[c+p];i[u]=l}return o},t.prototype.prod=function(h,e){this.assertNotComplex(h,"sum");for(var t=gt(h.shape,e),n=t[0],r=t[1],o=qt(n,Te(h.dtype,"int32")),a=U(r),i=o.dataSync(),s=h.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=1,p=0;p<a;++p)l*=s[c+p];i[u]=l}return o},t.prototype.unsortedSegmentSum=function(p,e,t){this.assertNotComplex(p,"unsortedSegmentSum");for(var n=[],r=p.rank-e.rank,o=0;o<r;++o)e=e.expandDims(o+1);for(o=0;o<t;++o){var a=Wt(o,"int32"),i=Su(a,e).asType("float32").mul(p).sum(0);n.push(i)}return Kd(n)},t.prototype.argMin=function(g,e){this.assertNotComplex(g,"argMin");var t=[e];yt("argMin",t,g.rank);for(var n=gt(g.shape,t),r=n[0],o=n[1],a=qt(r,"int32"),i=U(o),s=a.dataSync(),u=g.dataSync(),c=0;c<s.length;++c){for(var l=c*i,p=u[l],d=0,h=0,f;h<i;++h)f=u[l+h],f<p&&(p=f,d=h);s[c]=d}return a},t.prototype.argMax=function(g,e){this.assertNotComplex(g,"argMax");var t=[e];yt("argMax",t,g.rank);for(var n=gt(g.shape,t),r=n[0],o=n[1],a=qt(r,"int32"),i=U(o),s=a.dataSync(),u=g.dataSync(),c=0;c<s.length;++c){for(var l=c*i,p=u[l],d=0,h=0,f;h<i;++h)f=u[l+h],f>p&&(p=f,d=h);s[c]=d}return a},t.prototype.cumsum=function(m,e,t,n){if(this.assertNotComplex(m,"cumsum"),e!==m.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(m.rank-1)+" but got axis="+e);for(var r=Te(m.dtype,"int32"),o=qt(m.shape,r),a=o.dataSync(),i=m.dataSync(),s=m.shape[m.rank-1],u=n?function(a,e){return a+s-e-1}:function(a,e){return a+e},c=0;c<i.length;c+=s)for(var l=0,p;l<s;l++)if(p=u(c,l),0===l)a[p]=t?0:i[p];else{var d=u(c,l-1);a[p]=t?i[d]+a[d]:i[p]+a[d]}return o},t.prototype.equal=function(a,e){return this.assertNotComplex([a,e],"equal"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a===e?1:0})},t.prototype.notEqual=function(a,e){return this.assertNotComplex([a,e],"notEqual"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a===e?0:1})},t.prototype.less=function(a,e){return this.assertNotComplex([a,e],"less"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a<e?1:0})},t.prototype.lessEqual=function(a,e){return this.assertNotComplex([a,e],"lessEqual"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a<=e?1:0})},t.prototype.greater=function(a,e){return this.assertNotComplex([a,e],"greater"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a>e?1:0})},t.prototype.greaterEqual=function(a,e){return this.assertNotComplex([a,e],"greaterEqual"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a>=e?1:0})},t.prototype.logicalNot=function(a){this.assertNotComplex(a,"logicalNot");for(var e=a.dataSync(),t=new Uint8Array(e.length),o=0;o<e.length;++o)t[o]=e[o]?0:1;return Os.make(a.shape,{values:t},"bool")},t.prototype.logicalAnd=function(a,e){return this.assertNotComplex([a,e],"logicalAnd"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a&&e})},t.prototype.logicalOr=function(a,e){return this.assertNotComplex([a,e],"logicalOr"),this.broadcastedBinaryOp(a,e,"bool",function(a,e){return a||e})},t.prototype.select=function(d,e,t){this.assertNotComplex([d,e,t],"select");for(var n=d.dataSync(),r=e.dataSync(),o=t.dataSync(),a=qt(e.shape,Te(e.dtype,t.dtype)),i=a.dataSync(),s=0,u=0===d.rank||1<d.rank||1===e.rank?1:e.shape[1],c=0;c<n.length;c++)for(var l=0;l<u;l++)i[s++]=1===n[c]?r[c]:o[c];return a},t.prototype.where=function(a){this.assertNotComplex([a],"where");var e=a.dataSync();return Mn(a.shape,e)},t.prototype.topk=function(a,e,t){return this.assertNotComplex(a,"topk"),ia(a.dataSync(),a.shape,a.dtype,e,t)},t.prototype.min=function(m,e){this.assertNotComplex(m,"min"),yt("min",e,m.rank);for(var t=gt(m.shape,e),n=t[0],r=t[1],o=qt(n,m.dtype),a=U(r),i=o.dataSync(),s=m.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=s[c],p=0,d;p<a;++p)d=s[c+p],d<l&&(l=d);i[u]=l}return o},t.prototype.minimum=function(a,e){return this.assertNotComplex([a,e],"minimum"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return le(a,e)})},t.prototype.mod=function(a,e){return this.assertNotComplex([a,e],"mod"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){var t=a%e;return 0>a&&0>e||0<=a&&0<=e?t:(t+e)%e})},t.prototype.max=function(m,e){this.assertNotComplex(m,"max"),yt("max",e,m.rank);for(var t=gt(m.shape,e),n=t[0],r=t[1],o=qt(n,m.dtype),a=U(r),i=o.dataSync(),s=m.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=s[c],p=0,d;p<a;++p)d=s[c+p],d>l&&(l=d);i[u]=l}return o},t.prototype.maximum=function(a,e){return this.assertNotComplex([a,e],"maximum"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return de(a,e)})},t.prototype.all=function(m,e){this.assertNotComplex(m,"all"),yt("all",e,m.rank);for(var t=gt(m.shape,e),n=t[0],r=t[1],o=qt(n,m.dtype),a=U(r),i=o.dataSync(),s=m.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=s[c],p=0,d;p<a;++p)d=s[c+p],l=l&&d;i[u]=l}return o},t.prototype.any=function(m,e){this.assertNotComplex(m,"any"),yt("any",e,m.rank);for(var t=gt(m.shape,e),n=t[0],r=t[1],o=qt(n,m.dtype),a=U(r),i=o.dataSync(),s=m.dataSync(),u=0;u<i.length;++u){for(var c=u*a,l=s[c],p=0,d;p<a;++p)d=s[c+p],l=l||d;i[u]=l}return o},t.prototype.squaredDifference=function(a,e){return this.assertNotComplex([a,e],"squaredDifference"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){var t=a-e;return t*t})},t.prototype.ceil=function(a){this.assertNotComplex(a,"ceil");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=pe(e[o]);return Os.make(a.shape,{values:t})},t.prototype.floor=function(a){this.assertNotComplex(a,"floor");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=$(e[o]);return Os.make(a.shape,{values:t})},t.prototype.sign=function(a){this.assertNotComplex(a,"x");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=0>e[o]?-1:0<e[o]?1:0;return Os.make(a.shape,{values:t})},t.prototype.isNaN=function(a){this.assertNotComplex(a,"x");for(var e=a.dataSync(),t=new Uint8Array(e.length),o=0;o<e.length;++o)Number.isNaN(e[o])&&(t[o]=1);return Os.make(a.shape,{values:t},"bool")},t.prototype.isInf=function(a){this.assertNotComplex(a,"x");for(var e=a.dataSync(),t=new Uint8Array(e.length),o=0;o<e.length;++o)l(e[o])===1/0&&(t[o]=1);return Os.make(a.shape,{values:t},"bool")},t.prototype.isFinite=function(a){this.assertNotComplex(a,"x");for(var e=a.dataSync(),t=new Uint8Array(e.length),o=0;o<e.length;++o)Number.isFinite(e[o])&&(t[o]=1);return Os.make(a.shape,{values:t},"bool")},t.prototype.round=function(a){this.assertNotComplex(a,"round");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=$(e[s]),t[s]=.5>e[s]-r?$(e[s]):.5<e[s]-r?pe(e[s]):0==r%2?r:r+1;return Os.make(a.shape,{values:t})},t.prototype.exp=function(a){this.assertNotComplex(a,"exp");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=m(e[o]);return Os.make(a.shape,{values:t})},t.prototype.expm1=function(a){this.assertNotComplex(a,"expm1");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=Math.expm1(e[o]);return Os.make(a.shape,{values:t})},t.prototype.log=function(a){this.assertNotComplex(a,"log");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=p(r);return Os.make(a.shape,{values:t})},t.prototype.log1p=function(a){this.assertNotComplex(a,"log1p");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=Math.log1p(r);return Os.make(a.shape,{values:t})},t.prototype.sqrt=function(a){this.assertNotComplex(a,"sqrt");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=C(r);return Os.make(a.shape,{values:t})},t.prototype.rsqrt=function(a){this.assertNotComplex(a,"rsqrt");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=1/C(r);return Os.make(a.shape,{values:t})},t.prototype.square=function(a){this.assertNotComplex(a,"square");for(var e=a.dataSync(),t=new Float32Array(e.length),s=0,r;s<e.length;++s)r=e[s],t[s]=r*r;return Os.make(a.shape,{values:t})},t.prototype.reciprocal=function(a){this.assertNotComplex(a,"reciprocal");for(var e=a.dataSync(),t=new Float32Array(e.length),o=0;o<e.length;++o)t[o]=1/e[o];return Os.make(a.shape,{values:t})},t.prototype.linear=function(t){return t},t.prototype.relu=function(a){this.assertNotComplex(a,"relu");for(var e=qt(a.shape,a.dtype),t=e.dataSync(),n=a.dataSync(),r=0;r<n.length;++r)t[r]=de(0,n[r]);return e},t.prototype.prelu=function(a,e){return this.assertNotComplex([a,e],"prelu"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return 0>a?e*a:a})},t.prototype.elu=function(a){this.assertNotComplex(a,"elu");for(var e=new Float32Array(a.size),s=a.dataSync(),n=0,r;n<s.length;++n)r=s[n],e[n]=0<=r?r:m(r)-1;return Os.make(a.shape,{values:e})},t.prototype.eluDer=function(s,e){this.assertNotComplex([s,e],"eluDer");for(var t=new Float32Array(e.size),p=e.dataSync(),r=s.dataSync(),o=0,a;o<p.length;++o)a=p[o],t[o]=1<=a?r[o]:r[o]*(a+1);return Os.make(e.shape,{values:t})},t.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=new Float32Array(t.size),n=t.dataSync(),o=0,a;o<n.length;++o)a=n[o],e[o]=0<=a?ed*a:Jp*(m(a)-1);return Os.make(t.shape,{values:e})},t.prototype.clip=function(s,e,t){this.assertNotComplex(s,"clip");for(var n=new Float32Array(s.size),p=s.dataSync(),o=0,a;o<p.length;++o)a=p[o],n[o]=a>t?t:a<e?e:a;return Os.make(s.shape,{values:n})},t.prototype.abs=function(a){for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=l(o[n]);return Os.make(a.shape,{values:e})},t.prototype.complexAbs=function(s){for(var e=new Float32Array(s.size),i=s.dataSync(),n=0;n<s.size;++n){var r=i[2*n],o=i[2*n+1];e[n]=Math.hypot(r,o)}return Os.make(s.shape,{values:e})},t.prototype.int=function(a){this.assertNotComplex(a,"int");for(var e=new Int32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=o[n];return Os.make(a.shape,{values:e},"int32")},t.prototype.sigmoid=function(a){this.assertNotComplex(a,"sigmoid");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=1/(1+m(-o[n]));return Os.make(a.shape,{values:e})},t.prototype.softplus=function(d){this.assertNotComplex(d,"softplus");for(var e=-15.942385152878742+2,l=new Float32Array(d.size),c=d.dataSync(),r=0;r<c.length;++r){var o=c[r]>-e,a=c[r]<e,i=m(c[r]),s=void 0;s=a?i:o?c[r]:p(1+i),l[r]=s}return Os.make(d.shape,{values:l})},t.prototype.sin=function(a){this.assertNotComplex(a,"sin");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=s(o[n]);return Os.make(a.shape,{values:e})},t.prototype.cos=function(a){this.assertNotComplex(a,"cos");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=i(o[n]);return Os.make(a.shape,{values:e})},t.prototype.tan=function(a){this.assertNotComplex(a,"tan");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.tan(o[n]);return Os.make(a.shape,{values:e})},t.prototype.asin=function(a){this.assertNotComplex(a,"asin");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.asin(o[n]);return Os.make(a.shape,{values:e})},t.prototype.acos=function(a){this.assertNotComplex(a,"acos");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.acos(o[n]);return Os.make(a.shape,{values:e})},t.prototype.atan=function(a){this.assertNotComplex(a,"atan");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.atan(o[n]);return Os.make(a.shape,{values:e})},t.prototype.atan2=function(a,e){return this.assertNotComplex([a,e],"atan2"),this.broadcastedBinaryOp(a,e,a.dtype,function(a,e){return Math.atan2(a,e)})},t.prototype.sinh=function(a){this.assertNotComplex(a,"sinh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.sinh(o[n]);return Os.make(a.shape,{values:e})},t.prototype.cosh=function(a){this.assertNotComplex(a,"cosh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.cosh(o[n]);return Os.make(a.shape,{values:e})},t.prototype.tanh=function(a){this.assertNotComplex(a,"tanh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=z(o[n]);return Os.make(a.shape,{values:e})},t.prototype.asinh=function(a){this.assertNotComplex(a,"asinh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.asinh(o[n]);return Os.make(a.shape,{values:e})},t.prototype.acosh=function(a){this.assertNotComplex(a,"acosh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.acosh(o[n]);return Os.make(a.shape,{values:e})},t.prototype.atanh=function(a){this.assertNotComplex(a,"atanh");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n)e[n]=Math.atanh(o[n]);return Os.make(a.shape,{values:e})},t.prototype.erf=function(a){this.assertNotComplex(a,"erf");for(var e=new Float32Array(a.size),o=a.dataSync(),n=0;n<o.length;++n){var r=o[n],s=1/(1+Kp*r);e[n]=1-((((Zp*s+Qp)*s+Yp)*s+Xp)*s+jp)*s*m(-r*r)}return Os.make(a.shape,{values:e})},t.prototype.step=function(s,e){void 0===e&&(e=0),this.assertNotComplex(s,"step");for(var t=new Float32Array(s.size),i=s.dataSync(),r=0,o;r<i.length;++r)o=i[r],t[r]=isNaN(o)?NaN:0<o?1:e;return Os.make(s.shape,{values:t})},t.prototype.conv2d=function(P,e,t){this.assertNotComplex([P,e],"conv2d");for(var n=t.filterHeight,r=t.filterWidth,o=t.dilationHeight,a=t.dilationWidth,i=t.padInfo.left,s=t.padInfo.top,u=Ln(t.outShape,P.dtype),c=P.dataSync(),l=e.dataSync(),p=u.values,d=0;d<t.batchSize;++d)for(var h=d*P.strides[0],f=d*u.strides[0],m=0;m<t.outHeight;++m)for(var g=f+m*u.strides[1],v=m*t.strideHeight-i,y=0,x;y<n;y++)if(x=v+y*o,!(0>x||x>=t.inHeight))for(var E=y*e.strides[0],T=h+x*P.strides[1],b=0;b<t.outWidth;++b)for(var w=g+b*t.outChannels,S=b*t.strideWidth-s,C=0,A;C<r;C++)if(A=S+C*a,!(0>A||A>=t.inWidth))for(var N=E+C*e.strides[1],_=T+A*t.inChannels,R=N,I=0;I<t.inChannels;++I){for(var k=c[_+I],D=0;D<t.outChannels;++D)p[w+D]+=k*l[R+D];R+=t.outChannels}return u.toTensor()},t.prototype.conv3d=function(H,e,t){for(var n=t.filterDepth,r=t.filterHeight,o=t.filterWidth,a=t.dilationDepth,i=t.dilationHeight,s=t.dilationWidth,u=t.padInfo.front,c=t.padInfo.left,l=t.padInfo.top,p=Ln(t.outShape,H.dtype),d=H.dataSync(),h=e.dataSync(),f=p.values,m=0;m<t.batchSize;++m)for(var g=m*H.strides[0],v=m*p.strides[0],y=0;y<t.outDepth;++y)for(var x=v+y*p.strides[1],E=y*t.strideDepth-u,T=0,b;T<n;T++)if(b=E+T*a,!(0>b||b>=t.inDepth))for(var w=T*e.strides[0],S=g+b*H.strides[1],C=0;C<t.outHeight;++C)for(var A=x+C*p.strides[2],N=C*t.strideHeight-l,_=0,R;_<r;_++)if(R=N+_*i,!(0>R||R>=t.inHeight))for(var I=w+_*e.strides[1],k=S+R*H.strides[2],D=0;D<t.outWidth;++D)for(var O=A+D*t.outChannels,P=D*t.strideWidth-c,M=0,F;M<o;M++)if(F=P+M*s,!(0>F||F>=t.inWidth))for(var L=I+M*e.strides[2],B=k+F*t.inChannels,V=L,U=0;U<t.inChannels;++U){for(var z=d[B+U],W=0;W<t.outChannels;++W)f[O+W]+=z*h[V+W];V+=t.outChannels}return p.toTensor()},t.prototype.conv2dDerInput=function(j,e,t){this.assertNotComplex([j,e],"conv2dDerInput");for(var n=Ln(t.inShape,"float32"),r=n.values,o=n.strides,a=o[0],i=o[1],s=o[2],u=j.dataSync(),c=j.strides,l=c[0],p=c[1],d=c[2],h=e.dataSync(),f=e.strides,m=f[0],g=f[1],v=f[2],y=t.batchSize,x=t.filterHeight,E=t.filterWidth,T=t.inChannels,b=t.inHeight,w=t.inWidth,S=t.outChannels,C=t.outHeight,A=t.outWidth,N=t.strideHeight,_=t.strideWidth,R=x-1-t.padInfo.top,I=E-1-t.padInfo.left,k=0;k<y;++k)for(var D=0;D<T;++D)for(var O=0;O<b;++O)for(var P=O-R,M=de(0,pe(P/N)),F=le(C,(x+P)/N),L=0;L<w;++L){for(var B=L-I,V=de(0,pe(B/_)),U=le(A,(E+B)/_),z=0,W=M;W<F;++W)for(var G=W*N-P,H=V;H<U;++H)for(var q=l*k+p*W+d*H,$=m*(x-1-G)+g*(E-1-(H*_-B))+v*D,K=0;K<S;++K)z+=u[q+K]*h[$+K];r[a*k+i*O+s*L+D]=z}return n.toTensor()},t.prototype.conv3dDerInput=function(ce,e,t){for(var n=Ln(t.inShape,"float32"),r=n.values,o=n.strides,a=o[0],i=o[1],s=o[2],u=o[3],c=ce.dataSync(),l=ce.strides,p=l[0],d=l[1],h=l[2],f=l[3],m=e.dataSync(),g=e.strides,v=g[0],y=g[1],x=g[2],E=g[3],T=t.batchSize,b=t.filterDepth,w=t.filterHeight,S=t.filterWidth,C=t.inChannels,A=t.inDepth,N=t.inHeight,_=t.inWidth,R=t.outChannels,I=t.outDepth,k=t.outHeight,D=t.outWidth,O=t.strideDepth,P=t.strideHeight,M=t.strideWidth,F=b-1-t.padInfo.front,L=w-1-t.padInfo.top,B=S-1-t.padInfo.left,V=0;V<T;++V)for(var U=0;U<C;++U)for(var z=0;z<A;++z)for(var W=z-F,G=de(0,pe(W/O)),H=le(I,(b+W)/O),q=0;q<N;++q)for(var $=q-L,K=de(0,pe($/P)),X=le(k,(w+$)/P),j=0;j<_;++j){for(var Y=j-B,Q=de(0,pe(Y/M)),J=le(D,(S+Y)/M),Z=0,ee=G;ee<H;++ee)for(var te=ee*O-W,ne=K;ne<X;++ne)for(var re=ne*P-$,oe=Q;oe<J;++oe)for(var ae=p*V+d*ee+h*ne+f*oe,ie=v*(b-1-te)+y*(w-1-re)+x*(S-1-(oe*M-Y))+E*U,se=0;se<R;++se)Z+=c[ae+se]*m[ie+se];r[a*V+i*z+s*q+u*j+U]=Z}return n.toTensor()},t.prototype.conv2dDerFilter=function(R,e,t){this.assertNotComplex([R,e],"conv2dDerFilter");for(var n=t.strideHeight,r=t.strideWidth,o=t.filterHeight,a=t.filterWidth,i=Ln(t.filterShape,"float32"),s=t.padInfo.left,u=t.padInfo.top,c=R.bufferSync(),l=e.bufferSync(),p=0;p<o;++p)for(var d=de(0,pe((u-p)/n)),h=le(t.outHeight,(t.inHeight+u-p)/n),f=0;f<a;++f)for(var m=de(0,pe((s-f)/r)),g=le(t.outWidth,(t.inWidth+s-f)/r),v=0;v<t.inChannels;++v)for(var y=0;y<t.outChannels;++y){for(var x=0,E=0;E<t.batchSize;++E)for(var _=d;_<h;++_)for(var b=p+_*n-u,k=m,S;k<g;++k)S=f+k*r-s,x+=c.get(E,b,S,v)*l.get(E,_,k,y);i.set(x,p,f,v,y)}return i.toTensor()},t.prototype.conv3dDerFilter=function(ae,e,t){for(var n=t.strideDepth,r=t.strideHeight,o=t.strideWidth,a=t.filterDepth,i=t.filterHeight,s=t.filterWidth,u=Ln(t.filterShape,"float32"),c=u.values,l=u.strides,p=l[0],d=l[1],h=l[2],f=l[3],m=e.dataSync(),g=e.strides,v=g[0],y=g[1],x=g[2],E=g[3],T=ae.dataSync(),b=ae.strides,w=b[0],S=b[1],C=b[2],A=b[3],N=t.padInfo.front,_=t.padInfo.left,R=t.padInfo.top,I=0;I<a;++I)for(var k=de(0,pe((N-I)/n)),D=le(t.outDepth,(t.inDepth+N-I)/n),O=I*p,P=0;P<i;++P)for(var M=de(0,pe((R-P)/r)),F=le(t.outHeight,(t.inHeight+R-P)/r),L=P*d+O,B=0;B<s;++B)for(var V=de(0,pe((_-B)/o)),U=le(t.outWidth,(t.inWidth+_-B)/o),z=B*h+L,W=0;W<t.inChannels;++W)for(var G=W*f+z,H=0;H<t.outChannels;++H){for(var q=0,$=0;$<t.batchSize;++$)for(var K=$*w,X=$*v,j=k;j<D;++j)for(var Y=(I+j*n-N)*S+K,Q=j*y+X,J=M;J<F;++J)for(var Z=(P+J*r-R)*C+Y,ee=J*x+Q,te=V,oe;te<U;++te)oe=te*E+ee,q+=T[(B+te*o-_)*A+Z+W]*m[oe+H];c[G+H]=q}return u.toTensor()},t.prototype.depthwiseConv2D=function(F,e,t){this.assertNotComplex([F,e],"depthwiseConv2D");for(var n=t.filterHeight,r=t.filterWidth,o=t.dilationHeight,a=t.dilationWidth,i=t.padInfo.left,s=t.padInfo.top,u=t.outChannels/t.inChannels,c=Ln(t.outShape,F.dtype),l=F.dataSync(),p=e.dataSync(),d=c.values,h=0;h<t.batchSize;++h)for(var f=h*F.strides[0],m=h*c.strides[0],g=0;g<t.outHeight;++g)for(var v=m+g*c.strides[1],y=g*t.strideHeight-i,x=0,E;x<n;++x)if(E=y+x*o,!(0>E||E>=t.inHeight))for(var T=x*e.strides[0],b=f+E*F.strides[1],w=0;w<t.outWidth;++w)for(var S=v+w*c.strides[2],C=w*t.strideWidth-s,A=0,N;A<r;++A)if(N=C+A*a,!(0>N||N>=t.inWidth))for(var _=T+A*e.strides[1],R=b+N*t.inChannels,I=S,k=_,D=0;D<t.inChannels;++D){for(var O=l[R+D],P=0;P<u;++P)d[I+P]+=O*p[k+P];I+=u,k+=u}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(Y,e,t){this.assertNotComplex([Y,e],"depthwiseConv2DDerInput");for(var n=Ln(t.inShape,"float32"),r=n.values,o=n.strides,a=o[0],i=o[1],s=o[2],u=Y.dataSync(),c=Y.strides,l=c[0],p=c[1],d=c[2],h=e.dataSync(),f=e.strides,m=f[0],g=f[1],v=f[2],y=t.batchSize,x=t.filterHeight,E=t.filterWidth,T=t.inChannels,b=t.inHeight,w=t.inWidth,S=t.outChannels,C=t.outHeight,A=t.outWidth,N=t.strideHeight,_=t.strideWidth,R=x-1-t.padInfo.top,I=E-1-t.padInfo.left,k=S/T,D=0;D<y;++D)for(var O=0;O<T;++O)for(var P=0;P<b;++P)for(var M=P-R,F=de(0,pe(M/N)),L=le(C,(x+M)/N),B=0;B<w;++B){for(var V=B-I,U=de(0,pe(V/_)),z=le(A,(E+V)/_),W=0,G=F;G<L;++G)for(var H=G*N-M,q=U;q<z;++q)for(var $=l*D+p*G+d*q,K=m*(x-1-H)+g*(E-1-(q*_-V))+v*O,X=0;X<k;++X)W+=u[$+(O*k+X)]*h[K+X];r[a*D+i*P+s*B+O]=W}return n.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(R,e,t){this.assertNotComplex([R,e],"depthwiseConv2DDerFilter");for(var n=t.strideHeight,r=t.strideWidth,o=t.filterHeight,a=t.filterWidth,i=Ln(t.filterShape,"float32"),s=t.padInfo.left,u=t.padInfo.top,c=t.outChannels/t.inChannels,l=R.bufferSync(),p=e.bufferSync(),d=0;d<o;++d)for(var h=de(0,pe((u-d)/n)),f=le(t.outHeight,(t.inHeight+u-d)/n),m=0;m<a;++m)for(var g=de(0,pe((s-m)/r)),v=le(t.outWidth,(t.inWidth+s-m)/r),y=0;y<t.outChannels;++y){for(var x=Math.trunc(y/c),E=y%c,_=0,b=0;b<t.batchSize;++b)for(var k=h;k<f;++k)for(var S=d+k*n-u,C=g,w;C<v;++C)w=m+C*r-s,_+=l.get(b,S,w,x)*p.get(b,k,C,y);i.set(_,d,m,x,E)}return i.toTensor()},t.prototype.tile=function(p,e){this.assertNotComplex(p,"tile");for(var t=Array(p.rank),n=0;n<t.length;n++)t[n]=p.shape[n]*e[n];var r=Ln(t,p.dtype),o=p.bufferSync();for(n=0;n<r.values.length;++n){for(var a=r.indexToLoc(n),i=Array(p.rank),s=0;s<i.length;s++)i[s]=a[s]%p.shape[s];var d=o.locToIndex(i);r.values[n]=o.values[d]}return r.toTensor()},t.prototype.pad=function(p,e,t){this.assertNotComplex(p,"pad");var n=e.map(function(e,t){return e[0]+p.shape[t]+e[1]}),r=e.map(function(t){return t[0]}),o=p.bufferSync(),a=Ln(n,p.dtype);0!==t&&a.values.fill(t);for(var i=0;i<p.size;i++){var s=o.indexToLoc(i),d=s.map(function(a,e){return a+r[e]});a.set.apply(a,[o.get.apply(o,s)].concat(d))}return a.toTensor()},t.prototype.transpose=function(p,e){this.assertNotComplex(p,"transpose");for(var t=Array(p.rank),n=0;n<t.length;n++)t[n]=p.shape[e[n]];var r=p.dataSync(),o=Ln(t,p.dtype),a=p.bufferSync();for(n=0;n<p.size;++n){for(var i=a.indexToLoc(n),s=Array(i.length),d=0;d<s.length;d++)s[d]=i[e[d]];var u=o.locToIndex(s);o.values[u]=r[n]}return o.toTensor()},t.prototype.gather=function(p,e,t){this.assertNotComplex([p,e],"gather");var n=p.shape.slice(),r=e.dataSync();n[t]=r.length;for(var o=Ln(n,p.dtype),a=p.bufferSync(),i=0;i<o.size;++i){var s=o.indexToLoc(i),d=s.slice();d[t]=r[s[t]];var u=a.locToIndex(d);o.values[i]=a.values[u]}return o.toTensor()},t.prototype.batchToSpaceND=function(p,e,t){this.assertNotComplex([p],"batchToSpaceND");var n=e.reduce(function(a,e){return a*e}),r=pt(p.shape,e,n),o=dt(r.length,e.length),a=lt(p.shape,e,n),i=ut(t,e.length),s=ct(a,t,e.length);return p.reshape(r).transpose(o).reshape(a).slice(i,s)},t.prototype.spaceToBatchND=function(p,e,t){this.assertNotComplex([p],"spaceToBatchND");var n=e.reduce(function(a,e){return a*e}),r=[[0,0]];r.push.apply(r,t);for(var o=1+e.length;o<p.shape.length;++o)r.push([0,0]);var a=p.pad(r),i=pt(a.shape,e,n,!1),s=dt(i.length,e.length,!1),d=lt(a.shape,e,n,!1);return a.reshape(i).transpose(s).reshape(d)},t.prototype.pool=function(U,e,t){this.assertNotComplex(U,"pool");for(var n=e.strideHeight,r=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,i=e.effectiveFilterHeight,s=e.effectiveFilterWidth,u=e.padInfo.top,c=e.padInfo.left,l="max"===t?B:W,p=U.dataSync(),d=Ln(e.outShape,U.dtype),h=d.values,f=e.outShape[1]*e.outShape[2]*e.outShape[3],m=e.outShape[2]*e.outShape[3],g=e.outShape[3],v=0;v<e.batchSize;++v)for(var y=v*f,x=v*U.strides[0],E=0;E<e.inChannels;++E)for(var T=0;T<e.outHeight;++T)for(var b=T*n-u,w=de(0,b),S=le(e.inHeight,i+b),C=y+T*m,A=0;A<e.outWidth;++A){for(var N=A*r-c,_=de(0,N),R=le(e.inWidth,s+N),I=l,k=0,D=0,O=w;O<S;O+=o){for(var P=x+O*U.strides[1],M=_,F;M<R;M+=a)F=p[P+M*U.strides[2]+E],"max"===t&&F>I?I=F:"avg"==t&&(k+=F,D++);if(isNaN(I))break}h[C+A*g+E]="avg"===t?k/D:I}return d.toTensor()},t.prototype.maxPool=function(a,e){return this.pool(a,e,"max")},t.prototype.maxPoolPositions=function(R,e){for(var t=Ln(e.outShape,"int32"),n=e.strideHeight,r=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,i=e.effectiveFilterHeight,s=e.effectiveFilterWidth,u=e.padInfo.top,c=e.padInfo.left,l=R.bufferSync(),p=0;p<e.batchSize;++p)for(var d=0;d<e.inChannels;++d)for(var h=0;h<e.outHeight;++h){for(var f=h*n-u,m=f;0>m;)m+=o;for(var g=le(e.inHeight,i+f),v=0;v<e.outWidth;++v){for(var y=v*r-c,x=y;0>x;)x+=a;for(var E=le(e.inWidth,s+y),k=B,b=-1,w=m;w<g;w+=o)for(var S=w-f,C=x;C<E;C+=a){var I=C-y,N=l.get(p,w,C,d);N>k&&(k=N,b=S*s+I)}t.set(b,p,h,v,d)}}return t.toTensor()},t.prototype.maxPoolBackprop=function(R,e,t,n){this.assertNotComplex([e,t],"maxPoolBackprop");for(var r=this.maxPoolPositions(e,n),o=n.strideHeight,a=n.strideWidth,i=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,l=c-1-n.padInfo.left,p=u-1-n.padInfo.top,d=Ln(e.shape,"float32"),h=r.bufferSync(),f=R.bufferSync(),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var v=0;v<n.inHeight;++v)for(var y=0;y<n.inWidth;++y){for(var x=v-p,E=y-l,_=0,b=0,k;b<u;b+=i)if(k=(x+b)/o,!(0>k||k>=n.outHeight||$(k)!==k))for(var S=0,C;S<c;S+=s)if(C=(E+S)/a,!(0>C||C>=n.outWidth||$(C)!==C)){var w=u*c-1-h.get(m,k,C,g)===b*c+S?1:0;0!=w&&(_+=f.get(m,k,C,g)*w)}d.set(_,m,v,y,g)}return d.toTensor()},t.prototype.avgPoolBackprop=function(f,e,t){this.assertNotComplex([f,e],"avgPoolBackprop");for(var n=t.strideHeight,r=t.strideWidth,o=t.filterHeight,a=t.filterWidth,i=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=c-1-t.padInfo.left,p=u-1-t.padInfo.top,d=Ln(e.shape,"float32"),h=f.bufferSync(),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var v=0;v<t.inHeight;++v)for(var y=0;y<t.inWidth;++y){for(var x=v-p,R=y-l,E=0,b=0,_;b<u;b+=i)if(_=(x+b)/n,!(0>_||_>=t.outHeight||$(_)!==_))for(var S=0,C;S<c;S+=s)C=(R+S)/r,0>C||C>=t.outWidth||$(C)!==C||(E+=h.get(m,_,C,g));d.set(E*(1/(o*a)),m,v,y,g)}return d.toTensor()},t.prototype.cast=function(a,e){return jt(a,e,this)},t.prototype.reshape=function(a,e){return Xt(a,e)},t.prototype.avgPool=function(a,e){return this.assertNotComplex(a,"avgPool"),this.pool(a,e,"avg").toFloat()},t.prototype.resizeBilinear=function(E,e,t,n){this.assertNotComplex(E,"resizeBilinear");for(var r=E.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=E.dataSync(),c=new Float32Array(U([o,e,t,s])),l=[n&&1<e?a-1:a,n&&1<t?i-1:i],p=[n&&1<e?e-1:e,n&&1<t?t-1:t],d=0,h=l[0]/p[0],f=l[1]/p[1],m=0;m<o;m++)for(var g=0;g<e;g++)for(var v=h*g,y=$(v),x=le(a-1,pe(v)),T=m*E.strides[0]+y*E.strides[1],b=m*E.strides[0]+x*E.strides[1],w=0;w<t;w++)for(var S=f*w,C=$(S),A=S-C,N=le(i-1,pe(S)),B=T+C*E.strides[2],R=b+C*E.strides[2],I=T+ +N*E.strides[2],k=b+N*E.strides[2],D=0;D<s;D++){var O=u[B+D],P=u[R+D],M=O+(u[I+D]-O)*A,F=M+(P+(u[k+D]-P)*A-M)*(v-y);c[d++]=F}return Mt(c,[o,e,t,s])},t.prototype.resizeBilinearBackprop=function(B,e,t){this.assertNotComplex([B,e],"resizeBilinearBackprop");for(var n=e.shape,r=n[0],o=n[1],a=n[2],i=n[3],s=B.shape,u=s[1],c=s[2],l=new Float32Array(r*o*a*i),p=[t&&1<u?o-1:o,t&&1<c?a-1:a],d=[t&&1<u?u-1:u,t&&1<c?c-1:c],h=p[0]/d[0],f=p[1]/d[1],m=B.dataSync(),g=0,v=0;v<r;v++)for(var y=v*e.strides[0],x=0;x<u;x++)for(var E=x*h,T=$(E),b=le(pe(E),o-1),w=y+T*e.strides[1],S=y+b*e.strides[1],C=E-T,A=1-C,N=0;N<c;N++)for(var _=N*f,R=$(_),I=le(pe(_),a-1),k=_-R,D=1-k,O=w+R*e.strides[2],P=w+I*e.strides[2],M=S+R*e.strides[2],F=S+I*e.strides[2],L=0,W;L<i;L++)W=m[g++],l[O+L]+=W*(A*D),l[P+L]+=W*(A*k),l[M+L]+=W*(C*D),l[F+L]+=W*(C*k);return Vt(l,[r,a,o,i],e.dtype)},t.prototype.resizeNearestNeighbor=function(R,e,t,n){this.assertNotComplex(R,"resizeNearestNeighbor");for(var r=R.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=R.dataSync(),c=new Float32Array(o*e*t*s),l=[n&&1<e?a-1:a,n&&1<t?i-1:i],p=[n&&1<e?e-1:e,n&&1<t?t-1:t],d=l[0]/p[0],h=l[1]/p[1],f=0,m=0;m<o;m++)for(var g=m*R.strides[0],v=0;v<e;v++)for(var y=d*v,x=g+le(a-1,n?_(y):$(y))*R.strides[1],E=0;E<t;E++)for(var k=h*E,b=x+le(i-1,n?_(k):$(k))*R.strides[2],w=0,S;w<s;w++)S=u[b+w],c[f++]=S;return Mt(c,[o,e,t,s],R.dtype)},t.prototype.resizeNearestNeighborBackprop=function(W,e,t){this.assertNotComplex([W,e],"resizeNearestNeighborBackprop");for(var n=e.shape,r=n[0],o=n[1],a=n[2],i=n[3],s=W.shape,u=s[1],c=s[2],l=new Float32Array(r*o*a*i),p=W.dataSync(),d=[t&&1<u?o-1:o,t&&1<c?a-1:a],h=[t&&1<u?u-1:u,t&&1<c?c-1:c],f=d[0]/h[0],m=d[1]/h[1],g=1/f,v=1/m,y=2*pe(g)+2,x=2*pe(v)+2,E=0;E<r;E++)for(var T=E*e.strides[0],b=0;b<o;b++)for(var w=T+b*e.strides[1],S=$(b*g),C=$(S-y/2),A=0;A<a;A++)for(var N=w+A*e.strides[2],z=$(A*v),R=$(z-x/2),I=0;I<i;I++){for(var k=0,D=0,O;D<y;D++)if(O=D+C,!(0>O||O>=u)){var P=T+O*W.strides[1],M=O*f;if(b===le(o-1,t?_(M):$(M)))for(var F=0,L;F<x;F++)if(L=F+R,!(0>L||L>=c)){var B=P+L*W.strides[2],G=L*m;A===le(a-1,t?_(G):$(G))&&(k+=p[B+I])}}l[N+I]=k}return Vt(l,e.shape,e.dtype)},t.prototype.batchNormalization=function(b,e,t,n,r,o){this.assertNotComplex([b,e,t,r,o],"batchNorm");for(var a=b.dataSync(),i=e.dataSync(),s=t.dataSync(),u=r?r.dataSync():new Float32Array([1]),c=o?o.dataSync():new Float32Array([0]),l=new Float32Array(a.length),p=c.length,d=u.length,h=s.length,f=i.length,m=0,g=0,v=0,y=0,x=0;x<a.length;++x)l[x]=c[m++]+(a[x]-i[g++])*u[v++]/C(s[y++]+n),m>=p&&(m=0),g>=f&&(g=0),v>=d&&(v=0),y>=h&&(y=0);return Vt(l,b.shape)},t.prototype.localResponseNormalization4D=function(m,g,e,t,n){function r(t){for(var e=t%l,n=t-e+de(0,e-g),r=t-e+le(e+g,a),o=0,s;n<=r;n++)s=i[n],o+=s*s;return o}this.assertNotComplex(m,"localResponseNormalization4D");for(var l=m.shape[3],a=l-1,i=m.dataSync(),s=m.size,u=new Float32Array(s),c=0;c<s;c++){var p=r(c),d=i[c]*b(e+t*p,-n);u[c]=d}return Vt(u,m.shape)},t.prototype.LRNGrad=function(C,e,t,n,r,o,a){this.assertNotComplex(C,"LRNGrad");for(var R=C.shape[3],s=C.dataSync(),u=e.dataSync(),c=t.dataSync(),l=new Float32Array(C.size),p=C.size,d=0;d<p;d++){for(var h=d%R,f=d-h+de(0,h-n),m=d-h+le(R,h+n+1),g=0,v=f;v<m;v++)g+=b(u[v],2);for(g=o*g+r,v=f;v<m;v++){var y=-2*o*a*u[v]*c[d]/g;d===v&&(y+=b(g,-a)),y*=s[d],l[v]+=y}}return Vt(l,C.shape)},t.prototype.multinomial=function(x,e,t,n){this.assertNotComplex(x,"multinomial");for(var r=e?x:pi(x),o=r.shape[0],a=r.shape[1],i=qt([o,t],"int32"),s=i.dataSync(),u=r.dataSync(),c=0;c<o;++c){var l=c*a,p=new Float32Array(a-1);p[0]=u[l];for(var d=1;d<p.length;++d)p[d]=p[d-1]+u[l+d];for(var h=_d(n.toString()),f=c*t,m=0,g;m<t;++m){g=h(),s[f+m]=p.length;for(var b=0;b<p.length;b++)if(g<p[b]){s[f+m]=b;break}}}return i},t.prototype.oneHot=function(s,e,t,n){this.assertNotComplex(s,"oneHot");var r=new Float32Array(s.size*e);r.fill(n);for(var o=s.dataSync(),a=0;a<s.size;++a)0<=o[a]&&o[a]<e&&(r[a*e+o[a]]=t);return zt(r,[s.size,e],"int32")},t.prototype.nonMaxSuppression=function(a,e,t,n,r){return this.assertNotComplex(a,"nonMaxSuppression"),na(a.dataSync(),e.dataSync(),t,n,r)},t.prototype.fft=function(t){return this.fftBatch(t,!1)},t.prototype.ifft=function(t){return this.fftBatch(t,!0)},t.prototype.fftBatch=function(m,e){for(var t=m.shape[0],n=m.shape[1],r=Ln(m.shape,"float32"),o=Ln(m.shape,"float32"),a=ui(m).as2D(t,n),i=ci(m).as2D(t,n),s=0;s<t;s++)for(var u=a.slice([s,0],[1,n]),c=i.slice([s,0],[1,n]),l=li(u,c),p=this.fftImpl(l,e).dataSync(),d=0,h;d<n;d++)h=ea(p,d),r.values[s*n+d]=h.real,o.values[s*n+d]=h.imag;return li(r.toTensor(),o.toTensor()).as2D(t,n)},t.prototype.fftImpl=function(s,e){var t=s.as1D(),n=t.size;if(this.isExponentOf2(n)){var r=this.fftRadix2(t,n,e).as2D(s.shape[0],s.shape[1]);return e&&(r=li(ui(r).div(Wt(n)),ci(r).div(Wt(n)))),r}var o=s.dataSync(),a=Qt(this.fourierTransformByMatmul(o,n,e));return li(a.real,a.imag).as2D(s.shape[0],s.shape[1])},t.prototype.isExponentOf2=function(t){return 0==(t&t-1)},t.prototype.fftRadix2=function(m,e,t){if(1===e)return m;var n=m.dataSync(),r=e/2,o=Zt(n),a=li(o.real,o.imag).as1D(),i=Jt(n),s=li(i.real,i.imag).as1D();a=this.fftRadix2(a,r,t),s=this.fftRadix2(s,r,t);var u=aa(e,t),c=li(u.real,u.imag).mul(s),l=a.add(c),p=a.sub(c),d=ui(l).concat(ui(p)),h=ci(l).concat(ci(p));return li(d,h).as1D()},t.prototype.fourierTransformByMatmul=function(p,e,t){for(var n=new Float32Array(2*e),r=0;r<e;r++){for(var o=0,a=0,i=0;i<e;i++){var s=oa(r*i,e,t),d=ea(p,i);o+=d.real*s.real-d.imag*s.imag,a+=d.real*s.imag+d.imag*s.real}t&&(o/=e,a/=e),ta(n,o,a,r)}return n},t.prototype.depthToSpace=function(b,e,t){A("NHWC"===t,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+t}),A(1<e,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var n=b.shape[0],r=b.shape[1],o=b.shape[2],a=b.shape[3],i=r*e,s=o*e,u=a/(e*e),c=b.dataSync(),l=new Float32Array(n*i*s*u),p=0,d=0;d<n;++d)for(var h=0;h<i;++h)for(var f=$(h/e),m=h%e,g=0;g<s;++g)for(var v=$(g/e),y=(m*e+g%e)*u,x=0,C;x<u;++x)C=x+y+a*(v+o*(f+r*d)),l[p++]=c[C];return Vt(l,[n,i,s,u])},t.prototype.broadcastedBinaryOp=function(y,e,t,x){var n=ha(y.shape,e.shape),r=Ln(n,t),a=y.dataSync(),i=e.dataSync(),s=ua(y.shape,n),u=ua(e.shape,n),c=r.values;if(0===s.length+u.length)for(var o=0;o<c.length;++o)c[o]=x(a[o%a.length],i[o%i.length]);else{var l=y.bufferSync(),d=e.bufferSync(),p=function(t){var n=r.indexToLoc(t),o=n.slice(-y.rank);s.forEach(function(t){return o[t]=0});var p=l.locToIndex(o),h=n.slice(-e.rank);u.forEach(function(t){return h[t]=0});var m=d.locToIndex(h);c[t]=x(a[p],i[m])};for(o=0;o<c.length;++o)p(o)}return r.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(x,e,t){var n=ha(x.shape,e.shape),b=Ln(n,"float32"),o=Ln(n,"float32"),C=x.dataSync(),i=e.dataSync(),s=ua(x.shape,n),u=ua(e.shape,n),c=b.values,l=o.values;if(0===s.length+u.length)for(var a=0;a<c.length;a++){var r=a%C.length,p=a%i.length,d=t(C[2*r],C[2*r+1],i[2*p],i[2*p+1]);c[a]=d.real,l[a]=d.imag}else{var R=this.data.get(x.dataId).complexTensors.real.bufferSync(),g=this.data.get(e.dataId).complexTensors.real.bufferSync(),h=function(o){var n=b.indexToLoc(o),a=n.slice(-x.rank);s.forEach(function(t){return a[t]=0});var r=R.locToIndex(a),p=n.slice(-e.rank);u.forEach(function(t){return p[t]=0});var d=g.locToIndex(p),h=t(C[2*r],C[2*r+1],i[2*d],i[2*d+1]);c[o]=h.real,l[o]=h.imag};for(a=0;a<c.length;a++)h(a)}return this.complex(b.toTensor(),o.toTensor())},t.prototype.split=function(a,e,t){return sa(a,e,t)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.cropAndResize=function(Y,e,t,n,r,o){for(var a=Y.shape,i=a[0],s=a[1],u=a[2],c=a[3],l=e.shape[0],p=n[0],d=n[1],h=Ln([l,p,d,c],Y.dtype),f=e.dataSync(),m=t.dataSync(),g=Y.dataSync(),v=Y.strides,y=h.strides,x=0;x<l;x++){var E=4*x,T=f[E],b=f[E+1],w=f[E+2],S=f[E+3],C=m[x];if(!(C>=i))for(var A=1<p?(w-T)*(s-1)/(p-1):0,N=1<d?(S-b)*(u-1)/(d-1):0,Q=0,R;Q<p;Q++)if(R=1<p?T*(s-1)+Q*A:.5*(T+w)*(s-1),0>R||R>s-1)for(var I=0;I<d;I++)for(var k=0,D;k<c;k++)D=k+I*y[2]+Q*y[1]+x*y[0],h.values[D]=o;else if("bilinear"===r){var O=$(R),P=pe(R),M=R-O;for(I=0;I<d;I++)if(0>(H=1<d?b*(u-1)+I*N:.5*(b+S)*(u-1))||H>u-1)for(k=0;k<c;k++)D=k+I*y[2]+Q*y[1]+x*y[0],h.values[D]=o;else{var F=$(H),L=pe(H),B=H-F;for(k=0;k<c;k++){var V=g[D=k+F*v[2]+O*v[1]+C*v[0]],U=g[D=k+L*v[2]+O*v[1]+C*v[0]],z=g[D=k+F*v[2]+P*v[1]+C*v[0]],W=V+(U-V)*B,G=z+(g[D=k+L*v[2]+P*v[1]+C*v[0]]-z)*B;D=k+I*y[2]+Q*y[1]+x*y[0],h.values[D]=W+(G-W)*M}}}else for(I=0;I<d;++I){var H;if(0>(H=1<d?b*(u-1)+I*N:.5*(b+S)*(u-1))||H>u-1)for(k=0;k<c;k++)D=k+I*y[2]+Q*y[1]+x*y[0],h.values[D]=o;else{var q=_(H),Z=_(R);for(k=0;k<c;k++){var K=k+q*v[2]+Z*v[1]+C*v[0],X=k+I*y[2]+Q*y[1]+x*y[0];h.values[X]=g[K]}}}}return h.toTensor()},t.prototype.sparseToDense=function(p,e,t,n){var r=wt(e,p,t),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,d=r.outputSize;return this.scatter(p,e,t,d,i,a,o,s,n,!1)},t.prototype.gatherND=function(y,e){var t=e.shape,n=t[t.length-1],r=St(y,e),o=r[0],a=r[1],i=r[2],s=r[3];if(0===a)return Mt([],o,y.dtype);for(var u=new Ns([a,i],y.dtype),c=e.dataSync(),l=y.dataSync(),p=0;p<a;p++){for(var d=[],h=0,f=0,m;f<n;f++)m=c[p*n+f],h+=m*s[f],d.push(m);if(0>h||h>=y.size/i)throw new Error("Invalid indices: "+d+" does not index into "+y.shape);for(var g=0;g<i;g++)u.values[p*i+g]=l[h*i+g]}return u.toTensor().reshape(o)},t.prototype.scatterND=function(p,e,t){var n=wt(e,p,t),r=n.sliceRank,o=n.numUpdates,a=n.sliceSize,i=n.strides,s=n.outputSize,d=Wt(0);return this.scatter(p,e,t,s,a,o,r,i,d,!0)},t.prototype.fill=function(a,e,t){var o=Y(t=t||se(e),U(a));return o.fill(e),Os.make(a,{values:o},t)},t.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},t.prototype.zerosLike=function(a){var e=Y(a.dtype,U(a.shape));return Os.make(a.shape,{values:e},a.dtype)},t.prototype.scatter=function(l,e,t,n,r,o,a,i,s,u){var c=l.dataSync(),p=e.dataSync();if(0===n)return Mt([],t,e.dtype);var d=new Ns([n/r,r],e.dtype);d.values.fill(s.dataSync()[0]);for(var h=0;h<o;h++){for(var f=[],m=0,g=0,b;g<a;g++)b=c[h*a+g],f.push(b),m+=b*i[g];if(0>m||m>=n/r)throw new Error("Invalid indices: "+f+" does not index into "+t);for(var y=0;y<r;y++)u?d.values[m*r+y]+=p[h*r+y]:d.values[m*r+y]=0===e.rank?p[0]:p[h*r+y]}return d.toTensor().reshape(t)},t}();ei.registerBackend("cpu",function(){return new Zc},1);var Jc="undefined"==typeof requestAnimationFrame?"undefined"==typeof e?function(t){return t()}:e:requestAnimationFrame,eh={float32:4,int32:4,uint16:2,uint8:1,bool:1},th="undefined"!=typeof f&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa),ah=function(){function a(){this.saveRouters=[],this.loadRouters=[]}return a.getInstance=function(){return null==a.instance&&(a.instance=new a),a.instance},a.registerSaveRouter=function(e){a.getInstance().saveRouters.push(e)},a.registerLoadRouter=function(e){a.getInstance().loadRouters.push(e)},a.getSaveHandlers=function(e){return a.getHandlers(e,"save")},a.getLoadHandlers=function(e,t){return a.getHandlers(e,"load",t)},a.getHandlers=function(s,e,t){var r=[];return("load"===e?a.getInstance().loadRouters:a.getInstance().saveRouters).forEach(function(a){var e=a(s,t);null!==e&&r.push(e)}),r},a}(),oh="://",nh=function(){function a(){this.managers={}}return a.getInstance=function(){return null==a.instance&&(a.instance=new a),a.instance},a.registerManager=function(e,t){A(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(oh)&&(e=e.slice(0,e.indexOf(oh))),A(0<e.length,function(){return"scheme must not be an empty string."});var o=a.getInstance();A(null==o.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),o.managers[e]=t},a.getManager=function(a){var e=this.getInstance().managers[a];if(null==e)throw new Error("Cannot find model manager for scheme '"+a+"'");return e},a.getSchemes=function(){return Object.keys(this.getInstance().managers)},a}(),rh="tensorflowjs",sh=1,ih="models_store",ph="model_info_store",dh=function(){function t(t){if(this.indexedDB=es(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return x(this,void 0,void 0,function(){return R(this,function(){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return x(this,void 0,void 0,function(){return R(this,function(){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(a,h){var m=this;return new Promise(function(n,e){var r=m.indexedDB.open(rh,sh);r.onupgradeneeded=function(){return ts(r)},r.onsuccess=function(){var g=r.result;if(null==h){var a=g.transaction(ih,"readonly"),o=a.objectStore(ih).get(m.modelPath);o.onsuccess=function(){return null==o.result?(g.close(),e(new Error("Cannot find model with path '"+m.modelPath+"' in IndexedDB."))):void n(o.result.modelArtifacts)},o.onerror=function(){return g.close(),e(o.error)},a.oncomplete=function(){return g.close()}}else{var s=Qr(h),i=g.transaction(ph,"readwrite"),l=i.objectStore(ph),p=l.put({modelPath:m.modelPath,modelArtifactsInfo:s}),d;p.onsuccess=function(){var a=(d=g.transaction(ih,"readwrite")).objectStore(ih).put({modelPath:m.modelPath,modelArtifacts:h,modelArtifactsInfo:s});a.onsuccess=function(){return n({modelArtifactsInfo:s})},a.onerror=function(){var o=(l=i.objectStore(ph)).delete(m.modelPath);o.onsuccess=function(){return g.close(),e(a.error)},o.onerror=function(){return g.close(),e(a.error)}}},p.onerror=function(){return g.close(),e(p.error)},i.oncomplete=function(){null==d?g.close():d.oncomplete=function(){return g.close()}}}},r.onerror=function(){return e(r.error)}})},t.URL_SCHEME="indexeddb://",t}(),lh=function(t){return ei.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(dh.URL_SCHEME)?as(t.slice(dh.URL_SCHEME.length)):null};ah.registerSaveRouter(lh),ah.registerLoadRouter(lh);var uh=function(){function t(){this.indexedDB=es()}return t.prototype.listModels=function(){return x(this,void 0,void 0,function(){var a=this;return R(this,function(){return[2,new Promise(function(s,t){var n=a.indexedDB.open(rh,sh);n.onupgradeneeded=function(){return ts(n)},n.onsuccess=function(){var r=n.result,e=r.transaction(ph,"readonly"),i=e.objectStore(ph).getAll();i.onsuccess=function(){for(var t={},e=0,a=i.result,n;e<a.length;e++)n=a[e],t[n.modelPath]=n.modelArtifactsInfo;s(t)},i.onerror=function(){return r.close(),t(i.error)},e.oncomplete=function(){return r.close()}},n.onerror=function(){return t(n.error)}})]})})},t.prototype.removeModel=function(p){return x(this,void 0,void 0,function(){var e=this;return R(this,function(){return p=os(p),[2,new Promise(function(t,n){var r=e.indexedDB.open(rh,sh);r.onupgradeneeded=function(){return ts(r)},r.onsuccess=function(){var e=r.result,a=e.transaction(ph,"readwrite"),d=a.objectStore(ph),s=d.get(p),i;s.onsuccess=function(){if(null==s.result)return e.close(),n(new Error("Cannot find model with path '"+p+"' in IndexedDB."));var a=d.delete(p),o=function(){var a=(i=e.transaction(ih,"readwrite")).objectStore(ih).delete(p);a.onsuccess=function(){return t(s.result.modelArtifactsInfo)},a.onerror=function(){return n(s.error)}};a.onsuccess=o,a.onerror=function(){return o(),e.close(),n(s.error)}},s.onerror=function(){return e.close(),n(s.error)},a.oncomplete=function(){null==i?e.close():i.oncomplete=function(){return e.close()}}},r.onerror=function(){return n(r.error)}})]})})},t}();if(ei.get("IS_BROWSER"))try{nh.registerManager(dh.URL_SCHEME,new uh)}catch(t){}var ch="/",hh="tensorflowjs_models",mh="info",gh="model_topology",fh="weight_specs",yh="weight_data",xh="model_metadata",bh=function(){function t(t){if(!ei.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=ns(this.modelPath)}return t.prototype.save=function(a){return x(this,void 0,void 0,function(){var e,t,o;return R(this,function(){if(a.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(a.modelTopology),t=JSON.stringify(a.weightSpecs),o=Qr(a);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,t),this.LS.setItem(this.keys.weightData,Kr(a.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy})),[2,{modelArtifactsInfo:o}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return x(this,void 0,void 0,function(){var s,e,t,n,r,o,a;return R(this,function(){if(null==(s=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==s.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(t=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=t,null==(n=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=n,null!=(r=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(r),e.format=o.format,e.generatedBy=o.generatedBy,e.convertedBy=o.convertedBy),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=jr(a),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),vh=function(t){return ei.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(bh.URL_SCHEME)?is(t.slice(bh.URL_SCHEME.length)):null};ah.registerSaveRouter(vh),ah.registerLoadRouter(vh);var Ch=function(){function t(){A(ei.get("IS_BROWSER"),function(){return"Current environment is not a web browser"}),A(void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return x(this,void 0,void 0,function(){var s,e,t,n,r,o;return R(this,function(){for(s={},e=hh+ch,t=ch+mh,n=0;n<this.LS.length;++n)(r=this.LS.key(n)).startsWith(e)&&r.endsWith(t)&&(o=rs(r),s[o]=JSON.parse(this.LS.getItem(r)));return[2,s]})})},t.prototype.removeModel=function(a){return x(this,void 0,void 0,function(){var e,t;return R(this,function(){if(a=ss(a),e=ns(a),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+a+"'");return t=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,t]})})},t}();if(ei.get("IS_BROWSER"))try{nh.registerManager(bh.URL_SCHEME,new Ch)}catch(t){}var Rh=function(){function a(e){if(!ei.get("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(a.URL_SCHEME)&&(e=e.slice(a.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return a.prototype.save=function(s){return x(this,void 0,void 0,function(){var e,t,p,r,o,a;return R(this,function(){if(e=window.URL.createObjectURL(new Blob([s.weightData],{type:"application/octet-stream"})),s.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");return t=[{paths:["./"+this.weightDataFileName],weights:s.weightSpecs}],p={modelTopology:s.modelTopology,format:s.format,generatedBy:s.generatedBy,convertedBy:s.convertedBy,weightsManifest:t},r=window.URL.createObjectURL(new Blob([JSON.stringify(p)],{type:"application/json"})),(o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=r,o.click(),null!=s.weightData&&((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=e,a.click()),[2,{modelArtifactsInfo:Qr(s)}]})})},a.URL_SCHEME="downloads://",a}(),Sh=function(){function t(t){if(null==t||1>t.length)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return x(this,void 0,void 0,function(){var a=this,n,e;return R(this,function(){return n=this.files[0],e=this.files.slice(1),[2,new Promise(function(h,t){var o=new FileReader;o.onload=function(o){var r=JSON.parse(o.target.result),i=r.modelTopology;if(null!=i){0===e.length&&h({modelTopology:i});var m=r.weightsManifest;if(null!=m){var u;try{u=a.checkManifestAndWeightFiles(m,e)}catch(a){return void t(a)}var c=[],g=[],p=[];m.forEach(function(t){t.paths.forEach(function(t){g.push(t),p.push(null)}),c.push.apply(c,t.weights)}),m.forEach(function(a){a.paths.forEach(function(a){var e=new FileReader;e.onload=function(e){var t=e.target.result,n=g.indexOf(a);p[n]=t,-1===p.indexOf(null)&&h({modelTopology:i,weightSpecs:c,weightData:Xr(p)})},e.onerror=function(){return t("Failed to weights data from file of path '"+a+"'.")},e.readAsArrayBuffer(u[a])})})}else t(new Error("weightManifest field is missing from file "+n.name))}else t(new Error("modelTopology field is missing from file "+n.name))},o.onerror=function(){return t("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},o.readAsText(n)})]})})},t.prototype.checkManifestAndWeightFiles=function(s,p){for(var t=[],n=p.map(function(t){return Yr(t.name)}),r={},e=0,a=s;e<a.length;e++)a[e].paths.forEach(function(o){var e=Yr(o);if(-1!==t.indexOf(e))throw new Error("Duplicate file basename found in weights manifest: '"+e+"'");if(t.push(e),-1===n.indexOf(e))throw new Error("Weight file with basename '"+e+"' is not provided.");r[o]=p[n.indexOf(e)]});if(t.length!==p.length)throw new Error("Mismatch in the number of files in weights manifest ("+t.length+") and the number of weight files provided ("+p.length+").");return r},t}();ah.registerSaveRouter(function(t){return ei.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Rh.URL_SCHEME)?ps(t.slice(Rh.URL_SCHEME.length)):null});var Eh=function(){function t(a,o){if(this.DEFAULT_METHOD="POST",null==o&&(o={}),this.weightPathPrefix=o.weightPathPrefix,this.onProgress=o.onProgress,null==o.fetchFunc){var t=ei.global.fetch;if(void 0===t)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");o.fetchFunc=t.bind(ei.global)}else A("function"==typeof o.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"});if(this.fetchFunc=function(a,e){return o.fetchFunc(a,e).catch(function(e){throw new Error("Request for "+a+" failed due to error: "+e)})},A(null!=a&&0<a.length,function(){return"URL path for browserHTTPRequest must not be null, undefined or empty."}),Array.isArray(a)&&A(2===a.length,function(){return"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+a.length+")."}),this.path=a,null!=o.requestInit&&null!=o.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=o.requestInit||{}}return t.prototype.save=function(s){return x(this,void 0,void 0,function(){var e,t,i,r;return R(this,function(o){switch(o.label){case 0:if(s.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t=[{paths:["./model.weights.bin"],weights:s.weightSpecs}],i={modelTopology:s.modelTopology,format:s.format,generatedBy:s.generatedBy,convertedBy:s.convertedBy,weightsManifest:t},e.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),null!=s.weightData&&e.body.append("model.weights.bin",new Blob([s.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.getFetchFunc()(this.path,e)];case 1:if((r=o.sent()).ok)return[2,{modelArtifactsInfo:Qr(s),responses:[r]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+r.status+".");}})})},t.prototype.load=function(){return x(this,void 0,void 0,function(){var p,e,t,n,d,o,l,c;return R(this,function(s){switch(s.label){case 0:return[4,this.getFetchFunc()(this.path,this.requestInit)];case 1:if(!(p=s.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+p.status+". Please verify this URL points to the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,p.json()];case 3:return e=s.sent(),[3,5];case 4:throw s.sent(),t="Failed to parse model JSON of response from "+this.path+".",t+=this.path.endsWith(".pb")?" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":" Please make sure the server is serving valid JSON for this request.",new Error(t);case 5:if(n=e.modelTopology,d=e.weightsManifest,null==n&&null==d)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==d?[3,7]:[4,this.loadWeights(d)];case 6:c=s.sent(),o=c[0],l=c[1],s.label=7;case 7:return[2,{modelTopology:n,weightSpecs:o,weightData:l}];}})})},t.prototype.loadWeights=function(h){return x(this,void 0,void 0,function(){var e,t,n,r,o,a,i,s,d,u,l;return R(this,function(p){switch(p.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,t=cs(e),n=t[0],r=t[1],o=this.weightPathPrefix||n,a=[],i=0,s=h;i<s.length;i++)d=s[i],a.push.apply(a,d.weights);return u=[],h.forEach(function(t){t.paths.forEach(function(t){u.push(o+t+r)})}),[4,ls(u,{requestInit:this.requestInit,fetchFunc:this.getFetchFunc(),onProgress:this.onProgress})];case 1:return l=p.sent(),[2,[a,Xr(l)]];}})})},t.prototype.getFetchFunc=function(){return this.fetchFunc},t.URL_SCHEME_REGEX=/^https?:\/\//,t}(),_h=function(a,e){return"undefined"==typeof fetch?null:(Array.isArray(a)?a.every(function(t){return hs(t)}):hs(a))?ms(a,{onProgress:e}):null};ah.registerSaveRouter(_h),ah.registerLoadRouter(_h);var kh=function(){function t(a,o,t){this.modelTopology=a,this.weightSpecs=o,this.weightData=t}return t.prototype.load=function(){return x(this,void 0,void 0,function(){var t;return R(this,function(){return t={},null!=this.modelTopology&&(t=vs({modelTopology:this.modelTopology},t)),null!=this.weightSpecs&&0<this.weightSpecs.length&&(t=vs({weightSpecs:this.weightSpecs},t)),null!=this.weightData&&0<this.weightData.byteLength&&(t=vs({weightData:this.weightData},t)),[2,t]})})},t}(),wh=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return x(this,void 0,void 0,function(){return R(this,function(){return[2,this.saveHandler(t)]})})},t}(),Ih=Object.freeze({browserFiles:function(t){return new Sh(t)},browserHTTPRequest:ms,concatenateArrayBuffers:Xr,decodeWeights:Vr,encodeWeights:function(a){return x(this,void 0,void 0,function(){var e,s,n,i;return R(this,function(o){switch(o.label){case 0:for(n in e=[],s=[],a){if("float32"!==(i=a[n]).dtype&&"int32"!==i.dtype&&"bool"!==i.dtype)throw new Error("Unsupported dtype in weight '"+n+"': "+i.dtype);e.push({name:n,shape:i.shape,dtype:i.dtype}),s.push(i.data())}return[4,Promise.all(s)];case 1:return[2,{data:Hr(o.sent()),specs:e}];}})})},fromMemory:function(a,e,t){return new kh(a,e,t)},getLoadHandlers:function(t){return ah.getLoadHandlers(t)},getModelArtifactsInfoForJSON:Qr,getSaveHandlers:function(t){return ah.getSaveHandlers(t)},isHTTPScheme:hs,loadWeights:function(a,e,t,o){return void 0===e&&(e=""),x(this,void 0,void 0,function(){return R(this,function(){return[2,us(function(t){return ls(t,{requestInit:o})})(a,e,t)]})})},registerLoadRouter:function(t){return ah.registerLoadRouter(t)},registerSaveRouter:function(t){return ah.registerSaveRouter(t)},weightsLoaderFactory:us,withSaveHandler:function(t){return new wh(t)},copyModel:function(a,e){return x(this,void 0,void 0,function(){return R(this,function(t){switch(t.label){case 0:return[4,Jr(a,e,!1)];case 1:return[2,t.sent()];}})})},listModels:function(){return x(this,void 0,void 0,function(){var p,e,t,n,r,o,a;return R(this,function(i){switch(i.label){case 0:p=nh.getSchemes(),e={},t=0,n=p,i.label=1;case 1:return t<n.length?(r=n[t],[4,nh.getManager(r).listModels()]):[3,4];case 2:for(a in o=i.sent())e[r+oh+a]=o[a];i.label=3;case 3:return t++,[3,1];case 4:return[2,e];}})})},moveModel:function(a,e){return x(this,void 0,void 0,function(){return R(this,function(t){switch(t.label){case 0:return[4,Jr(a,e,!0)];case 1:return[2,t.sent()];}})})},removeModel:function(a){return x(this,void 0,void 0,function(){var e;return R(this,function(t){switch(t.label){case 0:return e=Zr(a),[4,nh.getManager(e.scheme).removeModel(e.path)];case 1:return[2,t.sent()];}})})}}),io=Lt({confusionMatrix_:function(s,e,t){var n=ot(s,"labels","confusionMatrix"),r=ot(e,"predictions","confusionMatrix");A(null==t||0<t&&h(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),A(1===n.rank,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),A(1===r.rank,function(){return"Expected the rank of predictions to be 1, but got "+r.rank}),A(n.shape[0]===r.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+r.shape[0]+". Labels and predictions should have the same number of elements."}),A(0<t&&h(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=Fd(n.asType("int32"),t),a=Fd(r.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}}),Nh=Object.freeze({confusionMatrix:io}),Th=Lt({fromPixels_:function(a,e){if(void 0===e&&(e=3),4<e)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return ei.engine.fromPixels(a,e)}}),Dh=Object.freeze({toPixels:function(C,e){return x(this,void 0,void 0,function(){var t,n,r,o,a,i,s,u,c,l,p,d,h,f,m,g,v,y,x,S;return R(this,function(R){switch(R.label){case 0:if(t=ot(C,"img","toPixels"),C instanceof Os||(t=t.toInt()),2!==t.rank&&3!==t.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),r=n[0],o=n[1],4<(a=2===t.rank?1:t.shape[2])||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return i=t.min(),s=t.max(),[4,i.data()];case 1:return u=R.sent()[0],[4,s.data()];case 2:if(!(c=R.sent()[0],i.dispose(),s.dispose(),"float32"===t.dtype)){if("int32"!==t.dtype)throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(0>u||255<c)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+u+" - "+c+"].")}else if(0>u||1<c)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+u+" - "+c+"].");return[4,t.data()];case 3:for(l=R.sent(),p="float32"===t.dtype?255:1,d=new Uint8ClampedArray(4*(o*r)),h=0;h<r*o;++h)f=void 0,m=void 0,g=void 0,v=void 0,1===a?(f=l[h]*p,m=l[h]*p,g=l[h]*p,v=255):3===a?(f=l[3*h]*p,m=l[3*h+1]*p,g=l[3*h+2]*p,v=255):4===a&&(f=l[4*h]*p,m=l[4*h+1]*p,g=l[4*h+2]*p,v=l[4*h+3]*p),d[(y=4*h)+0]=_(f),d[y+1]=_(m),d[y+2]=_(g),d[y+3]=_(v);return null!=e&&(e.width=o,e.height=r,x=e.getContext("2d"),S=new ImageData(d,o,r),x.putImageData(S,0,0)),t!==C&&t.dispose(),[2,d];}})})},fromPixels:Th}),Ah=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(a,e){return new a(e)},t}(),Oh=function(){function a(){this.classNameMap={}}return a.getMap=function(){return null==a.instance&&(a.instance=new a),a.instance},a.register=function(e){a.getMap().classNameMap[e.className]=[e,e.fromConfig]},a}(),Ph=Object.freeze({Serializable:Ah,SerializationMap:Oh,registerClass:gs}),Fh=Object.freeze({WEBGL_ENVS:{HAS_WEBGL:!0},PACKED_ENVS:{WEBGL_PACK:!0},NODE_ENVS:{IS_NODE:!0},CHROME_ENVS:{IS_CHROME:!0},BROWSER_ENVS:{IS_BROWSER:!0},CPU_ENVS:{HAS_WEBGL:!1},ALL_ENVS:{},expectArraysClose:fs,expectPromiseToFail:function(a,e){a().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(a,e){var o="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return a instanceof Os&&"string"===a.dtype||e instanceof Os&&"string"===e.dtype||Array.isArray(a)&&oe(a[0])||Array.isArray(e)&&oe(e[0])?ys(a,o,function(a,e){return a==e}):fs(a,e,0)},expectNumbersClose:function(a,e,t){if(null==t&&(t=ei.get("TEST_EPSILON")),!xs(a,e,t))throw new Error("Numbers differ: actual === "+a+", expected === "+e)},expectValuesInRange:function(a,e,t){var n=a instanceof Os?a.dataSync():a;for(var r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error("Value out of range:"+n[r]+" low: "+e+", high: "+t)},expectArrayBuffersEqual:function(a,e){expect(new Float32Array(a)).toEqual(new Float32Array(e))}}),Bh=Object.freeze({gpgpu_util:mp,webgl_util:hp,MathBackendWebGL:Jd,GPGPUContext:gp}),Lh=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}return y(e,a),e.prototype.minimize=function(s,e,t){void 0===e&&(e=!1);var n=this.computeGradients(s,t),r=n.value,o=n.grads;return this.applyGradients(o),Object.keys(o).forEach(function(t){return o[t].dispose()}),e?r:(r.dispose(),null)},e.prototype.computeGradients=function(a,e){return rt(a,e)},e.prototype.dispose=function(){},e}(Ah);Object.defineProperty(Lh,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var Mh=function(a){function e(e,s,n){void 0===n&&(n=null);var r=a.call(this)||this;return r.learningRate=e,r.rho=s,r.epsilon=n,r.accumulatedGrads={},r.accumulatedUpdates={},r.c=oi(Wt(-e)),r.rhoScalar=oi(Wt(s)),r.oneMinusRho=oi(Wt(1-s)),null===n&&(n=ei.get("EPSILON")),r.epsilonScalar=oi(Wt(n)),r}return y(e,a),e.prototype.applyGradients=function(p){var d=this,e=function(l){var n=ei.engine.registeredVariables[l];null==t.accumulatedGrads[l]&&ai(function(){d.accumulatedGrads[l]=mi(n).variable(!1)}),null==t.accumulatedUpdates[l]&&ai(function(){d.accumulatedUpdates[l]=mi(n).variable(!1)});var o=p[l],a=t.accumulatedGrads[l],i=t.accumulatedUpdates[l];ai(function(){var t=d.rhoScalar.mul(a).add(d.oneMinusRho.mul(o.square())),e=i.add(d.epsilonScalar).sqrt().div(a.add(d.epsilonScalar).sqrt()).mul(o),r=d.rhoScalar.mul(i).add(d.oneMinusRho.mul(e.square()));d.accumulatedGrads[l].assign(t),d.accumulatedUpdates[l].assign(r);var s=d.c.mul(e).add(n);n.assign(s)})},t=this;for(var a in p)e(a)},e.prototype.dispose=function(){var a=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return a.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return a.accumulatedGrads[e].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(a,e){return new a(e.learningRate,e.rho,e.epsilon)},e.className="AdadeltaOptimizer",e}(Lh);gs(Mh);var Wh=function(a){function e(e,o){void 0===o&&(o=.1);var n=a.call(this)||this;return n.learningRate=e,n.initialAccumulatorValue=o,n.accumulatedGrads={},n.c=oi(Wt(-e)),n.epsilon=oi(Wt(ei.get("EPSILON"))),n}return y(e,a),e.prototype.applyGradients=function(s){var p=this,e=function(d){var n=ei.engine.registeredVariables[d];null==t.accumulatedGrads[d]&&ai(function(){p.accumulatedGrads[d]=$t(n.shape,p.initialAccumulatorValue).variable(!1)});var o=s[d],a=t.accumulatedGrads[d];ai(function(){var t=a.add(o.square());p.accumulatedGrads[d].assign(t);var e=p.c.mul(o.div(t.add(p.epsilon).sqrt())).add(n);n.assign(e)})},t=this;for(var a in s)e(a)},e.prototype.dispose=function(){var a=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return a.accumulatedGrads[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(a,e){return new a(e.learningRate,e.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(Lh);gs(Wh);var Uh=function(s){function e(e,i,n,r){void 0===r&&(r=null);var o=s.call(this)||this;return o.learningRate=e,o.beta1=i,o.beta2=n,o.epsilon=r,o.accumulatedFirstMoment={},o.accumulatedSecondMoment={},o.c=oi(Wt(-e)),o.beta1Scalar=oi(Wt(i)),o.beta2Scalar=oi(Wt(n)),ai(function(){o.accBeta1=Wt(i).variable(),o.accBeta2=Wt(n).variable()}),o.oneMinusBeta1=oi(Wt(1-i)),o.oneMinusBeta2=oi(Wt(1-n)),o.one=oi(Wt(1)),null===r&&(r=ei.get("EPSILON")),o.epsScalar=oi(Wt(r)),o}return y(e,s),e.prototype.applyGradients=function(m){var e=this;ai(function(){var t=e.one.sub(e.accBeta1),n=e.one.sub(e.accBeta2);for(var r in m){var o=ei.engine.registeredVariables[r];if(null==e.accumulatedFirstMoment[r]){var a=!1;e.accumulatedFirstMoment[r]=mi(o).variable(a)}null==e.accumulatedSecondMoment[r]&&(a=!1,e.accumulatedSecondMoment[r]=mi(o).variable(a));var i=m[r],s=e.accumulatedFirstMoment[r],u=e.accumulatedSecondMoment[r],c=e.beta1Scalar.mul(s).add(e.oneMinusBeta1.mul(i)),l=e.beta2Scalar.mul(u).add(e.oneMinusBeta2.mul(i.square())),p=c.div(t),d=l.div(n);e.accumulatedFirstMoment[r].assign(c),e.accumulatedSecondMoment[r].assign(l);var h=e.c.mul(p.div(e.epsScalar.add(d.sqrt()))).add(o);o.assign(h)}e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar)),e.accBeta2.assign(e.accBeta2.mul(e.beta2Scalar))})},e.prototype.dispose=function(){var a=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return a.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(e){return a.accumulatedSecondMoment[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(a,e){return new a(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="AdamOptimizer",e}(Lh);gs(Uh);var zh=function(s){function e(e,p,n,r,o){void 0===r&&(r=null),void 0===o&&(o=0);var a=s.call(this)||this;return a.learningRate=e,a.beta1=p,a.beta2=n,a.epsilon=r,a.decay=o,a.accumulatedFirstMoment={},a.accumulatedWeightedInfNorm={},a.c=oi(Wt(-e)),a.beta1Scalar=oi(Wt(p)),a.beta2Scalar=oi(Wt(n)),a.decayScalar=oi(Wt(o)),ai(function(){a.iteration=Wt(0).variable(),a.accBeta1=Wt(p).variable()}),a.oneMinusBeta1=oi(Wt(1-p)),a.one=oi(Wt(1)),null===r&&(r=ei.get("EPSILON")),a.epsScalar=oi(Wt(r)),a}return y(e,s),e.prototype.applyGradients=function(m){var e=this;ai(function(){var t=e.one.sub(e.accBeta1),n=e.c.div(e.one.add(e.decayScalar.mul(e.iteration)));for(var r in m){var o=ei.engine.registeredVariables[r];if(null==e.accumulatedFirstMoment[r]){var a=!1;e.accumulatedFirstMoment[r]=mi(o).variable(a)}null==e.accumulatedWeightedInfNorm[r]&&(a=!1,e.accumulatedWeightedInfNorm[r]=mi(o).variable(a));var i=m[r],s=e.accumulatedFirstMoment[r],u=e.accumulatedWeightedInfNorm[r],c=e.beta1Scalar.mul(s).add(e.oneMinusBeta1.mul(i)),l=e.beta2Scalar.mul(u),p=i.abs(),d=l.maximum(p);e.accumulatedFirstMoment[r].assign(c),e.accumulatedWeightedInfNorm[r].assign(d);var h=n.div(t).mul(c.div(e.epsScalar.add(d))).add(o);o.assign(h)}e.iteration.assign(e.iteration.add(e.one)),e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar))})},e.prototype.dispose=function(){var a=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return a.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(e){return a.accumulatedWeightedInfNorm[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(a,e){return new a(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="AdamaxOptimizer",e}(Lh);gs(zh);var Gh=function(a){function e(e){var o=a.call(this)||this;return o.learningRate=e,o.setLearningRate(e),o}return y(e,a),e.prototype.applyGradients=function(a){var n=this;Object.keys(a).forEach(function(e){var t=a[e],r=ei.engine.registeredVariables[e];ai(function(){var a=n.c.mul(t).add(r);r.assign(a)})})},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=oi(Wt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(a,e){return new a(e.learningRate)},e.className="SGDOptimizer",e}(Lh);gs(Gh);var Vh=function(a){function e(e,s,n){void 0===n&&(n=!1);var r=a.call(this,e)||this;return r.learningRate=e,r.momentum=s,r.useNesterov=n,r.m=Wt(r.momentum),r.accumulations={},r}return y(e,a),e.prototype.applyGradients=function(s){var p=this,e=function(d){var n=ei.engine.registeredVariables[d];null==t.accumulations[d]&&ai(function(){p.accumulations[d]=mi(n).variable(!1)});var o=t.accumulations[d],a=s[d];ai(function(){var t=p.m.mul(o).add(a),r;r=p.useNesterov?p.c.mul(a.add(t.mul(p.m))).add(n):p.c.mul(t).add(n),p.accumulations[d].assign(t),n.assign(r)})},t=this;for(var a in s)e(a)},e.prototype.dispose=function(){if(a.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var e in this.accumulations)this.accumulations[e].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(a,e){return new a(e.learningRate,e.momentum,e.useNesterov)},e.className="MomentumOptimizer",e}(Gh);gs(Vh);var Hh=function(s){function e(e,p,n,r,o){void 0===p&&(p=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1);var a=s.call(this)||this;return a.learningRate=e,a.decay=p,a.momentum=n,a.epsilon=r,a.accumulatedMeanSquares={},a.accumulatedMeanGrads={},a.accumulatedMoments={},a.c=oi(Wt(e)),a.decayScalar=oi(Wt(p)),a.momentumScalar=oi(Wt(n)),a.oneMinusDecay=oi(Wt(1-p)),a.centered=o,null===r&&(r=ei.get("EPSILON")),a.epsilonScalar=oi(Wt(r)),a}return y(e,s),e.prototype.applyGradients=function(p){var d=this,e=function(h){var n=ei.engine.registeredVariables[h];null==t.accumulatedMeanSquares[h]&&ai(function(){d.accumulatedMeanSquares[h]=mi(n).variable(!1)}),null==t.accumulatedMeanGrads[h]&&t.centered&&ai(function(){d.accumulatedMeanGrads[h]=mi(n).variable(!1)}),null==t.accumulatedMoments[h]&&ai(function(){d.accumulatedMoments[h]=mi(n).variable(!1)});var o=t.accumulatedMeanSquares[h],a=t.accumulatedMeanGrads[h],i=t.accumulatedMoments[h],s=p[h];ai(function(){var t=d.decayScalar.mul(o).add(d.oneMinusDecay.mul(s.square()));if(d.centered){var e=d.decayScalar.mul(a).add(d.oneMinusDecay.mul(s)),r=d.momentumScalar.mul(i).add(d.c.mul(s).div(t.sub(e.square().add(d.epsilonScalar)).sqrt()));d.accumulatedMeanSquares[h].assign(t),d.accumulatedMeanGrads[h].assign(e),d.accumulatedMoments[h].assign(r);var u=n.sub(r);n.assign(u)}else{var l=d.decayScalar.mul(o).add(d.oneMinusDecay.mul(s.square()));r=d.momentumScalar.mul(i).add(d.c.mul(s).div(l.add(d.epsilonScalar).sqrt())),d.accumulatedMeanSquares[h].assign(l),d.accumulatedMoments[h].assign(r),u=n.sub(r),n.assign(u)}})},t=this;for(var a in p)e(a)},e.prototype.dispose=function(){var a=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return a.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(e){return a.accumulatedMeanGrads[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return a.accumulatedMoments[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(a,e){return new a(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSPropOptimizer",e}(Lh);gs(Hh);var qh=function(){function t(){}return t.sgd=function(t){return new Gh(t)},t.momentum=function(a,e,t){return void 0===t&&(t=!1),new Vh(a,e,t)},t.rmsprop=function(a,e,t,n,r){return void 0===e&&(e=.9),void 0===t&&(t=0),void 0===n&&(n=null),void 0===r&&(r=!1),new Hh(a,e,t,n,r)},t.adam=function(a,e,t,o){return void 0===a&&(a=.001),void 0===e&&(e=.9),void 0===t&&(t=.999),void 0===o&&(o=null),new Uh(a,e,t,o)},t.adadelta=function(a,e,t){return void 0===a&&(a=.001),void 0===e&&(e=.95),void 0===t&&(t=null),new Mh(a,e,t)},t.adamax=function(a,e,t,n,r){return void 0===a&&(a=.002),void 0===e&&(e=.9),void 0===t&&(t=.999),void 0===n&&(n=null),void 0===r&&(r=0),new zh(a,e,t,n,r)},t.adagrad=function(a,e){return void 0===e&&(e=.1),new Wh(a,e)},t}(),$h={sgd:qh.sgd,momentum:qh.momentum,adadelta:qh.adadelta,adagrad:qh.adagrad,rmsprop:qh.rmsprop,adamax:qh.adamax,adam:qh.adam},Kh=Ys.setBackend,jh=Ys.getBackend,Xh=Ys.disposeVariables,Yh=Ys.memory;(function(t){Ds=t})(Qc)}).call(this,a(123),a(15),a(148).setImmediate,a(119).Buffer)},197:function(e,t,a){"use strict";function o(e){var t="";if(!e)try{e=a(141)}catch(e){t=e.toString()}var o=e?function(t){return new Promise(function(a,o){e.readFile(t,function(e,t){return e?o(e):a(t)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:o}}a.d(t,"a",function(){return o})},283:function(e,t,a){"use strict";(function(e){function o(){var t=e.Canvas||e.HTMLCanvasElement,a=e.Image||e.HTMLImageElement,o=e.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},s=Object(r.a)();return n.a({Canvas:t||function(){return function(){}}(),CanvasRenderingContext2D:e.CanvasRenderingContext2D||function(){return function(){}}(),Image:a||function(){return function(){}}(),ImageData:e.ImageData||function(){return function(){}}(),Video:e.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(a)return new a;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},s)}a.d(t,"a",function(){return o});var n=a(115),r=a(197)}).call(this,a(15))},284:function(e,t,a){"use strict";(function(o,n){function r(){return"object"==typeof o&&!0&&"undefined"!=typeof e&&"undefined"!=typeof n&&!!n.version}a.d(t,"a",function(){return r})}).call(this,a(15),a(123))},285:function(e,t,a){"use strict";function o(e,t){return e instanceof Zt.a&&e.shape.length===t}function n(e){return o(e,2)}function r(e){return o(e,3)}function s(e){return o(e,4)}function i(e){return 0!=e%1}function p(e){return 0==e%2}function d(e,t){void 0===t&&(t=2);var a=Wt(10,t);return zt(e*a)/a}function l(e){return e&&e.width&&e.height}function u(e,t){var a=e.width,o=e.height,n=t/qt(o,a);return new Jt(Gt(a*n),Gt(o*n))}function c(e){return e.reduce(function(e,t){return e.add(t)},new ea(0,0)).div(new ea(e.length,e.length))}function h(e,t,a){return Array(e).fill(0).map(function(e,o){return t+o*a})}function m(e){return!!e&&e!==Infinity&&e!==-Infinity&&!isNaN(e)||0===e}function g(e){return m(e)&&0<=e&&1>=e}function f(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function y(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function x(){if(!ua)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ua}function b(e){ua=e}function v(){y()&&b(f()),Object(da.a)()&&b(Object(pa.a)())}function C(e){if(ua||v(),!ua)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,a=void 0===t?ua.Canvas:t,o=e.Image,n=void 0===o?ua.Image:o;ua.Canvas=a,ua.Image=n,ua.createCanvasElement=e.createCanvasElement||function(){return new a},ua.createImageElement=e.createImageElement||function(){return new n},ua.ImageData=e.ImageData||ua.ImageData,ua.Video=e.Video||ua.Video,ua.fetch=e.fetch||ua.fetch,ua.readFile=e.readFile||ua.readFile}function R(e){return la.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function S(e){var t=la.getEnv(),a=t.Canvas,o=t.CanvasRenderingContext2D;if(e instanceof o)return e;var n=R(e);if(!(n instanceof a))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var r=n.getContext("2d");if(!r)throw new Error("resolveContext2d - canvas 2d context is null");return r}function E(e,t,a,o){return void 0===a&&(a="same"),void 0===o&&(o=!1),Zt.w(function(){var n=Zt.c(Zt.f(e,t.filters,[1,1],a),t.bias);return o?Zt.m(n):n})}function _(e,t){Object.keys(e).forEach(function(a){t.some(function(e){return e.originalPath===a})||e[a].dispose()})}function k(e,t){return function(a,o,n,r){var s=Zt.v(e(a*o*n*n),[n,n,a,o]),i=Zt.t(e(o));return t.push({paramPath:r+"/filters"},{paramPath:r+"/bias"}),{filters:s,bias:i}}}function w(e,t){return function(a,o,n){var r=Zt.u(e(a*o),[a,o]),s=Zt.t(e(o));return t.push({paramPath:n+"/weights"},{paramPath:n+"/bias"}),{weights:r,bias:s}}}function I(e,t){return function(a,o,n){var r=Zt.v(e(9*a),[3,3,a,1]),s=Zt.v(e(a*o),[1,1,a,o]),i=Zt.t(e(o));return t.push({paramPath:n+"/depthwise_filter"},{paramPath:n+"/pointwise_filter"},{paramPath:n+"/bias"}),new ya(r,s,i)}}function N(e){return function(t){var a=e(t+"/depthwise_filter",4),o=e(t+"/pointwise_filter",4),n=e(t+"/bias",1);return new ya(a,o,n)}}function T(e,t){return function(a,n,r){var s=e[a];if(!o(s,n))throw new Error("expected weightMap["+a+"] to be a Tensor"+n+"D, instead have "+s);return t.push({originalPath:a,paramPath:r||a}),s}}function D(e){function t(e){var t=o.slice(0,e);return o=o.slice(e),t}function a(){return o}var o=e;return{extractWeights:t,getRemainingWeights:a}}function A(e,t){var a=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:a};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+a};var o=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(o,"");var n=e.split("/").filter(function(e){return e}),r=e.endsWith(".json")?n[n.length-1]:a,s=o+(e.endsWith(".json")?n.slice(0,n.length-1):n).join("/");return s=e.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:"/"===s?"/"+r:s+"/"+r}}function O(e){var t=la.getEnv(),a=t.Image,o=t.Video;return e instanceof a&&e.complete||e instanceof o&&3<=e.readyState}function P(e){return new Promise(function(t,a){function o(a){a.currentTarget&&(a.currentTarget.removeEventListener("load",o),a.currentTarget.removeEventListener("error",n),t(a))}function n(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",o),t.currentTarget.removeEventListener("error",n),a(t))}return e instanceof la.getEnv().Canvas||O(e)?t():void(e.addEventListener("load",o),e.addEventListener("error",n))})}function F(e){var t=la.getEnv(),a=t.Image,o=t.Video;return e instanceof a?new Jt(e.naturalWidth,e.naturalHeight):e instanceof o?new Jt(e.videoWidth,e.videoHeight):new Jt(e.width,e.height)}function B(e){var t=e.width,a=e.height,o=la.getEnv().createCanvasElement,n=o();return n.width=t,n.height=a,n}function L(e,t){var a=la.getEnv().ImageData;if(!(e instanceof a)&&!O(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var o=t||F(e),n=o.width,r=o.height,s=B({width:n,height:r});return e instanceof a?S(s).putImageData(e,0,0):S(s).drawImage(e,0,0,n,r),s}function M(e,t){return Yt.b(this,void 0,void 0,function(){var a,o;return Yt.d(this,function(n){switch(n.label){case 0:return a=la.getEnv().fetch,[4,a(e,t)];case 1:if(o=n.sent(),!(400>o.status))throw new Error("failed to fetch: ("+o.status+") "+o.statusText+", from url: "+o.url);return[2,o];}})})}function W(e){return Yt.b(this,void 0,void 0,function(){return Yt.d(this,function(t){switch(t.label){case 0:return[4,M(e)];case 1:return[2,t.sent().json()];}})})}function U(e,t){return Yt.b(this,void 0,void 0,function(){var a,o,n,r,i,p;return Yt.d(this,function(d){switch(d.label){case 0:return a=t||la.getEnv().createCanvasElement(),o=e.shape.slice(s(e)?1:0),n=o[0],r=o[1],i=o[2],p=Zt.w(function(){return e.as3D(n,r,i).toInt()}),[4,Zt.d.toPixels(p,a)];case 1:return d.sent(),p.dispose(),[2,a];}})})}function z(e,t,a){void 0===a&&(a=!1);var o=la.getEnv(),n=o.Image,r=o.Canvas;if(!(e instanceof n||e instanceof r))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=F(e),i=t/qt(s.height,s.width),p=i*s.width,d=i*s.height,l=B({width:t,height:t}),u=e instanceof r?e:L(e),c=Ut(p-d)/2,h=a&&p<d?c:0,m=a&&d<p?c:0;return S(l).drawImage(u,h,m,p,d),l}function G(e){var t=la.getEnv(),a=t.Image,o=t.Canvas,n=t.Video;return e instanceof a||e instanceof o||e instanceof n}function V(e,t){return Yt.b(this,void 0,void 0,function(){var a,o,n,r;return Yt.d(this,function(s){switch(s.label){case 0:return a=A(e,t),o=a.manifestUri,n=a.modelBaseUri,[4,W(o)];case 1:return r=s.sent(),[2,Zt.i.loadWeights(r,n)];}})})}function H(e,t){return void 0===t&&(t=!1),Zt.w(function(){var a=e.shape.slice(1),o=a[0],n=a[1];if(o===n)return e;var r=Ut(o-n),s=Gt(r*(t?.5:1)),i=o>n?2:1,p=function(t){var a=e.shape.slice();return a[i]=t,Zt.g(a,0)},d=p(s),l=r-d.shape[i],u=t&&l?p(l):null,c=[u,e,d].filter(function(e){return!!e}).map(function(e){return e.toFloat()});return Zt.e(c,i)})}function q(e){return Yt.b(this,void 0,void 0,function(){var t,a,o;return Yt.d(this,function(n){switch(n.label){case 0:if(e instanceof xa)return[2,e];if(t=Array.isArray(e)?e:[e],!t.length)throw new Error("toNetInput - empty array passed as input");return a=function(t){return Array.isArray(e)?" at input index "+t+":":""},o=t.map(R),o.forEach(function(e,o){if(!G(e)&&!r(e)&&!s(e)){if("string"==typeof t[o])throw new Error("toNetInput -"+a(o)+" string passed, but could not resolve HTMLElement for element id "+t[o]);throw new Error("toNetInput -"+a(o)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(s(e)){var n=e.shape[0];if(1!==n)throw new Error("toNetInput -"+a(o)+" tf.Tensor4D with batchSize "+n+" passed, but not supported in input array")}}),[4,Promise.all(o.map(function(e){return G(e)&&P(e)}))];case 1:return n.sent(),[2,new xa(o,Array.isArray(e))];}})})}function $(e,t,a){void 0===a&&(a=!0);var o=qt(0,$t(e.right,t.right)-qt(e.left,t.left)),n=qt(0,$t(e.bottom,t.bottom)-qt(e.top,t.top)),r=o*n;return a?r/(e.area+t.area-r):r/$t(e.area,t.area)}function K(e,t,a,o){void 0===o&&(o=!0);for(var n=t.map(function(e,t){return{score:e,boxIndex:t}}).sort(function(e,t){return e.score-t.score}).map(function(e){return e.boxIndex}),r=[],s=function(){var t=n.pop();r.push(t);for(var s=n,p=[],d=0;d<s.length;d++){var i=s[d],l=e[t],u=e[i];p.push($(l,u,o))}n=n.filter(function(e,t){return p[t]<=a})};0<n.length;)s();return r}function j(e,t){return Zt.w(function(){var a=t[0],o=t[1],n=t[2],r=Zt.g(e.shape.slice(0,3).concat([1]),a),s=Zt.g(e.shape.slice(0,3).concat([1]),o),i=Zt.g(e.shape.slice(0,3).concat([1]),n),p=Zt.e([r,s,i],3);return Zt.r(e,p)})}function X(e){return 1/(1+Ht(-e))}function Y(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!va(e.iouThreshold)||0>e.iouThreshold||1<e.iouThreshold)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(e){return"string"==typeof e}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(e){return e||{}}).every(function(e){return va(e.x)&&va(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(va)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function Q(e){return Zt.w(function(){var t=Zt.k(e,Zt.n(.10000000149011612));return Zt.c(Zt.m(Zt.r(e,t)),t)})}function Z(e,t){return Zt.w(function(){var a=Zt.l(e,[[0,0],[1,1],[1,1],[0,0]]);return a=Zt.f(a,t.conv.filters,[1,1],"valid"),a=Zt.r(a,t.bn.sub),a=Zt.k(a,t.bn.truediv),a=Zt.c(a,t.conv.bias),Q(a)})}function J(e,t){return Zt.w(function(){var a=Zt.l(e,[[0,0],[1,1],[1,1],[0,0]]);return a=Zt.o(a,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),a=Zt.c(a,t.bias),Q(a)})}function ee(e,t){function a(a,o){var n=Zt.t(e(a)),r=Zt.t(e(a));return t.push({paramPath:o+"/sub"},{paramPath:o+"/truediv"}),{sub:n,truediv:r}}var o=k(e,t),n=I(e,t);return{extractConvParams:o,extractConvWithBatchNormParams:function(e,t,n){var r=o(e,t,3,n+"/conv"),s=a(t,n+"/bn");return{conv:r,bn:s}},extractSeparableConvParams:n}}function te(e,t,a,o){var n=D(e),r=n.extractWeights,s=n.getRemainingWeights,i=[],p=ee(r,i),d=p.extractConvParams,l=p.extractConvWithBatchNormParams,u=p.extractSeparableConvParams,c;if(t.withSeparableConvs){var h=o[0],m=o[1],g=o[2],f=o[3],y=o[4],x=o[5],b=o[6],v=o[7],C=o[8],R=t.isFirstLayerConv2d?d(h,m,3,"conv0"):u(h,m,"conv0"),S=u(m,g,"conv1"),E=u(g,f,"conv2"),_=u(f,y,"conv3"),k=u(y,x,"conv4"),w=u(x,b,"conv5"),I=v?u(b,v,"conv6"):void 0,N=C?u(v,C,"conv7"):void 0,T=d(C||v||b,5*a,1,"conv8");c={conv0:R,conv1:S,conv2:E,conv3:_,conv4:k,conv5:w,conv6:I,conv7:N,conv8:T}}else{var h=o[0],m=o[1],g=o[2],f=o[3],y=o[4],x=o[5],b=o[6],v=o[7],C=o[8],R=l(h,m,"conv0"),S=l(m,g,"conv1"),E=l(g,f,"conv2"),_=l(f,y,"conv3"),k=l(y,x,"conv4"),w=l(x,b,"conv5"),I=l(b,v,"conv6"),N=l(v,C,"conv7"),T=d(C,5*a,1,"conv8");c={conv0:R,conv1:S,conv2:E,conv3:_,conv4:k,conv5:w,conv6:I,conv7:N,conv8:T}}if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:c,paramMappings:i}}function ae(e,t){function a(e){var t=n(e+"/sub",1),a=n(e+"/truediv",1);return{sub:t,truediv:a}}function o(e){var t=n(e+"/filters",4),a=n(e+"/bias",1);return{filters:t,bias:a}}var n=T(e,t),r=N(n);return{extractConvParams:o,extractConvWithBatchNormParams:function(e){var t=o(e+"/conv"),n=a(e+"/bn");return{conv:t,bn:n}},extractSeparableConvParams:r}}function oe(e,t){var a=[],o=ae(e,a),n=o.extractConvParams,r=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams,i;if(t.withSeparableConvs){var p=t.filterSizes&&t.filterSizes.length||9;i={conv0:t.isFirstLayerConv2d?n("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:7<p?s("conv6"):void 0,conv7:8<p?s("conv7"):void 0,conv8:n("conv8")}}else i={conv0:r("conv0"),conv1:r("conv1"),conv2:r("conv2"),conv3:r("conv3"),conv4:r("conv4"),conv5:r("conv5"),conv6:r("conv6"),conv7:r("conv7"),conv8:n("conv8")};return _(e,a),{params:i,paramMappings:a}}function ne(e,t,a){if(void 0===a&&(a=!1),e.beginPath(),t.slice(1).forEach(function(a,o){var n=a.x,r=a.y,s=t[o];e.moveTo(s.x,s.y),e.lineTo(n,r)}),a){var o=t[t.length-1],n=t[0];if(!o||!n)return;e.moveTo(o.x,o.y),e.lineTo(n.x,n.y)}e.stroke()}function re(e){return e.detection instanceof Ea}function se(e,t){return Object.assign({},e,{detection:t})}function ie(e,t){var a=Array.isArray(t)?t:[t];a.forEach(function(t){var a=t instanceof Ea?t.score:re(t)?t.detection.score:void 0,o=t instanceof Ea?t.box:re(t)?t.detection.box:new ta(t),n=a?""+d(a):void 0;new Kt.DrawBox(o,{label:n}).draw(e)})}function pe(e,t,a){return Qt.tidy(function(){var o=Qt.separableConv2d(e,t.depthwise_filter,t.pointwise_filter,a,"same");return o=Qt.add(o,t.bias),o})}function de(e,t,a){return void 0===a&&(a=!1),Qt.tidy(function(){var o=Qt.relu(a?Qt.add(Qt.conv2d(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):pe(e,t.conv0,[2,2])),n=pe(o,t.conv1,[1,1]),r=Qt.relu(Qt.add(o,n)),s=pe(r,t.conv2,[1,1]);return Qt.relu(Qt.add(o,Qt.add(n,s)))})}function le(e,t,a,o){return void 0===a&&(a=!1),void 0===o&&(o=!0),Qt.tidy(function(){var n=Qt.relu(a?Qt.add(Qt.conv2d(e,t.conv0.filters,o?[2,2]:[1,1],"same"),t.conv0.bias):pe(e,t.conv0,o?[2,2]:[1,1])),r=pe(n,t.conv1,[1,1]),s=Qt.relu(Qt.add(n,r)),i=pe(s,t.conv2,[1,1]),p=Qt.relu(Qt.add(n,Qt.add(r,i))),d=pe(p,t.conv3,[1,1]);return Qt.relu(Qt.add(n,Qt.add(r,Qt.add(i,d))))})}function ue(e,t){function a(e,t,a,r){void 0===r&&(r=!1);var s=r?o(e,t,3,a+"/conv0"):n(e,t,a+"/conv0"),i=n(t,t,a+"/conv1"),p=n(t,t,a+"/conv2");return{conv0:s,conv1:i,conv2:p}}var o=jt.extractConvParamsFactory(e,t),n=jt.extractSeparableConvParamsFactory(e,t);return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,o,r){void 0===r&&(r=!1);var s=a(e,t,o,r),i=s.conv0,p=s.conv1,d=s.conv2,l=n(t,t,o+"/conv3");return{conv0:i,conv1:p,conv2:d,conv3:l}}}}function ce(e){var t=[],a=jt.extractWeightsFactory(e),o=a.extractWeights,n=a.getRemainingWeights,r=ue(o,t).extractDenseBlock4Params,s=r(3,32,"dense0",!0),i=r(32,64,"dense1"),p=r(64,128,"dense2"),d=r(128,256,"dense3");if(0!==n().length)throw new Error("weights remaing after extract: "+n().length);return{paramMappings:t,params:{dense0:s,dense1:i,dense2:p,dense3:d}}}function he(e){return function(t){var a=e(t+"/filters",4),o=e(t+"/bias",1);return{filters:a,bias:o}}}function me(e,t){var a=jt.extractWeightEntryFactory(e,t),o=he(a),n=jt.loadSeparableConvParamsFactory(a);return{extractDenseBlock3Params:function(e,t){void 0===t&&(t=!1);var a=t?o(e+"/conv0"):n(e+"/conv0"),r=n(e+"/conv1"),s=n(e+"/conv2");return{conv0:a,conv1:r,conv2:s}},extractDenseBlock4Params:function(e,t){void 0===t&&(t=!1);var a=t?o(e+"/conv0"):n(e+"/conv0"),r=n(e+"/conv1"),s=n(e+"/conv2"),i=n(e+"/conv3");return{conv0:a,conv1:r,conv2:s,conv3:i}}}}function ge(e){var t=[],a=me(e,t).extractDenseBlock4Params,o={dense0:a("dense0",!0),dense1:a("dense1"),dense2:a("dense2"),dense3:a("dense3")};return jt.disposeUnusedWeightTensors(e,t),{params:o,paramMappings:t}}function fe(e,t){return Qt.tidy(function(){return Qt.add(Qt.matMul(e,t.weights),t.bias)})}function ye(e,t,a){var o=[],n=jt.extractWeightsFactory(e),r=n.extractWeights,s=n.getRemainingWeights,i=jt.extractFCParamsFactory(r,o),p=i(t,a,"fc");if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:o,params:{fc:p}}}function xe(e){var t=[],a=jt.extractWeightEntryFactory(e,t),o={fc:function(e){var t=a(e+"/weights",2),o=a(e+"/bias",1);return{weights:t,bias:o}}("fc")};return jt.disposeUnusedWeightTensors(e,t),{params:o,paramMappings:t}}function be(e){var t={},a={};return Object.keys(e).forEach(function(o){var n=o.startsWith("fc")?a:t;n[o]=e[o]}),{featureExtractorMap:t,classifierMap:a}}function ve(e){return e.expressions instanceof Ia}function Ce(e,t){return Object.assign({},e,{expressions:t})}function Re(t,e,a,o){void 0===a&&(a=.1);var n=Array.isArray(e)?e:[e];n.forEach(function(n){var e=n instanceof Ia?n:ve(n)?n.expressions:void 0;if(!e)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var r=e.asSortedArray(),s=r.filter(function(e){return e.probability>a}),i=re(n)?n.detection.box.bottomLeft:o||new ea(0,0),p=new Kt.DrawTextField(s.map(function(e){return e.expression+" ("+d(e.probability)+")"}),i);p.draw(t)})}function Se(e){var t=e.map(function(e){return e.x}),a=e.map(function(e){return e.y}),o=t.reduce(function(e,t){return t<e?t:e},Infinity),n=a.reduce(function(e,t){return t<e?t:e},Infinity),r=t.reduce(function(e,t){return e<t?t:e},0),s=a.reduce(function(e,t){return e<t?t:e},0);return new aa(o,n,r,s)}function Ee(e){return re(e)&&e.landmarks instanceof Ta&&e.unshiftedLandmarks instanceof Ta&&e.alignedRect instanceof Ea}function _e(e,t){var a=e.detection.box,o=t.shiftBy(a.x,a.y),n=o.align(),r=e.detection.imageDims,s=new Ea(e.detection.score,n.rescale(r.reverse()),r);return Object.assign({},e,{landmarks:o,unshiftedLandmarks:t,alignedRect:s})}function ke(e,t){var a=Array.isArray(t)?t:[t];a.forEach(function(t){var a=t instanceof Ta?t:Ee(t)?t.landmarks:void 0;if(!a)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Oa(a).draw(e)})}function we(e,t){var a=jt.extractConvParamsFactory(e,t),o=jt.extractSeparableConvParamsFactory(e,t);return{extractConvParams:a,extractSeparableConvParams:o,extractReductionBlockParams:function(e,t,n){var r=o(e,t,n+"/separable_conv0"),s=o(t,t,n+"/separable_conv1"),i=a(e,t,1,n+"/expansion_conv");return{separable_conv0:r,separable_conv1:s,expansion_conv:i}},extractMainBlockParams:function(e,t){var a=o(e,e,t+"/separable_conv0"),n=o(e,e,t+"/separable_conv1"),r=o(e,e,t+"/separable_conv2");return{separable_conv0:a,separable_conv1:n,separable_conv2:r}}}}function Ie(e,t){var a=[],o=jt.extractWeightsFactory(e),n=o.extractWeights,r=o.getRemainingWeights,s=we(n,a),i=s.extractConvParams,p=s.extractSeparableConvParams,d=s.extractReductionBlockParams,l=s.extractMainBlockParams,u=i(3,32,3,"entry_flow/conv_in"),c=d(32,64,"entry_flow/reduction_block_0"),m=d(64,128,"entry_flow/reduction_block_1"),g={};h(t,0,1).forEach(function(e){g["main_block_"+e]=l(128,"middle_flow/main_block_"+e)});var f=d(128,256,"exit_flow/reduction_block"),y=p(256,512,"exit_flow/separable_conv");if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{paramMappings:a,params:{entry_flow:{conv_in:u,reduction_block_0:c,reduction_block_1:m},middle_flow:g,exit_flow:{reduction_block:f,separable_conv:y}}}}function Ne(e,t){var a=jt.extractWeightEntryFactory(e,t),o=he(a),n=jt.loadSeparableConvParamsFactory(a);return{extractConvParams:o,extractSeparableConvParams:n,extractReductionBlockParams:function(e){var t=n(e+"/separable_conv0"),a=n(e+"/separable_conv1"),r=o(e+"/expansion_conv");return{separable_conv0:t,separable_conv1:a,expansion_conv:r}},extractMainBlockParams:function(e){var t=n(e+"/separable_conv0"),a=n(e+"/separable_conv1"),o=n(e+"/separable_conv2");return{separable_conv0:t,separable_conv1:a,separable_conv2:o}}}}function Te(e,t){var a=[],o=Ne(e,a),n=o.extractConvParams,r=o.extractSeparableConvParams,s=o.extractReductionBlockParams,i=o.extractMainBlockParams,p=n("entry_flow/conv_in"),d=s("entry_flow/reduction_block_0"),l=s("entry_flow/reduction_block_1"),u={};h(t,0,1).forEach(function(e){u["main_block_"+e]=i("middle_flow/main_block_"+e)});var c=s("exit_flow/reduction_block"),m=r("exit_flow/separable_conv");return jt.disposeUnusedWeightTensors(e,a),{params:{entry_flow:{conv_in:p,reduction_block_0:d,reduction_block_1:l},middle_flow:u,exit_flow:{reduction_block:c,separable_conv:m}},paramMappings:a}}function De(e,t,a){return Qt.add(Qt.conv2d(e,t.filters,a,"same"),t.bias)}function Ae(e,t,a){void 0===a&&(a=!0);var o=a?Qt.relu(e):e;return o=pe(o,t.separable_conv0,[1,1]),o=pe(Qt.relu(o),t.separable_conv1,[1,1]),o=Qt.maxPool(o,[3,3],[2,2],"same"),o=Qt.add(o,De(e,t.expansion_conv,[2,2])),o}function Oe(e,t){var a=pe(Qt.relu(e),t.separable_conv0,[1,1]);return a=pe(Qt.relu(a),t.separable_conv1,[1,1]),a=pe(Qt.relu(a),t.separable_conv2,[1,1]),a=Qt.add(a,e),a}function Pe(e){var t=[],a=jt.extractWeightsFactory(e),o=a.extractWeights,n=a.getRemainingWeights,r=jt.extractFCParamsFactory(o,t),s=r(512,1,"fc/age"),i=r(512,2,"fc/gender");if(0!==n().length)throw new Error("weights remaing after extract: "+n().length);return{paramMappings:t,params:{fc:{age:s,gender:i}}}}function Fe(e){function t(e){var t=o(e+"/weights",2),a=o(e+"/bias",1);return{weights:t,bias:a}}var a=[],o=jt.extractWeightEntryFactory(e,a),n={fc:{age:t("fc/age"),gender:t("fc/gender")}};return jt.disposeUnusedWeightTensors(e,a),{params:n,paramMappings:a}}function Be(e,t){return Yt.b(this,void 0,void 0,function(){var a,o,n,r,s,i,p;return Yt.d(this,function(d){switch(d.label){case 0:return a=la.getEnv().Canvas,o=e,e instanceof a?[3,5]:[4,q(e)];case 1:if(n=d.sent(),1<n.batchSize)throw new Error("extractFaces - batchSize > 1 not supported");return(r=n.getInput(0),!(r instanceof a))?[3,2]:(s=r,[3,4]);case 2:return[4,U(r)];case 3:s=d.sent(),d.label=4;case 4:o=s,d.label=5;case 5:return i=S(o),p=t.map(function(e){return e instanceof Ea?e.forSize(o.width,o.height).box.floor():e}).map(function(e){return e.clipAtImageBorders(o.width,o.height)}),[2,p.map(function(e){var t=e.x,a=e.y,o=e.width,n=e.height,r=B({width:o,height:n});return S(r).putImageData(i.getImageData(t,a,o,n),0,0),r})];}})})}function Le(e,t){return Yt.b(this,void 0,void 0,function(){return Yt.d(this,function(){if(!r(e)&&!s(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(s(e)&&1<e.shape[0])throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Qt.tidy(function(){var a=e.shape.slice(s(e)?1:0),o=a[0],n=a[1],r=a[2],i=t.map(function(e){return e instanceof Ea?e.forSize(n,o).box:e}).map(function(e){return e.clipAtImageBorders(n,o)}),p=i.map(function(t){var a=t.x,s=t.y,i=t.width,p=t.height;return Qt.slice3d(e.as3D(o,n,r),[s,a,0],[p,i,r])});return p})]})})}function Me(e){var t=[],a=me(e,t).extractDenseBlock3Params,o={dense0:a("dense0",!0),dense1:a("dense1"),dense2:a("dense2")};return jt.disposeUnusedWeightTensors(e,t),{params:o,paramMappings:t}}function We(e){var t=[],a=jt.extractWeightsFactory(e),o=a.extractWeights,n=a.getRemainingWeights,r=ue(o,t).extractDenseBlock3Params,s=r(3,32,"dense0",!0),i=r(32,64,"dense1"),p=r(64,128,"dense2");if(0!==n().length)throw new Error("weights remaing after extract: "+n().length);return{paramMappings:t,params:{dense0:s,dense1:i,dense2:p}}}function Ue(e,t){return Qt.add(Qt.mul(e,t.weights),t.biases)}function ze(e,t,a,o,n){void 0===n&&(n="same");var r=t.conv,s=r.filters,i=r.bias,p=Qt.conv2d(e,s,a,n);return p=Qt.add(p,i),p=Ue(p,t.scale),o?Qt.relu(p):p}function Ge(e,t){return ze(e,t,[1,1],!0)}function Ve(e,t){return ze(e,t,[1,1],!1)}function He(e,t){return ze(e,t,[2,2],!0,"valid")}function qe(e,t){function a(t,a,o){var n=e(t),r=n.length/(a*o*o);if(i(r))throw new Error("depth has to be an integer: "+r+", weights.length: "+n.length+", numFilters: "+a+", filterSize: "+o);return Qt.tidy(function(){return Qt.transpose(Qt.tensor4d(n,[a,r,o,o]),[2,3,1,0])})}function o(o,n,r,s){var i=a(o,n,r),p=Qt.tensor1d(e(n));return t.push({paramPath:s+"/filters"},{paramPath:s+"/bias"}),{filters:i,bias:p}}function n(a,o){var n=Qt.tensor1d(e(a)),r=Qt.tensor1d(e(a));return t.push({paramPath:o+"/weights"},{paramPath:o+"/biases"}),{weights:n,biases:r}}function r(e,t,a,r){var s=o(e,t,a,r+"/conv"),i=n(t,r+"/scale");return{conv:s,scale:i}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,a,o,n){void 0===n&&(n=!1);var s=r((n?.5:1)*e,t,a,o+"/conv1"),i=r(e,t,a,o+"/conv2");return{conv1:s,conv2:i}}}}function $e(e){var t=jt.extractWeightsFactory(e),a=t.extractWeights,o=t.getRemainingWeights,n=[],r=qe(a,n),s=r.extractConvLayerParams,i=r.extractResidualLayerParams,p=s(4704,32,7,"conv32_down"),d=i(9216,32,3,"conv32_1"),l=i(9216,32,3,"conv32_2"),u=i(9216,32,3,"conv32_3"),c=i(36864,64,3,"conv64_down",!0),h=i(36864,64,3,"conv64_1"),m=i(36864,64,3,"conv64_2"),g=i(36864,64,3,"conv64_3"),f=i(147456,128,3,"conv128_down",!0),y=i(147456,128,3,"conv128_1"),x=i(147456,128,3,"conv128_2"),b=i(589824,256,3,"conv256_down",!0),v=i(589824,256,3,"conv256_1"),C=i(589824,256,3,"conv256_2"),R=i(589824,256,3,"conv256_down_out"),S=Qt.tidy(function(){return Qt.transpose(Qt.tensor2d(a(32768),[128,256]),[1,0])});if(n.push({paramPath:"fc"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{conv32_down:p,conv32_1:d,conv32_2:l,conv32_3:u,conv64_down:c,conv64_1:h,conv64_2:m,conv64_3:g,conv128_down:f,conv128_1:y,conv128_2:x,conv256_down:b,conv256_1:v,conv256_2:C,conv256_down_out:R,fc:S},paramMappings:n}}function Ke(e,t){function a(e){var t=n(e+"/scale/weights",1),a=n(e+"/scale/biases",1);return{weights:t,biases:a}}function o(e){var t=n(e+"/conv/filters",4),o=n(e+"/conv/bias",1),r=a(e);return{conv:{filters:t,bias:o},scale:r}}var n=jt.extractWeightEntryFactory(e,t);return{extractConvLayerParams:o,extractResidualLayerParams:function(e){return{conv1:o(e+"/conv1"),conv2:o(e+"/conv2")}}}}function je(e){var t=[],a=Ke(e,t),o=a.extractConvLayerParams,r=a.extractResidualLayerParams,s=o("conv32_down"),i=r("conv32_1"),p=r("conv32_2"),d=r("conv32_3"),l=r("conv64_down"),u=r("conv64_1"),c=r("conv64_2"),h=r("conv64_3"),m=r("conv128_down"),g=r("conv128_1"),f=r("conv128_2"),y=r("conv256_down"),x=r("conv256_1"),b=r("conv256_2"),v=r("conv256_down_out"),C=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!n(C))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+C);return jt.disposeUnusedWeightTensors(e,t),{params:{conv32_down:s,conv32_1:i,conv32_2:p,conv32_3:d,conv64_down:l,conv64_1:u,conv64_2:c,conv64_3:h,conv128_down:m,conv128_1:g,conv128_2:f,conv256_down:y,conv256_1:x,conv256_2:b,conv256_down_out:v,fc:C},paramMappings:t}}function Xe(e,t){var a=Ge(e,t.conv1);return a=Ve(a,t.conv2),a=Qt.add(a,e),a=Qt.relu(a),a}function Ye(e,t){var a=He(e,t.conv1);a=Ve(a,t.conv2);var o=Qt.avgPool(e,2,2,"valid"),n=Qt.zeros(o.shape),r=o.shape[3]!==a.shape[3],s=o.shape[1]!==a.shape[1]||o.shape[2]!==a.shape[2];if(s){var i=a.shape.slice();i[1]=1;var p=Qt.zeros(i);a=Qt.concat([a,p],1);var d=a.shape.slice();d[2]=1;var l=Qt.zeros(d);a=Qt.concat([a,l],2)}return o=r?Qt.concat([o,n],3):o,a=Qt.add(o,a),a=Qt.relu(a),a}function Qe(e,t){return Object.assign({},e,{descriptor:t})}function Ze(e,t){function a(a,o){var n=Qt.tensor4d(e(9*a),[3,3,a,1]),r=Qt.tensor1d(e(a)),s=Qt.tensor1d(e(a)),i=Qt.tensor1d(e(a)),p=Qt.tensor1d(e(a));return t.push({paramPath:o+"/filters"},{paramPath:o+"/batch_norm_scale"},{paramPath:o+"/batch_norm_offset"},{paramPath:o+"/batch_norm_mean"},{paramPath:o+"/batch_norm_variance"}),{filters:n,batch_norm_scale:r,batch_norm_offset:s,batch_norm_mean:i,batch_norm_variance:p}}function o(a,o,n,r,s){var i=Qt.tensor4d(e(a*o*n*n),[n,n,a,o]),p=Qt.tensor1d(e(o));return t.push({paramPath:r+"/filters"},{paramPath:r+"/"+(s?"batch_norm_offset":"bias")}),{filters:i,bias:p}}function n(e,t,a,n){var r=o(e,t,a,n,!0),s=r.filters,i=r.bias;return{filters:s,batch_norm_offset:i}}function r(e,t,o){var r=a(e,o+"/depthwise_conv"),s=n(e,t,1,o+"/pointwise_conv");return{depthwise_conv:r,pointwise_conv:s}}return{extractMobilenetV1Params:function(){var e=n(3,32,3,"mobilenetv1/conv_0"),t=r(32,64,"mobilenetv1/conv_1"),a=r(64,128,"mobilenetv1/conv_2"),o=r(128,128,"mobilenetv1/conv_3"),s=r(128,256,"mobilenetv1/conv_4"),i=r(256,256,"mobilenetv1/conv_5"),p=r(256,512,"mobilenetv1/conv_6"),d=r(512,512,"mobilenetv1/conv_7"),l=r(512,512,"mobilenetv1/conv_8"),u=r(512,512,"mobilenetv1/conv_9"),c=r(512,512,"mobilenetv1/conv_10"),h=r(512,512,"mobilenetv1/conv_11"),m=r(512,1024,"mobilenetv1/conv_12"),g=r(1024,1024,"mobilenetv1/conv_13");return{conv_0:e,conv_1:t,conv_2:a,conv_3:o,conv_4:s,conv_5:i,conv_6:p,conv_7:d,conv_8:l,conv_9:u,conv_10:c,conv_11:h,conv_12:m,conv_13:g}},extractPredictionLayerParams:function(){var e=n(1024,256,1,"prediction_layer/conv_0"),t=n(256,512,3,"prediction_layer/conv_1"),a=n(512,128,1,"prediction_layer/conv_2"),r=n(128,256,3,"prediction_layer/conv_3"),s=n(256,128,1,"prediction_layer/conv_4"),i=n(128,256,3,"prediction_layer/conv_5"),p=n(256,64,1,"prediction_layer/conv_6"),d=n(64,128,3,"prediction_layer/conv_7"),l=o(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),u=o(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),c=o(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),h=o(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),m=o(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),g=o(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),f=o(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),y=o(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),x=o(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),b=o(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),v=o(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),C=o(128,18,1,"prediction_layer/box_predictor_5/class_predictor");return{conv_0:e,conv_1:t,conv_2:a,conv_3:r,conv_4:s,conv_5:i,conv_6:p,conv_7:d,box_predictor_0:{box_encoding_predictor:l,class_predictor:u},box_predictor_1:{box_encoding_predictor:c,class_predictor:h},box_predictor_2:{box_encoding_predictor:m,class_predictor:g},box_predictor_3:{box_encoding_predictor:f,class_predictor:y},box_predictor_4:{box_encoding_predictor:x,class_predictor:b},box_predictor_5:{box_encoding_predictor:v,class_predictor:C}}}}}function Je(e){var t=[],a=jt.extractWeightsFactory(e),o=a.extractWeights,n=a.getRemainingWeights,r=Ze(o,t),s=r.extractMobilenetV1Params,i=r.extractPredictionLayerParams,p=s(),d=i(),l=Qt.tensor3d(o(20472),[1,5118,4]);if(t.push({paramPath:"output_layer/extra_dim"}),0!==n().length)throw new Error("weights remaing after extract: "+n().length);return{params:{mobilenetv1:p,prediction_layer:d,output_layer:{extra_dim:l}},paramMappings:t}}function et(e,t){function a(e,t,a){var o=s(e+"/Conv2d_"+t+"_pointwise/weights",4,a+"/filters"),n=s(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,a+"/batch_norm_offset");return{filters:o,batch_norm_offset:n}}function o(e){var t="mobilenetv1/conv_"+e,o="MobilenetV1/Conv2d_"+e+"_depthwise",n=t+"/depthwise_conv",r=s(o+"/depthwise_weights",4,n+"/filters"),i=s(o+"/BatchNorm/gamma",1,n+"/batch_norm_scale"),p=s(o+"/BatchNorm/beta",1,n+"/batch_norm_offset"),d=s(o+"/BatchNorm/moving_mean",1,n+"/batch_norm_mean"),l=s(o+"/BatchNorm/moving_variance",1,n+"/batch_norm_variance");return{depthwise_conv:{filters:r,batch_norm_scale:i,batch_norm_offset:p,batch_norm_mean:d,batch_norm_variance:l},pointwise_conv:a("MobilenetV1",e,t+"/pointwise_conv")}}function n(e,t){var a=s(e+"/weights",4,t+"/filters"),o=s(e+"/biases",1,t+"/bias");return{filters:a,bias:o}}function r(e){var t=n("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),a=n("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor");return{box_encoding_predictor:t,class_predictor:a}}var s=jt.extractWeightEntryFactory(e,t);return{extractMobilenetV1Params:function(){return{conv_0:a("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:a("Prediction",0,"prediction_layer/conv_0"),conv_1:a("Prediction",1,"prediction_layer/conv_1"),conv_2:a("Prediction",2,"prediction_layer/conv_2"),conv_3:a("Prediction",3,"prediction_layer/conv_3"),conv_4:a("Prediction",4,"prediction_layer/conv_4"),conv_5:a("Prediction",5,"prediction_layer/conv_5"),conv_6:a("Prediction",6,"prediction_layer/conv_6"),conv_7:a("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:r(0),box_predictor_1:r(1),box_predictor_2:r(2),box_predictor_3:r(3),box_predictor_4:r(4),box_predictor_5:r(5)}}}}function tt(e){var t=[],a=et(e,t),o=a.extractMobilenetV1Params,n=a.extractPredictionLayerParams,s=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!r(s))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+s);var i={mobilenetv1:o(),prediction_layer:n(),output_layer:{extra_dim:s}};return jt.disposeUnusedWeightTensors(e,t),{params:i,paramMappings:t}}function at(e,t,a){return Qt.tidy(function(){var o=Qt.conv2d(e,t.filters,a,"same");return o=Qt.add(o,t.batch_norm_offset),Qt.clipByValue(o,0,6)})}function ot(e,t,a){return Qt.tidy(function(){var o=Qt.depthwiseConv2d(e,t.filters,a,"same");return o=Qt.batchNorm(o,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,Ka),Qt.clipByValue(o,0,6)})}function nt(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}function rt(e,t){return Qt.tidy(function(){var a=null,o=at(e,t.conv_0,[2,2]),n=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(n.forEach(function(e,t){var n=t+1,r=nt(n);o=ot(o,e.depthwise_conv,r),o=at(o,e.pointwise_conv,[1,1]),11===n&&(a=o)}),null===a)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:o,conv11:a}})}function st(e,t,a,o,n){var r=e.shape[0],s=$t(a,r),i=t.map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>n}).sort(function(e,t){return t.score-e.score}),p=function(e){return e<=o?1:0},d=[];return i.forEach(function(t){if(!(d.length>=s)){for(var a=t.score,o=d.length-1,r;0<=o&&!((r=it(e,t.boxIndex,d[o]),0!==r)&&(t.score*=p(r),t.score<=n));--o);a===t.score&&d.push(t.boxIndex)}}),d}function it(e,t,a){var o=e.arraySync(),n=$t(o[t][0],o[t][2]),r=$t(o[t][1],o[t][3]),s=qt(o[t][0],o[t][2]),i=qt(o[t][1],o[t][3]),p=$t(o[a][0],o[a][2]),d=$t(o[a][1],o[a][3]),l=qt(o[a][0],o[a][2]),u=qt(o[a][1],o[a][3]),c=(s-n)*(i-r),h=(l-p)*(u-d);if(0>=c||0>=h)return 0;var m=qt(n,p),g=qt(r,d),f=$t(s,l),y=$t(i,u),x=qt(f-m,0)*qt(y-g,0);return x/(c+h-x)}function pt(e){var t=Qt.unstack(Qt.transpose(e,[1,0])),a=[Qt.sub(t[2],t[0]),Qt.sub(t[3],t[1])],o=[Qt.add(t[0],Qt.div(a[0],Qt.scalar(2))),Qt.add(t[1],Qt.div(a[1],Qt.scalar(2)))];return{sizes:a,centers:o}}function dt(e,t){var a=pt(e),o=a.sizes,n=a.centers,r=Qt.unstack(Qt.transpose(t,[1,0])),s=Qt.div(Qt.mul(Qt.exp(Qt.div(r[2],Qt.scalar(5))),o[0]),Qt.scalar(2)),i=Qt.add(Qt.mul(Qt.div(r[0],Qt.scalar(10)),o[0]),n[0]),p=Qt.div(Qt.mul(Qt.exp(Qt.div(r[3],Qt.scalar(5))),o[1]),Qt.scalar(2)),d=Qt.add(Qt.mul(Qt.div(r[1],Qt.scalar(10)),o[1]),n[1]);return Qt.transpose(Qt.stack([Qt.sub(i,s),Qt.sub(d,p),Qt.add(i,s),Qt.add(d,p)]),[1,0])}function lt(e,t,a){return Qt.tidy(function(){var o=e.shape[0],n=dt(Qt.reshape(Qt.tile(a.extra_dim,[o,1,1]),[-1,4]),Qt.reshape(e,[-1,4]));n=Qt.reshape(n,[o,n.shape[0]/o,4]);var r=Qt.sigmoid(Qt.slice(t,[0,0,1],[-1,-1,-1])),s=Qt.slice(r,[0,0,0],[-1,-1,1]);s=Qt.reshape(s,[o,s.shape[1]]);var i=Qt.unstack(n),p=Qt.unstack(s);return{boxes:i,scores:p}})}function ut(e,t){return Qt.tidy(function(){var a=e.shape[0],o=Qt.reshape(jt.convLayer(e,t.box_encoding_predictor),[a,-1,1,4]),n=Qt.reshape(jt.convLayer(e,t.class_predictor),[a,-1,3]);return{boxPredictionEncoding:o,classPrediction:n}})}function ct(e,t,a){return Qt.tidy(function(){var o=at(e,a.conv_0,[1,1]),n=at(o,a.conv_1,[2,2]),r=at(n,a.conv_2,[1,1]),s=at(r,a.conv_3,[2,2]),i=at(s,a.conv_4,[1,1]),p=at(i,a.conv_5,[2,2]),d=at(p,a.conv_6,[1,1]),l=at(d,a.conv_7,[2,2]),u=ut(t,a.box_predictor_0),c=ut(e,a.box_predictor_1),h=ut(n,a.box_predictor_2),m=ut(s,a.box_predictor_3),g=ut(p,a.box_predictor_4),f=ut(l,a.box_predictor_5),y=Qt.concat([u.boxPredictionEncoding,c.boxPredictionEncoding,h.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding,f.boxPredictionEncoding],1),x=Qt.concat([u.classPrediction,c.classPrediction,h.classPrediction,m.classPrediction,g.classPrediction,f.classPrediction],1);return{boxPredictions:y,classPredictions:x}})}function ht(e,t,a,o,n){return void 0===n&&(n=function(e){var t=e.alignedRect;return t}),Yt.b(this,void 0,void 0,function(){var r,s,i,p,d;return Yt.d(this,function(l){switch(l.label){case 0:return r=e.map(function(e){return Ee(e)?n(e):e.detection}),i=o,i?[3,5]:t instanceof Qt.Tensor?[4,Le(t,r)]:[3,2];case 1:return p=l.sent(),[3,4];case 2:return[4,Be(t,r)];case 3:p=l.sent(),l.label=4;case 4:i=p,l.label=5;case 5:return s=i,[4,a(s)];case 6:return d=l.sent(),s.forEach(function(e){return e instanceof Qt.Tensor&&e.dispose()}),[2,d];}})})}function mt(e,t,a,o,n){return Yt.b(this,void 0,void 0,function(){var r=this;return Yt.d(this,function(){return[2,ht([e],t,function(e){return Yt.b(r,void 0,void 0,function(){return Yt.d(this,function(){return[2,a(e[0])]})})},o,n)]})})}function gt(e){return Qt.tidy(function(){return Qt.stack(Qt.unstack(e,3).reverse(),3)})}function ft(e,t){function a(a,o){var n=Qt.tensor1d(e(a));return t.push({paramPath:o}),n}function o(e,t,o){void 0===o&&(o=!1);var r=n(e[0],e[1],3,t+"/conv1"),s=a(e[1],t+"/prelu1_alpha"),i=n(e[1],e[2],3,t+"/conv2"),p=a(e[2],t+"/prelu2_alpha"),d=n(e[2],e[3],o?2:3,t+"/conv3"),l=a(e[3],t+"/prelu3_alpha");return{conv1:r,prelu1_alpha:s,conv2:i,prelu2_alpha:p,conv3:d,prelu3_alpha:l}}var n=jt.extractConvParamsFactory(e,t),r=jt.extractFCParamsFactory(e,t);return{extractPNetParams:function(){var e=o([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),a=n(32,4,1,"pnet/conv4_2");return Yt.a({},e,{conv4_1:t,conv4_2:a})},extractRNetParams:function(){var e=o([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=a(128,"rnet/prelu4_alpha"),s=r(128,2,"rnet/fc2_1"),i=r(128,4,"rnet/fc2_2");return Yt.a({},e,{fc1:t,prelu4_alpha:n,fc2_1:s,fc2_2:i})},extractONetParams:function(){var e=o([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),s=a(128,"onet/prelu4_alpha"),i=r(1152,256,"onet/fc1"),p=a(256,"onet/prelu5_alpha"),d=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),u=r(256,10,"onet/fc2_3");return Yt.a({},e,{conv4:t,prelu4_alpha:s,fc1:i,prelu5_alpha:p,fc2_1:d,fc2_2:l,fc2_3:u})}}}function yt(e){var t=jt.extractWeightsFactory(e),a=t.extractWeights,o=t.getRemainingWeights,n=[],r=ft(a,n),s=r.extractPNetParams,i=r.extractRNetParams,p=r.extractONetParams,d=s(),l=i(),u=p();if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{pnet:d,rnet:l,onet:u},paramMappings:n}}function xt(e,t){function a(e){var t=s(e+"/weights",4,e+"/filters"),a=s(e+"/bias",1);return{filters:t,bias:a}}function o(e){var t=s(e+"/weights",2),a=s(e+"/bias",1);return{weights:t,bias:a}}function n(e){return s(e,1)}function r(e){var t=a(e+"/conv1"),o=n(e+"/prelu1_alpha"),r=a(e+"/conv2"),s=n(e+"/prelu2_alpha"),i=a(e+"/conv3"),p=n(e+"/prelu3_alpha");return{conv1:t,prelu1_alpha:o,conv2:r,prelu2_alpha:s,conv3:i,prelu3_alpha:p}}var s=jt.extractWeightEntryFactory(e,t);return{extractPNetParams:function(){var e=r("pnet"),t=a("pnet/conv4_1"),o=a("pnet/conv4_2");return Yt.a({},e,{conv4_1:t,conv4_2:o})},extractRNetParams:function(){var e=r("rnet"),t=o("rnet/fc1"),a=n("rnet/prelu4_alpha"),s=o("rnet/fc2_1"),i=o("rnet/fc2_2");return Yt.a({},e,{fc1:t,prelu4_alpha:a,fc2_1:s,fc2_2:i})},extractONetParams:function(){var e=r("onet"),t=a("onet/conv4"),s=n("onet/prelu4_alpha"),i=o("onet/fc1"),p=n("onet/prelu5_alpha"),d=o("onet/fc2_1"),l=o("onet/fc2_2"),u=o("onet/fc2_3");return Yt.a({},e,{conv4:t,prelu4_alpha:s,fc1:i,prelu5_alpha:p,fc2_1:d,fc2_2:l,fc2_3:u})}}}function bt(e){var t=[],a=xt(e,t),o=a.extractPNetParams,n=a.extractRNetParams,r=a.extractONetParams,s=o(),i=n(),p=r();return jt.disposeUnusedWeightTensors(e,t),{params:{pnet:s,rnet:i,onet:p},paramMappings:t}}function vt(e,t){var a=t[0],o=t[1];return{height:zt(a*e),width:zt(o*e)}}function Ct(e,t,a){for(var o=a[0],n=a[1],r=eo/e,s=[],i=$t(o,n)*r,p=0;12<=i;)s.push(r*Wt(t,p)),i*=t,p+=1;return s}function Rt(e){return Qt.tidy(function(){return Qt.mul(Qt.sub(e,Qt.scalar(127.5)),Qt.scalar(.0078125))})}function St(e,t){return Qt.tidy(function(){return Qt.add(Qt.relu(e),Qt.mul(t,Qt.neg(Qt.relu(Qt.neg(e)))))})}function Et(e,t,a){return void 0===a&&(a=!1),Qt.tidy(function(){var o=jt.convLayer(e,t.conv1,"valid");return o=St(o,t.prelu1_alpha),o=Qt.maxPool(o,a?[2,2]:[3,3],[2,2],"same"),o=jt.convLayer(o,t.conv2,"valid"),o=St(o,t.prelu2_alpha),o=a?o:Qt.maxPool(o,[3,3],[2,2],"valid"),o=jt.convLayer(o,t.conv3,"valid"),o=St(o,t.prelu3_alpha),o})}function _t(e,t){return Qt.tidy(function(){var a=Et(e,t,!0),o=jt.convLayer(a,t.conv4_1,"valid"),n=Qt.expandDims(Qt.max(o,3),3),r=Qt.softmax(Qt.sub(o,n),3),s=jt.convLayer(a,t.conv4_2,"valid");return{prob:r,regions:s}})}function kt(e,t){return Qt.tidy(function(){var a=vt(t,e.shape.slice(1)),o=a.height,n=a.width,r=Qt.image.resizeBilinear(e,[o,n]),s=Rt(r);return Qt.transpose(s,[0,2,1,3])})}function wt(e,t,a,o){for(var n=[],r=e.arraySync(),s=0;s<e.shape[0];s++)for(var i=0;i<e.shape[1];i++)r[s][i]>=o&&n.push(new ea(i,s));var p=n.map(function(e){var o=new aa(Gt((e.y*Ja+1)/a),Gt((e.x*Ja+1)/a),Gt((e.y*Ja+eo)/a),Gt((e.x*Ja+eo)/a)),n=r[e.y][e.x],s=t.arraySync(),i=new to(s[e.y][e.x][0],s[e.y][e.x][1],s[e.y][e.x][2],s[e.y][e.x][3]);return{cell:o,score:n,region:i}});return p}function It(e,t,a,o,n){n.stage1=[];var r=t.map(function(t){return Qt.tidy(function(){var a={scale:t},n=kt(e,t),r=Date.now(),s=_t(n,o),i=s.prob,p=s.regions;a.pnet=Date.now()-r;var d=Qt.unstack(Qt.unstack(i,3)[1])[0],l=Qt.unstack(p)[0];return{scoresTensor:d,regionsTensor:l,scale:t,statsForScale:a}})}),s=r.map(function(e){var t=e.scoresTensor,o=e.regionsTensor,r=e.scale,s=e.statsForScale,i=wt(t,o,r,a);if(t.dispose(),o.dispose(),!i.length)return n.stage1.push(s),[];var p=Date.now(),d=K(i.map(function(e){return e.cell}),i.map(function(e){return e.score}),.5);return s.nms=Date.now()-p,s.numBoxes=d.length,n.stage1.push(s),d.map(function(e){return i[e]})}),i=s.reduce(function(e,t){return e.concat(t)},[]),p=[],d=[];if(0<i.length){var l=Date.now(),u=K(i.map(function(e){return e.cell}),i.map(function(e){return e.score}),.7);n.stage1_nms=Date.now()-l,d=u.map(function(e){return i[e].score}),p=u.map(function(e){return i[e]}).map(function(e){var t=e.cell,a=e.region;return new aa(t.left+a.left*t.width,t.top+a.top*t.height,t.right+a.right*t.width,t.bottom+a.bottom*t.height).toSquare().round()})}return{boxes:p,scores:d}}function Nt(e,t,a){var o=a.width,n=a.height;return Yt.b(this,void 0,void 0,function(){var a=this,r,s,p;return Yt.d(this,function(i){switch(i.label){case 0:return r=S(e),[4,Promise.all(t.map(function(t){return Yt.b(a,void 0,void 0,function(){var a,o,n,s,i,p,d,l;return Yt.d(this,function(){return a=t.padAtBorders(e.height,e.width),o=a.y,n=a.ey,s=a.x,i=a.ex,p=s-1,d=o-1,l=r.getImageData(p,d,i-p,n-d),[2,la.isNodejs()?L(l):createImageBitmap(l)]})})}))];case 1:return s=i.sent(),p=[],s.forEach(function(e){var t=B({width:o,height:n}),a=S(t);a.drawImage(e,0,0,o,n);for(var r=a.getImageData(0,0,o,n).data,s=[],d=0;d<r.length;d+=4)s.push(r[d+2]),s.push(r[d+1]),s.push(r[d]);p.push(s)}),[2,p.map(function(e){var a=Qt.tidy(function(){var t=Qt.transpose(Qt.tensor4d(e,[1,o,n,3]),[0,2,1,3]).toFloat();return Rt(t)});return a})];}})})}function Tt(e,t){return Qt.tidy(function(){var a=Et(e,t),o=Qt.reshape(a,[a.shape[0],t.fc1.weights.shape[0]]),n=fe(o,t.fc1),r=St(n,t.prelu4_alpha),s=fe(r,t.fc2_1),i=Qt.expandDims(Qt.max(s,1),1),p=Qt.softmax(Qt.sub(s,i),1),d=fe(r,t.fc2_2),l=Qt.unstack(p,1)[1];return{scores:l,regions:d}})}function Dt(e,t,a,o,n){return Yt.b(this,void 0,void 0,function(){var r,s,i,p,d,l,u,c,h,m,g,f,y,x;return Yt.d(this,function(b){switch(b.label){case 0:return r=Date.now(),[4,Nt(e,t,{width:24,height:24})];case 1:return s=b.sent(),n.stage2_extractImagePatches=Date.now()-r,r=Date.now(),i=s.map(function(e){var t=Tt(e,o);return e.dispose(),t}),n.stage2_rnet=Date.now()-r,p=1<i.length?Qt.concat(i.map(function(e){return e.scores})):i[0].scores,u=(l=Array).from,[4,p.data()];case 2:return d=u.apply(l,[b.sent()]),p.dispose(),c=d.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>a}).map(function(e){var t=e.idx;return t}),h=c.map(function(e){return t[e]}),m=c.map(function(e){return d[e]}),g=[],f=[],0<h.length&&(r=Date.now(),y=K(h,m,.7),n.stage2_nms=Date.now()-r,x=y.map(function(e){var t=i[c[e]].regions.arraySync();return new to(t[0][0],t[0][1],t[0][2],t[0][3])}),f=y.map(function(e){return m[e]}),g=y.map(function(e,t){return h[e].calibrate(x[t])})),i.forEach(function(e){e.regions.dispose(),e.scores.dispose()}),[2,{boxes:g,scores:f}];}})})}function At(e,t){return Qt.tidy(function(){var a=Et(e,t);a=Qt.maxPool(a,[2,2],[2,2],"same"),a=jt.convLayer(a,t.conv4,"valid"),a=St(a,t.prelu4_alpha);var o=Qt.reshape(a,[a.shape[0],t.fc1.weights.shape[0]]),n=fe(o,t.fc1),r=St(n,t.prelu5_alpha),s=fe(r,t.fc2_1),i=Qt.expandDims(Qt.max(s,1),1),p=Qt.softmax(Qt.sub(s,i),1),d=fe(r,t.fc2_2),l=fe(r,t.fc2_3),u=Qt.unstack(p,1)[1];return{scores:u,regions:d,points:l}})}function Ot(e,t,a,o,n){return Yt.b(this,void 0,void 0,function(){var r,s,p,i,d,l,u,c,h,m,g,f,y,x,b;return Yt.d(this,function(v){switch(v.label){case 0:return r=Date.now(),[4,Nt(e,t,{width:48,height:48})];case 1:return s=v.sent(),n.stage3_extractImagePatches=Date.now()-r,r=Date.now(),p=s.map(function(e){var t=At(e,o);return e.dispose(),t}),n.stage3_onet=Date.now()-r,i=1<p.length?Qt.concat(p.map(function(e){return e.scores})):p[0].scores,u=(l=Array).from,[4,i.data()];case 2:return d=u.apply(l,[v.sent()]),i.dispose(),c=d.map(function(e,t){return{score:e,idx:t}}).filter(function(e){return e.score>a}).map(function(e){var t=e.idx;return t}),h=c.map(function(e){var t=p[e].regions.arraySync();return new to(t[0][0],t[0][1],t[0][2],t[0][3])}),m=c.map(function(e,a){return t[e].calibrate(h[a])}),g=c.map(function(e){return d[e]}),f=[],y=[],x=[],0<m.length&&(r=Date.now(),b=K(m,g,.7,!1),n.stage3_nms=Date.now()-r,f=b.map(function(e){return m[e]}),y=b.map(function(e){return g[e]}),x=b.map(function(e,t){return[,,,,,].fill(0).map(function(a,o){var n=p[e].points.arraySync();return new ea(n[0][o]*(f[t].width+1)+f[t].left,n[0][o+5]*(f[t].height+1)+f[t].top)})})),p.forEach(function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()}),[2,{boxes:f,scores:y,points:x}];}})})}function Pt(e,t){return Object.assign({},e,{age:t})}function Ft(e,t,a){return Object.assign({},e,{gender:t,genderProbability:a})}function Bt(e,t){return void 0===t&&(t=new ja),new Ao(e,t)}function Lt(e,t){return void 0===t&&(t=new ja),new Do(e,t)}function Mt(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var a=Array.from(e),o=Array.from(t);return Vt(a.map(function(e,t){return e-o[t]}).reduce(function(e,t){return e+Wt(t,2)},0))}var Wt=Math.pow,Ut=Math.abs,zt=Math.floor,Gt=Math.round,Vt=Math.sqrt,Ht=Math.exp,qt=Math.max,$t=Math.min;a.d(t,"f",function(){return Qt}),a.d(t,"b",function(){return Bt}),a.d(t,"e",function(){return uo}),a.d(t,"d",function(){return co}),a.d(t,"c",function(){return ho}),a.d(t,"a",function(){return Qa});var Kt={};a.r(Kt),a.d(Kt,"DrawBoxOptions",function(){return ga}),a.d(Kt,"DrawBox",function(){return fa}),a.d(Kt,"AnchorPosition",function(){return ca}),a.d(Kt,"DrawTextFieldOptions",function(){return ha}),a.d(Kt,"DrawTextField",function(){return ma});var jt={};a.r(jt),a.d(jt,"convLayer",function(){return E}),a.d(jt,"disposeUnusedWeightTensors",function(){return _}),a.d(jt,"extractConvParamsFactory",function(){return k}),a.d(jt,"extractFCParamsFactory",function(){return w}),a.d(jt,"extractSeparableConvParamsFactory",function(){return I}),a.d(jt,"loadSeparableConvParamsFactory",function(){return N}),a.d(jt,"extractWeightEntryFactory",function(){return T}),a.d(jt,"extractWeightsFactory",function(){return D}),a.d(jt,"getModelUris",function(){return A}),a.d(jt,"SeparableConvParams",function(){return ya}),a.d(jt,"TinyYolov2",function(){return Sa}),a.d(jt,"TinyYolov2SizeType",function(){return Ca}),a.d(jt,"TinyYolov2Options",function(){return Ra}),a.d(jt,"validateConfig",function(){return Y});var Xt={};a.r(Xt),a.d(Xt,"drawContour",function(){return ne}),a.d(Xt,"drawDetections",function(){return ie}),a.d(Xt,"drawFaceExpressions",function(){return Re}),a.d(Xt,"DrawFaceLandmarksOptions",function(){return Aa}),a.d(Xt,"DrawFaceLandmarks",function(){return Oa}),a.d(Xt,"drawFaceLandmarks",function(){return ke});var Yt=a(115),Qt=a(116),Zt=a(121),Jt=function(){function e(e,t){if(!m(e)||!m(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}(),ea=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Ut(this.x),Ut(this.y))},e.prototype.magnitude=function(){return Vt(Wt(this.x,2)+Wt(this.y,2))},e.prototype.floor=function(){return new e(zt(this.x),zt(this.y))},e}(),ta=function(){function e(t,a){void 0===a&&(a=!0);var o=t||{},n=[o.left,o.top,o.right,o.bottom].every(m),r=[o.x,o.y,o.width,o.height].every(m);if(!r&&!n)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(o));var s=r?[o.x,o.y,o.width,o.height]:[o.left,o.top,o.right-o.left,o.bottom-o.top],i=s[0],p=s[1],d=s[2],l=s[3];e.assertIsValidBox({x:i,y:p,width:d,height:l},"Box.constructor",a),this._x=i,this._y=p,this._width=d,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(m)},e.assertIsValidBox=function(t,a,o){if(void 0===o&&(o=!1),!e.isRect(t))throw new Error(a+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!o&&(0>t.width||0>t.height))throw new Error(a+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new ea(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new ea(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new ea(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new ea(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return Gt(e)}),a=t[0],o=t[1],n=t[2],r=t[3];return new e({x:a,y:o,width:n,height:r})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(e){return zt(e)}),a=t[0],o=t[1],n=t[2],r=t[3];return new e({x:a,y:o,width:n,height:r})},e.prototype.toSquare=function(){var t=this,a=t.x,o=t.y,n=t.width,r=t.height,s=Ut(n-r);return n<r&&(a-=s/2,n+=s),r<n&&(o-=s/2,r+=s),new e({x:a,y:o,width:n,height:r})},e.prototype.rescale=function(t){var a=l(t)?t.width:t,o=l(t)?t.height:t;return new e({x:this.x*a,y:this.y*o,width:this.width*a,height:this.height*o})},e.prototype.pad=function(t,a){var o=[this.x-t/2,this.y-a/2,this.width+t,this.height+a],n=o[0],r=o[1],s=o[2],i=o[3];return new e({x:n,y:r,width:s,height:i})},e.prototype.clipAtImageBorders=function(t,a){var o=this,n=o.x,r=o.y,s=o.right,i=o.bottom,p=qt(n,0),d=qt(r,0),l=$t(s-p,t-p),u=$t(i-d,a-d);return new e({x:p,y:d,width:l,height:u}).floor()},e.prototype.shift=function(t,a){var o=this,n=o.width,r=o.height,s=this.x+t,i=this.y+a;return new e({x:s,y:i,width:n,height:r})},e.prototype.padAtBorders=function(e,t){var a=this.width+1,o=this.height+1,n=a,r=o,s=this.left,i=this.top,p=this.right,d=this.bottom;return p>t&&(n=-p+t+a,p=t),d>e&&(r=-d+e+o,d=e),1>s&&(r=2-s,s=1),1>i&&(r=2-i,i=1),{dy:1,edy:r,dx:1,edx:n,y:i,ey:d,x:s,ex:p,w:a,h:o}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),aa=function(e){function t(t,a,o,n,r){return void 0===r&&(r=!1),e.call(this,{left:t,top:a,right:o,bottom:n},r)||this}return Yt.c(t,e),t}(ta),oa=function(e){function t(t,a){var o=e.call(this,t)||this;return o._label=a,o}return Yt.c(t,e),t.assertIsValidLabeledBox=function(e,t){if(ta.assertIsValidBox(e,t),!m(e.label))throw new Error(t+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(ta),na=function(){function e(e,t,a,o,n){this._imageDims=new Jt(n.width,n.height),this._score=e,this._classScore=t,this._className=a,this._box=new ta(o).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new ta(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,a){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:a})},e}(),ra=function(e){function t(t,a,o,n){var r=e.call(this,t,a)||this;return r._score=o,r._classScore=n,r}return Yt.c(t,e),t.assertIsValidPredictedBox=function(e,t){if(oa.assertIsValidLabeledBox(e,t),!g(e.score)||!g(e.classScore))throw new Error(t+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t}(oa),sa=function(e){function t(t,a,o,n,r){return void 0===r&&(r=!1),e.call(this,{x:t,y:a,width:o,height:n},r)||this}return Yt.c(t,e),t}(ta),ia=a(197),pa=a(283),da=a(284),la={getEnv:x,setEnv:b,initialize:v,createBrowserEnv:f,createFileSystem:ia.a,createNodejsEnv:pa.a,monkeyPatch:C,isBrowser:y,isNodejs:da.a},ua;v();var ca;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(ca||(ca={}));var ha=function(){function e(e){void 0===e&&(e={});var t=e.anchorPosition,a=e.backgroundColor,o=e.fontColor,n=e.fontSize,r=e.fontStyle,s=e.padding;this.anchorPosition=t||ca.TOP_LEFT,this.backgroundColor=a||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=n||14,this.fontStyle=r||"Georgia",this.padding=s||4}return e}(),ma=function(){function e(t,a,o){void 0===o&&(o={}),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=a,this.options=new ha(o)}return e.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(t){return e.measureText(t).width}).reduce(function(e,t){return e<t?t:e},0)+2*t},e.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,a=e.padding;return this.text.length*t+2*a},e.prototype.getUpperLeft=function(e,t){var a=this.options.anchorPosition,o=a===ca.BOTTOM_RIGHT||a===ca.TOP_RIGHT,n=a===ca.BOTTOM_LEFT||a===ca.BOTTOM_RIGHT,r=this.measureWidth(e),s=this.measureHeight(),i=o?this.anchor.x-r:this.anchor.x,p=n?this.anchor.y-s:this.anchor.y;if(t){var d=t.width,l=t.height,u=qt($t(i,d-r),0),c=qt($t(p,l-s),0);return{x:u,y:c}}return{x:i,y:p}},e.prototype.draw=function(e){var t=R(e),a=S(t),o=this.options,n=o.backgroundColor,r=o.fontColor,s=o.fontSize,i=o.fontStyle,p=o.padding;a.font=s+"px "+i;var d=this.measureWidth(a),l=this.measureHeight();a.fillStyle=n;var u=this.getUpperLeft(a,t);a.fillRect(u.x,u.y,d,l),a.fillStyle=r,this.text.forEach(function(e,t){var o=p+u.x,n=p+u.y+(t+1)*s;a.fillText(e,o,n)})},e}(),ga=function(){function e(e){void 0===e&&(e={});var t=e.boxColor,a=e.lineWidth,o=e.label,n=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=a||2,this.label=o;var r={anchorPosition:ca.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new ha(Object.assign({},r,n))}return e}(),fa=function(){function e(e,t){void 0===t&&(t={}),this.box=new ta(e),this.options=new ga(t)}return e.prototype.draw=function(e){var t=S(e),a=this.options,o=a.boxColor,n=a.lineWidth,r=this.box,s=r.x,i=r.y,p=r.width,d=r.height;t.strokeStyle=o,t.lineWidth=n,t.strokeRect(s,i,p,d);var l=this.options.label;l&&new ma([l],{x:s-n/2,y:i},this.options.drawLabelOptions).draw(e)},e}(),ya=function(){return function(e,t,a){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=a}}(),xa=function(){function e(e,t){void 0===t&&(t=!1);var a=this;if(this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(e,t){if(r(e))return a._imageTensors[t]=e,void(a._inputDimensions[t]=e.shape);if(s(e)){var o=e.shape[0];if(1!==o)throw new Error("NetInput - tf.Tensor4D with batchSize "+o+" passed, but not supported in input array");return a._imageTensors[t]=e,void(a._inputDimensions[t]=e.shape.slice(1))}var n=e instanceof la.getEnv().Canvas?e:L(e);a._canvases[t]=n,a._inputDimensions[t]=[n.height,n.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return 1<this.batchSize||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return h(this.batchSize,0,1).map(function(t,a){return e.getReshapedInputDimensions(a)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),a=this.getInputHeight(e);return u({width:t,height:a},this.inputSize)},e.prototype.toBatchTensor=function(e,t){var a=this;return void 0===t&&(t=!0),this._inputSize=e,Zt.w(function(){var o=h(a.batchSize,0,1).map(function(o){var n=a.getInput(o);if(n instanceof Zt.a){var r=s(n)?n:n.expandDims();return r=H(r,t),(r.shape[1]!==e||r.shape[2]!==e)&&(r=Zt.h.resizeBilinear(r,[e,e])),r.as3D(e,e,3)}if(n instanceof la.getEnv().Canvas)return Zt.d.fromPixels(z(n,e,t));throw new Error("toBatchTensor - at batchIdx "+o+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+n)}),n=Zt.q(o.map(function(e){return e.toFloat()})).as4D(a.batchSize,e,e,3);return n})},e}(),ba=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),a=t.obj,o=t.objProp;return a[o]},e.prototype.reassignParamFromPath=function(e,t){var a=this.traversePropertyPath(e),o=a.obj,n=a.objProp;o[n].dispose(),o[n]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var a=t.paramPath;return{path:a,tensor:e.getParamFromPath(a)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Zt.b})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Zt.b)})},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var a=t.path,o=t.tensor;e.reassignParamFromPath(a,o.variable())})},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var a=t.path,o=t.tensor,n=Zt.s(o.dataSync());o.dispose(),e.reassignParamFromPath(a,n)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},e.prototype.load=function(e){return Yt.b(this,void 0,void 0,function(){return Yt.d(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2];}})})},e.prototype.loadFromUri=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,V(e,this.getDefaultModelName())];case 1:return t=a.sent(),this.loadFromWeightMap(t),[2];}})})},e.prototype.loadFromDisk=function(e){return Yt.b(this,void 0,void 0,function(){var t,a,o,n,r,s,i,p,d,l;return Yt.d(this,function(u){switch(u.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=la.getEnv().readFile,a=A(e,this.getDefaultModelName()),o=a.manifestUri,n=a.modelBaseUri,r=function(e){return Promise.all(e.map(function(e){return t(e).then(function(e){return e.buffer})}))},s=Zt.i.weightsLoaderFactory(r),d=(p=JSON).parse,[4,t(o)];case 1:return i=d.apply(p,[u.sent().toString()]),[4,s(i,n)];case 2:return l=u.sent(),this.loadFromWeightMap(l),[2];}})})},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),a=t.paramMappings,o=t.params;this._paramMappings=a,this._params=o},e.prototype.extractWeights=function(e){var t=this.extractParams(e),a=t.paramMappings,o=t.params;this._paramMappings=a,this._params=o},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(t,a){if(!t.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:t.nextObj,objProp:a,nextObj:t.nextObj[a]}},{nextObj:this.params}),a=t.obj,o=t.objProp;if(!a||!o||!(a[o]instanceof Zt.a))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:a,objProp:o}},e}(),va=function(e){return"number"==typeof e},Ca;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(Ca||(Ca={}));var Ra=function(){function e(e){var t=void 0===e?{}:e,a=t.inputSize,o=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=a||416,this._scoreThreshold=o||.5,"number"!=typeof this._inputSize||0!=this._inputSize%32)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||0>=this._scoreThreshold||1<=this._scoreThreshold)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),Sa=function(e){function t(t){var a=e.call(this,"TinyYolov2")||this;return Y(t),a._config=t,a}return Yt.c(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||1<this.config.classes.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var a=Z(e,t.conv0);return a=Zt.j(a,[2,2],[2,2],"same"),a=Z(a,t.conv1),a=Zt.j(a,[2,2],[2,2],"same"),a=Z(a,t.conv2),a=Zt.j(a,[2,2],[2,2],"same"),a=Z(a,t.conv3),a=Zt.j(a,[2,2],[2,2],"same"),a=Z(a,t.conv4),a=Zt.j(a,[2,2],[2,2],"same"),a=Z(a,t.conv5),a=Zt.j(a,[2,2],[1,1],"same"),a=Z(a,t.conv6),a=Z(a,t.conv7),E(a,t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var a=this.config.isFirstLayerConv2d?Q(E(e,t.conv0,"valid",!1)):J(e,t.conv0);return a=Zt.j(a,[2,2],[2,2],"same"),a=J(a,t.conv1),a=Zt.j(a,[2,2],[2,2],"same"),a=J(a,t.conv2),a=Zt.j(a,[2,2],[2,2],"same"),a=J(a,t.conv3),a=Zt.j(a,[2,2],[2,2],"same"),a=J(a,t.conv4),a=Zt.j(a,[2,2],[2,2],"same"),a=J(a,t.conv5),a=Zt.j(a,[2,2],[1,1],"same"),a=t.conv6?J(a,t.conv6):a,a=t.conv7?J(a,t.conv7):a,E(a,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var a=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return Zt.w(function(){var n=e.toBatchTensor(t,!1).toFloat();return n=a.config.meanRgb?j(n,a.config.meanRgb):n,n=n.div(Zt.n(256)),a.config.withSeparableConvs?a.runMobilenet(n,o):a.runTinyYolov2(n,o)})},t.prototype.forward=function(e,t){return Yt.b(this,void 0,void 0,function(){var a;return Yt.d(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,q(e)];case 1:return[4,a.apply(this,[o.sent(),t])];case 2:return[2,o.sent()];}})})},t.prototype.detect=function(e,t){return void 0===t&&(t={}),Yt.b(this,void 0,void 0,function(){var a=this,o,n,r,s,i,p,d,l,u,c,h,m,g,f;return Yt.d(this,function(y){switch(y.label){case 0:return o=new Ra(t),n=o.inputSize,r=o.scoreThreshold,[4,q(e)];case 1:return s=y.sent(),[4,this.forwardInput(s,n)];case 2:return i=y.sent(),p=Zt.w(function(){return Zt.x(i)[0].expandDims()}),d={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(p,s.getReshapedInputDimensions(0),r)];case 3:return l=y.sent(),i.dispose(),p.dispose(),u=l.map(function(e){return e.box}),c=l.map(function(e){return e.score}),h=l.map(function(e){return e.classScore}),m=l.map(function(e){return a.config.classes[e.label]}),g=K(u.map(function(e){return e.rescale(n)}),c,this.config.iouThreshold,!0),f=g.map(function(e){return new na(c[e],h[e],m[e],u[e],d)}),[2,f];}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return oe(e,this.config)},t.prototype.extractParams=function(e){var a=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=a?a.length:void 0;if(7!==o&&8!==o&&9!==o)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return te(e,this.config,this.boxEncodingSize,a)},t.prototype.extractBoxes=function(e,t,a){return Yt.b(this,void 0,void 0,function(){var o=this,n,r,s,i,p,d,l,u,c,h,m,g,f,b,v,C,R,S,E,_,k,w,I,x,y,N,T,D,A;return Yt.d(this,function(O){switch(O.label){case 0:return n=t.width,r=t.height,s=qt(n,r),i=s/n,p=s/r,d=e.shape[1],l=this.config.anchors.length,u=Zt.w(function(){var t=e.reshape([d,d,l,o.boxEncodingSize]),a=t.slice([0,0,0,0],[d,d,l,4]),n=t.slice([0,0,0,4],[d,d,l,1]),r=o.withClassScores?Zt.p(t.slice([0,0,0,5],[d,d,l,o.config.classes.length]),3):Zt.n(0);return[a,n,r]}),c=u[0],h=u[1],m=u[2],g=[],[4,h.array()];case 1:return f=O.sent(),[4,c.array()];case 2:b=O.sent(),v=0,O.label=3;case 3:if(!(v<d))return[3,12];C=0,O.label=4;case 4:if(!(C<d))return[3,11];R=0,O.label=5;case 5:return R<l?(S=X(f[v][C][R][0]),a&&!(S>a))?[3,9]:(E=(C+X(b[v][C][R][0]))/d*i,_=(v+X(b[v][C][R][1]))/d*p,k=Ht(b[v][C][R][2])*this.config.anchors[R].x/d*i,w=Ht(b[v][C][R][3])*this.config.anchors[R].y/d*p,I=E-k/2,x=_-w/2,y={row:v,col:C,anchor:R},this.withClassScores?[4,this.extractPredictedClass(m,y)]:[3,7]):[3,10];case 6:return A=O.sent(),[3,8];case 7:A={classScore:1,label:0},O.label=8;case 8:N=A,T=N.classScore,D=N.label,g.push(Yt.a({box:new aa(I,x,I+k,x+w),score:S,classScore:S*T,label:D},y)),O.label=9;case 9:return R++,[3,5];case 10:return C++,[3,4];case 11:return v++,[3,3];case 12:return c.dispose(),h.dispose(),m.dispose(),[2,g];}})})},t.prototype.extractPredictedClass=function(e,t){return Yt.b(this,void 0,void 0,function(){var a,o,n,r;return Yt.d(this,function(s){switch(s.label){case 0:return a=t.row,o=t.col,n=t.anchor,[4,e.array()];case 1:return r=s.sent(),[2,Array(this.config.classes.length).fill(0).map(function(e,t){return r[a][o][n][t]}).map(function(e,t){return{classScore:e,label:t}}).reduce(function(e,t){return e.classScore>t.classScore?e:t})];}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(ba),Ea=function(e){function t(t,a,o){return e.call(this,t,t,"",a,o)||this}return Yt.c(t,e),t.prototype.forSize=function(a,o){var n=e.prototype.forSize.call(this,a,o),r=n.score,s=n.relativeBox,i=n.imageDims;return new t(r,s,i)},t}(na),_a=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return Yt.c(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Qt.tidy(function(){var a=e.toBatchTensor(112,!0),o=j(a,[122.782,117.001,104.298]).div(Qt.scalar(255)),n=le(o,t.dense0,!0);return n=le(n,t.dense1),n=le(n,t.dense2),n=le(n,t.dense3),n=Qt.avgPool(n,[7,7],[2,2],"valid"),n})},t.prototype.forward=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,q(e)];case 1:return[2,t.apply(this,[a.sent()])];}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return ge(e)},t.prototype.extractParams=function(e){return ce(e)},t}(ba),ka=function(e){function t(t,a){var o=e.call(this,t)||this;return o._faceFeatureExtractor=a,o}return Yt.c(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return Qt.tidy(function(){var o=e instanceof xa?t.faceFeatureExtractor.forwardInput(e):e;return fe(o.as2D(o.shape[0],-1),a.fc)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),a=t.params,o=t.paramMappings;this._params=a,this._paramMappings=o},t.prototype.extractClassifierParams=function(e){return ye(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=be(e),a=t.featureExtractorMap,o=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),xe(o)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),o=a*t+a,n=e.slice(0,e.length-o),r=e.slice(e.length-o);return this.faceFeatureExtractor.extractWeights(n),this.extractClassifierParams(r)},t}(ba),wa=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Ia=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);wa.forEach(function(a,o){t[a]=e[o]})}return e.prototype.asSortedArray=function(){var e=this;return wa.map(function(t){return{expression:t,probability:e[t]}}).sort(function(e,t){return t.probability-e.probability})},e}(),Na=function(e){function t(t){return void 0===t&&(t=new _a),e.call(this,"FaceExpressionNet",t)||this}return Yt.c(t,e),t.prototype.forwardInput=function(e){var t=this;return Qt.tidy(function(){return Qt.softmax(t.runNet(e))})},t.prototype.forward=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,q(e)];case 1:return[2,t.apply(this,[a.sent()])];}})})},t.prototype.predictExpressions=function(e){return Yt.b(this,void 0,void 0,function(){var a=this,t,o,n,r;return Yt.d(this,function(s){switch(s.label){case 0:return[4,q(e)];case 1:return t=s.sent(),[4,this.forwardInput(t)];case 2:return o=s.sent(),[4,Promise.all(Qt.unstack(o).map(function(e){return Yt.b(a,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return[4,e.data()];case 1:return t=a.sent(),e.dispose(),[2,t];}})})}))];case 3:return n=s.sent(),o.dispose(),r=n.map(function(e){return new Ia(e)}),[2,t.isBatchInput?r:r[0]];}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(ka),Ta=function(){function e(e,t,a){void 0===a&&(a=new ea(0,0));var o=t.width,n=t.height;this._imgDims=new Jt(o,n),this._shift=a,this._positions=e.map(function(e){return e.mul(new ea(o,n)).add(a)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new ea(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new ea(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new ea(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var a=e instanceof Ea?e.box.floor():new ta(e);return this.shiftBy(a.x,a.y).align(null,t)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),n=o.useDlibAlignment,r=o.minBoxPadding;return n?this.alignDlib():this.alignMinBbox(r)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],a=e[1],o=e[2],n=function(e){return o.sub(e).magnitude()},r=(n(t)+n(a))/2,s=zt(r/.45),i=c(e),p=zt(qt(0,i.x-.5*s)),d=zt(qt(0,i.y-.43*s));return new sa(p,d,$t(s,this.imageWidth+p),$t(s,this.imageHeight+d))},e.prototype.alignMinBbox=function(e){var t=Se(this.positions);return t.pad(t.width*e,t.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),Da=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(c)},t}(Ta),Aa=function(){return function(e){void 0===e&&(e={});var t=e.drawLines,a=e.drawPoints,o=e.lineWidth,n=e.lineColor,r=e.pointSize,s=e.pointColor;this.drawLines=!(void 0!==t)||t,this.drawPoints=!(void 0!==a)||a,this.lineWidth=o||1,this.pointSize=r||2,this.lineColor=n||"rgba(0, 255, 255, 1)",this.pointColor=s||"rgba(255, 0, 255, 1)"}}(),Oa=function(){function e(e,t){void 0===t&&(t={}),this.faceLandmarks=e,this.options=new Aa(t)}return e.prototype.draw=function(e){var t=S(e),a=this.options,o=a.drawLines,n=a.drawPoints,r=a.lineWidth,s=a.lineColor,i=a.pointSize,p=a.pointColor;if(o&&this.faceLandmarks instanceof Da&&(t.strokeStyle=s,t.lineWidth=r,ne(t,this.faceLandmarks.getJawOutline()),ne(t,this.faceLandmarks.getLeftEyeBrow()),ne(t,this.faceLandmarks.getRightEyeBrow()),ne(t,this.faceLandmarks.getNose()),ne(t,this.faceLandmarks.getLeftEye(),!0),ne(t,this.faceLandmarks.getRightEye(),!0),ne(t,this.faceLandmarks.getMouth(),!0)),n){t.strokeStyle=p,t.fillStyle=p;var d=function(e){t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(d)}},e}(),Pa=function(e){function t(t){var a=e.call(this,"TinyXception")||this;return a._numMainBlocks=t,a}return Yt.c(t,e),t.prototype.forwardInput=function(e){var t=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return Qt.tidy(function(){var o=e.toBatchTensor(112,!0),n=j(o,[122.782,117.001,104.298]).div(Qt.scalar(256)),r=Qt.relu(De(n,a.entry_flow.conv_in,[2,2]));return r=Ae(r,a.entry_flow.reduction_block_0,!1),r=Ae(r,a.entry_flow.reduction_block_1),h(t._numMainBlocks,0,1).forEach(function(e){r=Oe(r,a.middle_flow["main_block_"+e])}),r=Ae(r,a.exit_flow.reduction_block),r=Qt.relu(pe(r,a.exit_flow.separable_conv,[1,1])),r})},t.prototype.forward=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,q(e)];case 1:return[2,t.apply(this,[a.sent()])];}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Te(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return Ie(e,this._numMainBlocks)},t}(ba),Fa;(function(e){e.FEMALE="female",e.MALE="male"})(Fa||(Fa={}));var Ba=function(e){function t(t){void 0===t&&(t=new Pa(2));var a=e.call(this,"AgeGenderNet")||this;return a._faceFeatureExtractor=t,a}return Yt.c(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return Qt.tidy(function(){var o=e instanceof xa?t.faceFeatureExtractor.forwardInput(e):e,n=Qt.avgPool(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),r=fe(n,a.fc.age).as1D(),s=fe(n,a.fc.gender);return{age:r,gender:s}})},t.prototype.forwardInput=function(e){var t=this;return Qt.tidy(function(){var a=t.runNet(e),o=a.age,n=a.gender;return{age:o,gender:Qt.softmax(n)}})},t.prototype.forward=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,q(e)];case 1:return[2,t.apply(this,[a.sent()])];}})})},t.prototype.predictAgeAndGender=function(e){return Yt.b(this,void 0,void 0,function(){var t=this,a,o,n,r,s,i;return Yt.d(this,function(p){switch(p.label){case 0:return[4,q(e)];case 1:return a=p.sent(),[4,this.forwardInput(a)];case 2:return o=p.sent(),n=Qt.unstack(o.age),r=Qt.unstack(o.gender),s=n.map(function(e,t){return{ageTensor:e,genderTensor:r[t]}}),[4,Promise.all(s.map(function(e){var a=e.ageTensor,o=e.genderTensor;return Yt.b(t,void 0,void 0,function(){var e,t,n,r,s;return Yt.d(this,function(i){switch(i.label){case 0:return[4,a.data()];case 1:return e=i.sent()[0],[4,o.data()];case 2:return t=i.sent()[0],n=.5<t,r=n?Fa.MALE:Fa.FEMALE,s=n?t:1-t,a.dispose(),o.dispose(),[2,{age:e,gender:r,genderProbability:s}];}})})}))];case 3:return i=p.sent(),o.age.dispose(),o.gender.dispose(),[2,a.isBatchInput?i:i[0]];}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),a=t.params,o=t.paramMappings;this._params=a,this._paramMappings=o},t.prototype.extractClassifierParams=function(e){return Pe(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=be(e),a=t.featureExtractorMap,o=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),Fe(o)},t.prototype.extractParams=function(e){var t=1539,a=e.slice(0,e.length-t),o=e.slice(e.length-t);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(o)},t}(ba),La=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],c([e[3],e[4]])]},t}(Ta),Ma=function(){function e(e,t){this._label=e,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(e){return void 0===e&&(e=!0),""+this.label+(e?" ("+d(this.distance)+")":"")},e}(),Wa=function(){function e(e,t){if("string"!=typeof e)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(e){return!(e instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e}(),Ua=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.postProcess=function(e,t,a){var o=a.map(function(e){var a=e.width,o=e.height,n=t/qt(o,a);return{width:a*n,height:o*n}}),n=o.length;return Qt.tidy(function(){var a=function(e,t){return Qt.stack([Qt.fill([68],e),Qt.fill([68],t)],1).as2D(1,136).as1D()},r=function(e,t){var a=o[e],n=a.width,r=a.height;return t(n,r)?Ut(n-r)/2:0},s=function(e){return r(e,function(e,t){return e<t})},i=function(e){return r(e,function(e,t){return t<e})},p=e.mul(Qt.fill([n,136],t)).sub(Qt.stack(Array.from(Array(n),function(e,t){return a(s(t),i(t))}))).div(Qt.stack(Array.from(Array(n),function(e,t){return a(o[t].width,o[t].height)})));return p})},t.prototype.forwardInput=function(e){var t=this;return Qt.tidy(function(){var a=t.runNet(e);return t.postProcess(a,e.inputSize,e.inputDimensions.map(function(e){var t=e[0],a=e[1];return{height:t,width:a}}))})},t.prototype.forward=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,q(e)];case 1:return[2,t.apply(this,[a.sent()])];}})})},t.prototype.detectLandmarks=function(e){return Yt.b(this,void 0,void 0,function(){var t=this,a,o,n;return Yt.d(this,function(r){switch(r.label){case 0:return[4,q(e)];case 1:return a=r.sent(),o=Qt.tidy(function(){return Qt.unstack(t.forwardInput(a))}),[4,Promise.all(o.map(function(e,o){return Yt.b(t,void 0,void 0,function(){var t,n,r,s,d;return Yt.d(this,function(i){switch(i.label){case 0:return r=(n=Array).from,[4,e.data()];case 1:return t=r.apply(n,[i.sent()]),s=t.filter(function(e,t){return p(t)}),d=t.filter(function(e,t){return!p(t)}),[2,new Da(Array(68).fill(0).map(function(e,t){return new ea(s[t],d[t])}),{height:a.getInputHeight(o),width:a.getInputWidth(o)})];}})})}))];case 2:return n=r.sent(),o.forEach(function(e){return e.dispose()}),[2,a.isBatchInput?n:n[0]];}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(ka),za=function(e){function t(t){return void 0===t&&(t=new _a),e.call(this,"FaceLandmark68Net",t)||this}return Yt.c(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Ua),Ga=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return Yt.c(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Qt.tidy(function(){var a=e.toBatchTensor(112,!0),o=j(a,[122.782,117.001,104.298]).div(Qt.scalar(255)),n=de(o,t.dense0,!0);return n=de(n,t.dense1),n=de(n,t.dense2),n=Qt.avgPool(n,[14,14],[2,2],"valid"),n})},t.prototype.forward=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,q(e)];case 1:return[2,t.apply(this,[a.sent()])];}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Me(e)},t.prototype.extractParams=function(e){return We(e)},t}(ba),Va=function(e){function t(t){return void 0===t&&(t=new Ga),e.call(this,"FaceLandmark68TinyNet",t)||this}return Yt.c(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Ua),Ha=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t}(za),qa=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return Yt.c(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Qt.tidy(function(){var a=e.toBatchTensor(150,!0).toFloat(),o=j(a,[122.782,117.001,104.298]).div(Qt.scalar(256)),n=He(o,t.conv32_down);n=Qt.maxPool(n,3,2,"valid"),n=Xe(n,t.conv32_1),n=Xe(n,t.conv32_2),n=Xe(n,t.conv32_3),n=Ye(n,t.conv64_down),n=Xe(n,t.conv64_1),n=Xe(n,t.conv64_2),n=Xe(n,t.conv64_3),n=Ye(n,t.conv128_down),n=Xe(n,t.conv128_1),n=Xe(n,t.conv128_2),n=Ye(n,t.conv256_down),n=Xe(n,t.conv256_1),n=Xe(n,t.conv256_2),n=Ye(n,t.conv256_down_out);var r=n.mean([1,2]),s=Qt.matMul(r,t.fc);return s})},t.prototype.forward=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,q(e)];case 1:return[2,t.apply(this,[a.sent()])];}})})},t.prototype.computeFaceDescriptor=function(e){return Yt.b(this,void 0,void 0,function(){var t=this,a,o,n;return Yt.d(this,function(r){switch(r.label){case 0:return[4,q(e)];case 1:return a=r.sent(),o=Qt.tidy(function(){return Qt.unstack(t.forwardInput(a))}),[4,Promise.all(o.map(function(e){return e.data()}))];case 2:return n=r.sent(),o.forEach(function(e){return e.dispose()}),[2,a.isBatchInput?n:n[0]];}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return je(e)},t.prototype.extractParams=function(e){return $e(e)},t}(ba),$a=function(){function e(e){var t=void 0===e?{}:e,a=t.minFaceSize,o=t.scaleFactor,n=t.maxNumScales,r=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=a||20,this._scaleFactor=o||.709,this._maxNumScales=n||10,this._scoreThresholds=r||[.6,.7,.7],this._scaleSteps=s,"number"!=typeof this._minFaceSize||0>this._minFaceSize)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||0>=this._scaleFactor||1<=this._scaleFactor)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||0>this._maxNumScales)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(e){return"number"!=typeof e}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(e){return"number"!=typeof e})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}(),Ka=.0010000000474974513,ja=function(){function e(e){var t=void 0===e?{}:e,a=t.minConfidence,o=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=a||.5,this._maxResults=o||100,"number"!=typeof this._minConfidence||0>=this._minConfidence||1<=this._minConfidence)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),Xa=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return Yt.c(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Qt.tidy(function(){var a=e.toBatchTensor(512,!1).toFloat(),o=Qt.sub(Qt.mul(a,Qt.scalar(.007843137718737125)),Qt.scalar(1)),n=rt(o,t.mobilenetv1),r=ct(n.out,n.conv11,t.prediction_layer),s=r.boxPredictions,i=r.classPredictions;return lt(s,i,t.output_layer)})},t.prototype.forward=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=this.forwardInput,[4,q(e)];case 1:return[2,t.apply(this,[a.sent()])];}})})},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),Yt.b(this,void 0,void 0,function(){var a,o,n,r,s,p,d,l,u,c,i,h,m,g,f,y,x,b,v,C,R;return Yt.d(this,function(S){switch(S.label){case 0:return a=new ja(t),o=a.maxResults,n=a.minConfidence,[4,q(e)];case 1:for(r=S.sent(),s=this.forwardInput(r),p=s.boxes,d=s.scores,l=p[0],u=d[0],c=1;c<p.length;c++)p[c].dispose(),d[c].dispose();return m=(h=Array).from,[4,u.data()];case 2:return i=m.apply(h,[S.sent()]),g=.5,f=st(l,i,o,g,n),y=r.getReshapedInputDimensions(0),x=r.inputSize,b=x/y.width,v=x/y.height,C=l.arraySync(),R=f.map(function(e){var t=[qt(0,C[e][0]),$t(1,C[e][2])].map(function(e){return e*v}),a=t[0],o=t[1],n=[qt(0,C[e][1]),$t(1,C[e][3])].map(function(e){return e*b}),s=n[0],p=n[1];return new Ea(i[e],new sa(s,a,p-s,o-a),{height:r.getInputHeight(0),width:r.getInputWidth(0)})}),l.dispose(),u.dispose(),[2,R];}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return tt(e)},t.prototype.extractParams=function(e){return Je(e)},t}(ba),Ya=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t}(Xa),Qa=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return Yt.c(t,e),t}(jt.TinyYolov2Options),Za=function(){function e(){}return e.prototype.then=function(e){return Yt.b(this,void 0,void 0,function(){var t;return Yt.d(this,function(a){switch(a.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[a.sent()])];}})})},e.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){return Yt.d(this,function(){throw new Error("ComposableTask - run is not implemented")})})},e}(),Ja=2,eo=12,to=function(e){function t(t,a,o,n){return e.call(this,{left:t,top:a,right:o,bottom:n},!0)||this}return Yt.c(t,e),t}(ta),ao=function(e){function t(){return e.call(this,"Mtcnn")||this}return Yt.c(t,e),t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),Yt.b(this,void 0,void 0,function(){var a,o,n,r,s,i,p,d,l,u,c,h,m,g,f,y,x,b,v,C,R;return Yt.d(this,function(S){switch(S.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(o=e.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return n={},r=Date.now(),s=Qt.tidy(function(){return gt(Qt.expandDims(Qt.browser.fromPixels(o)).toFloat())}),i=function(e){return s.dispose(),n.total=Date.now()-r,e},p=s.shape.slice(1),d=p[0],l=p[1],u=new $a(t),c=u.minFaceSize,h=u.scaleFactor,m=u.maxNumScales,g=u.scoreThresholds,f=u.scaleSteps,y=(f||Ct(c,h,[d,l])).filter(function(e){var t=vt(e,[d,l]);return $t(t.width,t.height)>eo}).slice(0,m),n.scales=y,n.pyramid=y.map(function(e){return vt(e,[d,l])}),x=Date.now(),[4,It(s,y,g[0],a.pnet,n)];case 1:return(b=S.sent(),n.total_stage1=Date.now()-x,!b.boxes.length)?[2,i({results:[],stats:n})]:(n.stage2_numInputBoxes=b.boxes.length,x=Date.now(),[4,Dt(o,b.boxes,g[1],a.rnet,n)]);case 2:return(v=S.sent(),n.total_stage2=Date.now()-x,!v.boxes.length)?[2,i({results:[],stats:n})]:(n.stage3_numInputBoxes=v.boxes.length,x=Date.now(),[4,Ot(o,v.boxes,g[2],a.onet,n)]);case 3:return C=S.sent(),n.total_stage3=Date.now()-x,R=C.boxes.map(function(e,t){return _e(se({},new Ea(C.scores[t],new sa(e.left/l,e.top/d,e.width/l,e.height/d),{height:d,width:l})),new La(C.points[t].map(function(t){return t.sub(new ea(e.left,e.top)).div(new ea(e.width,e.height))}),{width:e.width,height:e.height}))}),[2,i({results:R,stats:n})];}})})},t.prototype.forward=function(e,t){return void 0===t&&(t={}),Yt.b(this,void 0,void 0,function(){var a;return Yt.d(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,q(e)];case 1:return[4,a.apply(this,[o.sent(),t])];case 2:return[2,o.sent().results];}})})},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),Yt.b(this,void 0,void 0,function(){var a;return Yt.d(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,q(e)];case 1:return[2,a.apply(this,[o.sent(),t])];}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return bt(e)},t.prototype.extractParams=function(e){return yt(e)},t}(ba),oo=[new ea(1.603231,2.094468),new ea(6.041143,7.080126),new ea(2.882459,3.518061),new ea(4.266906,5.178857),new ea(9.041765,10.66308)],no=[117.001,114.697,97.404],ro=function(e){function t(){var t=this;return t=e.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:oo,meanRgb:no,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this,t}return Yt.c(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Yt.b(this,void 0,void 0,function(){var a;return Yt.d(this,function(o){switch(o.label){case 0:return[4,this.detect(e,t)];case 1:return a=o.sent(),[2,a.map(function(e){return new Ea(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})];}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(jt.TinyYolov2),so=[new ea(.738768,.874946),new ea(2.42204,2.65704),new ea(4.30971,7.04493),new ea(10.246,4.59428),new ea(12.6868,11.8741)],io=[new ea(1.603231,2.094468),new ea(6.041143,7.080126),new ea(2.882459,3.518061),new ea(4.266906,5.178857),new ea(9.041765,10.66308)],po=[117.001,114.697,97.404],lo=function(e){function t(t){void 0===t&&(t=!0);var a=this,o=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:io,meanRgb:po}:{anchors:so,withClassScores:!0});return a=e.call(this,o)||this,a}return Yt.c(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Yt.b(this,void 0,void 0,function(){var a;return Yt.d(this,function(o){switch(o.label){case 0:return[4,this.detect(e,t)];case 1:return a=o.sent(),[2,a.map(function(e){return new Ea(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})];}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(jt.TinyYolov2),uo={ssdMobilenetv1:new Xa,tinyFaceDetector:new ro,tinyYolov2:new lo,mtcnn:new ao,faceLandmark68Net:new za,faceLandmark68TinyNet:new Va,faceRecognitionNet:new qa,faceExpressionNet:new Na,ageGenderNet:new Ba},co=function(e){return uo.faceLandmark68TinyNet.load(e)},ho=function(e){return uo.faceExpressionNet.load(e)},mo=function(e){function t(t,a,o){var n=e.call(this)||this;return n.parentTask=t,n.input=a,n.extractedFaces=o,n}return Yt.c(t,e),t}(Za),go=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e=this,t,a;return Yt.d(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,ht(t,this.input,function(t){return Yt.b(e,void 0,void 0,function(){return Yt.d(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(e){return uo.faceExpressionNet.predictExpressions(e)}))];case 1:return[2,e.sent()];}})})},this.extractedFaces)];case 2:return a=o.sent(),[2,t.map(function(e,t){return Ce(e,a[t])})];}})})},t.prototype.withAgeAndGender=function(){return new vo(this,this.input)},t}(mo),fo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e,t;return Yt.d(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,mt(e,this.input,function(e){return uo.faceExpressionNet.predictExpressions(e)},this.extractedFaces)]:[2];case 2:return t=a.sent(),[2,Ce(e,t)];}})})},t.prototype.withAgeAndGender=function(){return new Co(this,this.input)},t}(mo),yo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.withAgeAndGender=function(){return new Ro(this,this.input)},t.prototype.withFaceDescriptors=function(){return new _o(this,this.input)},t}(go),xo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.withAgeAndGender=function(){return new So(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ko(this,this.input)},t}(fo),bo=function(e){function t(t,a,o){var n=e.call(this)||this;return n.parentTask=t,n.input=a,n.extractedFaces=o,n}return Yt.c(t,e),t}(Za),vo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e=this,t,a;return Yt.d(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,ht(t,this.input,function(t){return Yt.b(e,void 0,void 0,function(){return Yt.d(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(e){return uo.ageGenderNet.predictAgeAndGender(e)}))];case 1:return[2,e.sent()];}})})},this.extractedFaces)];case 2:return a=o.sent(),[2,t.map(function(e,t){var o=a[t],n=o.age,r=o.gender,s=o.genderProbability;return Pt(Ft(e,r,s),n)})];}})})},t.prototype.withFaceExpressions=function(){return new go(this,this.input)},t}(bo),Co=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e,t,a,o,n;return Yt.d(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return e=r.sent(),e?[4,mt(e,this.input,function(e){return uo.ageGenderNet.predictAgeAndGender(e)},this.extractedFaces)]:[2];case 2:return t=r.sent(),a=t.age,o=t.gender,n=t.genderProbability,[2,Pt(Ft(e,o,n),a)];}})})},t.prototype.withFaceExpressions=function(){return new fo(this,this.input)},t}(bo),Ro=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.withFaceExpressions=function(){return new yo(this,this.input)},t.prototype.withFaceDescriptors=function(){return new _o(this,this.input)},t}(vo),So=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.withFaceExpressions=function(){return new xo(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ko(this,this.input)},t}(Co),Eo=function(e){function t(t,a){var o=e.call(this)||this;return o.parentTask=t,o.input=a,o}return Yt.c(t,e),t}(Za),_o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e,t;return Yt.d(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,ht(e,this.input,function(e){return Promise.all(e.map(function(e){return uo.faceRecognitionNet.computeFaceDescriptor(e)}))},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return t=a.sent(),[2,t.map(function(t,a){return Qe(e[a],t)})];}})})},t.prototype.withFaceExpressions=function(){return new yo(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ro(this,this.input)},t}(Eo),ko=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e,t;return Yt.d(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,mt(e,this.input,function(e){return uo.faceRecognitionNet.computeFaceDescriptor(e)},null,function(e){return e.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return t=a.sent(),[2,Qe(e,t)];}})})},t.prototype.withFaceExpressions=function(){return new xo(this,this.input)},t.prototype.withAgeAndGender=function(){return new So(this,this.input)},t}(Eo),wo=function(e){function t(t,a,o){var n=e.call(this)||this;return n.parentTask=t,n.input=a,n.useTinyLandmarkNet=o,n}return Yt.c(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?uo.faceLandmark68TinyNet:uo.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Za),Io=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e=this,t,a,o,n,r;return Yt.d(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),a=t.map(function(e){return e.detection}),this.input instanceof Qt.Tensor?[4,Le(this.input,a)]:[3,3];case 2:return n=s.sent(),[3,5];case 3:return[4,Be(this.input,a)];case 4:n=s.sent(),s.label=5;case 5:return o=n,[4,Promise.all(o.map(function(t){return e.landmarkNet.detectLandmarks(t)}))];case 6:return r=s.sent(),o.forEach(function(e){return e instanceof Qt.Tensor&&e.dispose()}),[2,t.map(function(e,t){return _e(e,r[t])})];}})})},t.prototype.withFaceExpressions=function(){return new yo(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ro(this,this.input)},t.prototype.withFaceDescriptors=function(){return new _o(this,this.input)},t}(wo),No=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e,t,a,o,n;return Yt.d(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return(e=r.sent(),!e)?[2]:(t=e.detection,this.input instanceof Qt.Tensor?[4,Le(this.input,[t])]:[3,3]);case 2:return o=r.sent(),[3,5];case 3:return[4,Be(this.input,[t])];case 4:o=r.sent(),r.label=5;case 5:return a=o,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return n=r.sent(),a.forEach(function(e){return e instanceof Qt.Tensor&&e.dispose()}),[2,_e(e,n)];}})})},t.prototype.withFaceExpressions=function(){return new xo(this,this.input)},t.prototype.withAgeAndGender=function(){return new So(this,this.input)},t.prototype.withFaceDescriptor=function(){return new ko(this,this.input)},t}(wo),To=function(e){function t(t,a){void 0===a&&(a=new ja);var o=e.call(this)||this;return o.input=t,o.options=a,o}return Yt.c(t,e),t}(Za),Do=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e,t,a,o;return Yt.d(this,function(n){switch(n.label){case 0:return e=this,t=e.input,a=e.options,a instanceof $a?[4,uo.mtcnn.forward(t,a)]:[3,2];case 1:return[2,n.sent().map(function(e){return e.detection})];case 2:if(o=a instanceof Qa?function(e){return uo.tinyFaceDetector.locateFaces(e,a)}:a instanceof ja?function(e){return uo.ssdMobilenetv1.locateFaces(e,a)}:a instanceof jt.TinyYolov2Options?function(e){return uo.tinyYolov2.locateFaces(e,a)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(t)];}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(t){return Yt.b(e,void 0,void 0,function(){var e;return Yt.d(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return e=a.sent(),[2,t(e.map(function(e){return se({},e)}))];}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new Io(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new go(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new vo(this.runAndExtendWithFaceDetections(),this.input)},t}(To),Ao=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Yt.c(t,e),t.prototype.run=function(){return Yt.b(this,void 0,void 0,function(){var e,t;return Yt.d(this,function(a){switch(a.label){case 0:return[4,new Do(this.input,this.options)];case 1:return e=a.sent(),t=e[0],e.forEach(function(e){e.score>t.score&&(t=e)}),[2,t];}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(t){return Yt.b(e,void 0,void 0,function(){var e;return Yt.d(this,function(a){switch(a.label){case 0:return[4,this.run()];case 1:return e=a.sent(),[2,t(e?se({},e):void 0)];}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new No(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new fo(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Co(this.runAndExtendWithFaceDetection(),this.input)},t}(To),Oo=function(){function e(e,t){void 0===t&&(t=.6),this._distanceThreshold=t;var a=Array.isArray(e)?e:[e];if(!a.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,n=function(){return"person "+o++};this._labeledDescriptors=a.map(function(e){if(e instanceof Wa)return e;if(e instanceof Float32Array)return new Wa(n(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new Wa(n(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(e,t){return t.map(function(t){return Mt(t,e)}).reduce(function(e,t){return e+t},0)/(t.length||1)},e.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(a){var o=a.descriptors,n=a.label;return new Ma(n,t.computeMeanDistance(e,o))}).reduce(function(e,t){return e.distance<t.distance?e:t})},e.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new Ma("unknown",t.distance)},e}(),Po=Yt.a({},Kt,Xt)}}]);